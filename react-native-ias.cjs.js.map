{"version":3,"file":"react-native-ias.cjs.js","sources":["react-native-ias/../../node_modules/effector/effector.mjs","react-native-ias/../helpers/isArray.ts","react-native-ias/../helpers/isObject.ts","react-native-ias/../../node_modules/uuid/dist/esm-browser/rng.js","react-native-ias/../../node_modules/uuid/dist/esm-browser/validate.js","react-native-ias/../../node_modules/uuid/dist/esm-browser/v4.js","react-native-ias/../../node_modules/uuid/dist/esm-browser/stringify.js","react-native-ias/../helpers/isNil.ts","react-native-ias/../helpers/mergeObjects.ts","react-native-ias/../helpers/trimStartSlash.ts","react-native-ias/../story-manager/models/session/init.ts","react-native-ias/../helpers/isEmpty.ts","react-native-ias/../story-manager/models/story/init.ts","react-native-ias/../story-manager/models/storyContext/init.ts","react-native-ias/../stories_widget/util/string.ts","react-native-ias/../helpers/isFunction.ts","react-native-ias/../helpers/isString.ts","react-native-ias/../widget/utils.ts","react-native-ias/../rpc/remoteFX/server.ts","react-native-ias/../rpc/remoteFX/duplex.ts","react-native-ias/../rn-sdk/StoryReader.tsx","react-native-ias/../story-manager/common.h.ts","react-native-ias/../story-manager/models/storyManagerConfig/index.ts","react-native-ias/../story-manager/types/storyManager/storyManager.ts","react-native-ias/../story-manager/models/placeholder/index.ts","react-native-ias/../helpers/utility.ts","react-native-ias/../../node_modules/uuid/dist/esm-browser/regex.js","react-native-ias/../story-manager/api/index.ts","react-native-ias/../story-manager/models/session/index.ts","react-native-ias/../story-manager/types/index.ts","react-native-ias/../story-manager/models/story/index.ts","react-native-ias/../story-manager/models/storyContext/index.ts","react-native-ias/../story-manager/models/init.ts","react-native-ias/../story-manager/sharePage.h.ts","react-native-ias/../story-manager/index.ts","react-native-ias/../helpers/trimEndSlash.ts","react-native-ias/../helpers/isNumber.ts","react-native-ias/../helpers/uniq.ts","react-native-ias/../widget/index.ts","react-native-ias/../helpers/media.ts","react-native-ias/../widget/md5.js","react-native-ias/../widget-stories-list/rpc.ts","react-native-ias/../rpc/index.h.ts","react-native-ias/../rpc/WebViewWorkerServer.ts","react-native-ias/../widget-stories-list/rn.ts","react-native-ias/../widget-story-reader/index.h.ts","react-native-ias/../story-manager/appearanceCommon.h.ts","react-native-ias/../widget-story-reader/rpc.ts","react-native-ias/../widget-stories-list/index.h.ts","react-native-ias/../widget-story-reader/rn.ts","react-native-ias/../story-manager/types/storyManager/storyReader.ts","react-native-ias/../story-manager/types/storyManager/storyFavoriteReader.ts","react-native-ias/../story-manager/types/storyManager/goodsWidget.ts","react-native-ias/../helpers/useBeforeFirstRender.ts","react-native-ias/../../node_modules/effector-react/effector-react.mjs","react-native-ias/../helpers/useIas.ts","react-native-ias/../story-manager/AppearanceManager.ts","react-native-ias/../rn-sdk/StoriesList.tsx","react-native-ias/../rn-sdk/StoryManager.ts"],"sourcesContent":["function e(e,t,r,a){(V(e)||J(e))&&('family'in e||'graphite'in e)||B(`${t}: expect ${r} to be a unit (store, event or effect)${a}`)}function t(t,r,a){if(Array.isArray(t))for(let n=0;n<t.length;n++)e(t[n],r,`${n} item of ${a}`,'');else e(t,r,a,' or array of units')}function r(e,t){let r=ge(e).meta;Ce={parent:Ce,value:e,template:r.template||je(),sidRoot:r.sidRoot||Ce&&Ce.sidRoot};try{return t()}finally{Ce=xe(Ce)}}function a({node:e=[],from:t,source:r,parent:a=t||r,to:n,target:o,child:s=n||o,scope:l={},meta:i={},family:f={type:'regular'},regional:c}={}){let u=Fe(a),p=Fe(f.links),d=Fe(f.owners),m=[],h={};for(let t=0;t<e.length;t++){let r=e[t];r&&(m.push(r),Re(r,h))}let g={id:Y(),seq:m,next:Fe(s),meta:i,scope:l,family:{type:f.type||\"crosslink\",links:p,owners:d},reg:h};for(let e=0;e<p.length;e++)ye(p[e]).push(g);for(let e=0;e<d.length;e++)ke(d[e]).push(g);for(let e=0;e<u.length;e++)u[e].next.push(g);return c&&Ce&&Ae(Se(Ce),[g]),g}function n(e,t,r){let a=Be,n=null,o=He;if(e.target&&(t=e.params,r=e.defer,a='page'in e?e.page:a,e.stack&&(n=e.stack),o=Ne(e)||o,e=e.target),o&&He&&o!==He&&(He=null),Array.isArray(e))for(let r=0;r<e.length;r++)Ee('pure',a,ge(e[r]),n,t[r],o);else Ee('pure',a,ge(e),n,t,o);if(r&&!Ge)return;let s,l,i,f,c,u,p={isRoot:Ge,currentPage:Be,forkPage:He,isWatch:Ue};Ge=0;e:for(;f=$e();){let{idx:e,stack:t,type:r}=f;i=t.node,Be=c=t.page,He=Ne(t),u=(c||i).reg;let a={fail:0,scope:i.scope};s=l=0;for(let n=e;n<i.seq.length&&!s;n++){let o=i.seq[n],f=o.data;switch(o.type){case\"barrier\":{let a=f.barrierID;c&&(a=`${c.fullID}_${a}`);let o=f.priority;if(n!==e||r!==o){Te.has(a)||(Te.add(a),ze(n,t,o,a));continue e}Te.delete(a);break}case'mov':{let e;switch(f.from){case\"stack\":e=Se(t);break;case\"a\":case'b':e=t[f.from];break;case\"value\":e=f.store;break;case I:u[f.store.id]||(t.page=c=Ke(c,f.store.id),u=c?c.reg:i.reg),e=pe(u[f.store.id])}switch(f.to){case\"stack\":t.value=e;break;case\"a\":case'b':t[f.to]=e;break;case I:Le(c,i,f.target.id).current=e}break}case'check':switch(f.type){case'defined':l=void 0===Se(t);break;case'changed':l=Se(t)===pe(Le(c,i,f.store.id))}break;case\"filter\":l=!Qe(a,f,t);break;case'run':if(n!==e||\"effect\"!==r){ze(n,t,\"effect\");continue e}case'compute':Ue='watch'===i.meta.op,t.value=Qe(a,f,t),Ue=p.isWatch}s=a.fail||l}if(!s)for(let e=0;e<i.next.length;e++)Ee('child',c,i.next[e],t,Se(t),Ne(t))}Ge=p.isRoot,Be=p.currentPage,He=Ne(p)}function o(e,t=\"combine\"){let r=t+'(',a='',n=0;for(let t in e){let o=e[t];if(null!=o&&(r+=a,r+=E(o)?o.compositeName.fullName:o.toString()),n+=1,25===n)break;a=', '}return r+=')',r}function s(e,t){let r=l(t,xe(e));if(e.shortName=t,!e.compositeName)return void(e.compositeName=r);let a=e.compositeName;a.path=r.path,a.shortName=r.shortName,a.fullName=r.fullName}function l(e,t){let r,a,n,o=e;return t?(n=t.compositeName,0===e.length?(r=n.path,a=n.fullName):(r=n.path.concat([e]),a=0===n.fullName.length?e:n.fullName+'/'+e)):(r=0===e.length?[]:[e],a=e),{shortName:o,fullName:a,path:r}}function i(e,t){for(let r in e)t(e[r],r)}function f(e,t){e.forEach(t)}function c(e,t){let r=(e,...t)=>Be?((e,t,r,a)=>{let n=Be,o=null;if(t)for(o=Be;o&&o.template!==t;)o=xe(o);Je(o);let s=e.create(r,a);return Je(n),s})(r,o,e,t):r.create(e,t);r.graphite=a({meta:ht(\"event\",r,t,e),regional:1}),r.create=e=>(n(He?He.find(r):r,e),e),r.watch=Z(ut,r),r.map=e=>{let t,a;V(e)&&(t=e,a=e.name,e=e.fn);let n=c(Ye(r,a),t);return yt(r,n,$,e),n},r.filter=e=>kt(r,\"filter\",e.fn?e:e.fn,[le({fn:he})]),r.filterMap=e=>kt(r,'filterMap',e,[se({fn:he}),oe.defined()]),r.prepend=e=>{let t=c('* → '+r.shortName,{parent:xe(r)}),a=je();return a&&ge(t).seq.push(a.upward),yt(t,r,'prepend',e),mt(r,t),t};let o=je();return r}function u(e,r){function o(e,t){p.off(e),qe(p).set(e,lt(bt(e,p,'on',1,t,m)))}let s=ue(e),l=ue(e),i=gt('updates'),f=je();s.after=[{type:'copy',to:l}],f&&f.plain.push(s,l);let c=s.id,p={subscribers:new Map,updates:i,defaultState:e,stateRef:s,getState(){let e,t=s;if(Be){let t=Be;for(;t&&!t.reg[c];)t=xe(t);t&&(e=t)}return!e&&He&&He.reg[c]&&(e=He),e&&(t=e.reg[c]),pe(t)},setState(e){let t;He&&(t=He.nodeMap[ge(p).id]),t||(t=p),n({target:t,params:e,defer:1})},reset(...e){for(let t of e)p.on(t,(()=>p.defaultState));return p},on(e,r){if(t(e,'.on','first argument'),Array.isArray(e))for(let t of e)o(t,r);else o(e,r);return p},off(e){let t=qe(p).get(e);return t&&(t(),qe(p).delete(e)),p},map(e,t){let r,a,n;V(e)&&(r=e,a=e.name,t=e.firstState,e=e.fn);let o=p.getState(),l=je();l?n=null:void 0!==o&&(n=e(o,t));let i=u(n,{name:Ye(p,a),config:r,strict:0}),f=bt(p,i,$,0,e);return be(i).before=[{type:$,fn:e,from:s}],l&&(tt(l.plain,s)||tt(f.seq,l.loader)||f.seq.unshift(l.loader)),i},watch(e,t){if(!t||!E(e)){let t=ut(p,e),r=je();return r?r.watch.push({of:s,fn:e}):e(p.getState()),t}return J(t)||B('second argument should be a function'),e.watch((e=>t(p.getState(),e)))}},d=ht(I,p,r),m=p.defaultConfig.updateFilter;return p.graphite=a({scope:{state:s},node:[oe.defined(),oe.changed({store:l}),m&&ne({store:l,to:\"a\"}),m&&le({fn:(e,t,{a:r})=>m(e,r)}),fe({store:s}),fe({store:l})],child:i,meta:d,regional:1}),dt&&void 0===e&&B(\"current state can't be undefined, use null instead\"),Ae(p,[i]),p}function p(...e){let t,r,a;Ze(e[0],((t,r)=>{a=t,e=r}));let n,o,s=e[e.length-1];if(J(s)?(r=e.slice(0,-1),t=s):r=e,1===r.length){let e=r[0];W(e)||(n=e,o=1)}return o||(n=r,t&&(t=vt(t))),V(n)||B('shape should be an object'),wt(Array.isArray(n),n,a,t)}function d(){let e={};return e.req=new Promise(((t,r)=>{e.rs=t,e.rj=r})),e.req.catch((()=>{})),e}function m(e,t){let r=c(e,t),o=r.defaultConfig.handler||(()=>B(`no handler used in ${r.getType()}`)),s=ge(r);s.meta.onCopy=['runner'],s.meta.unit=r.kind=\"effect\",r.use=e=>(J(e)||B('.use argument should be a function'),o=e,r);let l=r.finally=gt('finally'),i=r.done=l.filterMap({named:'done',fn({status:e,params:t,result:r}){if('done'===e)return{params:t,result:r}}}),f=r.fail=l.filterMap({named:'fail',fn({status:e,params:t,error:r}){if('fail'===e)return{params:t,error:r}}}),p=r.doneData=i.map({named:'doneData',fn:({result:e})=>e}),m=r.failData=f.map({named:'failData',fn:({error:e})=>e}),h=a({scope:{getHandler:r.use.getCurrent=()=>o,finally:l},node:[ie({fn({params:e,req:t},{finally:r,getHandler:a},n){let o,s=St({params:e,req:t,ok:1,anyway:r,stack:n}),l=St({params:e,req:t,ok:0,anyway:r,stack:n});try{o=a()(e)}catch(e){return void l(e)}V(o)&&J(o.then)?o.then(s,l):s(o)}})],meta:{op:'fx',fx:'runner',onCopy:['finally']}});s.scope.runner=h,s.seq.push(se({fn:(e,t,r)=>xe(r)?{params:e,req:{rs(e){},rj(e){}}}:e}),ie({fn:(e,{runner:t},r)=>(n({target:t,params:e,defer:1,forkPage:Ne(r)}),e.params)})),r.create=e=>{let t=d(),a={params:e,req:t};if(He){if(!Ue){let e=He;t.req.finally((()=>{Ve(e)})).catch((()=>{}))}n(He.find(r),a)}else n(r,a);return t.req};let g=r.inFlight=u(0,{named:'inFlight'}).on(r,(e=>e+1)).on(l,(e=>e-1)),y=r.pending=g.map({fn:e=>e>0,named:'pending'});return Ae(r,[l,i,f,p,m,y,g,h]),r}function h(e){let t;Ze(e,((r,a)=>{t=r,e=a}));let{source:r,effect:a,mapParams:o}=e;o||(o=r?(e,t)=>t:e=>e);let s,l=m(e,t),{runner:i}=ge(l).scope,f=({params:e,req:t},{finally:r,effect:a},s)=>{let l,i=St({params:e,req:t,ok:0,anyway:r,stack:s});try{l=o(e,s.a)}catch(e){return i(e)}n({target:a,params:{params:l,req:{rs:St({params:e,req:t,ok:1,anyway:r,stack:s}),rj:i}},page:s.page,defer:1})};if(r){let e;W(r)?(e=r,Ae(r,[l])):(e=p(r),Ae(l,[e]));let t=ne({from:I,store:be(e),to:\"a\"});s=[ie({fn:e=>e}),t,se({fn:f})],Re(t,i.reg)}else s=[ie({fn:f})];return Ae(a,[l]),i.scope.effect=a,i.meta.onCopy.push(\"effect\"),i.seq.splice(0,1,...s),mt(a,l,\"effect\"),l}function g(...e){let[[t,r],a]=et(e),n={};return i(r,((e,r)=>{let o=n[r]=c(r,{parent:xe(t),config:a});t.on(o,e),mt(t,o)})),n}function y(e,t){let r=new Set,n=new Set,o=new Set,s=new Set,l=a({family:{type:\"domain\"},regional:1}),f={history:{domains:r,stores:n,effects:o,events:s},graphite:l};l.meta=ht(\"domain\",f,t,e);let[p,d,h,g]=['onEvent','onEffect','onStore','onDomain'].map(gt);f.hooks={event:p,effect:d,store:h,domain:g},f.onCreateEvent=xt(p,s,f),f.onCreateEffect=xt(d,o,f),f.onCreateStore=xt(h,n,f),f.onCreateDomain=xt(g,r,f),f.createEvent=f.event=(e,t)=>p(c(e,{parent:f,config:t})),f.createEffect=f.effect=(e,t)=>d(m(e,{parent:f,config:t})),f.createDomain=f.domain=(e,t)=>y({name:e,parent:f,config:t}),f.createStore=f.store=(e,t)=>h(u(e,{parent:f,config:t}));let k=xe(f);return k&&(i(f.hooks,((e,t)=>{ct({from:e,to:k.hooks[t]})})),k.hooks.domain(f)),f}function k(e){K(e);let t=_ in e?e[_]():e;t.subscribe||B('expect observable to have .subscribe');let r=c(),a=ee(st,r,void 0);return t.subscribe({next:r,error:a,complete:a}),r}function b(e,r){let a=c(r||o(e,'merge'));return t(e,'merge','first argument'),ct({from:e,to:a,meta:{op:'merge'}}),a}function v(...e){let r,n,o,s,[[l,i,d],m]=et(e);void 0===i&&V(l)&&(e=>{let t=0;return f(Nt,(r=>{r in e&&(null==e[r]&&B(`sample: ${r} should be defined`),t=1)})),t})(l)&&(i=l.clock,d=l.fn,s=l.greedy,r=l.target,n=l.name,o=l.sid,l=l.source);let h=1;void 0===l&&(t(i,'sample','clock'),Array.isArray(i)&&(i=b(i)),l=i,h=0),h&&!E(l)&&(l=p(l)),void 0===i&&(i=l),t(i,'sample','clock'),n=m||n||l.shortName;let g=je(),y=!!r;r||(W(l)&&W(i)?r=u(d?d(pe(be(l)),pe(be(i))):pe(be(l)),{name:n,sid:o}):(r=c(n),g&&ge(r).seq.push(g.loader)));let k=y&&E(r)&&ge(r).meta.nativeTemplate;if(W(l)){let e=be(l);Ae(l,[ft(i,r,{scope:{fn:d,targetTemplate:k},node:[g&&g.loader,!s&&ae({priority:\"sampler\"}),ne({store:e,to:d?\"a\":\"stack\"}),d&&se({fn:me}),g&&y&&g.upward],meta:{op:\"sample\",sample:I}})]),g&&(tt(g.plain,e)||tt(g.closure,e)||g.closure.push(e))}else{let e=ue(0),t=ue(),n=ue();g&&g.plain.push(e,t,n),a({parent:l,node:[fe({store:t}),ne({from:\"value\",store:1,target:e})],family:{owners:[l,r,i],links:r},meta:{op:\"sample\",sample:'source'},regional:1}),Ae(l,[ft(i,r,{scope:{fn:d,targetTemplate:k},node:[g&&g.loader,fe({store:n}),ne({store:e}),le({fn:e=>e}),!s&&ae({priority:\"sampler\"}),ne({store:t}),ne({store:n,to:\"a\"}),d&&se({fn:de}),g&&y&&g.upward],meta:{op:\"sample\",sample:'clock'}})])}return r}function w(...e){let r={op:'guard'},n='guard',[[o,s],l]=et(e);l&&(r.config=l,l.name&&(n=l.name)),s||(s=o,o=s.source);let{filter:i,greedy:f,clock:u,name:d=n}=s,m=s.target||c(d,r.config),h=E(i),g=1;return void 0===o&&(t(u,'guard','clock'),Array.isArray(u)&&(u=b(u)),o=u,g=0),g&&!E(o)&&(o=p(o)),u&&(t(u,'guard','clock'),o=v({source:o,clock:u,greedy:f,fn:h?null:(e,t)=>({source:e,clock:t})})),t(m,'guard','target'),h?v({source:i,clock:o,target:a({node:[le({fn:({guard:e})=>e}),se({fn:({data:e})=>e})],child:m,meta:r,family:{owners:[o,i,m,...[].concat(u||[])],links:m},regional:1}),fn:(e,t)=>({guard:e,data:t}),greedy:f,name:d}):(J(i)||B('`filter` should be function or unit'),ft(o,m,{scope:{fn:i},node:u?[le({fn:({source:e,clock:t},{fn:r})=>r(e,t)}),se({fn:({source:e})=>e})]:[le({fn:he})],meta:r})),m}function S(e,t,r){if(W(e))return e;if(E(e)){let a,n=xe(e);return T(e)&&(a=u(t,{parent:n,name:e.shortName,ɔ:r}).on(e,((e,t)=>t))),H(e)&&(a=u(t,{parent:n,name:e.shortName,ɔ:r}).on(e.done,((e,{result:t})=>t))),n&&n.hooks.store(a),a}let a=Array.isArray(e)?[]:{};return i(e,((e,t)=>{a[t]=W(e)?e:u(e,{name:t})})),a}function q(...e){let t,[[r,n],o]=et(e),s=!n;s&&(t=r.cases,n=r.match,r=r.source);let l=W(n),f=!E(n)&&J(n),u=!l&&!f&&V(n);t||(t={}),s||(u||B('match should be an object'),i(n,((e,r)=>{t[r]=c(o)})),t.__=c(o));let p,d=je(),m=new Set([].concat(r,Object.values(t))),h=Object.keys(l||f?t:n);if(l||f)l&&m.add(n),p=[l&&ae({priority:'sampler'}),l&&ne({store:be(n),to:'a'}),le({fn(e,t,r){let a=String(l?r.a:n(e));At(t,tt(h,a)?a:'__',e,r)}})];else if(u){let e=ue({});e.type='shape';let t,r=e.before=[],a=[ne({store:e,to:\"a\"}),se({fn(e,{key:t},{a:r}){r[t]=e}})],o=[];i(n,((n,s)=>{if(E(n)){t=1,o.push(s),m.add(n);let l=ft(n,[],{node:a,scope:{key:s}});if(W(n)){e.current[s]=n.getState();let t=be(n);r.push({type:'field',field:s,from:t}),d&&(tt(d.plain,t)||l.seq.unshift(d.loader))}}})),t&&d&&d.plain.push(e),p=[t&&ae({priority:'sampler'}),t&&ne({store:e,to:'a'}),le({fn(e,t,r){for(let a=0;a<h.length;a++){let s=h[a];if(tt(o,s)?r.a[s]:n[s](e))return void At(t,s,e,r)}At(t,'__',e,r)}})]}else B('expect match to be unit, function or object');if(a({meta:{onCopy:Object.keys(t),op:'split'},parent:r,scope:t,node:p,family:{type:'crosslink',owners:Array.from(m)},regional:1}),!s)return t}function x(e,{values:t}){let r=V(e)&&e.cloneOf;G(e)||r||B('first argument of hydrate should be domain or scope'),V(t)||B('values property should be an object');let a,o,s=j(t);if(r)a=[],o=[],i(s,((t,r)=>{let n=e.sidMap[r];n&&(a.push(n),o.push(t),e.changedStores.add(n.meta.forkOf.id))}));else{let t=(({flatGraphUnits:e,values:t,collectWatches:r})=>{let a=[],n=[],o={},s=new Set,l=Object.getOwnPropertyNames(t);return f(e,(e=>{let{reg:f}=e,{op:c,unit:u,sid:p}=e.meta;if(u===I&&p&&tt(l,p)){let{state:r}=e.scope;r.current=t[p],s.add(r)}if(r&&'watch'===c){let t=e.family.owners[0];t.meta.unit===I&&(a.push(e),n.push(t.scope.state))}i(f,((e,t)=>{o[t]=e}))})),f(P(N(o)),(e=>{(e=>{let t=0;if(e.before&&!s.has(e)&&f(e.before,(r=>{switch(r.type){case $:e.current=r.fn(r.from.current);break;case'field':{let a=r.from;t||(t=1,e.current=Array.isArray(e.current)?[...e.current]:{...e.current}),e.current[r.field]=a.current;break}}})),!e.after)return;let r=e.current;f(e.after,(e=>{let t=e.to;switch(e.type){case'copy':t.current=r;break;case $:t.current=e.fn(r)}}))})(o[e])})),{storeWatches:a,storeWatchesRefs:n}})({flatGraphUnits:R(e),values:s,collectWatches:1});a=t.storeWatches,o=t.storeWatchesRefs.map((({current:e})=>e))}n({target:a,params:o,forkPage:r?e:0})}function N(e){let t=Object.values(e),r={};return f(t,(({id:e})=>{r[e]=[]})),f(t,(({id:e,before:t,after:a})=>{t&&f(t,(t=>{r[t.from.id].push(e)})),a&&f(a,(t=>{r[e].push(t.to.id)}))})),r}function A({clones:e,changedStores:t},{ignore:r=[],onlyChanges:a}={}){let n={};return f(e,(({meta:e,scope:r,reg:o})=>{if(e.unit!==I)return;let{sid:s}=e;s&&(!a&&!e.isCombine||t.has(e.forkOf.id))&&(n[s]=o[r.state.id].current)})),f(r,(({sid:e})=>{e&&delete n[e]})),n}function C(e){He||B('scopeBind cannot be called outside of forked .watch');let t=He,r=He.find(e);return H(e)?e=>{let a=d();n({target:r,params:{params:e,req:a},forkPage:t})}:e=>(n({target:r,params:e,forkPage:t}),e)}function j(e,t=(()=>{})){if(e instanceof Map){let r={};for(let[a,n]of e)E(a)||B('Map key should be a unit'),t(a,n),r[a.sid]=n;return r}return e}function O(e,{values:t,handlers:r}={}){G(e)||B('first argument of fork should be domain');let n=!!t;t=j(t||{},(e=>!W(e)&&B('Values map can contain only stores as keys')));let o=(e=>{function t(e){let t=ge(e),a=r.indexOf(t);if(-1===a){let r='unit';e!==t&&e.id!==e.shortName&&(r=e.shortName),B(`${r} not found in forked scope`)}return p[a]}let r=R(e),n=new Map,o=new Set,s=se({fn:(e,t,r)=>((!r.node.meta.isCombine||xe(r)&&'combine'!==xe(r).node.meta.op)&&o.add(r.node.meta.forkOf.id),e)}),l=a({scope:{defers:[],inFlight:0,fxID:0},node:[se({fn(e,t,r){r.parent?'finally'===r.parent.node.meta.named?t.inFlight-=1:(t.inFlight+=1,t.fxID+=1):t.fxID+=1}}),ae({priority:\"sampler\"}),ie({fn(e,t){let{inFlight:r,defers:a,fxID:n}=t;r>0||0===a.length||Promise.resolve().then((()=>{t.fxID===n&&f(a.splice(0,a.length),(e=>{Ve(e.parentFork),e.rs(e.value)}))}))}})],meta:{unit:\"forkInFlightCounter\"}}),c={},u={},p=r.map((e=>{let{seq:t,next:r,meta:n,scope:o}=e,s=a({node:t.map((e=>({id:e.id,type:e.type,data:{...e.data},hasRef:e.hasRef}))),child:[...r],meta:{forkOf:e,...n},scope:{...o}});return s.family={type:e.family.type,links:[...ke(e)],owners:[...ye(e)]},c[e.id]=s,n.sid&&(u[n.sid]=s),s})),d={};return f(p,(e=>{let{reg:r,scope:a,meta:{onCopy:o,op:c,unit:u}}=e;switch(i(r,((e,t)=>{let a=n.get(e);a||(a={id:e.id,current:e.current},n.set(e,a)),d[t]=r[t]=a})),o&&f(o,(e=>{let r=a[e];a[e]=Array.isArray(r)?r.map(t):t(r)})),D(e,((e,r,a)=>{a[r]=t(e)})),c||u){case I:e.meta.wrapped=(e=>({kind:I,getState:()=>e.reg[e.scope.state.id].current,updates:{watch:Z(ut,e)},graphite:e,family:e.family}))(e),e.meta.sid&&e.seq.push(s);break;case M:e.next.push(l);break;case'fx':a.finally.next.push(l)}})),{cloneOf:e,changedStores:o,nodeMap:c,sidMap:u,clones:p,find:t,reg:d,getState:e=>t(e).meta.wrapped.getState(),graphite:a({family:{type:\"domain\",links:[l,...p]},meta:{unit:'fork'},scope:{forkInFlightCounter:l}})}})(e);if(n&&(()=>{let r=R(e),a={},n={},s=new Set,l=new Set,c=Object.getOwnPropertyNames(t);f(r,(({reg:e,meta:t})=>{let{nativeTemplate:r}=t;i(e,((e,t)=>{a[t]=e,r&&l.add(t)}))})),f(o.clones,(e=>{let{reg:r}=e,{unit:a,sid:l}=e.meta;if(a===I&&l&&tt(c,l)){let{state:a}=e.scope;r[a.id].current=t[l],s.add(a),o.changedStores.add(e.meta.forkOf.id)}i(r,((e,t)=>{n[t]=e}))})),f(P(N(a),l),(e=>{((e,t)=>{let r=0;if(t&&t.before&&!s.has(e)&&f(t.before,(t=>{switch(t.type){case $:e.current=t.fn(n[t.from.id].current);break;case'field':{let a=n[t.from.id];r||(r=1,e.current=Array.isArray(e.current)?[...e.current]:{...e.current}),e.current[t.field]=a.current;break}}})),!t||!t.after)return;let a=e.current;f(t.after,(e=>{let t=n[e.to.id];switch(e.type){case'copy':t.current=a;break;case $:t.current=e.fn(a)}}))})(n[e],a[e])}))})(),r){r=j(r,(e=>!H(e)&&B(\"Handlers map can contain only effects as keys\")));let e=Object.keys(r);f(o.clones,(({scope:t,meta:a})=>{a.sid&&tt(e,a.sid)&&(t.runner.scope.getHandler=()=>r[a.sid])}))}return o}function P(e,t){function r(e){s[e]=1;let t=a[e];for(let e=0;e<t.length;e++){let a=t[e];s[a]||o[a]||r(a)}s[e]=0,o[e]=1,n.push(e)}let a={};for(let t in e)a[t]=[...new Set(e[t])];let n=[],o={},s={};for(let e in a)o[e]||s[e]||r(e);if(n.reverse(),t&&t.size>0){let e,r=[],o=[...t];for(;e=o.shift();)r.push(e),f(a[e],(e=>{tt(r,e)||tt(o,e)||o.push(e)}));f(r,(e=>{rt(n,e)}))}return n}function F(e,{scope:t,params:r}){if(!E(e))return Promise.reject(Error('first argument should be unit'));let a=d();a.parentFork=He;let{forkInFlightCounter:o}=t.graphite.scope;o.scope.defers.push(a);let s=[t.find(e)],l=[];return H(e)?l.push({params:r,req:{rs(e){a.value={status:'done',value:e}},rj(e){a.value={status:'fail',value:e}}}}):l.push(r),s.push(o),l.push(null),n({target:s,params:l,forkPage:t}),a.req}function R(e){let t=[];return function e(r){tt(t,r)||(t.push(r),D(r,e))}(ge(e)),t}function D(e,t){let r=e.meta.unit;'fork'!==r&&\"forkInFlightCounter\"!==r&&(f(e.next,t),f(ye(e),t),f(ke(e),t))}let _='undefined'!=typeof Symbol&&Symbol.observable||'@@observable',I='store',M='effect',$='map',E=e=>(J(e)||V(e))&&'kind'in e;const z=e=>t=>E(t)&&t.kind===e;let W=z(I),T=z(\"event\"),H=z(M),G=z(\"domain\");var U={__proto__:null,unit:E,store:W,event:T,effect:H,domain:G};let B=e=>{throw Error(e)},V=e=>'object'==typeof e&&null!==e,J=e=>'function'==typeof e,K=e=>{V(e)||J(e)||B('expect first argument be an object')};const L=()=>{let e=0;return()=>(++e).toString(36)};let Q=L(),X=L(),Y=L(),Z=(e,t)=>e.bind(null,t),ee=(e,t,r)=>e.bind(null,t,r);const te=(e,t,r)=>({id:X(),type:e,data:r,hasRef:t});let re=0,ae=({priority:e=\"barrier\"})=>te(\"barrier\",0,{barrierID:++re,priority:e}),ne=({from:e=I,store:t,target:r,to:a=(r?I:\"stack\")})=>te('mov',e===I,{from:e,store:t,to:a,target:r}),oe={defined:()=>te('check',0,{type:'defined'}),changed:({store:e})=>te('check',1,{type:'changed',store:e})},se=ee(te,'compute',0),le=ee(te,\"filter\",0),ie=ee(te,'run',0),fe=({store:e})=>ne({from:\"stack\",target:e});var ce={__proto__:null,barrier:ae,mov:ne,check:oe,compute:se,filter:le,run:ie,update:fe};let ue=e=>({id:X(),current:e}),pe=({current:e})=>e,de=(e,{fn:t},{a:r})=>t(e,r),me=(e,{fn:t},{a:r})=>t(r,e),he=(e,{fn:t})=>t(e),ge=e=>e.graphite||e,ye=e=>e.family.owners,ke=e=>e.family.links,be=e=>e.stateRef,ve=e=>e.config,we=e=>e.ɔ,Se=e=>e.value,qe=e=>e.subscribers,xe=e=>e.parent,Ne=e=>e.forkPage,Ae=(e,t)=>{let r=ge(e);for(let e=0;e<t.length;e++){let a=ge(t[e]);\"domain\"!==r.family.type&&(a.family.type=\"crosslink\"),ye(a).push(r),ke(r).push(a)}},Ce=null,je=()=>Ce&&Ce.template,Oe=e=>(e&&Ce&&Ce.sidRoot&&(e=`${Ce.sidRoot}ɔ${e}`),e),Pe=({sid:e,name:t,loc:n,method:o,fn:s})=>r(a({meta:{sidRoot:Oe(e),name:t,loc:n,method:o}}),s);const Fe=(e=[])=>{let t=[];if(Array.isArray(e))for(let r=0;r<e.length;r++)Array.isArray(e[r])?t.push(...e[r]):t.push(e[r]);else t.push(e);return t.map(ge)};let Re=({hasRef:e,type:t,data:r},a)=>{let n;e&&(n=r.store,a[n.id]=n),'mov'===t&&r.to===I&&(n=r.target,a[n.id]=n)},De=null;const _e=(e,t)=>{if(!e)return t;if(!t)return e;let r,a=e.v.type===t.v.type;return(a&&e.v.id>t.v.id||!a&&\"sampler\"===e.v.type)&&(r=e,e=t,t=r),r=_e(e.r,t),e.r=e.l,e.l=r,e},Ie=[];let Me=0;for(;Me<5;)Ie.push({first:null,last:null,size:0}),Me+=1;const $e=()=>{for(let e=0;e<5;e++){let t=Ie[e];if(t.size>0){if(2===e||3===e){t.size-=1;let e=De.v;return De=_e(De.l,De.r),e}1===t.size&&(t.last=null);let r=t.first;return t.first=r.r,t.size-=1,r.v}}},Ee=(e,t,r,a,n,o)=>ze(0,{a:null,b:null,node:r,parent:a,value:n,page:t,forkPage:o},e),ze=(e,t,r,a=0)=>{let n=We(r),o=Ie[n],s={v:{idx:e,stack:t,type:r,id:a},l:0,r:0};2===n||3===n?De=_e(De,s):(0===o.size?o.first=s:o.last.r=s,o.last=s),o.size+=1},We=e=>{switch(e){case'child':return 0;case'pure':return 1;case\"barrier\":return 2;case\"sampler\":return 3;case M:return 4;default:return-1}},Te=new Set;let He,Ge=1,Ue=0,Be=null,Ve=e=>{He=e},Je=e=>{Be=e};const Ke=(e,t)=>{if(e){for(;e&&!e.reg[t];)e=xe(e);if(e)return e}return null},Le=(e,t,r)=>(Ke(e,r)||t).reg[r],Qe=(e,{fn:t},r)=>{try{return t(Se(r),e.scope,r)}catch(t){console.error(t),e.fail=1}};let Xe=(e,t)=>''+e.shortName+t,Ye=(e,t)=>null==t?Xe(e,' → *'):t,Ze=(e,t)=>{K(e),we(e)&&t(ve(e),we(e))},et=e=>{let t;return Ze(e[0],((r,a)=>{t=r,e=a})),[e,t]},tt=(e,t)=>e.includes(t),rt=(e,t)=>{let r=e.indexOf(t);-1!==r&&e.splice(r,1)};const at=(e,t)=>{rt(e.next,t),rt(ye(e),t),rt(ke(e),t)},nt=(e,t,r)=>{let a;e.next.length=0,e.seq.length=0,e.scope=null;let n=ke(e);for(;a=n.pop();)at(a,e),(t||r&&!e.meta.sample||\"crosslink\"===a.family.type)&&nt(a,t,'on'!==a.meta.op&&r);for(n=ye(e);a=n.pop();)at(a,e),r&&\"crosslink\"===a.family.type&&nt(a,t,'on'!==a.meta.op&&r)},ot=e=>e.clear();let st=(e,{deep:t}={})=>{let r=0;if(e.ownerSet&&e.ownerSet.delete(e),W(e))ot(qe(e));else if(G(e)){r=1;let t=e.history;ot(t.events),ot(t.effects),ot(t.stores),ot(t.domains)}nt(ge(e),!!t,r)},lt=e=>{let t=ee(st,e,void 0);return t.unsubscribe=t,t},ft=(e,t,{node:r,scope:n,meta:o})=>a({node:r,parent:e,child:t,scope:n,meta:o,family:{owners:[e,t],links:t},regional:1}),ct=e=>{let r;Ze(e,((t,a)=>{r=t,e=a}));let{from:n,to:o,meta:s={op:'forward'}}=e;return t(n,'forward','\"from\"'),t(o,'forward','\"to\"'),r&&(s.config=r),lt(a({parent:n,child:o,meta:s,family:{},regional:1}))},ut=(e,t)=>{if(J(t)||B('.watch argument should be a function'),He){let t=He.nodeMap[ge(e).id];t&&(e=t)}return lt(a({scope:{fn:t},node:[ie({fn:he})],parent:e,meta:{op:'watch'},family:{owners:e},regional:1}))};const pt=(e,t)=>(V(e)&&(pt(ve(e),t),null!=e.name&&(V(e.name)?pt(e.name,t):J(e.name)?t.handler=e.name:t.name=e.name),e.loc&&(t.loc=e.loc),(e.sid||null===e.sid)&&(t.sid=e.sid),e.handler&&(t.handler=e.handler),e.updateFilter&&(t.updateFilter=e.updateFilter),xe(e)&&(t.parent=xe(e)),'strict'in e&&(t.strict=e.strict),e.named&&(t.named=e.named),pt(we(e),t)),t);let dt,mt=(e,t,r=\"event\")=>{xe(e)&&xe(e).hooks[r](t)},ht=(e,t,r,a)=>{let n=pt({name:a,config:r},{}),o=\"domain\"===e,s=Q(),{parent:i=null,sid:f=null,strict:c=1,named:u=null}=n,p=u||n.name||(o?'':s),d=l(p,i),m={unit:t.kind=e,name:t.shortName=p,sid:t.sid=Oe(f),named:u,unitId:t.id=s};if(t.parent=i,t.compositeName=d,t.defaultConfig=n,t.thru=e=>e(t),t.getType=()=>d.fullName,!o){t.subscribe=e=>(K(e),t.watch(J(e)?e:t=>{e.next&&e.next(t)})),t[_]=()=>t;let e=je();e&&(m.nativeTemplate=e)}return dt=c,m},gt=e=>c({named:e});const yt=(e,t,r,a)=>ft(e,t,{scope:{fn:a},node:[se({fn:he})],meta:{op:r}}),kt=(e,t,r,a)=>{let n;V(r)&&(n=r,r=r.fn);let o=c(Xe(e,' →? *'),n);return ft(e,o,{scope:{fn:r},node:a,meta:{op:t}}),o},bt=(e,t,r,a,n,o)=>{let s=be(t),l=[ne({store:s,to:\"a\"}),se({fn:a?me:de}),oe.defined(),oe.changed({store:s}),o&&le({fn:(e,t,{a:r})=>o(e,r)}),fe({store:s})],i=je();if(i&&(l.unshift(i.loader),l.push(i.upward),W(e))){let t=be(e);tt(i.plain,t)||(tt(i.closure,t)||i.closure.push(t),s.before||(s.before=[]),s.before.push({type:'closure',of:t}))}return ft(e,t,{scope:{fn:n},node:l,meta:{op:r}})},vt=e=>t=>e(...t),wt=(e,t,r,a)=>{let n=e?e=>e.slice():e=>({...e}),s=e?[]:{},l=je(),f=n(s),c=ue(f),p=ue(1);c.type=e?'list':'shape',l&&l.plain.push(c,p);let d=u(f,{name:r||o(t)});ge(d).meta.isCombine=1;let m=[oe.defined(),ne({store:c,to:\"a\"}),le({fn:(e,{key:t},{a:r})=>e!==r[t]}),ne({store:p,to:'b'}),se({fn(e,{clone:t,key:r},a){a.b&&(a.a=t(a.a)),a.a[r]=e}}),ne({from:\"a\",target:c}),ne({from:\"value\",store:0,target:p}),ae({priority:\"barrier\"}),ne({from:\"value\",store:1,target:p}),ne({store:c}),a&&se({fn:a}),oe.changed({store:be(d)})],h=c.before=[];return i(t,((e,t)=>{if(!W(e))return void(f[t]=s[t]=e);s[t]=e.defaultState,f[t]=e.getState();let r=ft(e,d,{scope:{key:t,clone:n},node:m,meta:{op:'combine'}}),a=be(e);h.push({type:'field',field:t,from:a}),l&&(tt(l.plain,a)||r.seq.unshift(l.loader))})),d.defaultShape=t,c.after=[a?{type:$,to:be(d),fn:a}:{type:'copy',to:be(d)}],l||(d.defaultState=a?be(d).current=a(f):s),d};let St=({params:e,req:t,ok:r,anyway:a,stack:o})=>s=>n({target:[a,qt],params:[r?{status:'done',params:e,result:s}:{status:'fail',params:e,error:s},{fn:r?t.rs:t.rj,value:s}],defer:1,page:o.page,forkPage:Ne(o)}),qt=a({node:[ie({fn({fn:e,value:t}){e(t)}})],meta:{op:'fx',fx:'sidechain'}});const xt=(e,t,r)=>(e.create=t=>(n(e,t),t),ge(e).seq.push(se({fn:(e,t,r)=>(r.forkPage=null,e)})),e.watch((e=>{Ae(r,[e]),t.add(e),e.ownerSet||(e.ownerSet=t),xe(e)||(e.parent=r)})),Ae(r,[e]),r=>(t.forEach(r),e.watch(r))),Nt=['source','clock','target'],At=(e,t,r,a)=>{let o=e[t];o&&n({target:o,params:Array.isArray(o)?o.map((()=>r)):r,defer:1,stack:a})},Ct=\"21.8.12\";export{F as allSettled,h as attach,st as clearNode,p as combine,g as createApi,y as createDomain,m as createEffect,c as createEvent,a as createNode,u as createStore,p as createStoreObject,O as fork,ct as forward,k as fromObservable,w as guard,x as hydrate,U as is,n as launch,b as merge,S as restore,v as sample,C as scopeBind,A as serialize,s as setStoreName,q as split,ce as step,Ct as version,Pe as withFactory,r as withRegion};\n//# sourceMappingURL=effector.mjs.map\n","export function isArray(value: any): boolean {\n  return Array.isArray(value);\n}","export function isObject(value: any) {\n  const type = typeof value;\n  return value != null && (type === 'object' || type === 'function');\n}","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nvar getRandomValues;\nvar rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n    // find the complete implementation of crypto (msCrypto) on IE11.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","import REGEX from './regex.js';\n\nfunction validate(uuid) {\n  return typeof uuid === 'string' && REGEX.test(uuid);\n}\n\nexport default validate;","import rng from './rng.js';\nimport stringify from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (var i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return stringify(rnds);\n}\n\nexport default v4;","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction stringify(arr) {\n  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","export function isNil(value: any): boolean {\n  return value == null;\n}","export function mergeObjects<T extends Object, M extends Object>(obj1: T, obj2: M): T & M {\n  return {...obj1, ...obj2};\n}","export function trimStartSlash(str: String) {\n  return str.replace(/^\\//, \"\");\n}","import {forward} from 'effector';\nimport {$session, fetchSessionFx, sessionChanged, SessionModel} from './';\nimport API, {ApiRequestConfig} from './../../api';\nimport {debug} from \"../../../stories_widget/util/debug\";\nimport {ISessionInitData} from \"../Session2\";\nimport {$storyManagerConfig, configDeviceIdChanged} from \"../storyManagerConfig\";\nimport {Option} from \"../../../../global.h\";\nimport {StoryManager} from \"../../index\";\n\n\n// import {fetchUsersFx, $usersMap} from './';\n\n// fetchUsersFx.use(async () => fetch('/users'))\n//\n// addUserFx.use(async user =>\n//     fetch('/users', {\n//         method: 'POST',\n//         body: JSON.stringify(user),\n//     }),\n// )\n//\n// $usersMap.on(fetchUsersFx.doneData, (_, users) => users)\n//\n// forward({\n//     from: addUserFx.doneData,\n//     to: fetchUsersFx,\n// })\n\nexport async function getRequestConfig(): Promise<ApiRequestConfig> {\n    return {\n        method: \"post\",\n        url: \"session/open\",\n        params: {expand: \"cache\"},\n        data: completeDeviceData(await getDeviceData())\n    } as ApiRequestConfig;\n}\n\n\n// после запроса создать модель ?\n// can pass params\nfetchSessionFx.use(async () => {\n    // todo try catch\n    const response = await API.post<SessionModel>('session/open?expand=cache', completeDeviceData(await getDeviceData()));\n    // create instance via Abstract model ?\n  // или взять только поля из типа и их сохранить\n    return response.data;\n});\n\nforward({\n    from: sessionChanged,\n    to: $session\n});\n\n// forward({\n//     from: fetchSessionFx.doneData,\n//     to: $session\n// });\n\n// fetchSessionFx({});\n\nconst completeDeviceData = (data: ISessionInitData) => {\n    if (data.os_name === 'iOS') {\n        (window as any).isIos = true;\n    } else if (data.os_name === 'Android') {\n        (window as any).Android = true;\n    }\n\n    const configData = $storyManagerConfig.getState();\n    if (configData && configData.userId) {\n        data.user_id = configData.userId;\n    }\n\n    data.features = 'animation,data,deeplink,placeholder,resetTimers,gameReader,swipeUpItems';\n\n    // dispatch an action\n    // не нужно ?\n    // store.dispatch('user/updateDeviceId', data.device_id);\n\n    // debug(data)\n    return data;\n};\n\n// this.getDeviceId().then((data: ISessionInitData) => {\n//\n//     if (data.os_name === 'iOS') {\n//         (<any>window).isIos = true;\n//     } else if (data.os_name === 'Android') {\n//         (<any>window).Android = true;\n//     }\n//\n//     if (store.getters['shared/options']?.userId) {\n//         data.user_id = store.getters['shared/options']?.userId;\n//     }\n//\n//     // переехали в запрос списков\n//     // if (store.getters['stories/options']?.tags) {\n//     //     data.tags = store.getters['stories/options']?.tags;\n//     // }\n//\n//     data.features = 'animation,data,deeplink,placeholder,resetTimers,gameReader';\n//\n//     // dispatch an action\n//     // не нужно ?\n//     store.dispatch('user/updateDeviceId', data.device_id);\n//\n//     debug(data)\n//\n//     Session2.fetch(data).then(session => {\n//         sessionInitInProcess = false;\n//         // TODO activeModel - set\n//         if (!session) {\n//             reject(`Key session not exists in response ${session}`)\n//         }\n//\n//         // sync\n//         store.commit('shared/setSession', {session})\n//\n//\n//         //\n//\n//         ///,  и в Reader виджет вынести\n//\n//         if (session.rawData && session.rawData.share) {\n//             store.commit('shared/setHasShare', {status: true})\n//         }\n//\n//         store.commit('shared/addDefaultPlaceholders', {value: session.placeholders});\n//\n//\n//         resolve(session)\n//\n//         // save all to store\n//\n//         //   \"session\": {\n//         //     \"id\": \"3edd5f192dd39045c05f26f450205426\",\n//         //     \"expire_in\": 3600\n//         //   },\n//         //   \"server_timestamp\": 1531471495\n//\n//         // resolve(val)\n//     }, error => {\n//         sessionInitInProcess = false;\n//         debug(error);\n//     })\n//\n// });\n\n// move to helper\nconst getDeviceData = (): Promise<ISessionInitData> => {\n  return StoryManager.getInstance().getDeviceInfo(configDeviceIdChanged);\n}","export function isEmpty(obj: any): boolean {\n  return [Object, Array].includes((obj || {}).constructor) && !Object.entries((obj || {})).length;\n}","import {fetchStoriesFx, StoryModel} from './';\nimport API, {ApiRequestConfig} from './../../api';\nimport {$storyManagerConfig} from \"../storyManagerConfig\";\nimport {STORY_LIST_TYPE} from \"../../types\";\nimport {Option} from \"../../../../global.h\";\nimport {isArray} from \"../../../helpers/isArray\";\n\n\n// import {fetchUsersFx, $usersMap} from './';\n\n// fetchUsersFx.use(async () => fetch('/users'))\n//\n// addUserFx.use(async user =>\n//     fetch('/users', {\n//         method: 'POST',\n//         body: JSON.stringify(user),\n//     }),\n// )\n//\n// $usersMap.on(fetchUsersFx.doneData, (_, users) => users)\n//\n// forward({\n//     from: addUserFx.doneData,\n//     to: fetchUsersFx,\n// })\n\n\n// после запроса создать модель ?\n// can pass params\n\nexport function getRequestConfig(listType: STORY_LIST_TYPE, compositeSessionIdRef?: Option<string>, customTags?: Array<string>): ApiRequestConfig {\n    let url = \"story\";\n    if (listType === STORY_LIST_TYPE.onboarding) {\n        url = \"story-onboarding\";\n    }\n    return {\n        method: \"get\",\n        url,\n        ...configForListRequest(listType, compositeSessionIdRef, customTags)\n    } as ApiRequestConfig;\n}\n\nexport function storySlidesGetRequestConfig(id: number | string, allFields = false, compositeSessionIdRef?: Option<string>): ApiRequestConfig {\n  const config: ApiRequestConfig = {\n    url: `story/${id}`,\n    method: \"get\",\n    params: {expand: ['slides_html', 'slides_duration'].join(',')},\n  };\n  if (!allFields && config.params) {\n    config.params.fields = ['id', 'slides_html', 'slides_duration'].join(',');\n  }\n  if (compositeSessionIdRef !== null && config.params) {\n    config.params.session_id = compositeSessionIdRef;\n  }\n  return config;\n}\n\n\n\nfetchStoriesFx.use(async ({listType}) => API.get<StoryModel>('story', configForListRequest(listType)));\n\nconst configForListRequest = (listType: STORY_LIST_TYPE, compositeSessionIdRef?: Option<string>, customTags?: Array<string>) => {\n    let tags = $storyManagerConfig.getState()?.tags;\n    const params: {tags?: Option<string>, favorite?: number, session_id?: string} = {};\n    if (tags && isArray(tags) && tags.length > 0) {\n        params.tags = tags.join(',');\n    }\n    if (customTags !== undefined && isArray(customTags) && customTags.length > 0) {\n      params.tags = customTags.join(',');\n    }\n    if (listType === STORY_LIST_TYPE.favorite) {\n        params.favorite = 1;\n    }\n\n    if (compositeSessionIdRef) {\n        params.session_id = compositeSessionIdRef;\n    }\n    return {params};\n};\n\n\n// forward({\n//     from: fetchSessionFx.doneData,\n//     to: $session\n// });\n\n// fetchSessionFx({});","import {$storyContext, fetchStoryContextFx, storyContextChanged} from './';\nimport API, {ApiRequestConfig} from './../../api';\nimport {forward} from \"effector\";\nimport {Option} from \"../../../../global.h\";\nimport {isObject} from \"../../../helpers/isObject\";\n\n// после запроса создать модель ?\n// can pass params\n\n\nexport function getRequestConfig(ids: Array<number | string>, compositeSessionIdRef?: Option<string>): ApiRequestConfig {\n  const config: ApiRequestConfig = {\n    url: `story-context`,\n    method: \"get\",\n    params: {\n      id: ids.join(',')\n    },\n  };\n  if (compositeSessionIdRef !== null && config.params) {\n    config.params.session_id = compositeSessionIdRef;\n  }\n  return config;\n}\n\nfetchStoryContextFx.use(async ({ids}) => API.request(getRequestConfig(ids)));\n\nforward({from: fetchStoryContextFx.done.filterMap(payload => {\n    const context = payload.result.data;\n    if (context && isObject(context)) {\n      return {...context, ids: payload.params.ids};\n    }\n    return undefined;\n  }), to: $storyContext});\nforward({from: storyContextChanged, to: $storyContext});","//Taken from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions\nfunction escapeRegExp(val: string) {\n  return val.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\n}\n\n// replaceAll does not work in safari\nexport function replaceAll(val: string, match: string, replacement: string) {\n  return String(val).replace(new RegExp(escapeRegExp(match), 'g'), () => replacement);\n}","export function isFunction(func: any): boolean {\n  return typeof func === \"function\";\n}","export function isString(str: any){\n  if (str != null && typeof str.valueOf() === \"string\") {\n    return true\n  }\n  return false\n}","export function extend(target: any, source: any, overwrite: boolean): any {\n  for (const key in source) {\n    if (source.hasOwnProperty(key)) {\n      if (overwrite || target[key] === undefined) {\n        target[key] = source[key];\n      }\n    }\n  }\n  return target;\n}\n\nexport enum BlobContentType {\n  CSS = 'text/css',\n  JS = 'text/javascript',\n  HTML = 'text/html',\n}\n\nexport function getBlobURL(code: string, type: BlobContentType): string {\n  const blob = new Blob([code], {type})\n  return URL.createObjectURL(blob)\n}","import {createEvent, clearNode, Effect, Domain} from \"effector\";\nimport {IWorkerServer} from \"../IWorkerServer\";\nimport {Dict} from \"../../../global.h\";\nimport {IWorkerClient} from \"../IWorkerClient\";\nimport {create as createDuplex} from \"./duplex\";\n\n\nexport function create(domains: {serverFxDomain: Domain, clientFxDomain: Domain}, worker: IWorkerClient) {\n\n  createDuplex({\n    fxSenderDomain: domains.clientFxDomain,\n    fxReceiverDomain: domains.serverFxDomain\n  }, worker);\n\n}\n\n","import {createEvent, Effect} from \"effector\";\nimport {IWorkerServer} from \"../IWorkerServer\";\nimport {IWorkerClient} from \"../IWorkerClient\";\nimport {RpcDomains} from \"./duplex.h\";\nimport {Message, MessageStatus, MessageType} from \"../index.h\";\nimport {Option, Dict} from \"../../../global.h\";\n\nlet nextID = 0;\n\nclass Defer {\n\n  public id = ++nextID;\n  public rs: (data: any) => void = () => {\n  };\n  public rj: (error: any) => void = () => {\n  };\n  public req: Promise<any>;\n\n  constructor() {\n    reqMap.set(this.id, this);\n    const req = new Promise((rs, rj) => {\n      this.rs = rs;\n      this.rj = rj;\n    })\n    req\n      .finally(() => {\n        reqMap.delete(this.id)\n      })\n      .catch(() => {\n      })\n    this.req = req;\n  }\n}\n\nconst reqMap = new Map<number, Defer>();\n\nconst fxMap = new Map<string, Effect<any, any, any>>();\n\n\nexport function create(domains: RpcDomains, worker: IWorkerServer | IWorkerClient) {\n\n  const onMessage = createEvent<Dict>();\n\n  worker.onmessage = onMessage;\n\n  onMessage.watch((data) => {\n    if (Object(data) !== data) return;\n    if (!data.sid) return;\n    if (!data.id) return;\n\n    handleFxResponse(data as Message);\n    handleFx(data as Message, worker);\n  });\n\n\n  // fx for work on this side\n  domains.fxReceiverDomain.onCreateEffect((fx: Effect<any, any, any>) => {\n    // fx.sid only with \"effector/babel-plugin\"\n\n    // console.log('onCreateEffect', {fx});\n\n    fxMap.set(fx.shortName, fx);\n  });\n\n  // fx for send from this side\n  domains.fxSenderDomain.onCreateEffect((fx: Effect<any, any, any>) => {\n    console.log('fxSenderDomain onCreateEffect', {fx});\n\n    fx.use(params => {\n      const defer = new Defer();\n      worker.sendMessage({\n        id: defer.id,\n        // use (fx.sid || fx.shortName) only with \"effector/babel-plugin\"\n        sid: fx.shortName,\n        type: MessageType.REQUEST,\n        params,\n      });\n      return defer.req;\n    });\n  });\n\n\n}\n\nfunction handleFxResponse(message: Message) {\n  if (message.type !== MessageType.RESPONSE) return;\n  const req = reqMap.get(message.id);\n  if (!req) return;\n  if (message.status === MessageStatus.SUCCESS) {\n    req.rs(message.result);\n  } else {\n    if ('raw' in message.error) {\n      req.rj(message.error.raw);\n      return;\n    }\n    const error = Error('');\n    if ('name' in message.error) error.name = message.error.name;\n    if ('message' in message.error) error.message = message.error.message;\n    if ('stack' in message.error) error.stack = message.error.stack;\n    if ('code' in message.error) (error as any).code = message.error.code;\n    req.rj(error);\n  }\n}\n\nasync function handleFx(message: Message, worker: IWorkerServer | IWorkerClient) {\n  if (message.type !== MessageType.REQUEST) return;\n  const fx = fxMap.get(message.sid);\n  if (!fx) {\n    worker.sendMessage({\n      id: message.id,\n      sid: message.sid,\n      type: MessageType.RESPONSE,\n      status: MessageStatus.ERROR,\n      error: {\n        name: 'RemoteFXError',\n        message: `Unknown sid \"${message.sid}\"`,\n      },\n    });\n    return;\n  }\n  console.log({\"onMessage watch\": 3, message});\n  await fx(message.params)\n    .then(result => {\n      //@ts-ignore\n      worker.sendMessage({\n        id: message.id,\n        sid: message.sid,\n        type: MessageType.RESPONSE,\n        status: MessageStatus.SUCCESS,\n        result,\n      })\n    })\n    .catch(error => {\n      const serialized: {\n        raw?: any,\n        name?: any,\n        code?: any,\n        message?: any,\n        stack?: any,\n      } = {};\n\n      if (error instanceof Error) {\n        serialized.name = (error as any).name;\n        if ('code' in error) serialized.code = (error as any).code;\n        if ('message' in error) serialized.message = (error as any).message;\n        if ('stack' in error) serialized.stack = (error as any).stack;\n      } else {\n        serialized.raw = error;\n      }\n      worker.sendMessage({\n        id: message.id,\n        sid: message.sid,\n        type: MessageType.RESPONSE,\n        status: MessageStatus.ERROR,\n        error: serialized,\n      });\n\n    })\n\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n","import React, {useEffect, useRef, useState} from \"react\";\nimport {WebView} from \"react-native-webview\";\n// import {Colors} from \"react-native/Libraries/NewAppScreen\";\nimport {SafeAreaView, View, StyleSheet, StatusBar} from \"react-native\";\n\nimport {Option} from \"../../global.h\";\nimport {IWidgetStoryReader} from \"../widget-story-reader\";\nimport {StoryReaderProps} from \"./StoryReader.h\";\n\nfunction StoryReader({storyManager}: StoryReaderProps) {\n\n    // props - StoryManager\n    // создать инстанс WidgetStoriesList\n\n    const [widgetStoryReader, setWidgetStoryReader] = useState<Option<IWidgetStoryReader>>(null);\n\n    const [needFirstRender, setNeedFirstRender] = useState(false);\n\n\n    // get documentSrc && init fn\n\n    const viewRef = useRef<Option<WebView>>(null);\n    const [rpcBind, setRpcBind] = useState<Option<boolean>>(null);\n\n\n    // useFirstRender\n\n    useEffect(() => {\n        // передали опции, создали объект\n\n        // hook, not first render\n        // only when Some(storyManager)\n        if (widgetStoryReader === null) {\n            if (storyManager != null) {\n                setWidgetStoryReader(storyManager.createWidgetStoryReader(setNeedFirstRender, () => {\n\n                    console.log(\"[StoryReader] call detachComponent\");\n\n                    widgetStoryReader?.destructor();\n                    setRpcBind(null);\n                    setWidgetStoryReader(null);\n                    setNeedFirstRender(false);\n                }));\n                setRpcBind(false);\n            }\n        }\n\n        // bind rpc\n        if (rpcBind === false && viewRef.current !== null) {\n            console.log(\"bind rpc\");\n            widgetStoryReader?.createRpcServer<WebView>(viewRef.current);\n            setRpcBind(true);\n\n            // widgetLoaded\n\n        }\n\n\n        // привязали транспорт и события\n\n        // получили cb от виджета - готовы грузить сторис\n        // mounted()\n\n    },);\n\n    // useEffect(() => {\n    // console.log('options [widgetStoryReader]', widgetStoryReader?.viewOptions);\n    // });\n\n\n    // get view options\n\n    // bind rpc\n\n\n    // render if options exists\n    // onMessage={handler}\n    return (\n        <>\n            {widgetStoryReader && needFirstRender &&\n                <SafeAreaView style={{...styles.container, backgroundColor: \"#000\"}}>\n                    <StatusBar barStyle=\"light-content\" backgroundColor=\"#000\"/>\n                    <View {...widgetStoryReader?.containerOptions} >\n                        <WebView\n                            nativeConfig={{props: {webContentsDebuggingEnabled: true, allowsInlineMediaPlayback: true}}}\n                            scalesPageToFit={false} originWhitelist={[\"*\"]}\n                            onMessage={e => {\n                            }}\n                            {...widgetStoryReader?.viewOptions} ref={viewRef}\n                        />\n                    </View>\n                </SafeAreaView>\n            }\n\n            {/*<View style={{position: 'relative', height: 200}}>\n\n        <MyInlineWeb style={{width: '100%', height: webviewHeight,\n          backgroundColor: isDarkMode ? Colors.black : Colors.white,\n          // backgroundColor: 'transparent',\n        }}\n                     setScrollEnabled={setScrollEnabled} setWebviewHeight={setWebviewHeight} screenHeight={ScreenHeight}\n                     setWebViewStyle={setWebViewStyle}\n\n                     inputStoryState={inputStoryState}\n                     $storyState={$storyState}\n\n                     inputSessionState={inputSessionState}\n                     $sessionState={$sessionState}\n                     inputOpenStoryId={inputOpenStoryId}\n        />\n\n      </View>*/}\n\n        </>);\n\n}\n\nconst styles = StyleSheet.create({\n    container: {\n        flex: 1,\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        position: \"absolute\",\n        width: \"100%\",\n        height: \"100%\",\n    },\n});\n\nexport {StoryReader};\n","import {MutationPayload} from \"vuex\";\n\nimport {StoryContextModel} from \"./models/storyContext\";\nimport {StoryModel} from \"./models/story\";\nimport {Brand} from \"../../global.h\";\n\nexport type Url = Brand<string, \"url\">;\n\nexport type ClickOnStoryInternalPayload = {\n    id: number;\n    listType: STORY_LIST_TYPE;\n    windowReferer: STORY_READER_WINDOW_REFERER\n};\nexport type ClickOnStoryInternalWithDataPayload = ClickOnStoryInternalPayload & {\n    storyContext: StoryContextModel,\n    storyList: Array<StoryModel>,\n};\n\nexport type ClickOnButtonPayload = {\n    id: number;\n    index: number;\n    url: Url;\n    elementId: string;\n};\n\nexport type ClickOnStoryPayload = ClickOnButtonPayload & {\n    isDeeplink: boolean;\n};\n\nexport type ClickOnFavoriteCellInternalPayload = {\n    id: number;\n    storyList: Array<StoryModel>;\n    listType: STORY_LIST_TYPE;\n};\n\nexport type SyncStoreEvent = {\n    mutation: MutationPayload;\n};\n\nexport enum STORY_READER_WINDOW_REFERER {\n    default,\n    favorite\n}\n\nexport type FontResource = {\n    type: 'font-face',\n    weight: string,\n    style: string,\n    title: string,\n    family: string,\n    url: string,\n};\n\n\nexport enum STORY_LIST_TYPE {\n    default,\n    onboarding,\n    favorite\n}\n\nexport enum StoriesEvents {\n    CLICK_ON_STORY = 'clickOnStoryLink',\n}\n\nexport type ClickOnSwipeUpPayload = ClickOnButtonPayload & {\n    modeDesktop: boolean;\n    width: number;\n    height: number;\n    verticalMargin: number;\n};\n","// import {createStore, createEffect} from 'effector'\n\n// export const fetchUsersFx = createEffect()\n//\n// //imagine initially we have users list as a key-value store\n// export const $usersMap = createStore({})\n//\n// //we need array representaion for our UI tasks\n// export const $users = $usersMap.map(usersMap => Object.values(usersMap))\n\n\nimport {createApi, createEvent, createStore, forward, Event} from 'effector';\nimport {StoryManagerConfig, StoryManagerConfigDefault} from \"../../types/storyManager/storyManager\";\nimport {DeviceId} from \"./index.h\";\n\nconst $storyManagerConfig = createStore<StoryManagerConfig>(StoryManagerConfigDefault);\n\n// const {storyManagerConfigChanged}: {storyManagerConfigChanged: Event<StoryManagerConfig>} = createApi($storyManagerConfig, {\n//   storyManagerConfigChanged: (state, config) => config,\n// });\n\nconst storyManagerConfigChanged = createEvent<StoryManagerConfig>();\n$storyManagerConfig.on(storyManagerConfigChanged, (state, config) => config);\n\nconst storyManagerConfigTagsChanged = createEvent<Pick<StoryManagerConfig, \"tags\">>();\n$storyManagerConfig.on(storyManagerConfigTagsChanged, (state, {tags}) => ({...state, tags}));\n\nconst storyManagerConfigUserIdChanged = createEvent<Pick<StoryManagerConfig, \"userId\">>();\n$storyManagerConfig.on(storyManagerConfigUserIdChanged, (state, {userId}) => ({...state, userId}));\n\nconst storyManagerConfigPlaceholdersChanged = createEvent<Pick<StoryManagerConfig, \"placeholders\">>();\n$storyManagerConfig.on(storyManagerConfigPlaceholdersChanged, (state, {placeholders}) => ({...state, placeholders}));\n\nconst storyManagerConfigLangChanged = createEvent<Pick<StoryManagerConfig, \"lang\">>();\n$storyManagerConfig.on(storyManagerConfigLangChanged, (state, {lang}) => ({...state, lang}));\n\nconst storyManagerConfigIsSandboxChanged = createEvent<Pick<StoryManagerConfig, \"isSandbox\">>();\n$storyManagerConfig.on(storyManagerConfigIsSandboxChanged, (state, {isSandbox}) => ({...state, isSandbox: Boolean(isSandbox) }));\n\nconst storyManagerConfigApiKeyChanged = createEvent<Pick<StoryManagerConfig, \"apiKey\">>();\n$storyManagerConfig.on(storyManagerConfigApiKeyChanged, (state, {apiKey}) => ({...state, apiKey }));\n\n// $config.watch(s => console.log(s));\n\n\nconst $configDeviceId = createStore<DeviceId>('' as DeviceId);\nconst configDeviceIdChanged = createEvent<DeviceId>();\nforward({\n    from: configDeviceIdChanged,\n    to: $configDeviceId\n});\n\n\nexport {$storyManagerConfig, storyManagerConfigChanged, $configDeviceId, configDeviceIdChanged, storyManagerConfigTagsChanged, storyManagerConfigPlaceholdersChanged, storyManagerConfigUserIdChanged, storyManagerConfigLangChanged, storyManagerConfigIsSandboxChanged, storyManagerConfigApiKeyChanged};\n","import {Dict, Optional} from \"../index\";\n\nexport type StoryManagerConfig = {\n  apiKey: string;\n  userId?: Optional<string|number>;\n  tags?: Optional<Array<string>>;\n  placeholders?: Optional<Dict<string>>;\n  lang?: Optional<string>;\n  isSandbox?: boolean;\n};\n\n\nconst StoryManagerConfigDefault: StoryManagerConfig = {\n  apiKey: \"\",\n\n};\n\nexport {StoryManagerConfigDefault};","import {createApi, createStore} from 'effector';\nimport {SessionPlaceholderModel} from \"../session\";\nimport {isArray} from \"../../../helpers/isArray\";\nimport {isObject} from \"../../../helpers/isObject\";\n\nexport type Placeholders = Dict<string>;\nconst $placeholders = createStore<Placeholders>({});\n\nconst {sdkPlaceholdersChanged, addDefaultPlaceholders} = createApi($placeholders, {\n  sdkPlaceholdersChanged: (state: Placeholders, data: Placeholders) => data,\n  addDefaultPlaceholders: (state: Placeholders, data: Array<SessionPlaceholderModel>) => {\n    let _placeholders: Placeholders = {};\n    if (isArray(data)) {\n      data.forEach(item => {\n        if (isObject(item) && item['name'] !== undefined && item['default_value'] !== undefined) {\n          _placeholders[item['name']] = item['default_value'];\n        }\n      });\n    }\n    return _placeholders;\n  }\n});\n\nexport {$placeholders, sdkPlaceholdersChanged, addDefaultPlaceholders};\n","import {IData} from \"../story-manager/types\";\n\nexport class Utility {\n    public static createFunctionWithTimeout(cb: () => void, opt_timeout?: number): () => void {\n        let called = false;\n\n        function fn() {\n            if (!called) {\n                called = true;\n                cb();\n            }\n        }\n\n        setTimeout(fn, opt_timeout || 1000);\n        return fn;\n    }\n\n    public static convertModelToFormData(formData: FormData, data: IData, previousKey?: string) {\n        if (data instanceof Object) {\n            Object.keys(data).forEach(key => {\n                const value = (data as any)[key];\n                if (value instanceof Object && !Array.isArray(value)) {\n                    return this.convertModelToFormData(formData, value, key);\n                }\n                if (previousKey) {\n                    key = `${previousKey}[${key}]`;\n                }\n                if (Array.isArray(value)) {\n                    value.forEach(val => {\n                        formData.append(`${key}[]`, val);\n                    });\n                } else {\n                    formData.append(key, value);\n                }\n            });\n        }\n    }\n\n    // public static convertModelToFormData(model: any, form?: FormData, namespace = ''): FormData {\n    //     let formData = form || new FormData();\n    //     let formKey;\n    //\n    //     for (let propertyName in model) {\n    //         if (!model.hasOwnProperty(propertyName) || !model[propertyName]) continue;\n    //         let formKey = namespace ? `${namespace}[${propertyName}]` : propertyName;\n    //         if (model[propertyName] instanceof Date)\n    //             formData.append(formKey, model[propertyName].toISOString());\n    //         else if (model[propertyName] instanceof Array) {\n    //             model[propertyName].forEach((element: any, index: any) => {\n    //                 const tempFormKey = `${formKey}[${index}]`;\n    //                 this.convertModelToFormData(element, formData, tempFormKey);\n    //             });\n    //         }\n    //         else if (typeof model[propertyName] === 'object' && !(model[propertyName] instanceof File))\n    //             this.convertModelToFormData(model[propertyName], formData, formKey);\n    //         else\n    //             formData.append(formKey, model[propertyName].toString());\n    //     }\n    //     return formData;\n    // }\n}","export default /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;","\n\nimport {$storyManagerConfig, $configDeviceId} from \"../models/storyManagerConfig\";\nimport {$session} from \"../models/session\";\n\nimport {Utility} from \"../../helpers/utility\";\n\n// import {stringify as qsStringify} from \"qs\";\nfunction qsStringify(elements: Dict) {\nreturn '';\n}\n\nconst baseURL = process.env.API_URL as string;\nconst baseURLSandbox = process.env.API_URL_SANDBOX as string;\nconst apiVersion = 'v2';\n\nexport type ApiRequestConfigMethod = 'get' | 'post' | 'patch' | 'put' | 'delete';\n\nexport type ApiRequestConfig = {\n  url: string,\n  method: ApiRequestConfigMethod,\n  params?: Dict,\n  data?: Dict,\n  headers?: Dict\n}\n\nexport type ApiResponse<ResponseData = {}> = {\n  data: ResponseData,\n  headersRaw: Headers,\n  headers: Dict<string>,\n  status: number,\n  statusText: string,\n  ok: boolean,\n}\n\nclass API {\n  public get baseURL() {\n      return $storyManagerConfig.getState().isSandbox ? baseURLSandbox : baseURL;\n  }\n  private requestInterceptors: Array<(config: ApiRequestConfig) => void> = [];\n\n  public interceptors = {\n    request: {\n      use: (cb: (config: ApiRequestConfig) => void) => {\n        this.requestInterceptors.push(cb);\n      }\n    }\n  }\n\n  public async request<ResponseData>(config: ApiRequestConfig): Promise<ApiResponse<ResponseData>> {\n    try {\n\n      if (this.requestInterceptors.length) {\n        for (const interceptor of this.requestInterceptors) {\n          interceptor(config);\n        }\n      }\n\n      let url = new URL(`/${apiVersion}/${trimStartSlash(config.url)}`, this.baseURL);\n      if (!isNil(config.params) && isObject(config.params)) {\n        url.search = qsStringify(config.params);\n      }\n\n      let method = 'get';\n      if (!isNil(config.method)) {\n        method = config.method;\n      }\n\n      let headers: Dict = {};\n      if (!isNil(config.headers) && isObject(config.headers)) {\n        headers = config.headers;\n      }\n\n      let body = null;\n      if (!isNil(config.data) && isObject(config.data)) {\n        body = JSON.stringify(config.data);\n        headers[\"Content-Type\"] = \"application/json\";\n      }\n\n      const response = await fetch(url.toString(), {\n        method, body, headers, credentials: \"omit\"\n      });\n      const json = await response.json();\n\n\n      return {\n        data: json as ResponseData,\n        headersRaw: response.headers,\n        headers: Object.fromEntries([...response.headers]),\n        status: response.status,\n        statusText: response.statusText,\n        ok: response.ok\n      };\n\n    } catch (e) {\n      throw e;\n    }\n\n  }\n\n  public async post<ResponseData>(path: string, data: Dict) {\n    return this.request<ResponseData>({method: 'post', url: path, data});\n  }\n\n  public async get<ResponseData>(path: string, params: Dict) {\n    return this.request<ResponseData>({method: 'get', url: path, params});\n  }\n\n\n\n}\n\nconst APIInstance = new API();\n\nimport {v4 as uuidV4} from \"uuid\";\nimport {Dict} from \"../../../global.h\";\nimport {isNil} from \"../../helpers/isNil\";\nimport {isObject} from \"../../helpers/isObject\";\nimport {mergeObjects} from \"../../helpers/mergeObjects\";\nimport {trimStartSlash} from \"../../helpers/trimStartSlash\";\nimport {trimEndSlash} from \"../../helpers/trimEndSlash\";\n\nAPIInstance.interceptors.request.use(config => {\n\n  config.headers = mergeObjects(config.headers,  {\n    Authorization: `Bearer ${$storyManagerConfig.getState().apiKey}`,\n    \"Accept-Language\": $storyManagerConfig.getState().lang,\n    \"Auth-Session-Id\": $session.getState()?.session?.id,\n    \"X-Device-Id\": $configDeviceId.getState(),\n    \"X-User-Id\": $storyManagerConfig.getState().userId,\n    \"X-Request-Id\": uuidV4(),\n    \"X-Sdk-Version\": process.env.BUILD_VERSION,\n    // \"User-Agent\":\n    });\n\n  return config;\n\n});\n\nexport function APISendBeacon(path: string, data: Dict, cb: () => void): void {\n  if (\"sendBeacon\" in navigator) {\n\n    const url = `${trimEndSlash(baseURL)}/${trimStartSlash(path)}?access_token=${$storyManagerConfig.getState().apiKey}&session_id=${$session.getState()?.session?.id}`;\n\n    const formData = new FormData();\n    Object.keys(data).forEach((key) => {\n      Utility.convertModelToFormData(formData, data[key], key);\n    });\n\n    navigator.sendBeacon(url, formData);\n\n    cb();\n\n  } else {\n    APIInstance.post(path, data).then(() => cb(), () => cb());\n  }\n}\n\nexport default APIInstance;\n\n// usage\n/**\n * import API from '../api';\n *\n * const response = await API.delete(`users/${this.state.id}`);\n * console.log(response);\n * console.log(response.data);\n *\n *\n *\n * init sdk\n * первый же запрос - open session\n * и дальше готовы к работе\n *\n *\n *\n */","// import {createStore, createEffect} from 'effector'\n\n// export const fetchUsersFx = createEffect()\n//\n// //imagine initially we have users list as a key-value store\n// export const $usersMap = createStore({})\n//\n// //we need array representation for our UI tasks\n// export const $users = $usersMap.map(usersMap => Object.values(usersMap))\n\nimport API from './../../api';\nimport {createStore, createEvent, createEffect, createDomain, forward} from 'effector';\n\nexport type CacheResourceModel = {\n  url: string,\n  weight: string,\n  style: string,\n  title: string,\n  family: string,\n  type: 'font-face' | 'file',\n  format: string\n};\n\nexport type SessionPlaceholderModel = {\n  name: string,\n  default_value: string\n};\n\nexport type SessionInnerModel = {\n  id: string,\n  expire_in: number\n};\n\nexport type SessionModel = {\n  session: SessionInnerModel,\n  server_timestamp: number,\n  content_base_url: string,\n  user_key: string, // Anonymized user id\n  share: boolean, // Flag allow user share or not\n  is_allow_profiling: boolean, // Flag allow collect profiling for this session\n  cache: Array<CacheResourceModel>,\n  placeholders: Array<SessionPlaceholderModel>,\n};\n\nconst $session = createStore<SessionModel>({\n  session: {id: '', expire_in: 0},\n  server_timestamp: 0,\n  content_base_url: '',\n  user_key: '',\n  share: false,\n  is_allow_profiling: false,\n  cache: [],\n  placeholders: []\n});\n\nconst fetchSessionFx = createEffect<{}, SessionModel, Error>();\n\n$session.on(fetchSessionFx.doneData, (_, session: SessionModel) => session);\n\nconst sessionChanged = createEvent<SessionModel>();\n\n// const configChanged = createEvent<WidgetStoriesConfig>();\n// forward({\n//     from: configChanged,\n//     to: $config\n// });\n//\n// $session.watch(s => console.log(s));\n\n\nconst sessionHandleFlushThumbViewsFx = createEffect((payload: {data: Array<any>}) => {\n  API.post('session/update', payload);\n});\n\nconst sessionThumbViewsChanged = sessionHandleFlushThumbViewsFx.prepend((ids: Array<number>) => ({\n    // state.data.push([\n    //     action,\n    //     state.lastIndex,\n    //     storyId,\n    //     slideIndex,\n    //     slideDuration\n    // ]);\n    // state.lastIndex++\n    data: [[\n      5, //action: 5, // Прочтение\n      0, // lastIndex\n      ...ids,  // ids story,\n    ]]\n  })\n);\n\n\n\n\n\nexport {$session, fetchSessionFx, sessionChanged, sessionThumbViewsChanged};\n","import {MutationPayload} from \"vuex\";\n\nimport {StoryContextModel} from \"~/src/storyManager/models/storyContext\";\nimport {StoryModel} from \"~/src/storyManager/models/story\";\n\nexport type Url = Brand<string, \"url\">;\n\nexport type ClickOnStoryInternalPayload = {\n    id: number;\n    listType: STORY_LIST_TYPE;\n    windowReferer: STORY_READER_WINDOW_REFERER\n};\nexport type ClickOnStoryInternalWithDataPayload = ClickOnStoryInternalPayload & {\n  storyContext: StoryContextModel,\n  storyList: Array<StoryModel>,\n};\n\n\n\nexport type ClickOnButtonPayload = {\n    id: number;\n    index: number;\n    url: Url;\n    elementId: string;\n};\n\nexport type ClickOnStoryPayload = ClickOnButtonPayload & {\n    isDeeplink: boolean;\n};\n\nexport type ClickOnFavoriteCellInternalPayload = {\n    id: number;\n  storyList: Array<StoryModel>;\n  listType: STORY_LIST_TYPE;\n};\n\nexport type SyncStoreEvent = {\n    mutation: MutationPayload;\n};\n\nexport enum STORY_READER_WINDOW_REFERER {\n    default,\n    favorite\n}\n\nexport type FontResource = {\n  type: 'font-face',\n  weight: string,\n  style: string,\n  title: string,\n  family: string,\n  url: string,\n};\n\n\nexport enum STORY_LIST_TYPE {\n  default,\n  onboarding,\n  favorite\n}\n\nexport interface IData {\n  [key: string]: any;\n}\n\nexport type Optional<T> = T | null;\n\nexport type Dict<T = any> = {\n  [key: string]: T;\n}\n\n\nexport enum StoriesEvents {\n  CLICK_ON_STORY = 'clickOnStoryLink',\n}\n\nexport type ClickOnSwipeUpPayload = ClickOnButtonPayload & {\n  modeDesktop: boolean;\n  width: number;\n  height: number;\n  verticalMargin: number;\n};","// import {createStore, createEffect} from 'effector'\n\n// export const fetchUsersFx = createEffect()\n//\n// //imagine initially we have users list as a key-value store\n// export const $usersMap = createStore({})\n//\n// //we need array representation for our UI tasks\n// export const $users = $usersMap.map(usersMap => Object.values(usersMap))\n\n\nimport {createApi, createEffect, createStore} from 'effector';\nimport {STORY_LIST_TYPE} from \"../../types\";\nimport {$session} from \"../session\";\nimport {StoryManager} from \"../../index\";\nimport {isArray} from \"../../../helpers/isArray\";\nimport {isEmpty} from \"../../../helpers/isEmpty\";\n\nexport type StoryModel = {\n  id: number,\n  title: string,\n  title_color: string,\n  background: string, // img/video\n  background_color: string,\n  image: string,\n  display_to: number,\n  display_from: number,\n  slides_html: Array<number>, // expand\n  slides_duration: Array<number>,\n  favorite: boolean,\n  like: boolean,\n  slides_count: number,\n  deeplink: string,\n  hide_in_reader: boolean,\n  disable_close: boolean,\n  like_functional: boolean,\n  favorite_functional: boolean,\n  share_functional: boolean,\n  is_opened: boolean,\n  tags: string,\n  has_audio: boolean,\n  video_cover: string,\n  need_placeholders: boolean,\n  has_swipe_up: boolean,\n  sharePath: string,\n\n  slidesLoaded: boolean\n\n\n};\n\nconst $stories = createStore<Array<StoryModel>>([]);\nconst $storiesIds = createStore<Map<STORY_LIST_TYPE, Array<number>>>(new Map());\n\nconst $storiesDefault = createStore<Array<StoryModel>>([]);\nconst $storiesFavorite = createStore<Array<StoryModel>>([]);\nconst $storiesOnboarding = createStore<Array<StoryModel>>([]);\n\n$storiesDefault.on<any>([$storiesIds, $stories], (state, ids) => $stories.getState().filter(item => ($storiesIds.getState().get(STORY_LIST_TYPE.default) ?? []).indexOf(item.id) !== -1));\n$storiesFavorite.on<any>([$storiesIds, $stories], (state, ids) => $stories.getState().filter(item => ($storiesIds.getState().get(STORY_LIST_TYPE.favorite) ?? []).indexOf(item.id) !== -1));\n// width filter by ```is_opened```\n$storiesOnboarding.on<any>([$storiesIds, $stories], (state, ids) => $stories.getState().filter(item => ($storiesIds.getState().get(STORY_LIST_TYPE.onboarding) ?? []).indexOf(item.id) !== -1 && !item.is_opened));\n\n\nconst fetchStoriesFx = createEffect<{ listType: STORY_LIST_TYPE }, Array<StoryModel>, Error>();\n\n// localData isOpened\n// $stories.on(fetchStoriesFx.doneData, (_, stories: Array<StoryModel>) => stories);\n\nconst storyCheckLocalIsOpened = async (story: StoryModel, userKey: string = '') => {\n  if (story.is_opened) {\n    return story.is_opened;\n  }\n  const key = `u/${$session.getState().user_key}/s_opened` || userKey;\n  if (!isEmpty(key)) {\n    let data = await StoryManager.getInstance().localStorageGetArray<number>(key);\n    if (!isArray(data)) {\n      data = [];\n    }\n    if (data.indexOf(story.id) !== -1) {\n      return true;\n    }\n  }\n  return story.is_opened;\n}\n\n// const configChanged = createEvent<WidgetStoriesConfig>();\n// forward({\n//     from: configChanged,\n//     to: $config\n// });\n//\n// $stories.watch(s => console.log(`$stories.watch}`, s));\n// $storiesIds.watch(s => console.log(`$storiesIds.watch}`, s));\n// $storiesDefault.watch(s => console.log(`$storiesDefault.watch}`, s));\n// $storiesFavorite.watch(s => console.log(`$storiesFavorite.watch}`, s));\n// $storiesOnboarding.watch(s => console.log(`$storiesOnboarding.watch}`, s));\n\nconst $storiesIdsWithoutLoadedSlides = $stories.map(items => items.filter(item => !item.slidesLoaded).map(item => item.id));\n\nconst {storyItemFavoriteChanged, storyItemLikeChanged, storyItemIsOpenedChanged} = createApi($stories, {\n  storyItemFavoriteChanged: (state, {id, favorite}) => {\n    const models = state.slice(0);\n    const story = models.find(_ => _.id === id);\n    if (story !== undefined) {\n      story.favorite = favorite;\n    }\n    return models;\n  },\n  storyItemLikeChanged: (state, {id, like}) => {\n    const models = state.slice(0);\n    const story = models.find(_ => _.id === id);\n    if (story !== undefined) {\n      story.like = like;\n    }\n    return models;\n  },\n  storyItemIsOpenedChanged: (state, {id}) => {\n    const models = state.slice(0);\n    const story = models.find(_ => _.id === id);\n    if (story !== undefined) {\n      story.is_opened = true;\n    }\n    return models;\n  },\n\n});\n\n// const {storyFavoriteAdded, storyFavoriteDeleted} = createApi($storiesFavorite, {\n//     storyFavoriteAdded: (state, story: StoryModel) => state.concat([story]),\n//     storyFavoriteDeleted: (state, story: StoryModel) => state.filter(item => item.id !== story.id),\n//   }\n// );\n\nexport {\n  $stories,\n  $storiesIds,\n  fetchStoriesFx,\n  $storiesIdsWithoutLoadedSlides,\n  $storiesFavorite,\n  $storiesOnboarding,\n  $storiesDefault,\n  storyItemFavoriteChanged,\n  storyItemLikeChanged,\n  storyItemIsOpenedChanged,\n  storyCheckLocalIsOpened\n};\n","\n\n// context - for list ids\n\n\n\n\n\n// import {createStore, createEffect} from 'effector'\n\n// export const fetchUsersFx = createEffect()\n//\n// //imagine initially we have users list as a key-value store\n// export const $usersMap = createStore({})\n//\n// //we need array representation for our UI tasks\n// export const $users = $usersMap.map(usersMap => Object.values(usersMap))\n\n\nimport {createStore, createEvent, createEffect, createDomain, forward} from 'effector';\nimport {Option} from \"../../../../global.h\";\nimport {ApiResponse} from \"../../api\";\n\nexport type StoryContextModel = Option<{\n  style: string,\n  script: string,\n  ids: Array<number>\n}>;\n\nconst $storyContext = createStore<StoryContextModel>(null);\n// реализацию надо здесь же и писать\nconst fetchStoryContextFx = createEffect<{ids: Array<number>}, ApiResponse<StoryContextModel>, Error>();\nconst storyContextChanged = createEvent<StoryContextModel>();\n\n// $storyContext.watch((s, p) => console.log(`$storyContext.watch}`, s, p));\n\nexport {$storyContext, fetchStoryContextFx, storyContextChanged};\n","import './storyManagerConfig/init';\nimport './session/init';\nimport './story/init';\n\nimport API, {ApiRequestConfig} from './../api';\nimport {createApi, createEffect, Event, forward, sample} from \"effector\";\nimport {$session, SessionModel} from \"./session\";\nimport {getRequestConfig as sessionGetRequestConfig} from \"./session/init\";\nimport {getRequestConfig as storyContextGetRequestConfig} from \"./storyContext/init\";\nimport {\n  getRequestConfig as storyGetRequestConfig,\n  storySlidesGetRequestConfig\n} from \"./story/init\";\nimport {$stories, $storiesIds, storyCheckLocalIsOpened, StoryModel} from \"./story\";\nimport {$storyContext, StoryContextModel} from \"./storyContext\";\nimport {replaceAll} from \"../../stories_widget/util/string\";\nimport {$placeholders} from \"./placeholder\";\nimport {STORY_LIST_TYPE} from \"../types\";\nimport {Option, Dict} from \"../../../global.h\";\nimport {isEmpty} from \"../../helpers/isEmpty\";\nimport {isObject} from \"../../helpers/isObject\";\n\n\ntype CompositeResponseData<T = Dict<any>> = {\n  success: boolean,\n  compositeResponse: Array<{\n    ref: string,\n    body: T\n  }>,\n};\n\n\nconst fetchSessionAndStoriesCompositeFx = createEffect<{ defaultList: boolean, favoriteList: boolean, onboardingList: boolean, onboardingTags?: Array<string> },\n  Array<Dict>,\n  Error>(async ({defaultList, onboardingList, favoriteList, onboardingTags}): Promise<Array<Dict>> => {\n\n  // TODO custom tags for each list requests\n\n  const compositeRequest: Array<CompositeSubRequestData> = [];\n\n  const sessionId = $session.getState()?.session?.id;\n  let compositeSessionIdRef: Option<string> = null;\n  if (isEmpty(sessionId)) {\n    compositeRequest.push(getCompositeSubRequestDataFromRequestConfig(await sessionGetRequestConfig(), \"session\"));\n    compositeSessionIdRef = \"@{session.session.id}\";\n  }\n\n  if (defaultList) {\n    compositeRequest.push(getCompositeSubRequestDataFromRequestConfig(storyGetRequestConfig(STORY_LIST_TYPE.default, compositeSessionIdRef), \"storyList\"));\n  }\n\n  if (favoriteList) {\n    compositeRequest.push(getCompositeSubRequestDataFromRequestConfig(storyGetRequestConfig(STORY_LIST_TYPE.favorite, compositeSessionIdRef), \"storyFavoriteList\"));\n  }\n\n  if (onboardingList) {\n    compositeRequest.push(getCompositeSubRequestDataFromRequestConfig(storyGetRequestConfig(STORY_LIST_TYPE.onboarding, compositeSessionIdRef, onboardingTags), \"storyOnboardingList\"));\n  }\n\n  // todo try catch\n  const response = (await API.post<CompositeResponseData<Array<StoryModel>>>('composite', {compositeRequest}));\n\n  // console.log({data: response.data});\n\n  if (response.data && response.data.success && response.data.compositeResponse && Array.isArray(response.data.compositeResponse)) {\n    return response.data.compositeResponse;\n  }\n  return [];\n});\n\n// $session.on(fetchSessionFx.doneData, (_, session: Dict) => session);\n\n// const configChanged = createEvent<WidgetStoriesConfig>();\n// forward({\n//     from: configChanged,\n//     to: $config\n// });\n//\n\n// forward({\n//     from: fetchSessionFx.doneData,\n//     to: $session\n// });\n\ntype CompositeSubRequestData =\n  Pick<ApiRequestConfig, \"method\">\n  & { path?: string, qs?: Option<Dict>, body?: Option<Dict>, ref: string };\n\nconst getCompositeSubRequestDataFromRequestConfig = (config: ApiRequestConfig, ref: string): CompositeSubRequestData => {\n  const requestData: CompositeSubRequestData = {path: config.url, qs: config.params, body: config.data, ...config, ref};\n  return requestData;\n}\n\n\nconst replacePlaceholders = (value: string): string => {\n  for (let placeholdersKey in $placeholders.getState()) {\n    if ($placeholders.getState().hasOwnProperty(placeholdersKey)) {\n      value = replaceAll(value, `%${placeholdersKey}%`, $placeholders.getState()[placeholdersKey])\n    }\n  }\n  return value;\n};\n\nconst processStories = (list: Array<StoryModel> | undefined) => Array.isArray(list) ? list.map(item => ({\n  ...item,\n  title: item.need_placeholders ? replacePlaceholders(item.title) : item.title,\n  slidesLoaded: false,\n  is_opened: storyCheckLocalIsOpened(item)\n} as StoryModel)) : [];\n\n// продумать как проверять наличие полей в моделях\nforward({\n  from: fetchSessionAndStoriesCompositeFx.doneData.filterMap(list => list.find(item => item.ref === \"session\")?.body),\n  to: $session\n});\n\nsample({\n  source: $stories,\n  clock: $session,\n  fn: (source, clock) => source.map(item => ({...item, is_opened: storyCheckLocalIsOpened(item, clock.user_key)})),\n  target: $stories\n});\n\ntype StoriesListChangedEvent = {\n  listType: STORY_LIST_TYPE,\n  storyList: Array<StoryModel>\n};\nconst {storiesListItemsAdded} = createApi($stories, {\n    storiesListItemsAdded: (state, {listType, storyList}: StoriesListChangedEvent) => {\n      const ids = state.map(_ => _.id);\n      return [...state, ...storyList.filter(item => ids.indexOf(item.id) === -1)];\n    },\n\n  }\n);\nconst {storiesListIdsChanged} = createApi($storiesIds, {\n  storiesListIdsChanged: (state, {listType, storyList}: StoriesListChangedEvent) => {\n    const ids = new Map(state);\n    ids.set(listType, storyList.map(item => item.id));\n    return ids;\n  },\n});\n\nforward({\n  from: fetchSessionAndStoriesCompositeFx.doneData.filterMap(list => {\n    const storyList = processStories(list.find(item => item.ref === \"storyList\")?.body);\n    if (storyList.length > 0) {\n      return {\n        listType: STORY_LIST_TYPE.default,\n        storyList\n      };\n    }\n    return undefined;\n  }),\n  to: [storiesListItemsAdded, storiesListIdsChanged]\n});\nforward({\n  from: fetchSessionAndStoriesCompositeFx.doneData.filterMap(list => {\n    const storyList = processStories(list.find(item => item.ref === \"storyFavoriteList\")?.body);\n    if (storyList.length > 0) {\n      return {\n        listType: STORY_LIST_TYPE.favorite,\n        storyList\n      };\n    }\n    return undefined;\n  }),\n  to: [storiesListItemsAdded, storiesListIdsChanged]\n});\nforward({\n  from: fetchSessionAndStoriesCompositeFx.doneData.filterMap(list => {\n    // undefined - to prevent store trigger\n    const storyList = processStories(list.find(item => item.ref === \"storyOnboardingList\")?.body);\n\n    if (storyList.length > 0) {\n      return {\n        listType: STORY_LIST_TYPE.onboarding,\n        storyList\n      };\n    }\n    return undefined;\n  }),\n  to: [storiesListItemsAdded, storiesListIdsChanged]\n});\n\n\nconst fetchStoriesSlidesCompositeFx = createEffect<{ ids: Array<number> }, Array<{ body: StoryModel }>, Error>();\n\nfetchStoriesSlidesCompositeFx.use(async (params): Promise<Array<{ body: StoryModel }>> => {\n  const compositeRequest = params.ids.map(id => getCompositeSubRequestDataFromRequestConfig(storySlidesGetRequestConfig(id), `storySlides_${id}`));\n\n  // todo try catch\n  const response = await API.post<CompositeResponseData<StoryModel>>('composite', {compositeRequest});\n\n  // console.log({data: response.data});\n\n  if (response.data && response.data.success && response.data.compositeResponse && Array.isArray(response.data.compositeResponse)) {\n    return response.data.compositeResponse;\n  }\n  return [];\n});\n\nconst isStoryModel = (x: any): x is StoryModel => x && isObject(x) && (\"id\" in x);\nconst storySlidesReducer = (state: Array<StoryModel>, data: Array<{ body: StoryModel | StoryContextModel }>): Array<StoryModel> => {\n  if (Array.isArray(data) && Array.isArray(state)) {\n    return state.map(item => {\n      for (let i = 0; i < data.length; i++) {\n        // @ts-ignore\n        if (isStoryModel(data[i]?.body) && data[i]?.body?.id === item.id) {\n          return Object.assign({}, item, {\n            // @ts-ignore\n            slides_html: item.need_placeholders ? Array.from(data[i]?.body?.slides_html).map(item => replacePlaceholders(item)) : Array.from(data[i]?.body?.slides_html),\n            // @ts-ignore\n            slides_duration: data[i]?.body?.slides_duration,\n            slidesLoaded: true,\n            is_opened: storyCheckLocalIsOpened(item),\n          });\n        }\n      }\n      return item;\n    });\n  }\n  return state;\n};\n\n\nconst fetchStoriesContextAndStorySlidesCompositeFx = createEffect<{ ids: Array<number>, id: number }, Array<{ ref: string, body: StoryModel | StoryContextModel }>, Error>();\nfetchStoriesContextAndStorySlidesCompositeFx.use(async ({\n                                                          ids,\n                                                          id\n                                                        }): Promise<Array<{ ref: string, body: StoryModel | StoryContextModel }>> => {\n  const compositeRequest = [\n    getCompositeSubRequestDataFromRequestConfig(storySlidesGetRequestConfig(id), 'storySlides'),\n    getCompositeSubRequestDataFromRequestConfig(storyContextGetRequestConfig(ids), 'storyContext'),\n  ];\n\n  // todo try catch\n  const response = await API.post<CompositeResponseData<StoryModel|StoryContextModel>>('composite', {compositeRequest});\n\n  // console.log({data: response.data});\n\n  if (response.data && response.data.success && response.data.compositeResponse && Array.isArray(response.data.compositeResponse)) {\n    return response.data.compositeResponse;\n  }\n  return [];\n});\n\n// slides\n$stories.on<any>([fetchStoriesSlidesCompositeFx.doneData, fetchStoriesContextAndStorySlidesCompositeFx.doneData], storySlidesReducer);\n\nforward({\n  from: fetchStoriesContextAndStorySlidesCompositeFx.done.filterMap(list => {\n    const context = list.result.find(item => item.ref === \"storyContext\")?.body;\n    if (context && isObject(context)) {\n      return {...context, ids: list.params.ids};\n    }\n    return undefined;\n  }) as Event<Option<StoryContextModel>>,\n  to: $storyContext\n});\n\n// context and slides composite\n\n\n// split({\n//     source: fetchSessionAndStoriesCompositeFx,\n//     match: {\n//         session:\n//     }\n//\n// });\n\n\n/**\n * For load session, context, slides\n */\nconst fetchSessionAndStoryDataCompositeFx = createEffect<{ id: number | string}, Array<{ ref: string, body: SessionModel | StoryModel | StoryContextModel }>,\n  Error>(async ({id}): Promise<Array<{ ref: string, body: SessionModel | StoryModel | StoryContextModel }>> => {\n\n  const compositeRequest: Array<CompositeSubRequestData> = [];\n\n  const sessionId = $session.getState()?.session?.id;\n  let compositeSessionIdRef: Option<string> = null;\n  if (isEmpty(sessionId)) {\n    compositeRequest.push(getCompositeSubRequestDataFromRequestConfig(await sessionGetRequestConfig(), \"session\"));\n    compositeSessionIdRef = \"@{session.session.id}\";\n  }\n\n  compositeRequest.push(getCompositeSubRequestDataFromRequestConfig(storySlidesGetRequestConfig(id, true, compositeSessionIdRef), `story`));\n  compositeRequest.push(getCompositeSubRequestDataFromRequestConfig(storyContextGetRequestConfig([id], compositeSessionIdRef), 'storyContext'));\n\n  // todo try catch\n  const response = await API.post<CompositeResponseData<StoryModel|SessionModel|StoryContextModel>>('composite', {compositeRequest});\n\n  // console.log({data: response.data});\n\n  if (response.data && response.data.success && response.data.compositeResponse && Array.isArray(response.data.compositeResponse)) {\n    return response.data.compositeResponse;\n  }\n  if (response.data && !response.data.success) {\n    // todo 404 - part\n    // each - find error\n    throw Error('composite request error:' + JSON.stringify(response.data.compositeResponse));\n  }\n\n\n  return [];\n});\n\nconst isSessionModel = (item: any): item is SessionModel => {\n  return !!item\n}\nforward({\n  from: fetchSessionAndStoryDataCompositeFx.doneData.filterMap(list => {\n    const sessionModel = list.find(item => item.ref === \"session\")?.body;\n    if (sessionModel && isObject(sessionModel) && isSessionModel(sessionModel)) {\n      return sessionModel;\n    }\n    return undefined;\n  }),\n  to: $session\n});\n\nforward({\n  from: fetchSessionAndStoryDataCompositeFx.done.filterMap(list => {\n    const context = list.result.find(item => item.ref === \"storyContext\")?.body;\n    if (context && isObject(context)) {\n      // ids from back\n      return {...context, ids: [list.params.id]};\n    }\n    return undefined;\n  }) as Event<Option<StoryContextModel>>,\n  to: $storyContext\n});\n\n// slides\n$stories.on(fetchSessionAndStoryDataCompositeFx.doneData.filterMap(list => {\n  const story = list.find(item => item.ref === \"story\")?.body;\n  if (story && isObject(story)) {\n    return story;\n  }\n  return undefined;\n}), (state: Array<StoryModel>, data): Array<StoryModel> | undefined => {\n  if (!isStoryModel(data)) {\n    return undefined;\n  }\n\n  const newState = state.filter(_ => _.id !== (data as any)?.id).slice(0);\n  data = Object.assign(data, {\n    // @ts-ignore\n    slides_html: data.need_placeholders ? Array.from(data.slides_html).map(item => replacePlaceholders(item)) : Array.from(data.slides_html),\n    // @ts-ignore\n    slides_duration: data.slides_duration,\n    slidesLoaded: true,\n    is_opened: storyCheckLocalIsOpened(data),\n  });\n\n  newState.push(data);\n  return newState;\n});\n\n\n\nexport {\n  fetchSessionAndStoriesCompositeFx,\n  fetchStoriesSlidesCompositeFx,\n  fetchStoriesContextAndStorySlidesCompositeFx,\n  storiesListIdsChanged,\n  fetchSessionAndStoryDataCompositeFx\n};\n\n\n\n\n\n\n\n","import {Option, Dict} from \"../../global.h\";\n\nexport enum SharePageEvents {\n  START_LOADING = 'startLoading',\n  END_LOADING = 'endLoading',\n  CLOSE_STORY_READER = 'closeStoryReader',\n}\n\n\nexport type SharePageOptions = {\n\n  handleStartLoading?: () => void;\n  handleStopLoading?: (result: boolean) => void;\n\n  handleStoryReaderClose?: () => void;\n}\n","import {Dict, Option} from \"../../global.h\";\nimport {EventEmitter} from \"events\";\nimport {StoryManagerConfig} from \"./index.h\";\nimport {\n  ClickOnButtonPayload,\n  ClickOnFavoriteCellInternalPayload,\n  ClickOnStoryInternalPayload, ClickOnSwipeUpPayload,\n  StoriesEvents,\n  STORY_LIST_TYPE,\n  STORY_READER_WINDOW_REFERER\n} from \"./common.h\";\nimport {\n    $storyManagerConfig, configDeviceIdChanged, DeviceId, storyManagerConfigApiKeyChanged,\n    storyManagerConfigChanged, storyManagerConfigIsSandboxChanged,\n    storyManagerConfigLangChanged,\n    storyManagerConfigPlaceholdersChanged,\n    storyManagerConfigTagsChanged,\n    storyManagerConfigUserIdChanged\n} from \"./models/storyManagerConfig\";\nimport {sdkPlaceholdersChanged} from \"./models/placeholder\";\n\nimport {IWidgetStoriesList} from \"../widget-stories-list\";\n\n\n// import _StoryReader from \"./widget/_StoryReader\";\n\n// import {GoodsWidget} from \"~/src/storyManager/goodsWidget/GoodsWidget\";\n//\n// import _StoryFavorite from \"~/src/storyManager/widget/_StoryFavorite\";\n\nclass _StoryReader {}\nclass GoodsWidget {}\nclass _StoryFavorite {}\n\n\n// import {StoriesListClickEvent, StoriesListEvents} from \"./storiesList.h\";\n\nimport {\n  fetchSessionAndStoriesCompositeFx,\n  fetchSessionAndStoryDataCompositeFx,\n  fetchStoriesContextAndStorySlidesCompositeFx,\n  fetchStoriesSlidesCompositeFx,\n  storiesListIdsChanged\n} from \"./models/init\";\nimport {ObjectId} from \"../widget\";\nimport {createEffect, sample} from \"effector\";\nimport {\n  $stories,\n  $storiesDefault,\n  $storiesFavorite,\n  $storiesIdsWithoutLoadedSlides,\n  $storiesOnboarding,\n  storyItemFavoriteChanged,\n  storyItemIsOpenedChanged,\n  storyItemLikeChanged,\n  StoryModel\n} from \"./models/story\";\nimport API, {APISendBeacon} from \"./api\";\nimport {Utility} from \"../helpers/utility\";\nimport {$session, CacheResourceModel, sessionThumbViewsChanged} from \"./models/session\";\nimport {$storyContext, fetchStoryContextFx} from \"./models/storyContext\";\nimport {AppearanceManager} from \"./AppearanceManager\";\nimport {SharePageEvents, SharePageOptions} from \"./sharePage.h\";\nimport {StoryReaderOptions} from \"../widget-story-reader/index.h\";\nimport {ISessionInitData} from \"./models/Session2\";\nimport {IWidgetStoryReader} from \"../widget-story-reader\";\nimport {isArray} from \"../helpers/isArray\";\nimport {isFunction} from \"../helpers/isFunction\";\nimport {isString} from \"../helpers/isString\";\nimport {isEmpty} from \"../helpers/isEmpty\";\nimport {isObject} from \"../helpers/isObject\";\nimport {isNumber} from \"../helpers/isNumber\";\nimport {uniq} from \"../helpers/uniq\";\n\nclass StoriesList extends EventEmitter {\n\n}\n\nclass SharePage extends EventEmitter {\n\n}\n\nconst getStoryListByType = (listType: STORY_LIST_TYPE): Array<StoryModel> => {\n  switch (listType) {\n    case STORY_LIST_TYPE.default:\n      return $storiesDefault.getState();\n    case STORY_LIST_TYPE.favorite:\n      return $storiesFavorite.getState();\n    case STORY_LIST_TYPE.onboarding:\n      return $storiesOnboarding.getState();\n  }\n  return [];\n};\n\nconst getFontResources = () => $session.getState().cache.filter(item => item.type === 'font-face');\n\nconst _showStory = async (id: number | string, storyReaderInstance: _StoryReader) => {\n\n  // try catch if 200 - загружено а не 404\n\n  // очень странно, preset-typescript рунается на await\n  // const resp = await fetchSessionAndStoryDataCompositeFx({id});\n  // if (isString(id)) {\n  //   // get numeric id from response\n  //   if (isArray(resp)) {\n  //     id = (<StoryModel>resp.find(_ => _.ref === 'story')?.body)?.id;\n  //     await fetchStoryContextFx({ids: [id]});\n  //\n  //   }\n  // }\n\n  const story = $stories.getState().find(item => item.id === id);\n  // debug - console.log (if active)\n  // console.log({story, state: $stories.getState()});\n\n  if (story !== undefined) {\n\n    const openReaderData = {\n      windowReferer: STORY_READER_WINDOW_REFERER.default,\n      listType: STORY_LIST_TYPE.default,\n      id: story.id,\n      storyContext: $storyContext.getState(),\n      storyList: [story],\n      hasShare: $session.getState().share\n    }\n\n\n    // TODO закрыть если что то открыто\n    storyReaderInstance.closeReader();\n    storyReaderInstance.openReader(openReaderData);\n    return true;\n  }\n\n  // не false a exception\n  return false;\n};\n\n\nexport abstract class StoryManager extends EventEmitter {\n\n  private static instance?: StoryManager;\n\n\n\n\n  //Assign \"new StoryManager()\" here to avoid lazy initialisation\n\n\n  protected constructor(config: StoryManagerConfig, callbacks?: Dict<Function>) {\n    super();\n\n    if (!StoryManager.instance) {\n        storyManagerConfigChanged(config);\n\n        // и вынести в дополнение в отдельный метод для StoryManager\n        if (config.placeholders) {\n            sdkPlaceholdersChanged(config.placeholders);\n        }\n\n        if (callbacks && isObject(callbacks)) {\n            this._callbacks = callbacks;\n        }\n\n        StoryManager.instance = this;\n    }\n\n    return StoryManager.instance;\n\n  }\n\n  public destructor() {\n    // TODO\n    // close reader and others\n\n    delete StoryManager.instance;\n  }\n\n  private _callbacks: Dict<any> = {};\n\n  public set storyLinkClickHandler(callback: Function) {\n    if (isFunction(callback)) {\n      this._callbacks.storyLinkClickHandler = callback;\n    }\n  }\n\n  // SkuList => SkuFilledList\n  public set openGoodsWidgetHandler(callback: (skuList: Array<Dict>) => Promise<Array<Dict>>) {\n    if (isFunction(callback)) {\n      this._callbacks.openGoodsWidgetHandler = callback;\n    }\n  }\n\n  public get openGoodsWidgetHandler() {\n    return this._callbacks.openGoodsWidgetHandler;\n  }\n\n  static getInstance(): StoryManager {\n    if (!StoryManager.instance) {\n      throw new Error(\"Error - use new IAS.StoryManager(). For first init - with config\");\n      // или разрешить в getInstance передавтаь конфиг для первого вызова\n    }\n    // StoryManager.instance = StoryManager.instance || new StoryManager();\n    return StoryManager.instance;\n  }\n\n\n  public abstract createWidgetStoriesList(appearanceManager: AppearanceManager): IWidgetStoriesList;\n\n  public abstract createWidgetStoryReader(setNeedFirstRender: (value: boolean) => void, detachComponent: () => void): IWidgetStoryReader;\n\n  public abstract getDeviceInfo(configDeviceIdChanged: (device_id: DeviceId) => void): Promise<ISessionInitData>;\n\n  public abstract localStorageGet<T extends object>(key: string): Promise<Option<T>>;\n  // data - object like model or simple value, not JSON encoded string\n  public abstract localStorageSet(key: string, data: object): Promise<void>;\n\n  public abstract localStorageGetArray<T extends any>(key: string): Promise<Option<Array<T>>>;\n  // data - object like model or simple value, not JSON encoded string\n  public abstract localStorageSetArray(key: string, data: Array<any>): Promise<void>;\n\n\n  /**\n   * StoriesList\n   *\n   * интерфейс для DOM-sdk\n   */\n  public StoriesList = class extends EventEmitter {\n    private storyListWidget!: IWidgetStoriesList;\n    private appearanceManager!: AppearanceManager;\n\n    constructor(mountSelector: string, appearanceManager: AppearanceManager, ref: string = 'default') {\n      super();\n\n      // Factory\n\n      // StoryManager.instance,some = this.factoryMethod\n\n      // StoryManager.instance._storiesList(mountSelector, appearanceManager, this).then(({\n      //                                                                                    storyListWidget,\n      //                                                                                    appearanceManager\n      //                                                                                  }) => {\n      //   this.storyListWidget = storyListWidget;\n      //   this.appearanceManager = appearanceManager;\n      // });\n      // return this;\n\n\n    }\n\n    public async reload(options: { needLoader: boolean } = {needLoader: true}) {\n      let needLoader = true;\n      if (options?.needLoader === false) {\n        needLoader = false;\n      }\n      try {\n        await StoryManager.instance._loadStoriesList(this.storyListWidget, this.appearanceManager, this, false, needLoader);\n        return true;\n      } catch (e) {\n        throw Error(e as string);\n      }\n    }\n\n  }\n\n\n  public setTags(tags: Array<string>): void {\n    if (isArray(tags)) {\n      storyManagerConfigTagsChanged({tags});\n    } else {\n      // throw Error;\n    }\n  }\n\n  public setUserId(userId: string | number): void {\n    if (isString(userId) || isNumber(userId)) {\n      storyManagerConfigUserIdChanged({userId});\n    }\n  }\n\n  public setLang(lang: 'ru' | 'en'): void {\n    if (isString(lang)) {\n      storyManagerConfigLangChanged({lang});\n    }\n  }\n\n  public setPlaceholders(placeholders: Dict<string>): void {\n    if (isObject(placeholders)) {\n      storyManagerConfigPlaceholdersChanged({placeholders});\n    }\n  }\n\n    public setIsSandbox(isSandbox: boolean) {\n        storyManagerConfigIsSandboxChanged({isSandbox});\n    }\n\n    public setApiKey(apiKey: string) {\n        storyManagerConfigApiKeyChanged({apiKey});\n    }\n\n\n  // story Builder ?\n  // update config (set new user or tags)\n  // основная установка через init + возможность update каждого параметра\n\n\n  // tags - для каждого списка - свои теги\n  // идея с разными списками сторис\n\n  //\n\n  private _appearanceManager: Option<AppearanceManager> = null;\n  protected get appearanceManager() {\n    return this._appearanceManager;\n  }\n  protected set appearanceManager(_: Option<AppearanceManager>) {\n    this._appearanceManager = _;\n  }\n\n  private storyListInstance: Option<IWidgetStoriesList> = null;\n\n  private _storyReaderInstance: Option<IWidgetStoryReader> = null;\n  private storyReaderInstancePromise: Option<Promise<IWidgetStoryReader>> = null;\n  private storyReaderInstancePromiseResolver: Option<(value: IWidgetStoryReader) => void> = null;\n\n  private _goodsWidgetInstance: Option<GoodsWidget> = null;\n\n  private _storyReaderNeedFirstRender: Option<(value: boolean) => void> = null;\n  protected set storyReaderNeedFirstRender (cb: (value: boolean) => void) {\n    this._storyReaderNeedFirstRender = cb;\n  }\n\n  private _storyReaderDetachComponent: Option<() => void> = null;\n  protected set storyReaderDetachComponent (cb: () => void) {\n    this._storyReaderDetachComponent = cb;\n  }\n\n  public get storyReaderInstance(): Option<IWidgetStoryReader> {\n    return this._storyReaderInstance;\n  }\n\n  private async getStoryReaderInstance(): Promise<IWidgetStoryReader> {\n\n    // если есть контейнер - инициализируем в нем\n\n    // if (this.storyReaderInstancePromise === null) {\n    //   this.storyReaderInstancePromise = this.initStoryReader(appearanceManager, fontResources);\n    // }\n\n    return new Promise((resolve, reject) => {\n      if (this._storyReaderInstance == null) {\n\n        if (this.storyReaderInstancePromise == null) {\n\n          if (this._storyReaderNeedFirstRender != null) {\n            this._storyReaderNeedFirstRender(true);\n          }\n          // create promise\n          // wait for widgetLoaded\n          this.storyReaderInstancePromise = new Promise<IWidgetStoryReader>((resolve, reject) => this.storyReaderInstancePromiseResolver = resolve);\n          // this.storyReaderInstancePromise = this.initStoryReader(appearanceManager, getFontResources());\n        }\n\n        this.storyReaderInstancePromise.then(_ => {\n          this._storyReaderInstance = _;\n          resolve(_);\n        });\n      } else {\n        resolve(this._storyReaderInstance);\n      }\n    });\n  }\n\n\n\n  // вынести в отдельный класс это все\n  protected _storyReaderWidgetLoaded = async (storyReaderWidget: IWidgetStoryReader) => {\n\n    this.completeInitStoryReader(storyReaderWidget, getFontResources());\n    if (this.storyReaderInstancePromiseResolver != null) {\n      this.storyReaderInstancePromiseResolver(storyReaderWidget);\n    }\n\n  }\n\n  private _storyFavoriteReaderInstance: Option<_StoryFavorite> = null;\n  private storyFavoriteReaderInstancePromise: Option<Promise<_StoryFavorite>> = null;\n\n  private async getStoryFavoriteReaderInstance(): Promise<_StoryFavorite> {\n    return new Promise((resolve, reject) => {\n      if (this._storyFavoriteReaderInstance === null) {\n        if (this.storyFavoriteReaderInstancePromise !== null) {\n          this.storyFavoriteReaderInstancePromise.then(_ => {\n            this._storyFavoriteReaderInstance = _;\n            resolve(_);\n          });\n        } else {\n          reject('_storyFavoriteReaderInstance not inited yet');\n        }\n      } else {\n        resolve(this._storyFavoriteReaderInstance);\n      }\n    });\n  }\n\n\n  private _loadedStoriesLength = {\n    defaultListLength: 0,\n    favoriteListLength: 0\n  };\n  // версия для dom-sdk - с loader\n  // private _loadStoriesList = async (storyListWidget: IWidgetStoriesList, appearanceManager: AppearanceManager, storiesList: StoriesList, needFavorite = true, needLoader = true) => {\n  //\n  //   const storiesListOptions = appearanceManager.storiesListOptions;\n  //\n  //   if (needLoader) {\n  //     // loader\n  //     if (storiesListOptions.handleStartLoading && isFunction(storiesListOptions.handleStartLoading) || storiesList.listenerCount(StoriesListEvents.START_LOADER) !== 0) {\n  //       if (storiesListOptions.handleStartLoading && isFunction(storiesListOptions.handleStartLoading)) {\n  //         storiesListOptions.handleStartLoading(storyListWidget.loaderContainer);\n  //       } else {\n  //         storiesList.emit(StoriesListEvents.START_LOADER, storyListWidget.loaderContainer);\n  //       }\n  //     } else {\n  //       storyListWidget.startLoader();\n  //     }\n  //   }\n  //\n  //   const favoriteList = (appearanceManager.commonOptions.hasFavorite === true ? true : false) && needFavorite;\n  //\n  //   await fetchSessionAndStoriesCompositeFx({defaultList: true, onboardingList: false, favoriteList});\n  //\n  //\n  //\n  //   if (needLoader) {\n  //     // stop loader\n  //     // emit все равно делать\n  //     // и самим стопать если нет подписки\n  //     if (storiesListOptions.handleStopLoading && isFunction(storiesListOptions.handleStopLoading) || storiesList.listenerCount(StoriesListEvents.END_LOADER) !== 0) {\n  //       if (storiesListOptions.handleStopLoading && isFunction(storiesListOptions.handleStopLoading)) {\n  //         storiesListOptions.handleStopLoading(storyListWidget.loaderContainer, this._loadedStoriesLength);\n  //       } else {\n  //         storiesList.emit(StoriesListEvents.END_LOADER, storyListWidget.loaderContainer, this._loadedStoriesLength);\n  //       }\n  //     } else {\n  //       storyListWidget.stopLoader();\n  //     }\n  //   }\n  // }\n\n  private _loadStoriesList = async (storyListWidget: IWidgetStoriesList, appearanceManager: AppearanceManager, needFavorite = true) => {\n    const favoriteList = (appearanceManager.commonOptions.hasFavorite === true ? true : false) && needFavorite;\n    await fetchSessionAndStoriesCompositeFx({defaultList: true, onboardingList: false, favoriteList});\n  }\n\n\n  // private _storiesList = async (mountSelector: string, appearanceManager: AppearanceManager, storiesList: StoriesList):\n  //   Promise<{ storyListWidget: IWidgetStoriesList, appearanceManager: AppearanceManager }> => {\n  //\n  //\n  //   const storiesListOptions = appearanceManager.storiesListOptions;\n  //\n  //   // await create and mount widget -- after inited - we can pass data them\n  //   const storyListWidget = this.createWidgetStoriesList(mountSelector, {});\n  //\n  //   // init widget\n  //   await storyListWidget.init(mountSelector as ObjectId, {\n  //     ...storiesListOptions,\n  //     hasFavorite: appearanceManager.commonOptions.hasFavorite\n  //   });\n  //\n  //   sample({\n  //     source: $storiesDefault,\n  //     clock: $storiesDefault,\n  //     target: createEffect((storyList: Array<StoryModel>) => {\n  //       this._loadedStoriesLength.defaultListLength = storyList.length;\n  //       storyListWidget.setStories({\n  //         listType: STORY_LIST_TYPE.default,\n  //         storyList\n  //       });\n  //     })\n  //   });\n  //\n  //   if (appearanceManager.commonOptions.hasFavorite) {\n  //     sample({\n  //       source: $storiesFavorite,\n  //       clock: $storiesFavorite,\n  //       target: createEffect(async (storyList: Array<StoryModel>) => {\n  //         this._loadedStoriesLength.favoriteListLength = storyList.length;\n  //         storyListWidget.setStories({\n  //           listType: STORY_LIST_TYPE.favorite,\n  //           storyList\n  //         });\n  //         (await this.getStoryFavoriteReaderInstance()).setStories({\n  //           listType: STORY_LIST_TYPE.favorite,\n  //           storyList\n  //         });\n  //       })\n  //     });\n  //   }\n  //\n  //   // session - init if empty\n  //   // load and render\n  //\n  //   // if not opened\n  //   // Session.open\n  //\n  //   // config - move to models/config\n  //\n  //   // placeholders -- мерджить с конфигом и применять к моделям\n  //   // from common config (not from storyList config)\n  //\n  //   await this._loadStoriesList(storyListWidget, appearanceManager, storiesList, true, true);\n  //\n  //   const fontResources = getFontResources();\n  //   storyListWidget.setFonts(fontResources);\n  //\n  //   const params = $storyManagerConfig.getState();\n  //   storyListWidget.setCallbacks({\n  //     // deeplink from list\n  //     handleClickOnStoryDeepLink: (payload: StoriesListClickEvent) => {\n  //\n  //       // public event\n  //\n  //       // просто клик на ячейку\n  //       // if (config?.handleClickOnStory && isFunction(config?.handleClickOnStory)) {\n  //       //   config?.handleClickOnStory(payload);\n  //       // }\n  //\n  //\n  //       const dataForSending = {\n  //         // state.data.push([\n  //         //     action,\n  //         //     state.lastIndex,\n  //         //     storyId,\n  //         //     slideIndex,\n  //         //     slideDuration\n  //         // ]);\n  //         // state.lastIndex++\n  //         data: [[\n  //           1, //action: 1, // Прочтение\n  //           0, // lastIndex\n  //           payload.id, // storyId: e.storyId, // id story,\n  //           0, // slideIndex: 0, // индекс слайда\n  //           0, //slideDuration: 0\n  //         ]]\n  //       };\n  //\n  //       APISendBeacon('session/update', dataForSending, Utility.createFunctionWithTimeout(() => {\n  //\n  //\n  //         if (payload.isDeeplink && payload.url) {\n  //\n  //           // или событие\n  //           if (storiesListOptions?.handleStoryLinkClick && isFunction(storiesListOptions?.handleStoryLinkClick)) {\n  //             storiesListOptions?.handleStoryLinkClick(payload);\n  //           } else {\n  //             window.open(payload.url, '_self');\n  //           }\n  //         }\n  //\n  //       }));\n  //     },\n  //\n  //     // public event\n  //     handleClickOnStory: (payload: any) => {\n  //       // if (storiesListOptions?.handleClickOnStory && isFunction(storiesListOptions?.handleClickOnStory)) {\n  //       //   storiesListOptions?.handleClickOnStory(payload);\n  //       // }\n  //     },\n  //\n  //     handleFlushThumbViews: (payload: Array<number>) => {\n  //       // console.log('handleFlushThumbViews', payload);\n  //       sessionThumbViewsChanged(payload);\n  //     },\n  //\n  //\n  //     handleClickOnStoryInternal: (payload: ClickOnStoryInternalPayload) => this.handleClickOnStoryInternal(payload)\n  //\n  //\n  //   });\n  //\n  //\n  //   storyListWidget.on('clickOnFavoriteCellInternal', async (payload: ClickOnFavoriteCellInternalPayload) => {\n  //     const openReaderData = {\n  //       ...payload,\n  //       // storyContext: $storyContext.getState(),\n  //       storyList: getStoryListByType(STORY_LIST_TYPE.favorite),\n  //     };\n  //     (await this.getStoryFavoriteReaderInstance()).openReader(openReaderData);\n  //   });\n  //\n  //\n  //   // await fetchSessionFx({});\n  //   //\n  //   // // fetch default list\n  //   // await fetchStoriesFx({listType: STORY_LIST_TYPE.default});\n  //\n  //\n  //   // components api interface\n  //   // глобальный флаг - выбираем фабрику для интерфейса\n  //   // сами компоненты уже используют abstract functions\n  //   // и здесь отвтеная часть реагется\n  //   // storyListWidget object\n  //   // storyReaderWidget object etc\n  //   // favoriteReaderWidget object\n  //   // msgpack\n  //   // story manager хранит у себя виджеты и их rpc (внутри виджетов ?) (в parent class - field)\n  //\n  //\n  //   // все же грузить вместе с лентой\n  //   // let storyReaderInstancePromise: Option<Promise<_StoryReader>> = null;\n  //   // if (this.storyReaderInstance === null) {\n  //   //   storyReaderInstancePromise = this.initStoryReader($config.getState(), fontResources);\n  //   // }\n  //\n  //   this.storyListInstance = storyListWidget;\n  //\n  //   if (this.storyReaderInstancePromise === null) {\n  //     this.storyReaderInstancePromise = this.initStoryReader(appearanceManager, fontResources);\n  //   }\n  //\n  //   if (this.storyFavoriteReaderInstancePromise === null) {\n  //     this.storyFavoriteReaderInstancePromise = this.initStoryFavoriteReader(appearanceManager, fontResources);\n  //   }\n  //\n  //   return {storyListWidget, appearanceManager};\n  //\n  // }\n\n  // базовая версия без лоадера\n\n  // вынести в отдельный класс эт овсе\n  protected _storiesListWidgetLoaded = async (storyListWidget: IWidgetStoriesList, appearanceManager: AppearanceManager) => {\n\n    const storiesListOptions = appearanceManager.storiesListOptions;\n\n    sample({\n      source: $storiesDefault,\n      clock: $storiesDefault,\n      target: createEffect((storyList: Array<StoryModel>) => {\n        this._loadedStoriesLength.defaultListLength = storyList.length;\n        storyListWidget.setStories({\n          listType: STORY_LIST_TYPE.default,\n          storyList\n        });\n      })\n    });\n\n    if (appearanceManager.commonOptions.hasFavorite) {\n      sample({\n        source: $storiesFavorite,\n        clock: $storiesFavorite,\n        target: createEffect(async (storyList: Array<StoryModel>) => {\n          this._loadedStoriesLength.favoriteListLength = storyList.length;\n          storyListWidget.setStories({\n            listType: STORY_LIST_TYPE.favorite,\n            storyList\n          });\n          (await this.getStoryFavoriteReaderInstance()).setStories({\n            listType: STORY_LIST_TYPE.favorite,\n            storyList\n          });\n        })\n      });\n    }\n\n    // session - init if empty\n    // load and render\n\n    // if not opened\n    // Session.open\n\n    // config - move to models/config\n\n    // placeholders -- мерджить с конфигом и применять к моделям\n    // from common config (not from storyList config)\n\n    // needFavorite\n    await this._loadStoriesList(storyListWidget, appearanceManager, true);\n\n    const fontResources = getFontResources();\n    storyListWidget.setFonts(fontResources);\n\n    const params = $storyManagerConfig.getState();\n    storyListWidget.setCallbacks({\n      // deeplink from list\n      handleClickOnStoryDeepLink: (payload: StoriesListClickEvent) => {\n\n        // public event\n\n        // просто клик на ячейку\n        // if (config?.handleClickOnStory && isFunction(config?.handleClickOnStory)) {\n        //   config?.handleClickOnStory(payload);\n        // }\n\n\n        const dataForSending = {\n          // state.data.push([\n          //     action,\n          //     state.lastIndex,\n          //     storyId,\n          //     slideIndex,\n          //     slideDuration\n          // ]);\n          // state.lastIndex++\n          data: [[\n            1, //action: 1, // Прочтение\n            0, // lastIndex\n            payload.id, // storyId: e.storyId, // id story,\n            0, // slideIndex: 0, // индекс слайда\n            0, //slideDuration: 0\n          ]]\n        };\n\n        APISendBeacon('session/update', dataForSending, Utility.createFunctionWithTimeout(() => {\n\n\n          if (payload.isDeeplink && payload.url) {\n\n            // или событие\n            if (storiesListOptions?.handleStoryLinkClick && isFunction(storiesListOptions?.handleStoryLinkClick)) {\n              storiesListOptions?.handleStoryLinkClick(payload);\n            } else {\n              window.open(payload.url, '_self');\n            }\n          }\n\n        }));\n      },\n\n      // public event\n      handleClickOnStory: (payload: any) => {\n        // if (storiesListOptions?.handleClickOnStory && isFunction(storiesListOptions?.handleClickOnStory)) {\n        //   storiesListOptions?.handleClickOnStory(payload);\n        // }\n      },\n\n      handleFlushThumbViews: (payload: Array<number>) => {\n        // console.log('handleFlushThumbViews', payload);\n        sessionThumbViewsChanged(payload);\n      },\n\n\n      handleClickOnStoryInternal: (payload: ClickOnStoryInternalPayload) => this.handleClickOnStoryInternal(payload),\n\n    });\n\n\n    storyListWidget.on('clickOnFavoriteCellInternal', async (payload: ClickOnFavoriteCellInternalPayload) => {\n      const openReaderData = {\n        ...payload,\n        // storyContext: $storyContext.getState(),\n        storyList: getStoryListByType(STORY_LIST_TYPE.favorite),\n      };\n      (await this.getStoryFavoriteReaderInstance()).openReader(openReaderData);\n    });\n\n\n    // await fetchSessionFx({});\n    //\n    // // fetch default list\n    // await fetchStoriesFx({listType: STORY_LIST_TYPE.default});\n\n\n    // components api interface\n    // глобальный флаг - выбираем фабрику для интерфейса\n    // сами компоненты уже используют abstract functions\n    // и здесь отвтеная часть реагется\n    // storyListWidget object\n    // storyReaderWidget object etc\n    // favoriteReaderWidget object\n    // msgpack\n    // story manager хранит у себя виджеты и их rpc (внутри виджетов ?) (в parent class - field)\n\n\n    // все же грузить вместе с лентой\n    // let storyReaderInstancePromise: Option<Promise<_StoryReader>> = null;\n    // if (this.storyReaderInstance === null) {\n    //   storyReaderInstancePromise = this.initStoryReader($config.getState(), fontResources);\n    // }\n\n    this.storyListInstance = storyListWidget;\n\n    // не будем сразу инициализировать\n\n    // if (this.storyReaderInstancePromise == null) {\n    //   this.storyReaderInstancePromise = this.initStoryReader(appearanceManager, fontResources);\n    // }\n    //\n    // if (this.storyFavoriteReaderInstancePromise == null) {\n    //   this.storyFavoriteReaderInstancePromise = this.initStoryFavoriteReader(appearanceManager, fontResources);\n    // }\n\n    return {storyListWidget, appearanceManager};\n\n  }\n\n  private async handleClickOnStoryInternal(payload: ClickOnStoryInternalPayload) {\n    // load expand story, img resources,\n    // create story reader instance\n    // open story reader\n\n    console.log('clickOnStoryInternalEvent 3');\n    console.log('[handleClickOnStoryInternal] -- open Reader', payload);\n\n\n    // state - loading\n\n    // open / close iframe container\n    // with - sbHelper.setScrollbar(); (open)\n\n\n    // load all slides\n    // await fetchStoriesSlidesCompositeFx({ids: $storiesIdsWithoutLoadedSlides.getState()});\n\n\n    // load expand target story and list context\n\n\n    // context и ids slides -- грузить только для нужного списка\n    const storyContext = $storyContext.getState();\n    // неправильно, нужно - сравиниать со спиком, который щас открываем\n    let storyContextExists = storyContext !== null/* && storyContext.ids === $storiesIdsWithoutLoadedSlides.getState()*/;\n    if (storyContext && $storiesIdsWithoutLoadedSlides.getState().length > 0) {\n      if (storyContext.ids !== $storiesIdsWithoutLoadedSlides.getState()) {\n        storyContextExists = false;\n      }\n    }\n    // TODO  $storiesIdsWithoutLoadedSlides.getState() -- для нужного списка фильтровать или для каждой сторис грузить отдельно layout\n    // у каждой сторис просто хранить ее layout (ее кастомная часть, а общую - в context стили общие и проетка) частная -- стили и виджеты)\n    const story = getStoryListByType(payload.listType).find(_ => _.id === payload.id);\n    if (!storyContextExists && (story && !story.slidesLoaded)) {\n      await fetchStoriesContextAndStorySlidesCompositeFx({\n        ids: $storiesIdsWithoutLoadedSlides.getState(),\n        id: payload.id\n      });\n    } else {\n      if (!storyContextExists) {\n        if ($storiesIdsWithoutLoadedSlides.getState().length) {\n          await fetchStoryContextFx({ids: $storiesIdsWithoutLoadedSlides.getState()});\n        }\n      } else if (!story || !story.slidesLoaded) {\n        await fetchStoriesSlidesCompositeFx({ids: [payload.id]});\n      }\n    }\n\n// beforehand - open reader with loader screen\n\n// list type\n// this.storyReaderInstance.setStories($stories.getState());\n// this.storyReaderInstance.setStoriesContext($storyContext.getState());\n\n\n    const openReaderData = {\n      ...payload,\n      storyContext: $storyContext.getState(),\n      storyList: getStoryListByType(payload.listType),\n      hasShare: $session.getState().share\n    }\n\n\n// run example app - in server env + README\n// without chrome server\n\n\n    // try catch\n    const storyReaderInstance = await this.getStoryReaderInstance();\n    // if (this._storyReaderNeedFirstRender != null) {\n    //   this._storyReaderNeedFirstRender(true);\n    // }\n\n    console.log('clickOnStoryInternalEvent 4', storyReaderInstance);\n\n    storyReaderInstance.openReader(openReaderData);\n\n    // fetch other slides\n    const ids = $storiesIdsWithoutLoadedSlides.getState();\n    if (ids.length > 0) {\n      await fetchStoriesSlidesCompositeFx({ids});\n    }\n\n    // set stories\n    storyReaderInstance.setStories({listType: payload.listType, storyList: getStoryListByType(payload.listType)});\n\n  }\n\n  // composite для expand сторис\n  // react library\n  // add method - close reader из вне\n\n\n  protected completeInitStoryReader(storyReaderInstance: IWidgetStoryReader/*, appearanceManager: AppearanceManager*/, fonts: Array<CacheResourceModel>, overrideStoryReaderOptions: Pick<StoryReaderOptions, \"recycleStoriesList\" | \"closeOnLastSlideByTimer\"> = {}) {\n    // инстанс виджета создается через JSX\n    // const storyReaderInstance = new _StoryReader('body', {});\n\n    // await storyReaderInstance.init('body' as ObjectId, {\n    //   ...appearanceManager.storyReaderOptions,\n    //   appearanceCommon: appearanceManager.commonOptions,\n    //   ...overrideStoryReaderOptions\n    // });\n\n\n\n    storyReaderInstance.setFonts(fonts);\n\n    // set all callbacks\n    storyReaderInstance.setCallbacks({\n      // public events\n\n\n    });\n\n    // todo избавиться от этой связи -- storyListInstance\n    // т.к. может быть мнго списоков в менеджере\n\n    storyReaderInstance.on('storyOpenedInternal', (payload: { id: number }) => this.storyListInstance?.onStoryOpened(payload));\n\n    storyReaderInstance.on('setStoryOpened', async (payload: { listTYpe: STORY_LIST_TYPE, id: string, data: any, cb: string }) => {\n      // update store and localStorage\n\n      if (!isEmpty($session.getState().user_key)) {\n        const key = `u/${$session.getState().user_key}/s_opened`;\n        let data = await this.localStorageGetArray<number>(key);\n        if (!isArray(data)) {\n          data = [];\n        }\n        data.push(payload.data.id);\n        data = uniq(data);\n        this.localStorageSetArray(key, data)\n      }\n\n\n      // @ts-ignore\n      storyItemIsOpenedChanged({id: payload.data.id});\n\n      storyReaderInstance.rpcCb(payload.cb, {requestId: payload.id, success: true, data: payload.data, err: ''});\n\n    });\n\n    storyReaderInstance.on('updateStoryFavorite', async (payload: { listTYpe: STORY_LIST_TYPE, id: string, data: any, cb: string }) => {\n\n      // console.log('updateStoryFavorite', payload);\n      // call api and update model in store\n      let success = false;\n      const data: { favorite: undefined | boolean } = {\n        favorite: undefined\n      };\n      let err = '';\n      try {\n        const response = await API.post<Dict<any>>(`story-favorite/${payload.data.id}`, {value: payload.data.favorite});\n        if (response.data.favorite !== undefined) {\n          success = true;\n          data.favorite = Boolean(response.data.favorite);\n\n          // @ts-ignore\n          storyItemFavoriteChanged({id: payload.data.id, favorite: data.favorite});\n          if (data.favorite === false) {\n            // @ts-ignore\n            storiesListIdsChanged({\n              listType: STORY_LIST_TYPE.favorite,\n              storyList: $storiesFavorite.getState().filter(_ => _.id !== payload.data.id)\n            });\n          } else {\n            // @ts-ignore\n            storiesListIdsChanged({\n              listType: STORY_LIST_TYPE.favorite,\n              storyList: [...$storiesFavorite.getState(), ...$stories.getState().filter(_ => _.id === payload.data.id)]\n            });\n          }\n\n        } else {\n          err = 'response.data.favorite is undefined';\n        }\n      } catch (e) {\n        // @ts-ignore\n        err = e.toString();\n      }\n\n      storyReaderInstance.rpcCb(payload.cb, {requestId: payload.id, success, data, err});\n\n    });\n\n    storyReaderInstance.on('updateStoryLike', async (payload: { listTYpe: STORY_LIST_TYPE, id: string, data: any, cb: string }) => {\n\n      // console.log('updateStoryLike', payload);\n      // call api and update model in store\n      let success = false;\n      const data: { like: undefined | number } = {\n        like: undefined\n      };\n      let err = '';\n      try {\n        const response = await API.post<Dict<any>>(`story-like/${payload.data.id}`, {value: payload.data.like});\n        if (response.data.like !== undefined) {\n          success = true;\n          data.like = response.data.like;\n\n          // @ts-ignore\n          // в effector не надо ?\n          // storyItemLikeChanged({id: payload.data.id, like: data.like});\n        } else {\n          err = 'response.data.like is undefined';\n        }\n      } catch (e) {\n        // @ts-ignore\n        err = e.toString();\n      }\n\n      storyReaderInstance.rpcCb(payload.cb, {requestId: payload.id, success, data, err});\n\n    });\n\n    storyReaderInstance.on('getStorySharePath', async (payload: { listTYpe: STORY_LIST_TYPE, id: string, data: any, cb: string }) => {\n\n      let success = false;\n      const data: { url: undefined | number } = {\n        url: undefined\n      };\n      let err = '';\n      try {\n        const response = await API.get<Dict<any>>(`story-share/${payload.data.id}`);\n        if (response.data.url !== undefined) {\n          success = true;\n          data.url = response.data.url;\n\n          // @ts-ignore\n          storyItemLikeChanged({id: payload.data.id, url: data.url});\n        } else {\n          err = 'response.data.url is undefined';\n        }\n      } catch (e) {\n        // @ts-ignore\n        err = e.toString();\n      }\n\n      storyReaderInstance.rpcCb(payload.cb, {requestId: payload.id, success, data, err});\n\n    });\n\n    storyReaderInstance.on('updateStoriesStat', async (payload: { listTYpe: STORY_LIST_TYPE, id: string, data: any, cb: string }) => {\n\n      // console.log('updateStoryLike', payload);\n      // call api and update model in store\n      let success = false;\n      let data: Dict = {};\n      let err = '';\n      try {\n        const response = await API.post<Dict<any>>(`session/update`, payload.data);\n        if (response.data !== undefined) {\n          success = true;\n          data = response.data;\n        } else {\n          err = 'response.data is undefined';\n        }\n      } catch (e) {\n        // @ts-ignore\n        err = e.toString();\n      }\n\n      storyReaderInstance.rpcCb(payload.cb, {requestId: payload.id, success, data, err});\n\n    });\n\n\n    // button from slide\n    storyReaderInstance.on('clickOnButton', (payload: ClickOnButtonPayload) => {\n      if (isFunction(this._callbacks.storyLinkClickHandler) || this.listenerCount(StoriesEvents.CLICK_ON_STORY) > 0) {\n        const cbPayload = {src: 'storyReader', srcRef: 'default', data: payload};\n        try {\n          if (isFunction(this._callbacks.storyLinkClickHandler)) {\n            this._callbacks.storyLinkClickHandler(cbPayload);\n          }\n          this.emit(StoriesEvents.CLICK_ON_STORY, cbPayload);\n        } catch (e) {\n          console.error(e)\n        }\n      } else {\n        window.open(payload.url, '_self');\n      }\n    });\n\n\n    // SwipeUpGoods\n    // map - по названи. события - какой тип payload\n    storyReaderInstance.on('clickOnSwipeUpGoods', (payload: ClickOnSwipeUpPayload) => {\n      if (storyReaderInstance) {\n        this._goodsWidgetInstance = new GoodsWidget(this, appearanceManager, storyReaderInstance, payload);\n\n        this._goodsWidgetInstance.once('close', (data: { elementId: string }) => {\n          this._goodsWidgetInstance = null;\n\n          if (storyReaderInstance) {\n            // on close - for resumeUI\n            storyReaderInstance.closeGoodsWidget(data);\n          }\n        });\n      }\n    });\n\n    // StatusBar\n    storyReaderInstance.on('openStoryReader', (options: { windowReferer: STORY_READER_WINDOW_REFERER }) => {\n\n    });\n\n    storyReaderInstance.on('closeStoryReader', (options: { windowReferer: STORY_READER_WINDOW_REFERER }) => {\n      StoryManager.instance?.closeGoodsWidget();\n\n      // detach View\n      if (this._storyReaderDetachComponent != null) {\n        this._storyReaderDetachComponent();\n      }\n      this.storyReaderInstancePromise = null;\n      this._storyReaderInstance = null;\n\n    });\n\n\n    return storyReaderInstance;\n  }\n\n\n  private async initStoryFavoriteReader(appearanceManager: AppearanceManager, fonts: Array<CacheResourceModel>) {\n    if (this._storyFavoriteReaderInstance !== null) {\n      return this._storyFavoriteReaderInstance;\n    }\n    const storyFavoriteReaderInstance = new _StoryFavorite('body', {});\n    await storyFavoriteReaderInstance.init('body' as ObjectId, {\n      options: appearanceManager.storyFavoriteReaderOptions,\n      storiesListOptions: appearanceManager.storiesListOptions\n    });\n    storyFavoriteReaderInstance.setFonts(fonts);\n\n    // set all callbacks\n    storyFavoriteReaderInstance.setCallbacks({\n      // public events\n\n\n    });\n\n    storyFavoriteReaderInstance.on('closeReader', () => {\n      try {\n        window.focus()\n      } catch (e) {\n        console.error(e)\n      }\n    });\n\n    storyFavoriteReaderInstance.on('clickOnStoryInternal', (payload: ClickOnStoryInternalPayload) => this.handleClickOnStoryInternal(payload));\n\n\n    (await this.getStoryReaderInstance()).on('openStoryReader', (options: { windowReferer: STORY_READER_WINDOW_REFERER }) => storyFavoriteReaderInstance.openStoryReader(options));\n    (await this.getStoryReaderInstance()).on('closeStoryReader', (options: { windowReferer: STORY_READER_WINDOW_REFERER }) => storyFavoriteReaderInstance.closeStoryReader(options));\n\n    return storyFavoriteReaderInstance;\n  }\n\n\n  // tags ref appearanceManager\n  public async showOnboardingStories(appearanceManager: AppearanceManager, customTags?: Array<string>) {\n    const fontResources = getFontResources();\n\n\n    await fetchSessionAndStoriesCompositeFx({\n      defaultList: false,\n      onboardingList: true,\n      favoriteList: false,\n      onboardingTags: customTags\n    });\n\n\n    if (this.storyReaderInstancePromise === null) {\n      // TODO config - sepaarte\n      this.storyReaderInstancePromise = this.initStoryReader(appearanceManager, fontResources);\n    }\n\n    // стор может не успеть обновиться ?\n    const onboardingStories = $storiesOnboarding.getState();\n\n    if (onboardingStories.length > 0) {\n      const payload: ClickOnStoryInternalPayload = {\n        windowReferer: STORY_READER_WINDOW_REFERER.default,\n        listType: STORY_LIST_TYPE.onboarding,\n        id: onboardingStories[0].id\n      };\n      await this.handleClickOnStoryInternal(payload);\n      return true;\n    }\n    return false;\n\n  }\n\n  public async showStory(id: number | string, appearanceManager: AppearanceManager, ref: string = 'default') {\n\n    const fontResources = getFontResources();\n    if (this.storyReaderInstancePromise === null) {\n      // TODO config - sepaarte\n      this.storyReaderInstancePromise = this.initStoryReader(appearanceManager, fontResources);\n    }\n\n    const storyReaderInstance = await this.getStoryReaderInstance();\n\n    return await _showStory(id, storyReaderInstance);\n  }\n\n  public async closeStoryReader() {\n    if (this.storyReaderInstancePromise === null) {\n      return false;\n    }\n    const storyReaderInstance = await this.getStoryReaderInstance();\n    this.closeGoodsWidget();\n    storyReaderInstance.closeReader();\n  }\n\n  public closeGoodsWidget() {\n    if (this._goodsWidgetInstance) {\n      this._goodsWidgetInstance.close();\n      this._goodsWidgetInstance = null;\n    }\n  }\n\n\n  public SharePage = class extends EventEmitter {\n\n    private storyReaderWidget!: Option<_StoryReader>;\n    private appearanceManager!: AppearanceManager;\n    private options: SharePageOptions = {};\n\n    constructor(storyId: number | string, appearanceManager: AppearanceManager, options?: SharePageOptions, ref: string = 'default') {\n      super();\n\n      if (options) this.options = options;\n\n      StoryManager.instance._showSharePage(storyId, appearanceManager, this.options, this).then(({\n                                                                                     storyReaderInstance,\n                                                                                     appearanceManager,\n                                                                                     result\n                                                                                   }) => {\n        this.storyReaderWidget = storyReaderInstance;\n        this.appearanceManager = appearanceManager;\n      });\n\n      return this;\n    }\n\n    public async closeStoryReader() {\n      if (this.storyReaderWidget) {\n        StoryManager.instance.closeGoodsWidget();\n        this.storyReaderWidget.closeReader();\n      }\n    }\n\n  }\n\n  private _showSharePage = async (storyId: number | string, appearanceManager: AppearanceManager, sharePageOptions: SharePageOptions, sharePage: SharePage) => {\n\n    setTimeout(() => {\n      sharePage.emit(SharePageEvents.START_LOADING);\n      if (isFunction(sharePageOptions.handleStartLoading)) sharePageOptions.handleStartLoading();\n    });\n\n    let result = false;\n    let storyReaderInstance: Option<_StoryReader> = null;\n    try {\n\n      storyReaderInstance = await this.initStoryReader(appearanceManager, getFontResources(), {\n        closeOnLastSlideByTimer: false,\n        recycleStoriesList: false\n      });\n\n      storyReaderInstance.on('closeStoryReader', (options: { windowReferer: STORY_READER_WINDOW_REFERER }) => {\n\n          if (isFunction(sharePageOptions.handleStoryReaderClose) || sharePage.listenerCount(SharePageEvents.CLOSE_STORY_READER) > 0) {\n            // const cbPayload = {src: 'storyReader', srcRef: 'default'};\n            try {\n              if (isFunction(sharePageOptions.handleStoryReaderClose)) {\n                sharePageOptions.handleStoryReaderClose();\n              }\n              sharePage.emit(SharePageEvents.CLOSE_STORY_READER);\n            } catch (e) {\n              console.error(e)\n            }\n          } else {\n\n              const isIframe = window.location != window.parent.location;\n              const location = isIframe ? window.parent.location : window.location;\n              // window.location = `${location.protocol}//${location.host}`\n              window.open(`${location.protocol}//${location.host}`, '_parent');\n\n          }\n\n      });\n\n      // show story inner\n      result = await _showStory(storyId, storyReaderInstance);\n\n    } catch (e) {\n\n    }\n    sharePage.emit(SharePageEvents.END_LOADING, {result});\n    if (isFunction(sharePageOptions.handleStopLoading)) sharePageOptions.handleStopLoading(result);\n\n    return {storyReaderInstance, appearanceManager, result};\n\n  }\n\n\n}\n","export function trimEndSlash(str: String) {\n  return str.replace(/\\/$/, \"\");\n}","export function isNumber(value: any) {\n  return typeof value === 'number';\n}","export function uniq(array: Array<any>) {\n  return [...new Set(array)];\n}","import {EventEmitter} from 'events';\nimport {BlobContentType, getBlobURL, extend} from \"./utils\";\nimport {md5} from \"./md5\";\nimport {checkUrlProtocol} from \"../helpers/media\";\nimport {Brand, Option, Dict} from \"../../global.h\";\n\ndeclare global {\n  interface Window {\n    scrollNode: any; // browser env\n    iasAsyncInitCallbacks: Array<() => void>;\n  }\n}\n\n// env c URL test / prod\n\n\ninterface IAbstractModel {\n  [key: string]: any\n}\n\n\nenum Events {\n  START_LOADER = 'startLoader',\n  END_LOADER = 'endLoader',\n}\n\nenum BlobType {\n\n}\n\nexport type ObjectId = Brand<string, \"objectId\">\n\n/*\nФабрика\nсоздание и вставка в виджета в разметку\nAdapter\niframe или View.webview\nобщение - класс Transport - может быть общий\nWebView onMessage={this.webViewMessageHandler}\n\n */\n\nexport default class Widget extends EventEmitter {\n  static count: number = 0;\n  static RPC: any = {};\n  protected widgetId!: number | string;\n\n  public callbacks: Dict<any> = {};\n\n  private obj!: HTMLElement;\n  private _loaderContainer: Option<HTMLElement> = null;\n  public get loaderContainer() {\n    // if (!this._loaderContainer) {\n    //   const _loaderContainer = document.createElement('div');\n    //   this.obj.style.position = 'relative';\n    //   _loaderContainer.style.position = 'absolute';\n    //   _loaderContainer.style.left = _loaderContainer.style.top = _loaderContainer.style.right = _loaderContainer.style.bottom = '0px';\n    //   _loaderContainer.style.pointerEvents = 'none';\n    //   this.obj.prepend(_loaderContainer);\n    //   this._loaderContainer = _loaderContainer;\n    // }\n    return this._loaderContainer;\n  }\n\n  public setCallbacks(callbacks: Dict<any>) {\n    this.callbacks = callbacks;\n  }\n\n  constructor() {\n    super();\n\n    // const self = this;\n    // let obj: Option<HTMLElement> = null;\n    // if (objId === 'body') {\n    //   obj = document.body;\n    // } else {\n    //   obj = document.querySelector(objId);\n    // }\n    //\n    // if (obj) {\n    //   this.obj = obj;\n    // }\n\n    this.loaderContainer;\n    // setTimeout(async () => await self.init(objId, options, params, funcs, defaults, onDone, widgetId, iter), 0);\n  }\n\n  public async init(mountSelector: string, options: Dict) {\n    const params = {};\n    const funcs = {};\n    const defaults = {};\n    const onDone = () => {\n    };\n    const widgetId = null;\n    const iter = null;\n\n    // return this._init(mountSelector as ObjectId, options, params, {}, funcs, defaults, onDone, widgetId, iter);\n  }\n\n  // protected async _init(mountSelector: ObjectId, options: Dict, params: Dict, widgetParams: Dict, funcs: Dict, defaults: Dict, onDone: (obj: any, iframe: any, rpc: any) => void, widgetId: Option<string | number>, iter: Option<number>) {\n  //\n  //   params = params || {};\n  //   funcs = funcs || {};\n  //\n  //   const self = this;\n  //   let obj: Option<HTMLElement> = null;\n  //   if (mountSelector === 'body') {\n  //     obj = document.body;\n  //   } else {\n  //     obj = document.querySelector(mountSelector);\n  //   }\n  //   this.widgetId = widgetId || (++Widget.count);\n  //\n  //   if (!obj) {\n  //     let _iter = iter || 0;\n  //     if (_iter > 10) {\n  //       throw Error('IAS_OLD.Widget: object #' + mountSelector + ' not found.');\n  //     }\n  //     setTimeout(async () => {\n  //       await self._init(mountSelector, options, params, widgetParams, funcs, defaults, onDone, self.widgetId, _iter + 1);\n  //     }, 500);\n  //\n  //     return;\n  //   }\n  //\n  //\n  //   options = options || {};\n  //   defaults = defaults || {};\n  //   funcs = funcs || {};\n  //\n  //   if (options.preview) {\n  //     params.preview = 1;\n  //     delete options['preview'];\n  //   }\n  //   var ifr, url, urlQueryString, encodedParam, rpc: any, iframe: any, i,\n  //     base_domain = options.base_domain || IAS_OLD._protocol + '//sdk-narrator.kiozk.ru',\n  //     // base_domain = options.base_domain || IAS_OLD._protocol + '//sdk-nar-nar.test.kiozk.ru',\n  //     width: number = options.width === 'auto' ? (obj.clientWidth || obj.offsetWidth || defaults.minWidth) | 0 : parseInt(options.width || 0, 10);\n  //   const cssWidth: string = width ? (Math.max(defaults.minWidth || 200, Math.min(defaults.maxWidth || 10000, width)) + 'px') : '100%';\n  //\n  //   if (!defaults.fullScreen) {\n  //     obj.style.width = cssWidth;\n  //     obj.style.overflow = 'hidden';\n  //\n  //     if (options.height) {\n  //       params.height = options.height;\n  //       obj.style.height = options.height + 'px';\n  //     } else {\n  //       obj.style.height = (defaults.startHeight || 200) + 'px';\n  //     }\n  //\n  //     if (options.overflowTouch) {\n  //       obj.style['overflow'] = 'auto';\n  //       (<any>obj).style['-webkit-overflow-scrolling'] = 'touch';\n  //     }\n  //   }\n  //\n  //\n  //   if (cssWidth === '100%') params.startWidth = (obj.clientWidth || obj.offsetWidth) | 0;\n  //   if (!params.url) params.url = options.pageUrl || location.href.replace(/#.*$/, '');\n  //\n  //   // const widgetUrl = 'stories.php';\n  //   // url = base_domain + '/' + widgetUrl;\n  //   // urlQueryString = '';\n  //   // if (!options.noDefaultParams) {\n  //   //     urlQueryString += '&appKey=' + IAS_OLD._apiKey + '&width=' + encodeURIComponent(cssWidth)\n  //   // }\n  //   // urlQueryString += '&_ver=' + IAS_OLD.version\n  //   params.url = params.url || \"\";\n  //   params.referrer = params.referrer || document.referrer || \"\";\n  //   params.title = params.title || document.title || \"\";\n  //   params.userId = params.userId || '';\n  //\n  //   params.origin = window.location.protocol + '//' + window.location.hostname;\n  //\n  //   // for (i in params) {\n  //   //     if (params.hasOwnProperty(i)) {\n  //   //         if (typeof (params[i]) == 'number') {\n  //   //             encodedParam = params[i];\n  //   //         } else {\n  //   //             try {\n  //   //                 encodedParam = encodeURIComponent(params[i]);\n  //   //             } catch (e) {\n  //   //                 encodedParam = '';\n  //   //             }\n  //   //         }\n  //   //         urlQueryString += '&' + i + '=' + encodedParam;\n  //   //     }\n  //   // }\n  //   // urlQueryString += '&' + (+new Date()).toString(16);\n  //   // url += '?' + urlQueryString.substr(1);\n  //\n  //   const iframeDocumentResources = {\n  //     html: this.getWidgetDocument(widgetParams), css: params.extraCss ?? null, js: params.extraJs ?? null\n  //   };\n  //   let blobUrl = this.getGeneratedPageURL(iframeDocumentResources);\n  //\n  //\n  //   funcs.onStartLoading && funcs.onStartLoading();\n  //   if (!options.no_loading) {\n  //     self.loading(this.loaderContainer, true);\n  //   }\n  //\n  //   funcs.showLoader = function (enable: boolean) {\n  //     IAS_OLD.Util.Loader(enable);\n  //   };\n  //   funcs.publish = function () {\n  //     var args = Array.prototype.slice.call(arguments);\n  //     args.push(self.widgetId);\n  //     IAS_OLD.Observer.publish.apply(IAS_OLD.Observer, args);\n  //   };\n  //   funcs.onInit = function () {\n  //     if (!options.no_finish_loading) {\n  //       self.loading(this.loaderContainer, false);\n  //     }\n  //     // if (funcs.onReady) funcs.onReady();\n  //     if (options.onReady) options.onReady();\n  //   };\n  //   funcs.hideLoader = function () {\n  //     self.loading(this.loaderContainer, false);\n  //   }\n  //   funcs.resize = function (e: number, cb: () => void) {\n  //     if (obj) {\n  //       obj.style.height = e + 'px';\n  //       var el = document.getElementById('iaswidget' + self.widgetId);\n  //       if (el) {\n  //         el.style.height = e + 'px';\n  //       }\n  //     }\n  //   };\n  //   funcs.resizeWidget = function (width: string, height: string) {\n  //     const newWidth = parseInt(width);\n  //     const newHeight = parseInt(height);\n  //     var widgetElem = document.getElementById('iaswidget' + self.widgetId);\n  //     if (isFinite(newWidth)) {\n  //       if (obj) {\n  //         obj.style.width = newWidth + 'px';\n  //         if (widgetElem) {\n  //           widgetElem.style.width = newWidth + 'px';\n  //         }\n  //       }\n  //     }\n  //     if (isFinite(newHeight)) {\n  //       if (obj) {\n  //         obj.style.height = newHeight + 'px';\n  //         if (widgetElem) {\n  //           widgetElem.style.height = newHeight + 'px';\n  //         }\n  //       }\n  //     }\n  //     if (options.onResizeWidget) options.onResizeWidget();\n  //   };\n  //\n  //   rpc = IAS_OLD.Widget.RPC[self.widgetId] = new window.fastXDM.Server(funcs, function (origin: string) {\n  //     if (!origin) return true;\n  //     origin = origin.toLowerCase();\n  //     return true;\n  //     // TODO вернуть обратно\n  //     return (origin.match(/(\\.|\\/)inappstory\\.com($|\\/|\\?)/));\n  //   }, {safe: true});\n  //\n  //   const iframeOptions: Dict<any> = {\n  //     src: '',\n  //     id: 'iaswidget' + self.widgetId,\n  //     allowTransparency: options.allowTransparency || false,\n  //     style: {\n  //       backgroundColor: options.backgroundColor || 'transparent',\n  //     }\n  //   };\n  //\n  //   if (!defaults.fullScreen) {\n  //     iframeOptions.width = (cssWidth.indexOf('%') != -1) ? cssWidth : (parseInt(cssWidth) || cssWidth);\n  //     iframeOptions.height = defaults.startHeight || '100%';\n  //\n  //     // for correct @media in iframe work - pass innerWidth instead of clientWidth\n  //     // plus parent div overflow: hidden\n  //     // width: cssWidth === '100%' ? '100%' : cssWidth,\n  //     // https://stackoverflow.com/questions/23083462/how-to-get-an-iframe-to-be-responsive-in-ios-safari\n  //     iframeOptions.style.width = '1px';\n  //     iframeOptions.style.minWidth = '100%';\n  //     iframeOptions.style[\"*width\"] = '100%';\n  //   } else {\n  //     iframeOptions.style.position = 'fixed';\n  //     iframeOptions.style.left = 0;\n  //     iframeOptions.style.top = 0;\n  //     iframeOptions.style.padding = 0;\n  //     iframeOptions.style.border = 0;\n  //     iframeOptions.style.zIndex = 1002;\n  //     iframeOptions.style.width = '100%';\n  //     iframeOptions.style.height = '100%';\n  //   }\n  //\n  //   if (defaults.scrolling) {\n  //     iframeOptions.scrolling = 'yes';\n  //   } else {\n  //     iframeOptions.scrolling = 'no';\n  //     iframeOptions.style.overflow = 'hidden';\n  //   }\n  //\n  //   if (defaults.hidden) {\n  //     iframeOptions.style.display = 'none';\n  //   }\n  //\n  //\n  //   if (await isWindowSupportIframeBlobSrc()) {\n  //     iframeOptions.src = blobUrl.src;\n  //   } else {\n  //     //@ts-ignore\n  //     iframeOptions.srcdoc = blobUrl.srcdoc;\n  //   }\n  //\n  //\n  //   iframe = IAS_OLD.Widget.RPC[self.widgetId].append(obj, iframeOptions);\n  //   onDone && setTimeout(function () {\n  //     onDone(obj, iframe || obj?.firstChild, rpc);\n  //   }, 10);\n  //\n  //\n  //   this.emit('ready');\n  //\n  //   // on initDone from iframe\n  //\n  //   // this.on('sessionInitInternal', (payload: any) => storyReader.sessionInit(payload));\n  //\n  //\n  //   return new Promise((resolve, reject) => {\n  //     this.on('widgetLoaded', () => {\n  //       // console.log('widgetLoaded');\n  //       resolve(true)\n  //     });\n  //   });\n  //\n  // }\n\n  loading(obj: any, enabled: boolean) {\n    // if (enabled) {\n    //   this.emit(Events.START_LOADER, obj);\n    // } else {\n    //   this.emit(Events.END_LOADER, obj);\n    // }\n    //\n    //\n    // if (this.listenerCount(Events.START_LOADER) === 0) {\n    //   obj.style.background = enabled ? 'url(\"' + IAS_OLD._protocol + '//sdk-narrator.kiozk.ru/images/upload2.gif\") center center no-repeat transparent' : 'none';\n    // }\n  }\n\n  startLoader() {\n    const baseUrl = process.env.BASE_URL;\n    const buildVersion = process.env.BUILD_VERSION;\n\n    // todo можно BASE_URL менять в процессе сборки\n    let imgResource = checkUrlProtocol(`${baseUrl}/v${buildVersion}/dist/images/loader.gif`);\n    if (process.env.NODE_ENV === \"development\") {\n      imgResource = checkUrlProtocol(`${baseUrl}/images/loader.gif`);\n    }\n\n    this.loaderContainer.style.background = `url(\"${imgResource}\") center center no-repeat transparent`;\n  }\n  stopLoader() {\n    this.loaderContainer.style.background = 'none';\n  }\n\n\n  getGeneratedPageURL({html, css, js}: { html: string, css: Option<string>, js: Option<string> }) {\n    let cssTag = '';\n    let jsTag = '';\n    if (css !== null) {\n      cssTag = `<link rel=\"stylesheet\" type=\"text/css\" href=\"${getBlobURL(css, BlobContentType.CSS)}\" />`;\n    }\n    if (js !== null) {\n      jsTag = `<script >${getBlobURL(js, BlobContentType.JS)}</script>`;\n    }\n    const source = `\n    <html>\n      <head>\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n        ${cssTag}\n        ${jsTag}\n      </head>\n      <body>\n        ${html || ''}\n      </body>\n    </html>\n  `;\n\n    if (css !== null) {\n      cssTag = `<style>${css}</style>`;\n    }\n    if (js !== null) {\n      jsTag = `<script>${js}</script>`;\n    }\n    let htmlVariant = `\n    <html>\n      <head>\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n        ${cssTag}\n        ${jsTag}\n      </head>\n      <body>\n        ${html || ''}\n      </body>\n    </html>\n        `;\n    return {src: getBlobURL(source, BlobContentType.HTML), srcdoc: htmlVariant};\n  }\n\n  getWidgetDocument(widgetParams: Dict): string {\n    return '';\n  }\n\n  destroy(widgetId: string, objId: string) {\n    // var obj = document.getElementById(objId);\n    // if (!obj) {\n    //   throw Error('IAS_OLD.Widget: object #' + objId + ' not found.');\n    // }\n    var rpc = Widget.RPC[widgetId];\n    if (!rpc) {\n      rpc.destroy();\n    }\n    // TODO destroy APP\n    obj.innerHTML = '';\n  }\n\n\n}\n\n\nexport class IAS_OLD {\n  static version = 'v1';\n  static MD5: any = md5;\n  static extend: any = extend;\n\n  static readonly _protocol = 'https:';\n  static readonly _base_domain = '';\n\n  static Widget: any = Widget;\n\n  // static Stories = Stories;\n  // static StoryReader = StoryReader;\n\n\n  static xdConnectionCallbacks: Array<any>;\n  static init: any;\n  static _apiKey: any;\n  static userId: any;\n\n  static XDM: any;\n  static _domain: any;\n  static _path: any;\n  static xdReady: any;\n  static Observer: any;\n\n  static _rootId: any;\n\n  static Util: any;\n\n}\n\n\nif (!IAS_OLD.xdConnectionCallbacks) {\n\n  IAS_OLD.extend(IAS_OLD, {\n    version: 1,\n    _apiKey: null,\n    _session: null,\n    _domain: {\n      // main: IAS_OLD._protocol + '//sdk-narrator.kiozk.ru/',\n      main: IAS_OLD._protocol + '//sdk-narrator.kiozk.ru/',\n      api: IAS_OLD._protocol + '//api-narrator.kiozk.ru/'\n    },\n    _path: {\n      login: 'authorize',\n      proxy: 'fxdm_oauth_proxy.html'\n    },\n    _rootId: 'ias_api_transport',\n    _nameTransportPath: '',\n    xdReady: false,\n\n  });\n\n  IAS_OLD.init = function (options: Dict) {\n    var body, root;\n\n    IAS_OLD._apiKey = null;\n\n    if (!options.apiKey) {\n      throw Error('IAS_OLD.init() called without an apiKey');\n    }\n    IAS_OLD._apiKey = options.apiKey;\n\n    IAS_OLD.userId = options.userId;\n    return true;\n\n  };\n\n\n} else { // if IAS_OLD.xdConnectionCallbacksready\n  setTimeout(function () {\n    var callback;\n    while (callback = IAS_OLD.xdConnectionCallbacks.pop()) {\n      callback();\n    }\n  }, 0);\n\n  // if (IAS_OLD.Widget && !IAS_OLD.Widget._constructor) {\n  //     IAS_OLD.Widget = false;\n  // }\n}\n\n\n\n\n\n\n\n","export function onAllMediaLoaded(slideBox: HTMLElement, cb: Function) {\n  const loadMedia = function (media: HTMLMediaElement | HTMLImageElement) {\n    return new Promise(function (resolve, reject) {\n      if (media.tagName.toLowerCase() === 'img' && media instanceof HTMLImageElement) {\n        const imageLoadHandler = () => {\n          // first frame after load\n          requestAnimationFrame(\n            () =>  // startRender\n              //Rendering start\n              requestAnimationFrame(() => {\n                resolve(media);\n                media.removeEventListener('load', imageLoadHandler);\n              })\n          );\n        };\n        media.addEventListener('load', imageLoadHandler);\n        if (media.complete && media.naturalHeight !== 0) {\n          // resolve(media)\n\n          // first frame after load\n          requestAnimationFrame(\n            function () { // startRender\n              //Rendering start\n              requestAnimationFrame(function () {\n                resolve(media);\n                // console.log('img already loaded');\n              });\n            }\n          );\n\n        }\n      } else if (media.tagName.toLowerCase() === 'video' && media instanceof HTMLMediaElement) {\n        if (media.oncanplaythrough !== undefined) {\n          const oncanplaythroughHandler = () =>\n            //Rendering start\n            requestAnimationFrame(() => requestAnimationFrame(() => {\n                resolve(media);\n                media.removeEventListener('canplaythrough', oncanplaythroughHandler);\n                // console.log('video - canplaythrough');\n              })\n            )\n          ;\n          // first frame after load\n          // startRender\n          media.addEventListener('canplaythrough', oncanplaythroughHandler);\n          media.load();\n        } else {\n          const videLoadHandler = () =>\n            //Rendering start\n            requestAnimationFrame(() => requestAnimationFrame(() => {\n                resolve(media);\n                media.removeEventListener('canplay', videLoadHandler);\n                // console.log('video - load');\n              })\n            );\n\n          media.addEventListener('canplay', videLoadHandler);\n          media.load();\n        }\n\n      }\n\n      media.addEventListener('error', function (err: any) {\n        reject(err)\n      });\n\n    });\n  };\n\n  const mediaElements = slideBox.querySelectorAll<HTMLMediaElement | HTMLImageElement>('img,video');\n\n  let i;\n  let promises = [];\n  for (i = 0; i < mediaElements.length; ++i) {\n    promises.push(loadMedia(mediaElements[i]));\n  }\n  // не должно быть fallback\n  // const fallbackTimeout = setTimeout(() => cb(), 300);\n  if (promises.length > 0) {\n    // минимальная задержка 300ms\n    promises.push(new Promise((resolve, reject) => setTimeout(resolve, 300)));\n  }\n  Promise.all(promises).then((values) => {\n    // clearTimeout(fallbackTimeout);\n    cb();\n  });\n}\n\nexport function checkUrlProtocol(url: string): string {\n  let isSecure = (window as any).isSecureContext;\n  if (isSecure === undefined) {\n    if ((window as any).location.protocol === 'https:') {\n      isSecure = true;\n    }\n  }\n  if (!isSecure) {\n    return url.replace(/^https:\\/\\//, 'http://');\n  }\n\n  return url;\n}","/*\n * Based on JavaScript implementation of the RSA Data Security, Inc. MD5 Message\n * Copyright (C) Paul Johnston 1999 - 2009\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\n * Distributed under the BSD License\n */\nexport function md5(n) {\n        var j = function(o, r) {\n            var q = (o & 65535) + (r & 65535), p = (o >> 16) + (r >> 16) + (q >> 16);\n            return (p << 16) | (q & 65535)\n        }, g  = function(o, p) {\n            return (o << p) | (o >>> (32 - p))\n        }, k  = function(w, r, p, o, v, u) {\n            return j(g(j(j(r, w), j(o, u)), v), p)\n        }, a  = function(q, p, w, v, o, u, r) {\n            return k((p & w) | ((~p) & v), q, p, o, u, r)\n        }, h  = function(q, p, w, v, o, u, r) {\n            return k((p & v) | (w & (~v)), q, p, o, u, r)\n        }, c  = function(q, p, w, v, o, u, r) {\n            return k(p ^ w ^ v, q, p, o, u, r)\n        }, m  = function(q, p, w, v, o, u, r) {\n            return k(w ^ (p | (~v)), q, p, o, u, r)\n        }, b  = function(A, u) {\n            var z                           = 1732584193, y = -271733879, w = -1732584194, v = 271733878, r, q, p, o;\n            A[u >> 5] |= 128 << ((u) % 32);\n            A[(((u + 64) >>> 9) << 4) + 14] = u;\n            for (var t = 0, s = A.length; t < s; t += 16) {\n                r = z;\n                q = y;\n                p = w;\n                o = v;\n                z = a(z, y, w, v, A[t + 0], 7, -680876936);\n                v = a(v, z, y, w, A[t + 1], 12, -389564586);\n                w = a(w, v, z, y, A[t + 2], 17, 606105819);\n                y = a(y, w, v, z, A[t + 3], 22, -1044525330);\n                z = a(z, y, w, v, A[t + 4], 7, -176418897);\n                v = a(v, z, y, w, A[t + 5], 12, 1200080426);\n                w = a(w, v, z, y, A[t + 6], 17, -1473231341);\n                y = a(y, w, v, z, A[t + 7], 22, -45705983);\n                z = a(z, y, w, v, A[t + 8], 7, 1770035416);\n                v = a(v, z, y, w, A[t + 9], 12, -1958414417);\n                w = a(w, v, z, y, A[t + 10], 17, -42063);\n                y = a(y, w, v, z, A[t + 11], 22, -1990404162);\n                z = a(z, y, w, v, A[t + 12], 7, 1804603682);\n                v = a(v, z, y, w, A[t + 13], 12, -40341101);\n                w = a(w, v, z, y, A[t + 14], 17, -1502002290);\n                y = a(y, w, v, z, A[t + 15], 22, 1236535329);\n                z = h(z, y, w, v, A[t + 1], 5, -165796510);\n                v = h(v, z, y, w, A[t + 6], 9, -1069501632);\n                w = h(w, v, z, y, A[t + 11], 14, 643717713);\n                y = h(y, w, v, z, A[t + 0], 20, -373897302);\n                z = h(z, y, w, v, A[t + 5], 5, -701558691);\n                v = h(v, z, y, w, A[t + 10], 9, 38016083);\n                w = h(w, v, z, y, A[t + 15], 14, -660478335);\n                y = h(y, w, v, z, A[t + 4], 20, -405537848);\n                z = h(z, y, w, v, A[t + 9], 5, 568446438);\n                v = h(v, z, y, w, A[t + 14], 9, -1019803690);\n                w = h(w, v, z, y, A[t + 3], 14, -187363961);\n                y = h(y, w, v, z, A[t + 8], 20, 1163531501);\n                z = h(z, y, w, v, A[t + 13], 5, -1444681467);\n                v = h(v, z, y, w, A[t + 2], 9, -51403784);\n                w = h(w, v, z, y, A[t + 7], 14, 1735328473);\n                y = h(y, w, v, z, A[t + 12], 20, -1926607734);\n                z = c(z, y, w, v, A[t + 5], 4, -378558);\n                v = c(v, z, y, w, A[t + 8], 11, -2022574463);\n                w = c(w, v, z, y, A[t + 11], 16, 1839030562);\n                y = c(y, w, v, z, A[t + 14], 23, -35309556);\n                z = c(z, y, w, v, A[t + 1], 4, -1530992060);\n                v = c(v, z, y, w, A[t + 4], 11, 1272893353);\n                w = c(w, v, z, y, A[t + 7], 16, -155497632);\n                y = c(y, w, v, z, A[t + 10], 23, -1094730640);\n                z = c(z, y, w, v, A[t + 13], 4, 681279174);\n                v = c(v, z, y, w, A[t + 0], 11, -358537222);\n                w = c(w, v, z, y, A[t + 3], 16, -722521979);\n                y = c(y, w, v, z, A[t + 6], 23, 76029189);\n                z = c(z, y, w, v, A[t + 9], 4, -640364487);\n                v = c(v, z, y, w, A[t + 12], 11, -421815835);\n                w = c(w, v, z, y, A[t + 15], 16, 530742520);\n                y = c(y, w, v, z, A[t + 2], 23, -995338651);\n                z = m(z, y, w, v, A[t + 0], 6, -198630844);\n                v = m(v, z, y, w, A[t + 7], 10, 1126891415);\n                w = m(w, v, z, y, A[t + 14], 15, -1416354905);\n                y = m(y, w, v, z, A[t + 5], 21, -57434055);\n                z = m(z, y, w, v, A[t + 12], 6, 1700485571);\n                v = m(v, z, y, w, A[t + 3], 10, -1894986606);\n                w = m(w, v, z, y, A[t + 10], 15, -1051523);\n                y = m(y, w, v, z, A[t + 1], 21, -2054922799);\n                z = m(z, y, w, v, A[t + 8], 6, 1873313359);\n                v = m(v, z, y, w, A[t + 15], 10, -30611744);\n                w = m(w, v, z, y, A[t + 6], 15, -1560198380);\n                y = m(y, w, v, z, A[t + 13], 21, 1309151649);\n                z = m(z, y, w, v, A[t + 4], 6, -145523070);\n                v = m(v, z, y, w, A[t + 11], 10, -1120210379);\n                w = m(w, v, z, y, A[t + 2], 15, 718787259);\n                y = m(y, w, v, z, A[t + 9], 21, -343485551);\n                z = j(z, r);\n                y = j(y, q);\n                w = j(w, p);\n                v = j(v, o)\n            }\n            return [z, y, w, v]\n        }, f  = function(r) {\n            var q = \"\", s = -1, p = r.length, o, t;\n            while (++s < p) {\n                o = r.charCodeAt(s);\n                t = s + 1 < p ? r.charCodeAt(s + 1) : 0;\n                if (55296 <= o && o <= 56319 && 56320 <= t && t <= 57343) {\n                    o = 65536 + ((o & 1023) << 10) + (t & 1023);\n                    s++\n                }\n                if (o <= 127) {\n                    q += String.fromCharCode(o)\n                } else {\n                    if (o <= 2047) {\n                        q += String.fromCharCode(192 | ((o >>> 6) & 31), 128 | (o & 63))\n                    } else {\n                        if (o <= 65535) {\n                            q += String.fromCharCode(224 | ((o >>> 12) & 15), 128 | ((o >>> 6) & 63), 128 | (o & 63))\n                        } else {\n                            if (o <= 2097151) {\n                                q += String.fromCharCode(240 | ((o >>> 18) & 7), 128 | ((o >>> 12) & 63), 128 | ((o >>> 6) & 63), 128 | (o & 63))\n                            }\n                        }\n                    }\n                }\n            }\n            return q\n        }, e  = function(p) {\n            var o = Array(p.length >> 2), r, q;\n            for (r = 0, q = o.length; r < q; r++) {\n                o[r] = 0\n            }\n            for (r = 0, q = p.length * 8; r < q; r += 8) {\n                o[r >> 5] |= (p.charCodeAt(r / 8) & 255) << (r % 32)\n            }\n            return o\n        }, l  = function(p) {\n            var o = \"\";\n            for (var r = 0, q = p.length * 32; r < q; r += 8) {\n                o += String.fromCharCode((p[r >> 5] >>> (r % 32)) & 255)\n            }\n            return o\n        }, d  = function(o) {\n            return l(b(e(o), o.length * 8))\n        }, i  = function(q) {\n            var t = \"0123456789abcdef\", p = \"\", o;\n            for (var s = 0, r = q.length; s < r; s++) {\n                o = q.charCodeAt(s);\n                p += t.charAt((o >>> 4) & 15) + t.charAt(o & 15)\n            }\n            return p\n        };\n        return i(d(f(n)))\n    }\n","import {createDomain, Effect} from 'effector';\nimport {\n  ClickOnStoryInternalPayload,\n  ClickOnStoryPayload,\n  FontResource,\n  STORY_LIST_TYPE\n} from \"../story-manager/common.h\";\nimport {Dict} from \"../../global.h\";\n\n// use name|sid or  \"effector/babel-plugin\"\nconst toServerFxDomain = createDomain(\"serverFxDomainWidgetStoriesList\");\nconst toClientFxDomain = createDomain(\"clientFxDomainWidgetStoriesList\");\n\nexport {toServerFxDomain as serverFxDomain, toClientFxDomain as clientFxDomain}\n\nexport const rpcDomains = {\n  serverFxDomain: toServerFxDomain,\n  clientFxDomain: toClientFxDomain\n}\n\n// export const workerMessage = domain.effect<string, string[]>();\n// export const failure = domain.effect<void, any>();\n// export const ping: Effect<{now: number}, {ping: number}> = domain.effect();\n\n\n\nexport const RpcMessage = toClientFxDomain.effect<string, string[]>(\"RpcMessage\");\nexport const setStories = toClientFxDomain.effect<{listType: STORY_LIST_TYPE, storyList: Array<Dict>}, void>(\"setStories\");\nexport const setFonts = toClientFxDomain.effect<FontResource, void>(\"setFonts\");\n\nexport const RpcMessageOnServer = toServerFxDomain.effect<string, string[]>(\"RpcMessageOnServer\");\n\n\nexport const widgetLoaded = toServerFxDomain.effect<void, void>(\"widgetLoaded\");\nexport const clickOnStoryInternalEvent = toServerFxDomain.effect<ClickOnStoryInternalPayload, void>(\"clickOnStoryInternalEvent\");\nexport const flushThumbViewsEvent = toServerFxDomain.effect<Array<number>, void>(\"flushThumbViewsEvent\");\nexport const clickOnStoryEvent = toServerFxDomain.effect<ClickOnStoryPayload, void>(\"clickOnStoryEvent\");\nexport const clickOnStoryDeepLinkEvent = toServerFxDomain.effect<ClickOnStoryPayload, void>(\"clickOnStoryDeepLinkEvent\");\n\n\n","export enum MessageType {\n  REQUEST,\n  RESPONSE\n}\n\nexport enum MessageStatus {\n  SUCCESS,\n  ERROR\n}\n\nexport type Message = {\n  type: MessageType,\n  id: number,\n  sid: string,\n  params?: any,\n  status?: MessageStatus,\n  error?: any,\n  result?: any,\n};\n","import {IWorkerServer} from \"./IWorkerServer\";\nimport {Option, Dict} from \"../../global.h\";\n\nimport {Message} from \"./index.h\";\nimport WebView from \"react-native-webview\";\nimport {isFunction} from \"../helpers/isFunction\";\n\n\nexport class WebViewWorkerServer implements IWorkerServer {\n\n  private readonly _destructor;\n  constructor(private webview: WebView) {\n    const messageListener = (event: MessageEvent) => this.messageListener(event);\n    // @ts-ignore\n    webview.onMessage = messageListener;\n      // webview.addEventListener(\"message\", messageListener, false);\n    // this._destructor = () => webview.removeEventListener(\"message\", this.messageListener);\n    this._destructor = () => {};\n  }\n\n  public destructor() {\n    this._destructor();\n  }\n\n\n  messageListener(event: MessageEvent) {\n    //@ts-ignore\n    console.log(\"messageListener server\", {\"event.nativeEvent.data\": event.nativeEvent.data, \"this\": this});\n\n    let data = {};\n    try {\n      data = JSON.parse(event.nativeEvent.data);\n    } catch (e) {\n      console.error(e);\n    }\n\n    // TODO  check из какого webview пришло сообщение\n\n    if (isFunction(this.onMessageCb)) {\n      //@ts-ignore\n      console.log(\"messageListener server 3\", {data});\n      //@ts-ignore\n      this.onMessageCb(data);\n    }\n\n  }\n\n  sendMessage(message: Message) {\n    console.log('sendMessage from server', {message});\n    // this.contentWindow?.postMessage(message, this.origin);\n      try {\n          this.webview.postMessage(JSON.stringify(message));\n      } catch (e) {\n          // invariant error - this.webview.webViewRef is null\n          console.log(e);\n      }\n  }\n\n  private onMessageCb: Option<(data: Dict) => void> = null;\n  set onmessage(cb: (data: Dict) => void) {\n    this.onMessageCb = cb;\n  }\n\n}","import {Dict, Option} from \"../../global.h\";\nimport Widget, {ObjectId} from \"../widget\";\nimport {ClickOnStoryInternalPayload, ClickOnStoryPayload, SyncStoreEvent} from \"../story-manager/common.h\";\nimport {StoriesListOptions} from \"./index.h\";\nimport {AppearanceCommonOptions} from \"../story-manager/appearanceCommon.h\";\nimport {IWidgetStoriesList} from \"./index\";\nimport {AppearanceManager} from \"../story-manager/AppearanceManager\";\nimport {CreateViewOptions} from \"./rn.h\";\n\ndeclare global {\n  interface Window {\n    scrollNode: any; // browser env\n    fastXDM: any;\n    iasAsyncInitCallbacks: Array<() => void>;\n  }\n}\n\nimport {\n  rpcDomains,\n  RpcMessage,\n  RpcMessageOnServer,\n  widgetLoaded,\n  setStories,\n  setFonts,\n  clickOnStoryInternalEvent, flushThumbViewsEvent, clickOnStoryEvent, clickOnStoryDeepLinkEvent\n} from \"./rpc\";\nimport {create as createRpcServer} from \"../rpc/remoteFX/server\";\nimport {IframeWorkerServer} from \"../rpc/IframeWorkerServer\";\nimport {ReactEventHandler, SyntheticEvent} from \"react\";\nimport WebView from \"react-native-webview\";\nimport {WebViewWorkerServer} from \"../rpc/WebViewWorkerServer\";\n\n\nRpcMessageOnServer.use(async arg => {\n  return [arg + \" :125\"];\n});\n\n\n//@ts-ignore\nwindow.RpcMessage = RpcMessage;\n// const result = await workerMessage('foo bar  baz bam')\n\n// const jsResourceGlobal = new URL(\"./StoriesListClient.umd.js\", import.meta.url);\n// const cssResourceGlobal = new URL(\"./StoriesListClient.umd.css\", import.meta.url);\n\n// escaped content\n// @ts-ignore\nimport jsResourceGlobal from \"../../packages/react-native-ias/StoriesListClient.js\";\n// @ts-ignore\nimport cssResourceGlobal from \"../../packages/react-native-ias/StoriesListClient.css.js\";\nimport {isFunction} from \"../helpers/isFunction\";\nconsole.log('changed');\n\n// const jsResourceGlobal = \"\";\n// const cssResourceGlobal = \"\";\n\n\nclass WidgetStoriesList extends Widget implements IWidgetStoriesList {\n\n  private readonly storiesListOptions: StoriesListOptions & Pick<AppearanceCommonOptions, \"hasFavorite\">;\n\n  constructor(private appearanceManager: AppearanceManager) {\n    super();\n\n    this.storiesListOptions = {\n      ...appearanceManager.storiesListOptions,\n      hasFavorite: appearanceManager.commonOptions.hasFavorite\n    }\n\n    this.widgetId = ++Widget.count;\n\n    // вынести в общую часть\n    widgetLoaded.use(() => {\n      this.emit(\"widgetLoaded\");\n    });\n\n    clickOnStoryInternalEvent.use(payload => {\n      console.log('clickOnStoryInternalEvent 1');\n      if (isFunction(this.callbacks?.handleClickOnStoryInternal)) {\n        console.log('clickOnStoryInternalEvent 2');\n        this.callbacks?.handleClickOnStoryInternal(payload);\n      }\n    });\n\n    flushThumbViewsEvent.use(payload => {\n      if (isFunction(this.callbacks?.handleFlushThumbViews)) {\n        this.callbacks?.handleFlushThumbViews(payload);\n      }\n    });\n\n    // public event\n    clickOnStoryEvent.use(\n      payload => {\n        if (isFunction(this.callbacks?.handleClickOnStory)) {\n          this.callbacks?.handleClickOnStory(payload);\n        }\n      }\n    );\n\n    // click on deep link from story list\n    clickOnStoryDeepLinkEvent.use(payload => {\n      if (isFunction(this.callbacks?.handleClickOnStoryDeepLink)) {\n        this.callbacks?.handleClickOnStoryDeepLink(payload);\n      }\n    });\n\n    // storyReader.on('storyOpenedInternal', (payload: {id: number}) => this.onStoryOpened(payload));\n\n\n    // storyReader.on('favoriteStoryInternal', (payload: {id: number, value: boolean}) => this.onStoryFavoriteChange(payload));\n\n\n\n  }\n\n  public get widgetSrcFile(): string | URL {\n    return jsResourceGlobal;\n  }\n\n  public get widgetEntrypoint(): string {\n    return `\n      <head>\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, user-scalable=0, shrink-to-fit=no\">\n        <style type=\"text/css\">${cssResourceGlobal}</style>\n      </head>\n      <div id=\"app\"><div id=\"_app\"></div></div>\n      <script type=\"text/javascript\">${jsResourceGlobal}</script>\n      <script type=\"text/javascript\">\n        window.storiesList = (function () {\n          var self = window.storiesList || {};\n          self._e = self._e || [];\n          self.ready = self.ready || function (f) {self._e.push(f);};\n          return self;\n        }());\n\n        window.storiesList.ready(function () {\n          window.storiesList.init(${JSON.stringify(this.storiesListOptions)});\n        });\n\n      </script>`;\n  }\n\n\n  private rpc: any;\n\n  public async mount(mountSelector: string, storiesListOptions: StoriesListOptions & Pick<AppearanceCommonOptions, \"hasFavorite\">): Promise<boolean> {\n    // создаем iframe\n    // по завершению - mounted();\n\n\n    const options: CreateViewOptions = {\n      allowTransparency: true,\n      overflowTouch: false,\n      backgroundColor: storiesListOptions.layout.backgroundColor,\n      width: 'auto',\n      height: 0,\n      pageUrl: '',\n      startHeight: 0\n    };\n\n    // todo непонятно как высоту с учетом title рассчитывать\n    if (storiesListOptions.layout.height) {\n      options.startHeight = storiesListOptions.layout.height;\n    } else {\n      if (!storiesListOptions.title) {\n        options.startHeight = storiesListOptions.card.height + storiesListOptions.topPadding + storiesListOptions.bottomPadding + storiesListOptions.bottomMargin;\n      } else {\n        // line height + margin-bottom\n        options.startHeight = 50 + storiesListOptions.card.height + storiesListOptions.topPadding + storiesListOptions.bottomPadding + storiesListOptions.bottomMargin;\n      }\n    }\n\n    this.createView(mountSelector, options);\n\n  }\n\n\n  private createView(mountSelector: string, options: CreateViewOptions) {\n    const self = this;\n    let obj: Option<HTMLElement> = null;\n    if (mountSelector === 'body') {\n      obj = document.body;\n    } else {\n      obj = document.querySelector(mountSelector);\n    }\n\n\n    if (obj) {\n\n\n    }\n  }\n\n  private extend(obj1: Dict, obj2: Dict) {\n    for (var i in obj2) {\n      if (obj1[i] && typeof (obj1[i]) === 'object') {\n        this.extend(obj1[i], obj2[i])\n      } else {\n        obj1[i] = obj2[i];\n      }\n    }\n  }\n\n  private genKey() {\n    var key = '';\n    for (var i = 0; i < 5; i++) {\n      key += Math.ceil(Math.random() * 15).toString(16);\n    }\n    return key;\n  }\n\n  private frameName: string = '';\n\n  private mountView(obj: HTMLElement, options: Dict, attrs?: Dict) {\n\n    this.frameName = 'fXD' + this.genKey();\n\n    const div = document.createElement('div');\n    div.innerHTML = '<iframe name=\"' + this.frameName + '\" ' + (attrs || '') + '></iframe>';\n    const frame = div.firstChild as HTMLIFrameElement;\n    const self = this;\n\n    setTimeout(function () {\n      frame.frameBorder = '0';\n      if (options) self.extend(frame, options);\n      obj.insertBefore(frame, obj.firstChild);\n\n      //             this.caller = obj.contentWindow;\n      //             this.frame  = obj;\n      // rpcServerStart\n\n      // self.start(frame);\n\n    }, 0);\n\n    return frame;\n  }\n\n\n  // container options\n  public get containerOptions(): Dict {\n    const options: CreateViewOptions = {\n      allowTransparency: true,\n      overflowTouch: false,\n      backgroundColor: this.storiesListOptions.layout.backgroundColor,\n      width: 0,\n      height: 0,\n      pageUrl: '',\n      startHeight: 0\n    };\n\n\n    //\n    // // todo непонятно как высоту с учетом title рассчитывать\n    // if (this.storiesListOptions.layout.height) {\n    //   options.startHeight = this.storiesListOptions.layout.height;\n    // } else {\n    //   if (!this.storiesListOptions.title) {\n    //     options.startHeight = this.storiesListOptions.card.height + this.storiesListOptions.topPadding + this.storiesListOptions.bottomPadding + this.storiesListOptions.bottomMargin;\n    //   } else {\n    //     // line height + margin-bottom\n    //     options.startHeight = 50 + this.storiesListOptions.card.height + this.storiesListOptions.topPadding + this.storiesListOptions.bottomPadding + this.storiesListOptions.bottomMargin;\n    //   }\n    // }\n\n    let params: Dict<any> = {\n      // настройки storiesList виджета\n      storiesHeight: this.storiesListOptions.card?.height || 70,\n      storiesLayoutHeight: this.storiesListOptions.layout?.height || 0,\n      storiesBackgroundColor: this.storiesListOptions.layout?.backgroundColor || 'transparent',\n      storiesListTopPadding: this.storiesListOptions.topPadding || 20,\n      storiesListBottomPadding: this.storiesListOptions.bottomPadding || 20,\n      storiesListBottomMargin: this.storiesListOptions.bottomMargin || 20,\n      storiesTitle: this.storiesListOptions.title?.content || '',\n\n      extraCss: this.storiesListOptions.extraCss || null,\n      extraJs: null,\n\n    };\n\n    let defaults = {\n      maxWidth: 0,\n      startHeight: 70,\n      minWidth: 150,\n      storiesHeight: 70,\n      scrolling: false,\n      hidden: false\n    };\n\n    // todo непонятно как высоту с учетом title рассчитывать\n    if (params.storiesLayoutHeight) {\n      defaults.startHeight = parseFloat(params.storiesLayoutHeight);\n    } else {\n      if (!params.storiesTitle) {\n        defaults.startHeight = parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      } else {\n        // line height + margin-bottom\n        defaults.startHeight = 50 + parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      }\n    }\n\n\n    let width: number = options.width === 'auto' ? (/*obj.clientWidth || obj.offsetWidth || */defaults.minWidth) | 0 : parseInt(options.width || 0, 10);\n\n    const cssWidth: string = width ? (Math.max(defaults.minWidth || 200, Math.min(defaults.maxWidth || 10000, width)) + 'px') : '100%';\n\n    const containerOptions: Dict = {\n      style: {}\n    };\n\n    containerOptions.style.width = cssWidth;\n    containerOptions.style.overflow = 'hidden';\n\n    if (options.height) {\n      // params.height = options.height;\n      containerOptions.style.height = options.height + 'px';\n    } else {\n      containerOptions.style.height = (defaults.startHeight || 200) + 'px';\n    }\n\n    if (options.overflowTouch) {\n      containerOptions.style.overflow = 'auto';\n      containerOptions.style.WebkitOverflowScrolling = 'touch';\n    }\n\n    return {\n      style: {\n        position: 'relative',\n        height: parseInt(containerOptions.style.height),\n          width: \"100%\"\n      }\n    };\n\n    // return containerOptions;\n  }\n\n\n  public get viewOptions(): Dict {\n    if (!this.frameName) {\n      this.frameName = 'fXD' + this.genKey();\n    }\n\n    const options: CreateViewOptions = {\n      allowTransparency: true,\n      overflowTouch: false,\n      backgroundColor: this.storiesListOptions.layout.backgroundColor,\n      width: 0,\n      height: 0,\n      pageUrl: '',\n      startHeight: 0\n    };\n\n    // // todo непонятно как высоту с учетом title рассчитывать\n    // if (this.storiesListOptions.layout.height) {\n    //   options.startHeight = this.storiesListOptions.layout.height;\n    // } else {\n    //   if (!this.storiesListOptions.title) {\n    //     options.startHeight = this.storiesListOptions.card.height + this.storiesListOptions.topPadding + this.storiesListOptions.bottomPadding + this.storiesListOptions.bottomMargin;\n    //   } else {\n    //     // line height + margin-bottom\n    //     options.startHeight = 50 + this.storiesListOptions.card.height + this.storiesListOptions.topPadding + this.storiesListOptions.bottomPadding + this.storiesListOptions.bottomMargin;\n    //   }\n    // }\n\n\n    // todo in common part\n    let params: Dict<any> = {\n      // настройки storiesList виджета\n      storiesHeight: this.storiesListOptions.card?.height || 70,\n      storiesLayoutHeight: this.storiesListOptions.layout?.height || 0,\n      storiesBackgroundColor: this.storiesListOptions.layout?.backgroundColor || 'transparent',\n      storiesListTopPadding: this.storiesListOptions.topPadding || 20,\n      storiesListBottomPadding: this.storiesListOptions.bottomPadding || 20,\n      storiesListBottomMargin: this.storiesListOptions.bottomMargin || 20,\n      storiesTitle: this.storiesListOptions.title?.content || '',\n\n      extraCss: this.storiesListOptions.extraCss || null,\n      extraJs: null,\n\n    };\n\n    let defaults = {\n      maxWidth: 0,\n      startHeight: 70,\n      storiesHeight: 70,\n      minWidth: 150,\n      scrolling: false,\n      hidden: false\n    };\n\n    // todo непонятно как высоту с учетом title рассчитывать\n    if (params.storiesLayoutHeight) {\n      defaults.startHeight = parseFloat(params.storiesLayoutHeight);\n    } else {\n      if (!params.storiesTitle) {\n        defaults.startHeight = parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      } else {\n        // line height + margin-bottom\n        defaults.startHeight = 50 + parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      }\n    }\n\n\n    let width: number = options.width === 'auto' ? (/*obj.clientWidth || obj.offsetWidth || */defaults.minWidth) | 0 : parseInt(options.width || 0, 10);\n\n    const cssWidth: string = width ? (Math.max(defaults.minWidth || 200, Math.min(defaults.maxWidth || 10000, width)) + 'px') : '100%';\n\n\n    const iframeOptions: Dict<any> = {\n      src: '',\n      id: 'iaswidget' + this.widgetId,\n      allowtransparency: Boolean(options.allowTransparency || false).toString(),\n      style: {\n        backgroundColor: options.backgroundColor || 'transparent',\n      }\n    };\n\n    iframeOptions.width = (cssWidth.indexOf('%') != -1) ? cssWidth : (parseInt(cssWidth) || cssWidth);\n    iframeOptions.height = defaults.startHeight || '100%';\n\n    // for correct @media in iframe work - pass innerWidth instead of clientWidth\n    // plus parent div overflow: hidden\n    // width: cssWidth === '100%' ? '100%' : cssWidth,\n    // https://stackoverflow.com/questions/23083462/how-to-get-an-iframe-to-be-responsive-in-ios-safari\n    iframeOptions.style.width = '1px';\n    iframeOptions.style.minWidth = '100%';\n    iframeOptions.style[\"*width\"] = '100%';\n\n\n    if (defaults.scrolling) {\n      iframeOptions.scrolling = 'yes';\n    } else {\n      iframeOptions.scrolling = 'no';\n      iframeOptions.style.overflow = 'hidden';\n    }\n\n    if (defaults.hidden) {\n      iframeOptions.style.display = 'none';\n    }\n\n\n    // if (isWindowSupportIframeBlobSrcSync()) {\n    //   iframeOptions.src = blobUrl.src;\n    // } else {\n    //   //@ts-ignore\n    //   iframeOptions.srcDoc = blobUrl.srcdoc;\n    // }\n\n    return {\n      style: {\n        width: '100%',\n        height: iframeOptions.height\n      },\n      // не нужно для WebView\n      // onLoad: WidgetStoriesList.onViewFirstLoad,\n\n      source: {\n        html: this.widgetEntrypoint, baseUrl: 'https://sdk.inappstory.com'\n      }\n    };\n\n    return {\n      name: this.frameName,\n      frameBorder: '0',\n      ...iframeOptions,\n      // onLoad: WidgetStoriesList.onViewFirstLoad\n    };\n\n  }\n\n\n  public createRpcServer(worker: any) {\n    createRpcServer(rpcDomains, new WebViewWorkerServer(worker));\n  }\n\n\n  public async init(mountSelector: string, storiesListOptions: StoriesListOptions & Pick<AppearanceCommonOptions, \"hasFavorite\">) {\n\n    let params: Dict<any> = {\n        // настройки storiesList виджета\n        storiesHeight: storiesListOptions.card?.height || 70,\n        storiesLayoutHeight: storiesListOptions.layout?.height || 0,\n        storiesBackgroundColor: storiesListOptions.layout?.backgroundColor || 'transparent',\n        storiesListTopPadding: storiesListOptions.topPadding || 20,\n        storiesListBottomPadding: storiesListOptions.bottomPadding || 20,\n        storiesListBottomMargin: storiesListOptions.bottomMargin || 20,\n        storiesTitle: storiesListOptions.title?.content || '',\n\n        extraCss: storiesListOptions.extraCss || null,\n        extraJs: null,\n\n      },\n      widgetRoot: any,\n      widget: any,\n      rpc: any,\n      inFullScreenMode = false,\n      scrollPosition = [0, 0],\n      options: Dict<any> = {};\n\n    options.allowTransparency = true;\n    options.overflowTouch = false;\n\n    options.backgroundColor = params.storiesBackgroundColor;\n\n    var defaults = {\n      startHeight: 70,\n      minWidth: 150,\n      storiesHeight: 70\n    };\n\n    // todo непонятно как высоту с учетом title рассчитывать\n    if (params.storiesLayoutHeight) {\n      defaults.startHeight = parseFloat(params.storiesLayoutHeight);\n    } else {\n      if (!params.storiesTitle) {\n        defaults.startHeight = parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      } else {\n        // line height + margin-bottom\n        defaults.startHeight = 50 + parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      }\n    }\n\n    var body = document.querySelector('body'),\n      html = document.querySelector('html'),\n      zIndex = options.zIndex || 10000;\n\n    const self = this;\n\n    const functions = {\n\n      // TODO add class to body\n\n      // switchToFullScreen: function () {\n      //     if (inFullScreenMode) {\n      //         return;\n      //     }\n      //\n      //     scrollPosition = IAS_OLD.Util.getScroll();\n      //\n      //     if (body) {\n      //         body.style.setProperty('user-select', 'none');\n      //         body.style.setProperty('-webkit-user-select', 'none');\n      //\n      //         body.style.setProperty('overflow', 'hidden');\n      //         body.style.setProperty('-webkit-overflow-scrolling', 'touch');\n      //     }\n      //\n      //     if (html) {\n      //         html.style.setProperty('position', 'fixed');\n      //         html.style.setProperty('overflow', 'hidden');\n      //     }\n      //\n      //     if (widgetRoot && widget) {\n      //         // получаем текущее смещение от начала viewport\n      //         const viewportOffset = widgetRoot.getBoundingClientRect();\n      //         const offsetTop = viewportOffset.top;\n      //\n      //         widget.style.setProperty('position', 'fixed')\n      //         widget.style.setProperty('top', '0')\n      //         widget.style.setProperty('bottom', '0')\n      //         widget.style.setProperty('left', '0')\n      //         widget.style.setProperty('right', '0')\n      //         widget.style.setProperty('height', '0')\n      //         widget.style.setProperty('min-height', '100%')\n      //         widget.style.setProperty('max-height', '100%')\n      //\n      //         widget.style.setProperty('z-index', zIndex)\n      //\n      //         rpc.callMethod('onEnterFullScreen', {offsetTop: offsetTop})\n      //\n      //     }\n      //\n      //     inFullScreenMode = true;\n      //\n      //     // newWidth  = parseInt(newWidth);\n      //     // newHeight = parseInt(newHeight);\n      //     // var widgetElem = document.getElementById('iaswidget' + widgetId);\n      //     // if (isFinite(newWidth)) {\n      //     //   obj.style.width = newWidth + 'px';\n      //     //   if (widgetElem) {\n      //     //     widgetElem.style.width = newWidth + 'px';\n      //     //   }\n      //     // }\n      //     // if (isFinite(newHeight)) {\n      //     //   obj.style.height = newHeight + 'px';\n      //     //   if (widgetElem) {\n      //     //     widgetElem.style.height = newHeight + 'px';\n      //     //   }\n      //     // }\n      //     // if (options.onResizeWidget) options.onResizeWidget();\n      //     //\n      //\n      //\n      // },\n      // switchFromFullScreen: function () {\n      //     if (!inFullScreenMode) {\n      //         return;\n      //     }\n      //\n      //     if (widgetRoot && widget) {\n      //         widget.style.setProperty('position', '')\n      //         widget.style.setProperty('top', '')\n      //         widget.style.setProperty('bottom', '')\n      //         widget.style.setProperty('left', '')\n      //         widget.style.setProperty('right', '')\n      //         widget.style.setProperty('height', isFinite(defaults['startHeight']) ? defaults['startHeight'] + 'px' : '100%')\n      //         widget.style.setProperty('min-height', '')\n      //         widget.style.setProperty('max-height', '')\n      //         widget.style.setProperty('z-index', '')\n      //\n      //         rpc.callMethod('onLeaveFullScreen')\n      //     }\n      //\n      //     if (body) {\n      //         body.style.setProperty('user-select', '');\n      //         body.style.setProperty('-webkit-user-select', '');\n      //\n      //         body.style.setProperty('overflow', '');\n      //         body.style.setProperty('-webkit-overflow-scrolling', '');\n      //     }\n      //\n      //     if (html) {\n      //         html.style.setProperty('position', '');\n      //         html.style.setProperty('overflow', '');\n      //     }\n      //\n      //     window.scrollTo(scrollPosition[0], scrollPosition[1])\n      //\n      //     inFullScreenMode = false;\n      //\n      // },\n\n      event: function (name: string, data: Object) {\n        self.emit(name, data)\n      },\n    };\n\n\n    params.extraJs = null;\n\n    // custom load end\n    options.no_finish_loading = true;\n\n    return this._init(mountSelector as ObjectId, options, params, storiesListOptions, functions, defaults, function (o: any, i: any, r: any) {\n      widgetRoot = o;\n      widget = i;\n      rpc = r;\n    }, null, null);\n\n  }\n\n  getWidgetDocument(widgetParams: Dict): string {\n\n    const baseUrl = process.env.BASE_URL;\n    const apiUrl = process.env.API_URL;\n    const buildVersion = process.env.BUILD_VERSION;\n\n    // todo можно BASE_URL менять в процессе сборки\n    let cssResource: URL | string = `${baseUrl}/v${buildVersion}/dist/css/storiesList.css`;\n    let jsResource: URL | string = `${baseUrl}/v${buildVersion}/dist/js/storiesList.js`;\n    if (process.env.NODE_ENV === \"development\") {\n      cssResource = `${baseUrl}/css/storiesList.css`;\n      jsResource = `${baseUrl}/js/storiesList.js`;\n\n      // if npm pack\n      // cssResource = new URL(\"~/dist/css/storiesList.css\", import.meta.url);\n      // jsResource = new URL(\"~/dist/js/storiesList.js\", import.meta.url);\n\n\n      // jsResource = `/js/storiesList.js`;\n\n    }\n\n    // cssResource = new URL(\"~/dist/css/storiesList.css\", import.meta.url);\n    // jsResource = new URL(\"~/dist/js/storiesList.js\", import.meta.url);\n\n    jsResource = jsResourceGlobal;\n\n    // console.log({meta: import.meta});\n\n    // (async () => {\n    //   const {WStories} = await import(\"~/src/stories_widget/stories-slider\");\n    //   console.log({WStories});\n    // })();\n\n\n    // <link rel=\"stylesheet\" type=\"text/css\" href=\"${cssResource}\"/>\n    // <script type=\"text/javascript\" src=\"${jsResource}\"></script>\n    // import.meta.url\n\n    // <script type=\"text/javascript\" src=\"${jsResource}\"></script>\n    return `\n        <script type=\"text/javascript\" src=\"${jsResource}\"></script>\n        <div id=\"app\"><div id=\"_app\"></div></div>\n        <script type=\"text/javascript\">\n          window.storiesList.init(${JSON.stringify(widgetParams)});\n        </script>\n`;\n\n\n  }\n\n  protected async _init(mountSelector: ObjectId, options: Dict, params: Dict, widgetParams: Dict, funcs: Dict, defaults: Dict, onDone: (obj: any, iframe: any, rpc: any) => void, widgetId: Nullable<string | number>, iter: Nullable<number>) {\n\n    funcs.event = (name: string, data: Object) => this.emit(name, data)\n\n    onDone = (obj: any, iframe: any, rpc: any) => {\n      this.rpc = rpc;\n    };\n\n    const result = super._init(mountSelector, options, params, widgetParams, funcs, defaults, onDone, widgetId, iter);\n\n    // story reader\n\n    // const storyReader = new StoryReader('body', options);\n\n\n    // this.on('sessionInitInternal', (payload: any) => storyReader.sessionInit(payload));\n    // this.on('clickOnStoryInternal', (payload: ClickOnStoryInternalPayload) => storyReader.openReader(payload));\n    this.on('clickOnStoryInternal', (payload: ClickOnStoryInternalPayload) => {\n      if (isFunction(this.callbacks?.handleClickOnStoryInternal)) {\n        this.callbacks?.handleClickOnStoryInternal(payload);\n      }\n    });\n\n    this.on('flushThumbViews', (payload: Array<number>) => {\n      if (isFunction(this.callbacks?.handleFlushThumbViews)) {\n        this.callbacks?.handleFlushThumbViews(payload);\n      }\n    });\n\n\n    // storyReader.on('storyOpenedInternal', (payload: {id: number}) => this.onStoryOpened(payload));\n\n\n    // storyReader.on('favoriteStoryInternal', (payload: {id: number, value: boolean}) => this.onStoryFavoriteChange(payload));\n\n\n    // public event\n    this.on('clickOnStory', (payload: ClickOnStoryPayload) => {\n      if (isFunction(this.callbacks?.handleClickOnStory)) {\n        this.callbacks?.handleClickOnStory(payload);\n      }\n    });\n\n    // click on deep link from story list\n    this.on('clickOnStoryDeepLink', (payload: ClickOnStoryPayload) => {\n      if (isFunction(this.callbacks?.handleClickOnStoryDeepLink)) {\n        this.callbacks?.handleClickOnStoryDeepLink(payload);\n      }\n    });\n\n    // button from slide\n    // storyReader.on('clickOnButton', (payload: ClickOnButtonPayload) => {\n    //     if (params.storyLinkHandleClick && isFunction(params.storyLinkHandleClick)) {\n    //         params.storyLinkHandleClick(payload);\n    //     } else {\n    //         window.open(payload.url, '_self');\n    //     }\n    // });\n\n    const publicEvents = ['showSlide', 'showStory', 'closeStory', 'clickOnButton', 'likeStory', 'dislikeStory', 'favoriteStory', 'shareStory', 'shareStoryWithPath'];\n\n    // publicEvents.forEach((eventName) => storyReader.on(eventName, (payload) => this.emit(eventName, payload)));\n\n    // let storyFavorite: Nullable<_StoryFavorite> = null;\n    // if (options.hasFavorite) {\n    //   storyFavorite = new _StoryFavorite('body', options);\n    // }\n\n    // storyFavorite && this.on('sessionInitInternal', (payload: any) => storyFavorite && storyFavorite.sessionInit(payload));\n    // storyFavorite && this.on('clickOnFavoriteCellInternal', (payload: ClickOnFavoriteCellInternalPayload) => storyFavorite && storyFavorite.openReader(payload));\n\n    // custom method\n    // storyFavorite && storyFavorite.on('clickOnStoryInternal', (payload: ClickOnStoryInternalPayload) => storyReader.openReader(payload));\n    // storyFavorite && storyReader.on('openStoryReader', (options: {windowReferer: STORY_READER_WINDOW_REFERER}) => storyFavorite && storyFavorite.openStoryReader(options));\n    // storyFavorite && storyReader.on('closeStoryReader', (options: {windowReferer: STORY_READER_WINDOW_REFERER}) => storyFavorite && storyFavorite.closeStoryReader(options));\n\n    /*    storyFavorite && storyFavorite.on('closeReader', () => {\n          try {\n            window.focus()\n          } catch (e) {\n            console.error(e)\n          }\n        });*/\n\n    this.on('syncStore', (payload: SyncStoreEvent) => {\n      // storyReader.syncStoreHandle(payload);\n      // storyFavorite && storyFavorite.syncStoreHandle(payload);\n    });\n\n    // storyReader.on('syncStore', (payload: SyncStoreEvent) => {\n    //     this.syncStoreHandle(payload);\n    //     storyFavorite && storyFavorite.syncStoreHandle(payload);\n    // });\n    //\n    // storyFavorite && storyFavorite.on('syncStore', (payload: SyncStoreEvent) => {\n    //     this.syncStoreHandle(payload);\n    //     storyReader.syncStoreHandle(payload);\n    // });\n\n    return result;\n  }\n\n  onStoryOpened(payload: { id: number }) {\n    this.rpc.callMethod('onStoryOpened', payload);\n  }\n\n  // onStoryFavoriteChange(payload: {id: number, value: boolean}) {\n  //     this.rpc.callMethod('onStoryFavoriteChange', payload);\n  // }\n\n  syncStoreHandle(payload: SyncStoreEvent) {\n    this.rpc.callMethod('onSyncStore', payload);\n  }\n\n\n  // pass story list\n  setStories(payload: any) {\n    // вынести в общую часть\n    setStories(payload);\n\n  }\n\n  setFonts(payload: any) {\n    setFonts(payload);\n  }\n\n\n}\n\nexport {WidgetStoriesList};\n","import {Option, Dict} from \"../../global.h\";\n\nexport enum StoryReaderCloseButtonPosition {\n  LEFT = 'left',\n  RIGHT = 'right'\n}\n\nexport enum StoryReaderSwipeStyle {\n  FLAT = 'flat',\n  COVER = 'cover',\n  CUBE = 'cube'\n}\n\n\nexport type StoryReaderOptions = {\n  closeButtonPosition: StoryReaderCloseButtonPosition,\n  scrollStyle: StoryReaderSwipeStyle,\n  loader?: {\n    default: {\n      color: Option<string>,\n      accentColor: Option<string>,\n    },\n    custom: Option<string>\n  },\n  recycleStoriesList?: boolean,\n  closeOnLastSlideByTimer?: boolean,\n};\n\nconst StoryReaderOptionsDefault: StoryReaderOptions = {\n  closeButtonPosition: StoryReaderCloseButtonPosition.RIGHT,\n  scrollStyle: StoryReaderSwipeStyle.FLAT,\n  loader: {\n    default: {\n      color: null,\n      accentColor: null,\n    },\n    custom: null\n  },\n  recycleStoriesList: false,\n  closeOnLastSlideByTimer: true\n};\n\nexport {StoryReaderOptionsDefault};\n","export type AppearanceCommonOptions = {\n  hasFavorite?: boolean;\n  hasLike?: boolean;\n  hasShare?: boolean;\n};\n\nconst AppearanceCommonOptionsDefault: AppearanceCommonOptions = {\n  hasFavorite: false,\n  hasLike: false,\n  hasShare: false\n};\n\nexport {AppearanceCommonOptionsDefault};\n\n\n","import {createDomain, Effect} from 'effector';\n\nimport {\n  ClickOnStoryInternalWithDataPayload,\n  FontResource,\n  STORY_LIST_TYPE,\n  STORY_READER_WINDOW_REFERER\n} from \"../story-manager/common.h\";\nimport {Dict} from \"../../global.h\";\n\n// use name|sid or  \"effector/babel-plugin\"\nconst toServerFxDomain = createDomain(\"serverFxDomainWidgetStory\");\nconst toClientFxDomain = createDomain(\"clientFxDomainWidgetStory\");\n\nexport {toServerFxDomain as serverFxDomain, toClientFxDomain as clientFxDomain}\n\nexport const rpcDomains = {\n  serverFxDomain: toServerFxDomain,\n  clientFxDomain: toClientFxDomain\n}\n\n// export const workerMessage = domain.effect<string, string[]>();\n// export const failure = domain.effect<void, any>();\n// export const ping: Effect<{now: number}, {ping: number}> = domain.effect();\n\n\n\nexport const RpcMessage = toClientFxDomain.effect<string, string[]>(\"RpcMessage\");\n\nexport const setStories = toClientFxDomain.effect<{listType: STORY_LIST_TYPE, storyList: Array<Dict>}, void>(\"setStories\");\nexport const setFonts = toClientFxDomain.effect<FontResource, void>(\"setFonts\");\n\nexport const onOpenReader = toClientFxDomain.effect<ClickOnStoryInternalWithDataPayload & {hasShare: boolean}, void>(\"onOpenReader\");\nexport const onCloseReader = toClientFxDomain.effect<void, void>(\"onCloseReader\");\n\nexport const RpcMessageOnServer = toServerFxDomain.effect<string, string[]>(\"RpcMessageOnServer\");\n\n\nexport const widgetLoaded = toServerFxDomain.effect<void, void>(\"widgetLoaded\");\nexport const onReaderOpened = toServerFxDomain.effect<{windowReferer: STORY_READER_WINDOW_REFERER}, void>(\"onReaderOpened\");\nexport const onReaderClosed = toServerFxDomain.effect<{windowReferer: STORY_READER_WINDOW_REFERER}, void>(\"onReaderClosed\");","import {Option, Dict} from \"../../global.h\";\n\nexport type StoriesListOptions = {\n    title: StoriesListTitleOptions;\n    card: StoriesListCardOptions;\n    favoriteCard: StoriesListFavoriteCardOptions;\n    layout: {\n        height: number;\n        backgroundColor: string;\n    };\n    sidePadding: number;\n    topPadding: number;\n    bottomPadding: number;\n    bottomMargin: number;\n\n    navigation: {\n        showControls: boolean;\n        controlsSize: number;\n        controlsBackgroundColor: string;\n        controlsColor: string;\n    };\n\n    extraCss?: string;\n\n    // setCallback ?\n    handleStoryLinkClick?: (payload: StoriesListClickEvent) => void;\n\n    handleStartLoading?: (loaderContainer: HTMLElement) => void;\n    handleStopLoading?: (loaderContainer: HTMLElement) => void;\n\n\n    // handleClickOnStory?: (event: StoriesListClickEvent) => void,\n\n}\n\nexport type StoriesListTitleOptions = {\n    content: string;\n    color: string;\n    font: string;\n    marginBottom: number;\n}\n\nexport enum StoriesListCardViewVariant {\n    CIRCLE = 'circle',\n    QUAD = 'quad',\n    RECTANGLE = 'rectangle'\n}\n\nexport type StoriesListCardOptions = {\n    title: {\n        color: string;\n        padding: string | number;\n        font: string;\n    };\n    gap: number;\n    height: number;\n    variant: StoriesListCardViewVariant;\n    border: {\n        radius: number;\n        color: string;\n        width: number;\n        gap: number;\n    };\n    boxShadow: Option<string>;\n    opacity: Option<number>;\n    mask: {\n        color: Option<string>;\n    };\n    opened: {\n        border: {\n            radius: Option<number>;\n            color: Option<string>;\n            width: Option<number>;\n            gap: Option<number>;\n        };\n        boxShadow: Option<string>;\n        opacity: Option<number>;\n        mask: {\n            color: Option<string>;\n        };\n    };\n}\n\nexport type StoriesListFavoriteCardOptions = StoriesListCardOptions & {\n    title: {\n        content: string;\n        color: string;\n        padding: string | number;\n        font: string;\n    }\n};\n\nexport type StoriesListClickEvent = {\n    id: number,\n    index: number,\n    isDeeplink: boolean,\n    url: string|undefined,\n};\n\n\n\nexport enum StoriesListEvents {\n    START_LOADER = 'startLoader',\n    END_LOADER = 'endLoader',\n}\n\n\n\nconst StoriesListOptionsDefault: StoriesListOptions =\n    {\n        title: {\n            content: '',\n            color: '#ffffff',\n            font: 'normal',\n            marginBottom: 20,\n        },\n        card: {\n            title: {\n                font: 'normal',\n                color: '#ffffff',\n                padding: 15,\n            },\n            gap: 10,\n            height: 70,\n            variant: StoriesListCardViewVariant.CIRCLE,\n            border: {\n                radius: 0,\n                color: 'black',\n                width: 2,\n                gap: 3,\n            },\n            boxShadow: null,\n            opacity: null,\n            mask: {\n                color: null,\n            },\n            opened: {\n                border: {\n                    radius: null,\n                    color: null,\n                    width: null,\n                    gap: null,\n                },\n                boxShadow: null,\n                opacity: null,\n                mask: {\n                    color: null,\n                },\n            },\n        },\n        favoriteCard: {\n            title: {\n                content: 'Избранное',\n                font: 'normal',\n                color: '#000',\n                padding: 15,\n            },\n            gap: 10,\n            height: 70,\n            variant: StoriesListCardViewVariant.CIRCLE,\n            border: {\n                radius: 0,\n                color: 'black',\n                width: 2,\n                gap: 3,\n            },\n            boxShadow: null,\n            opacity: null,\n            mask: {\n                color: null,\n            },\n            opened: {\n                border: {\n                    radius: null,\n                    color: null,\n                    width: null,\n                    gap: null,\n                },\n                boxShadow: null,\n                opacity: null,\n                mask: {\n                    color: null,\n                },\n            },\n        },\n        sidePadding: 20,\n        topPadding: 20,\n        bottomPadding: 20,\n        bottomMargin: 17,\n        layout: {\n            height: 0,\n            backgroundColor: 'transparent'\n        },\n        navigation: {\n            showControls: false,\n            controlsSize: 48,\n            controlsBackgroundColor: 'white',\n            controlsColor: 'black'\n        },\n    };\n\nexport {StoriesListOptionsDefault};\n","import {Dict, Option} from \"../../global.h\";\nimport Widget, {ObjectId} from \"../widget\";\nimport {\n  ClickOnStoryInternalPayload,\n  ClickOnStoryInternalWithDataPayload,\n  ClickOnStoryPayload, STORY_READER_WINDOW_REFERER,\n  SyncStoreEvent\n} from \"../story-manager/common.h\";\nimport {StoryReaderOptions, StoryReaderOptionsDefault} from \"./index.h\";\nimport {AppearanceCommonOptions, AppearanceCommonOptionsDefault} from \"../story-manager/appearanceCommon.h\";\nimport {IWidgetStoryReader} from \"./index\";\nimport {AppearanceManager} from \"../story-manager/AppearanceManager\";\nimport {CreateViewOptions} from \"./rn.h\";\n\ndeclare global {\n  interface Window {\n    scrollNode: any; // browser env\n    fastXDM: any;\n    iasAsyncInitCallbacks: Array<() => void>;\n  }\n}\n\nimport {\n  rpcDomains,\n  RpcMessage,\n  RpcMessageOnServer,\n  widgetLoaded,\n  setStories,\n  setFonts,\n  onOpenReader,\n  onCloseReader,\n  onReaderOpened, onReaderClosed\n} from \"./rpc\";\nimport {create as createRpcServer} from \"../rpc/remoteFX/server\";\nimport {IframeWorkerServer} from \"../rpc/IframeWorkerServer\";\nimport {ReactEventHandler, SyntheticEvent} from \"react\";\nimport WebView from \"react-native-webview\";\nimport {WebViewWorkerServer} from \"../rpc/WebViewWorkerServer\";\n\n\nRpcMessageOnServer.use(async arg => {\n  return [arg + \" :125\"];\n});\n\n\n//@ts-ignore\nwindow.RpcMessage = RpcMessage;\n// const result = await workerMessage('foo bar  baz bam')\n\n// const jsResourceGlobal = new URL(\"./StoriesListClient.umd.js\", import.meta.url);\n// const cssResourceGlobal = new URL(\"./StoriesListClient.umd.css\", import.meta.url);\n\n// escaped content\n// @ts-ignore\nimport jsResourceGlobal from \"../../packages/react-native-ias/StoryReaderClient.js\";\n//@ts-ignore\nimport cssResourceGlobal from \"../../packages/react-native-ias/StoryReaderClient.css.js\";\nimport {isFunction} from \"../helpers/isFunction\";\n\n// const jsResourceGlobal = \"\";\n// const cssResourceGlobal = \"\";\n\n\nclass WidgetStoryReader extends Widget implements IWidgetStoryReader {\n\n  constructor(private appearanceManagerGetter: () => Option<AppearanceManager>, private overrideStoryReaderOptions: Pick<StoryReaderOptions, \"recycleStoriesList\" | \"closeOnLastSlideByTimer\"> = {}) {\n    super();\n\n    this.widgetId = ++Widget.count;\n\n    // вынести в общую часть\n    widgetLoaded.use(() => {\n      this.emit(\"widgetLoaded\");\n    });\n\n    onReaderOpened.use(options => {\n      if (options.windowReferer === STORY_READER_WINDOW_REFERER.default) {\n        // web container only !\n        // sbHelper.setScrollbar();\n      } else if (options.windowReferer === STORY_READER_WINDOW_REFERER.favorite) {\n        // self.emit('openStoryReader', options);\n      }\n      this.emit('openStoryReader', options);\n\n      // if (body) {\n      //     body.style.setProperty('user-select', 'none');\n      //     body.style.setProperty('-webkit-user-select', 'none');\n      //\n      //     body.style.setProperty('overflow', 'hidden');\n      //     body.style.setProperty('-webkit-overflow-scrolling', 'touch');\n      // }\n\n      // if (html) {\n      //   // TODO сохранять оригинал и возвраащать обратно\n      //   // html.style.setProperty('position', 'fixed');\n      //   // html.style.setProperty('overflow', 'hidden');\n      // }\n\n      // if (self.iframe) {\n      //   // self.iframe.style.setProperty('position', 'fixed');\n      //   self.iframe.style.setProperty('display', 'block');\n      //   // self.iframe.style.setProperty('height', '0')\n      //   // self.iframe.style.setProperty('min-height', '100%')\n      //   // self.iframe.style.setProperty('max-height', '100%')\n      //\n      //   self.iframe.style.setProperty('z-index', zIndex)\n      // }\n\n    });\n\n    onReaderClosed.use(options => {\n      if (options.windowReferer === STORY_READER_WINDOW_REFERER.default) {\n        // web container only !\n        // sbHelper.resetScrollbar();\n      } else if (options.windowReferer === STORY_READER_WINDOW_REFERER.favorite) {\n        // self.emit('closeStoryReader', options);\n      }\n\n      this.emit('closeStoryReader', options);\n\n      // set display none\n\n\n      // if (self.iframe) {\n      //   self.iframe.style.setProperty('display', 'none');\n      // }\n\n      // if (body) {\n      //     body.style.setProperty('user-select', '');\n      //     body.style.setProperty('-webkit-user-select', '');\n      //\n      //     body.style.setProperty('overflow', '');\n      //     body.style.setProperty('-webkit-overflow-scrolling', '');\n      // }\n\n      // if (html) {\n      //\n      //   // TODO сохранять оригинал и возвраащать обратно\n      //   // html.style.setProperty('position', '');\n      //   // html.style.setProperty('overflow', '');\n      // }\n    });\n\n\n    const functions = {\n\n      // event: function (name: string, data: Object) {\n      //   self.emit(name, data)\n      // },\n\n      // setFixedHtmlPosition: function () {\n      //   if (html) {\n      //     // TODO сохранять оригинал и возвраащать обратно\n      //     // html.style.setProperty('position', 'fixed');\n      //     // html.style.setProperty('overflow', 'hidden');\n      //   }\n      // },\n\n\n    };\n\n  }\n\n  private get storyReaderOptions(): StoryReaderOptions & { appearanceCommon: AppearanceCommonOptions } {\n    const appearanceManager = this.appearanceManagerGetter();\n    if (appearanceManager != null) {\n      return {\n        ...appearanceManager.storyReaderOptions,\n        appearanceCommon: appearanceManager.commonOptions,\n        ...this.overrideStoryReaderOptions\n      }\n    } else {\n      return {\n        ...StoryReaderOptionsDefault,\n        appearanceCommon: AppearanceCommonOptionsDefault,\n        ...this.overrideStoryReaderOptions\n      }\n    }\n\n  }\n\n\n  public get widgetSrcFile(): string | URL {\n    return jsResourceGlobal;\n  }\n\n  public get widgetEntrypoint(): string {\n    return `\n      <head>\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, user-scalable=0, shrink-to-fit=no\">\n        <style type=\"text/css\">${cssResourceGlobal}</style>\n      </head>\n      <div id=\"app\"><div id=\"_app\"></div></div>\n      <script type=\"text/javascript\">${jsResourceGlobal}</script>\n      <script type=\"text/javascript\">\n        window.storiesList = (function () {\n          var self = window.storiesList || {};\n          self._e = self._e || [];\n          self.ready = self.ready || function (f) {self._e.push(f);};\n          return self;\n        }());\n\n        window.storyReader.ready(function () {\n          window.storyReader.init(${JSON.stringify(this.storyReaderOptions)});\n        });\n\n      </script>`;\n  }\n\n\n  private rpc: any;\n\n  public async mount(mountSelector: string, storiesListOptions: StoriesListOptions & Pick<AppearanceCommonOptions, \"hasFavorite\">): Promise<boolean> {\n    // создаем iframe\n    // по завершению - mounted();\n\n\n    const options: CreateViewOptions = {\n      allowTransparency: true,\n      overflowTouch: false,\n      backgroundColor: storiesListOptions.layout.backgroundColor,\n      width: 'auto',\n      height: 0,\n      pageUrl: '',\n      startHeight: 0\n    };\n\n    // todo непонятно как высоту с учетом title рассчитывать\n    if (storiesListOptions.layout.height) {\n      options.startHeight = storiesListOptions.layout.height;\n    } else {\n      if (!storiesListOptions.title) {\n        options.startHeight = storiesListOptions.card.height + storiesListOptions.topPadding + storiesListOptions.bottomPadding + storiesListOptions.bottomMargin;\n      } else {\n        // line height + margin-bottom\n        options.startHeight = 50 + storiesListOptions.card.height + storiesListOptions.topPadding + storiesListOptions.bottomPadding + storiesListOptions.bottomMargin;\n      }\n    }\n\n    this.createView(mountSelector, options);\n\n  }\n\n\n  private createView(mountSelector: string, options: CreateViewOptions) {\n    const self = this;\n    let obj: Option<HTMLElement> = null;\n    if (mountSelector === 'body') {\n      obj = document.body;\n    } else {\n      obj = document.querySelector(mountSelector);\n    }\n\n\n    if (obj) {\n\n\n    }\n  }\n\n  private extend(obj1: Dict, obj2: Dict) {\n    for (var i in obj2) {\n      if (obj1[i] && typeof (obj1[i]) === 'object') {\n        this.extend(obj1[i], obj2[i])\n      } else {\n        obj1[i] = obj2[i];\n      }\n    }\n  }\n\n  private genKey() {\n    var key = '';\n    for (var i = 0; i < 5; i++) {\n      key += Math.ceil(Math.random() * 15).toString(16);\n    }\n    return key;\n  }\n\n  private frameName: string = '';\n\n  private mountView(obj: HTMLElement, options: Dict, attrs?: Dict) {\n\n    this.frameName = 'fXD' + this.genKey();\n\n    const div = document.createElement('div');\n    div.innerHTML = '<iframe name=\"' + this.frameName + '\" ' + (attrs || '') + '></iframe>';\n    const frame = div.firstChild as HTMLIFrameElement;\n    const self = this;\n\n    setTimeout(function () {\n      frame.frameBorder = '0';\n      if (options) self.extend(frame, options);\n      obj.insertBefore(frame, obj.firstChild);\n\n      //             this.caller = obj.contentWindow;\n      //             this.frame  = obj;\n      // rpcServerStart\n\n      // self.start(frame);\n\n    }, 0);\n\n    return frame;\n  }\n\n\n  // container options\n  public get containerOptions(): Dict {\n    const options: CreateViewOptions = {\n      allowTransparency: true,\n      overflowTouch: false,\n      backgroundColor: 'transparent',\n      width: 0,\n      height: 0,\n      pageUrl: '',\n      startHeight: 0\n    };\n\n\n    //\n    // // todo непонятно как высоту с учетом title рассчитывать\n    // if (this.storiesListOptions.layout.height) {\n    //   options.startHeight = this.storiesListOptions.layout.height;\n    // } else {\n    //   if (!this.storiesListOptions.title) {\n    //     options.startHeight = this.storiesListOptions.card.height + this.storiesListOptions.topPadding + this.storiesListOptions.bottomPadding + this.storiesListOptions.bottomMargin;\n    //   } else {\n    //     // line height + margin-bottom\n    //     options.startHeight = 50 + this.storiesListOptions.card.height + this.storiesListOptions.topPadding + this.storiesListOptions.bottomPadding + this.storiesListOptions.bottomMargin;\n    //   }\n    // }\n\n    let params: Dict<any> = {\n      extraCss: null,\n      extraJs: null,\n\n    };\n\n    let defaults = {\n      maxWidth: 0,\n      startHeight: 70,\n      minWidth: 150,\n      storiesHeight: 70,\n      scrolling: false,\n      hidden: false\n    };\n\n    // todo непонятно как высоту с учетом title рассчитывать\n    if (params.storiesLayoutHeight) {\n      defaults.startHeight = parseFloat(params.storiesLayoutHeight);\n    } else {\n      if (!params.storiesTitle) {\n        defaults.startHeight = parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      } else {\n        // line height + margin-bottom\n        defaults.startHeight = 50 + parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      }\n    }\n\n\n    let width: number = options.width === 'auto' ? (/*obj.clientWidth || obj.offsetWidth || */defaults.minWidth) | 0 : parseInt(options.width || 0, 10);\n\n    const cssWidth: string = width ? (Math.max(defaults.minWidth || 200, Math.min(defaults.maxWidth || 10000, width)) + 'px') : '100%';\n\n    const containerOptions: Dict = {\n      style: {}\n    };\n\n    containerOptions.style.width = cssWidth;\n    containerOptions.style.overflow = 'hidden';\n\n    if (options.height) {\n      // params.height = options.height;\n      containerOptions.style.height = options.height + 'px';\n    } else {\n      containerOptions.style.height = (defaults.startHeight || 200) + 'px';\n    }\n\n    if (options.overflowTouch) {\n      containerOptions.style.overflow = 'auto';\n      containerOptions.style.WebkitOverflowScrolling = 'touch';\n    }\n\n    return {\n      style: {\n        backgroundColor: 'transparent',\n        position: 'relative',\n        // height: parseInt(containerOptions.style.height),\n        height: '100%',\n        width: '100%'\n      }\n    };\n\n    // return containerOptions;\n  }\n\n\n  public get viewOptions(): Dict {\n    if (!this.frameName) {\n      this.frameName = 'fXD' + this.genKey();\n    }\n\n    const options: CreateViewOptions = {\n      allowTransparency: true,\n      overflowTouch: false,\n      backgroundColor: 'transparent',\n      width: '100%',\n      height: '100%',\n      pageUrl: '',\n      startHeight: 0\n    };\n\n    // // todo непонятно как высоту с учетом title рассчитывать\n    // if (this.storiesListOptions.layout.height) {\n    //   options.startHeight = this.storiesListOptions.layout.height;\n    // } else {\n    //   if (!this.storiesListOptions.title) {\n    //     options.startHeight = this.storiesListOptions.card.height + this.storiesListOptions.topPadding + this.storiesListOptions.bottomPadding + this.storiesListOptions.bottomMargin;\n    //   } else {\n    //     // line height + margin-bottom\n    //     options.startHeight = 50 + this.storiesListOptions.card.height + this.storiesListOptions.topPadding + this.storiesListOptions.bottomPadding + this.storiesListOptions.bottomMargin;\n    //   }\n    // }\n\n\n    // todo in common part\n    let params: Dict<any> = {\n      extraCss: null,\n      extraJs: null,\n\n    };\n\n    let defaults = {\n      maxWidth: 0,\n      startHeight: 70,\n      storiesHeight: 70,\n      minWidth: 150,\n      scrolling: false,\n      hidden: false\n    };\n\n    // todo непонятно как высоту с учетом title рассчитывать\n    if (params.storiesLayoutHeight) {\n      defaults.startHeight = parseFloat(params.storiesLayoutHeight);\n    } else {\n      if (!params.storiesTitle) {\n        defaults.startHeight = parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      } else {\n        // line height + margin-bottom\n        defaults.startHeight = 50 + parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      }\n    }\n\n\n    let width: number = options.width === 'auto' ? (/*obj.clientWidth || obj.offsetWidth || */defaults.minWidth) | 0 : parseInt(options.width || 0, 10);\n\n    const cssWidth: string = width ? (Math.max(defaults.minWidth || 200, Math.min(defaults.maxWidth || 10000, width)) + 'px') : '100%';\n\n\n    // if (cssWidth === '100%') params.startWidth = (obj.clientWidth || obj.offsetWidth) | 0;\n\n    const iframeOptions: Dict<any> = {\n      src: '',\n      id: 'iaswidget' + this.widgetId,\n      allowtransparency: Boolean(options.allowTransparency || false).toString(),\n      style: {\n        backgroundColor: options.backgroundColor || 'transparent',\n      }\n    };\n\n    iframeOptions.width = (cssWidth.indexOf('%') != -1) ? cssWidth : (parseInt(cssWidth) || cssWidth);\n    iframeOptions.height = defaults.startHeight || '100%';\n\n    // for correct @media in iframe work - pass innerWidth instead of clientWidth\n    // plus parent div overflow: hidden\n    // width: cssWidth === '100%' ? '100%' : cssWidth,\n    // https://stackoverflow.com/questions/23083462/how-to-get-an-iframe-to-be-responsive-in-ios-safari\n    iframeOptions.style.width = '1px';\n    iframeOptions.style.minWidth = '100%';\n    iframeOptions.style[\"*width\"] = '100%';\n\n\n    if (defaults.scrolling) {\n      iframeOptions.scrolling = 'yes';\n    } else {\n      iframeOptions.scrolling = 'no';\n      iframeOptions.style.overflow = 'hidden';\n    }\n\n    if (defaults.hidden) {\n      iframeOptions.style.display = 'none';\n    }\n\n\n    // if (isWindowSupportIframeBlobSrcSync()) {\n    //   iframeOptions.src = blobUrl.src;\n    // } else {\n    //   //@ts-ignore\n    //   iframeOptions.srcDoc = blobUrl.srcdoc;\n    // }\n\n\n    /*\n                                // flex: 1,\n                            position: 'absolute',\n                            left: 0,\n                            right: 0,\n                            top: 0,\n                            // bottom: 0,\n\n                            // width: '100%',\n                            height: this.props.screenHeight,\n                            // height: webviewHeight,\n     */\n\n    return {\n      style: {\n        backgroundColor: 'transparent',\n        // display: \"none\",\n        position: 'absolute',\n          left: 0,\n          right: 0,\n          top: 0,\n        height: \"100%\",\n        width: '100%',\n        // height: iframeOptions.height\n      },\n      // не нужно для WebView\n      // onLoad: WidgetStoriesList.onViewFirstLoad,\n      source: {\n        html: this.widgetEntrypoint, baseUrl: 'https://sdk.inappstory.com'\n      }\n    };\n\n    return {\n      name: this.frameName,\n      frameBorder: '0',\n      ...iframeOptions,\n      // onLoad: WidgetStoriesList.onViewFirstLoad\n    };\n\n  }\n\n\n  public createRpcServer(worker: any) {\n    // WebViewWorkerServer - destroy ?\n\n    createRpcServer(rpcDomains, new WebViewWorkerServer(worker));\n  }\n\n\n  public async init(mountSelector: string, storiesListOptions: StoriesListOptions & Pick<AppearanceCommonOptions, \"hasFavorite\">) {\n\n    let params: Dict<any> = {\n        // настройки storiesList виджета\n        storiesHeight: storiesListOptions.card?.height || 70,\n        storiesLayoutHeight: storiesListOptions.layout?.height || 0,\n        storiesBackgroundColor: storiesListOptions.layout?.backgroundColor || 'transparent',\n        storiesListTopPadding: storiesListOptions.topPadding || 20,\n        storiesListBottomPadding: storiesListOptions.bottomPadding || 20,\n        storiesListBottomMargin: storiesListOptions.bottomMargin || 20,\n        storiesTitle: storiesListOptions.title?.content || '',\n\n        extraCss: storiesListOptions.extraCss || null,\n        extraJs: null,\n\n      },\n      widgetRoot: any,\n      widget: any,\n      rpc: any,\n      inFullScreenMode = false,\n      scrollPosition = [0, 0],\n      options: Dict<any> = {};\n\n    options.allowTransparency = true;\n    options.overflowTouch = false;\n\n    options.backgroundColor = params.storiesBackgroundColor;\n\n    var defaults = {\n      startHeight: 70,\n      minWidth: 150,\n      storiesHeight: 70\n    };\n\n    // todo непонятно как высоту с учетом title рассчитывать\n    if (params.storiesLayoutHeight) {\n      defaults.startHeight = parseFloat(params.storiesLayoutHeight);\n    } else {\n      if (!params.storiesTitle) {\n        defaults.startHeight = parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      } else {\n        // line height + margin-bottom\n        defaults.startHeight = 50 + parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      }\n    }\n\n    var body = document.querySelector('body'),\n      html = document.querySelector('html'),\n      zIndex = options.zIndex || 10000;\n\n    const self = this;\n\n    const functions = {\n\n      // TODO add class to body\n\n      // switchToFullScreen: function () {\n      //     if (inFullScreenMode) {\n      //         return;\n      //     }\n      //\n      //     scrollPosition = IAS_OLD.Util.getScroll();\n      //\n      //     if (body) {\n      //         body.style.setProperty('user-select', 'none');\n      //         body.style.setProperty('-webkit-user-select', 'none');\n      //\n      //         body.style.setProperty('overflow', 'hidden');\n      //         body.style.setProperty('-webkit-overflow-scrolling', 'touch');\n      //     }\n      //\n      //     if (html) {\n      //         html.style.setProperty('position', 'fixed');\n      //         html.style.setProperty('overflow', 'hidden');\n      //     }\n      //\n      //     if (widgetRoot && widget) {\n      //         // получаем текущее смещение от начала viewport\n      //         const viewportOffset = widgetRoot.getBoundingClientRect();\n      //         const offsetTop = viewportOffset.top;\n      //\n      //         widget.style.setProperty('position', 'fixed')\n      //         widget.style.setProperty('top', '0')\n      //         widget.style.setProperty('bottom', '0')\n      //         widget.style.setProperty('left', '0')\n      //         widget.style.setProperty('right', '0')\n      //         widget.style.setProperty('height', '0')\n      //         widget.style.setProperty('min-height', '100%')\n      //         widget.style.setProperty('max-height', '100%')\n      //\n      //         widget.style.setProperty('z-index', zIndex)\n      //\n      //         rpc.callMethod('onEnterFullScreen', {offsetTop: offsetTop})\n      //\n      //     }\n      //\n      //     inFullScreenMode = true;\n      //\n      //     // newWidth  = parseInt(newWidth);\n      //     // newHeight = parseInt(newHeight);\n      //     // var widgetElem = document.getElementById('iaswidget' + widgetId);\n      //     // if (isFinite(newWidth)) {\n      //     //   obj.style.width = newWidth + 'px';\n      //     //   if (widgetElem) {\n      //     //     widgetElem.style.width = newWidth + 'px';\n      //     //   }\n      //     // }\n      //     // if (isFinite(newHeight)) {\n      //     //   obj.style.height = newHeight + 'px';\n      //     //   if (widgetElem) {\n      //     //     widgetElem.style.height = newHeight + 'px';\n      //     //   }\n      //     // }\n      //     // if (options.onResizeWidget) options.onResizeWidget();\n      //     //\n      //\n      //\n      // },\n      // switchFromFullScreen: function () {\n      //     if (!inFullScreenMode) {\n      //         return;\n      //     }\n      //\n      //     if (widgetRoot && widget) {\n      //         widget.style.setProperty('position', '')\n      //         widget.style.setProperty('top', '')\n      //         widget.style.setProperty('bottom', '')\n      //         widget.style.setProperty('left', '')\n      //         widget.style.setProperty('right', '')\n      //         widget.style.setProperty('height', isFinite(defaults['startHeight']) ? defaults['startHeight'] + 'px' : '100%')\n      //         widget.style.setProperty('min-height', '')\n      //         widget.style.setProperty('max-height', '')\n      //         widget.style.setProperty('z-index', '')\n      //\n      //         rpc.callMethod('onLeaveFullScreen')\n      //     }\n      //\n      //     if (body) {\n      //         body.style.setProperty('user-select', '');\n      //         body.style.setProperty('-webkit-user-select', '');\n      //\n      //         body.style.setProperty('overflow', '');\n      //         body.style.setProperty('-webkit-overflow-scrolling', '');\n      //     }\n      //\n      //     if (html) {\n      //         html.style.setProperty('position', '');\n      //         html.style.setProperty('overflow', '');\n      //     }\n      //\n      //     window.scrollTo(scrollPosition[0], scrollPosition[1])\n      //\n      //     inFullScreenMode = false;\n      //\n      // },\n\n      event: function (name: string, data: Object) {\n        self.emit(name, data)\n      },\n    };\n\n\n    params.extraJs = null;\n\n    // custom load end\n    options.no_finish_loading = true;\n\n    return this._init(mountSelector as ObjectId, options, params, storiesListOptions, functions, defaults, function (o: any, i: any, r: any) {\n      widgetRoot = o;\n      widget = i;\n      rpc = r;\n    }, null, null);\n\n  }\n\n  getWidgetDocument(widgetParams: Dict): string {\n\n    const baseUrl = process.env.BASE_URL;\n    const apiUrl = process.env.API_URL;\n    const buildVersion = process.env.BUILD_VERSION;\n\n    // todo можно BASE_URL менять в процессе сборки\n    let cssResource: URL | string = `${baseUrl}/v${buildVersion}/dist/css/storyReader.css`;\n    let jsResource: URL | string = `${baseUrl}/v${buildVersion}/dist/js/storiesList.js`;\n    if (process.env.NODE_ENV === \"development\") {\n      cssResource = `${baseUrl}/css/storyReader.css`;\n      jsResource = `${baseUrl}/js/storyReader.js`;\n\n      // if npm pack\n      // cssResource = new URL(\"~/dist/css/storiesList.css\", import.meta.url);\n      // jsResource = new URL(\"~/dist/js/storiesList.js\", import.meta.url);\n\n\n      // jsResource = `/js/storiesList.js`;\n\n    }\n\n    // cssResource = new URL(\"~/dist/css/storiesList.css\", import.meta.url);\n    // jsResource = new URL(\"~/dist/js/storiesList.js\", import.meta.url);\n\n    jsResource = jsResourceGlobal;\n\n    // console.log({meta: import.meta});\n\n    // (async () => {\n    //   const {WStories} = await import(\"~/src/stories_widget/stories-slider\");\n    //   console.log({WStories});\n    // })();\n\n\n    // <link rel=\"stylesheet\" type=\"text/css\" href=\"${cssResource}\"/>\n    // <script type=\"text/javascript\" src=\"${jsResource}\"></script>\n    // import.meta.url\n\n    // <script type=\"text/javascript\" src=\"${jsResource}\"></script>\n    return `\n        <script type=\"text/javascript\" src=\"${jsResource}\"></script>\n        <div id=\"app\"><div id=\"_app\"></div></div>\n        <script type=\"text/javascript\">\n          window.storyReader.init(${JSON.stringify(widgetParams)});\n        </script>\n`;\n\n\n  }\n\n  protected async _init(mountSelector: ObjectId, options: Dict, params: Dict, widgetParams: Dict, funcs: Dict, defaults: Dict, onDone: (obj: any, iframe: any, rpc: any) => void, widgetId: Nullable<string | number>, iter: Nullable<number>) {\n\n    funcs.event = (name: string, data: Object) => this.emit(name, data)\n\n    onDone = (obj: any, iframe: any, rpc: any) => {\n      this.rpc = rpc;\n    };\n\n    const result = super._init(mountSelector, options, params, widgetParams, funcs, defaults, onDone, widgetId, iter);\n\n    // story reader\n\n    // const storyReader = new StoryReader('body', options);\n\n\n    // this.on('sessionInitInternal', (payload: any) => storyReader.sessionInit(payload));\n    // this.on('clickOnStoryInternal', (payload: ClickOnStoryInternalPayload) => storyReader.openReader(payload));\n    this.on('clickOnStoryInternal', (payload: ClickOnStoryInternalPayload) => {\n      if (isFunction(this.callbacks?.handleClickOnStoryInternal)) {\n        this.callbacks?.handleClickOnStoryInternal(payload);\n      }\n    });\n\n    this.on('flushThumbViews', (payload: Array<number>) => {\n      if (isFunction(this.callbacks?.handleFlushThumbViews)) {\n        this.callbacks?.handleFlushThumbViews(payload);\n      }\n    });\n\n\n    // storyReader.on('storyOpenedInternal', (payload: {id: number}) => this.onStoryOpened(payload));\n\n\n    // storyReader.on('favoriteStoryInternal', (payload: {id: number, value: boolean}) => this.onStoryFavoriteChange(payload));\n\n\n    // public event\n    this.on('clickOnStory', (payload: ClickOnStoryPayload) => {\n      if (isFunction(this.callbacks?.handleClickOnStory)) {\n        this.callbacks?.handleClickOnStory(payload);\n      }\n    });\n\n    // click on deep link from story list\n    this.on('clickOnStoryDeepLink', (payload: ClickOnStoryPayload) => {\n      if (isFunction(this.callbacks?.handleClickOnStoryDeepLink)) {\n        this.callbacks?.handleClickOnStoryDeepLink(payload);\n      }\n    });\n\n    // button from slide\n    // storyReader.on('clickOnButton', (payload: ClickOnButtonPayload) => {\n    //     if (params.storyLinkHandleClick && isFunction(params.storyLinkHandleClick)) {\n    //         params.storyLinkHandleClick(payload);\n    //     } else {\n    //         window.open(payload.url, '_self');\n    //     }\n    // });\n\n    const publicEvents = ['showSlide', 'showStory', 'closeStory', 'clickOnButton', 'likeStory', 'dislikeStory', 'favoriteStory', 'shareStory', 'shareStoryWithPath'];\n\n    // publicEvents.forEach((eventName) => storyReader.on(eventName, (payload) => this.emit(eventName, payload)));\n\n    // let storyFavorite: Nullable<_StoryFavorite> = null;\n    // if (options.hasFavorite) {\n    //   storyFavorite = new _StoryFavorite('body', options);\n    // }\n\n    // storyFavorite && this.on('sessionInitInternal', (payload: any) => storyFavorite && storyFavorite.sessionInit(payload));\n    // storyFavorite && this.on('clickOnFavoriteCellInternal', (payload: ClickOnFavoriteCellInternalPayload) => storyFavorite && storyFavorite.openReader(payload));\n\n    // custom method\n    // storyFavorite && storyFavorite.on('clickOnStoryInternal', (payload: ClickOnStoryInternalPayload) => storyReader.openReader(payload));\n    // storyFavorite && storyReader.on('openStoryReader', (options: {windowReferer: STORY_READER_WINDOW_REFERER}) => storyFavorite && storyFavorite.openStoryReader(options));\n    // storyFavorite && storyReader.on('closeStoryReader', (options: {windowReferer: STORY_READER_WINDOW_REFERER}) => storyFavorite && storyFavorite.closeStoryReader(options));\n\n    /*    storyFavorite && storyFavorite.on('closeReader', () => {\n          try {\n            window.focus()\n          } catch (e) {\n            console.error(e)\n          }\n        });*/\n\n    this.on('syncStore', (payload: SyncStoreEvent) => {\n      // storyReader.syncStoreHandle(payload);\n      // storyFavorite && storyFavorite.syncStoreHandle(payload);\n    });\n\n    // storyReader.on('syncStore', (payload: SyncStoreEvent) => {\n    //     this.syncStoreHandle(payload);\n    //     storyFavorite && storyFavorite.syncStoreHandle(payload);\n    // });\n    //\n    // storyFavorite && storyFavorite.on('syncStore', (payload: SyncStoreEvent) => {\n    //     this.syncStoreHandle(payload);\n    //     storyReader.syncStoreHandle(payload);\n    // });\n\n    return result;\n  }\n\n  onStoryOpened(payload: { id: number }) {\n    this.rpc.callMethod('onStoryOpened', payload);\n  }\n\n  // onStoryFavoriteChange(payload: {id: number, value: boolean}) {\n  //     this.rpc.callMethod('onStoryFavoriteChange', payload);\n  // }\n\n  syncStoreHandle(payload: SyncStoreEvent) {\n    this.rpc.callMethod('onSyncStore', payload);\n  }\n\n\n  // pass story list\n  openReader(payload: ClickOnStoryInternalWithDataPayload & { hasShare: boolean }) {\n    // вынести в общую часть\n    onOpenReader(payload);\n\n  }\n\n  // pass story list\n  setStories(payload: any) {\n    // вынести в общую часть\n    setStories(payload);\n\n  }\n\n  setFonts(payload: any) {\n    setFonts(payload);\n  }\n\n\n  destructor() {\n    // destroy RPC\n\n  }\n\n\n}\n\nexport {WidgetStoryReader};\n","import {Optional, Dict} from \"../index\";\nimport {ReaderCloseButtonPosition, ReaderSwipeStyle} from \"~/src/storyManager/WidgetStoriesConfig\";\n\n\n\nexport enum StoryReaderCloseButtonPosition {\n  LEFT = 'left',\n  RIGHT = 'right'\n}\n\nexport enum StoryReaderSwipeStyle {\n  FLAT = 'flat',\n  COVER = 'cover',\n  CUBE = 'cube'\n}\n\n\nexport type StoryReaderOptions = {\n  closeButtonPosition: StoryReaderCloseButtonPosition,\n  scrollStyle: StoryReaderSwipeStyle,\n  loader?: {\n    default: {\n      color: Optional<string>,\n      accentColor: Optional<string>,\n    },\n    custom: Optional<string>\n  },\n  recycleStoriesList?: boolean,\n  closeOnLastSlideByTimer?: boolean,\n};\n\nconst StoryReaderOptionsDefault: StoryReaderOptions = {\n  closeButtonPosition: StoryReaderCloseButtonPosition.RIGHT,\n  scrollStyle: StoryReaderSwipeStyle.FLAT,\n  loader: {\n    default: {\n      color: null,\n      accentColor: null,\n    },\n    custom: null\n  },\n  recycleStoriesList: false,\n  closeOnLastSlideByTimer: true\n};\n\nexport {StoryReaderOptionsDefault};","import {Optional, Dict} from \"../index\";\n\n\nexport type StoryFavoriteReaderOptions = {\n  title?: {\n    content: string;\n  }\n};\n\nconst StoryFavoriteReaderOptionsDefault: StoryFavoriteReaderOptions = {\n  title: {\n    content: 'Сохраненные истории',\n  }\n};\n\nexport {StoryFavoriteReaderOptionsDefault};","import {Dict, Optional} from \"../index\";\n\n\nexport enum GoodsWidgetRenderingType {\n  DEFAULT = 'default',\n  CUSTOM_CARD = 'customCard',\n  CUSTOM_WIDGET = 'customWidget'\n}\n\nexport type GoodsWidgetOptions = {\n  goodsWidgetRenderingType: GoodsWidgetRenderingType;\n  openGoodsWidgetHandler?: (skuList: Array<Dict>) => Promise<Array<Dict>>;\n  // требуется если тип GoodsWidgetRenderingType.CUSTOM_CARD - описать это в ts\n  getCardHtml?: (item: Dict, index: number) => string;\n  // требуется для всех кроме custom widget\n  itemClickHandler?: (item: Dict) => void;\n\n  loader?: {\n    default: {\n      color: Optional<string>,\n      accentColor: Optional<string>,\n    },\n    custom: Optional<string>\n  };\n\n\n\n};\n\nconst GoodsWidgetOptionsDefault: GoodsWidgetOptions = {\n  goodsWidgetRenderingType: GoodsWidgetRenderingType.DEFAULT,\n  loader: {\n    default: {\n      color: null,\n      accentColor: null,\n    },\n    custom: null\n  },\n};\n\nexport {GoodsWidgetOptionsDefault};","import {useRef} from \"react\";\n\nexport const useBeforeFirstRender = (effect: () => void) => {\n    const willMount = useRef(true);\n\n    if (willMount.current) {\n        effect();\n        willMount.current = false;\n    }\n};","function e(e){i.store(e)||h('expect useStore argument to be a store');let t=e.getState(),n=f.useReducer((e=>e+1),0)[1],r=f.useRef({store:e,value:t,pending:0});return k((()=>{let t=e.updates.watch((e=>{let t=r.current;t.pending||(t.value=e,t.pending=1,n(),t.pending=0)})),o=e.getState(),u=r.current;return u.store===e&&u.value!==o&&(u.value=o,u.pending=1,n(),u.pending=0),u.store=e,t}),[e]),t}function t(t,n){let r,o,u,s;n?(r=n,u=t,s=[]):(r=t.fn,u=t.store,s=t.keys,o=t.updateFilter),i.store(u)||h('useStoreMap expects a store'),Array.isArray(s)||h('useStoreMap expects an array as keys'),'function'!=typeof r&&h('useStoreMap expects a function');let a=f.useMemo((()=>p(r(u.getState(),s),{updateFilter:o}).on(u,((e,t)=>r(t,s)))),s),l=e(a);return k((()=>()=>{a.off(u),m(a,{deep:1})}),s),l}function n(e,t){return t.displayName=e,t}function r(t,r){function o(t){let n=f.useRef(t),o=e(u);k((()=>(a({props:n.current,state:u.getState()}),()=>{l({props:n.current,state:u.getState()})})),[]);let s=r(t,o);return n.current=t,s}let u;i.store(t)?u=t:'object'==typeof t&&null!==t?u=y(t):h('shape should be a store or object with stores');let s='Unknown';u&&u.shortName&&(s=u.shortName);let a=d(),l=d();return o.mounted=a,o.unmounted=l,n(`${s}.View`,o)}function o(e){return r(e,(({children:e},t)=>e(t)))}function u(r,o){let u,s,a=[];'object'==typeof o&&null!==o?(o.keys&&(a=o.keys),u=o.fn,o.getKey&&(s=o.getKey)):u=o,i.store(r)||h('expect useList first argument to be a store'),'function'!=typeof u&&h(\"expect useList's renderItem to be a function\"),Array.isArray(a)||h(\"expect useList's keys to be an array\");let l=f.useMemo((()=>{let e=n(`${r.shortName||'Unknown'}.Item`,(e=>{let{index:n,keys:o,keyVal:u,value:s}=e;if(c.current[1])return c.current[0](s,u);let a=t({store:r,keys:[n,...o],fn:(e,t)=>e[t[0]]});return c.current[0](a,n)}));return f.memo(e)}),[r,!!s]),c=f.useRef([u,s]);c.current=[u,s];let p=f.useMemo((()=>a),a);if(s)return e(r).map((e=>{let t=c.current[1](e);return f.createElement(l,{keyVal:t,key:t,keys:p,value:e})}));{let e=t({store:r,keys:[r],fn:e=>e.length});return Array.from({length:e},((e,t)=>f.createElement(l,{index:t,key:t,keys:p})))}}function s(t,r){return n(`Connect(${r.displayName||r.name||'Unknown'})`,(n=>f.createElement(r,Object.assign({},n,e(t)))))}function a(e,t={}){let n=f.useRef(null);k((()=>(e.open(n.current),()=>e.close(n.current))),[e]),((e,t)=>{if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return 0;for(let r=0;r<n.length;r++){let o=n[r];if(e[o]!==t[o])return 0}return 1}return 0})(n.current,t)||(n.current=t,e.set(t))}function l(e=\"gate\",t={}){let r;return'object'==typeof e&&null!==e&&('defaultState'in e&&(t=e.defaultState),e.domain&&(r=e.domain),e=e.name),(({name:e=\"gate\",domain:t,defaultState:r,hook:o})=>{function u(e){return o(u,e),null}let s=`${t?`${t.compositeName.fullName}/`:''}${e}`,a=d(`${s}.set`),l=d(`${s}.open`),c=d(`${s}.close`),f=p(Boolean(0),{name:`${s}.status`}).on(l,(()=>Boolean(1))).on(c,(()=>Boolean(0))),i=p(r,{name:`${s}.state`}).on(a,((e,t)=>t)).reset(c);if(t){let{hooks:e}=t;g({target:[e.store,e.store,e.event,e.event,e.event],params:[f,i,l,c,a]})}return u.open=l,u.close=c,u.status=f,u.state=i,u.set=a,n(`Gate:${s}`,u)})({name:e,domain:r,defaultState:t,hook:a})}function c(e){return e}import f from'react';import{is as i,createStore as p,clearNode as m,combine as y,createEvent as d,launch as g}from'effector/effector.mjs';let k='undefined'!=typeof window?f.useLayoutEffect:f.useEffect,h=e=>{throw Error(e)},b=(t,r,o)=>n(`${t.shortName||'Unknown'}.ContextComponent`,(n=>{let u=f.useContext(r),s=e(t);return o(n,s,u)})),S=e=>t=>{let n=e;return'function'!=typeof e&&(n=t,t=e),s(t,n)};export{S as connect,r as createComponent,b as createContextComponent,l as createGate,s as createReactState,o as createStoreConsumer,c as useEvent,a as useGate,u as useList,e as useStore,t as useStoreMap};\n//# sourceMappingURL=effector-react.mjs.map\n","import {StoryManager} from \"../story-manager\";\nimport {AppearanceManager} from \"../story-manager/AppearanceManager\";\nimport {createEvent, createStore} from \"effector\";\nimport {Option} from \"../../global.h\";\nimport {useBeforeFirstRender} from \"./useBeforeFirstRender\";\nimport {useStore} from \"effector-react\";\n\nconst setManagers = createEvent<{ storyManager: Option<StoryManager>, appearanceManager: Option<AppearanceManager> }>();\nconst $managers = createStore<{\n    storyManager: Option<StoryManager>;\n    appearanceManager: Option<AppearanceManager>;\n}>({storyManager: null, appearanceManager: null}).on(\n    setManagers,\n    (state, value) => value\n);\n\nexport const useIas = (\n    createStoryManager: () => StoryManager,\n    createAppearanceManager: () => AppearanceManager\n) => {\n    const managers = useStore($managers);\n    useBeforeFirstRender(() => {\n        if (managers.storyManager == null || managers.appearanceManager == null) {\n            setManagers({\n                storyManager: createStoryManager(),\n                appearanceManager: createAppearanceManager(),\n            });\n        }\n    });\n    return managers;\n};\n","import {AppearanceCommonOptions, AppearanceCommonOptionsDefault} from \"./appearanceCommon.h\";\nimport {StoriesListOptions, StoriesListOptionsDefault} from \"../widget-stories-list/index.h\";\nimport {StoryReaderOptions, StoryReaderOptionsDefault} from \"./types/storyManager/storyReader\";\nimport {StoryFavoriteReaderOptions, StoryFavoriteReaderOptionsDefault} from \"./types/storyManager/storyFavoriteReader\";\n\nimport {GoodsWidgetOptions, GoodsWidgetOptionsDefault} from \"./types/storyManager/goodsWidget\";\nimport {mergeObjects} from \"../helpers/mergeObjects\";\n\nexport class AppearanceManager {\n  constructor() {\n  }\n\n  private _commonOptions: AppearanceCommonOptions = AppearanceCommonOptionsDefault;\n\n  public setCommonOptions(options: AppearanceCommonOptions): AppearanceManager {\n    // + fonts\n    this._commonOptions = mergeObjects(this._commonOptions, options);\n    return this;\n  }\n\n  public get commonOptions(): AppearanceCommonOptions {\n    return this._commonOptions;\n  }\n\n  private _storiesListOptions: StoriesListOptions = StoriesListOptionsDefault;\n\n  public setStoriesListOptions(options: StoriesListOptions): AppearanceManager {\n    // validator\n    this._storiesListOptions = mergeObjects(this._storiesListOptions, options);\n    return this;\n  }\n\n  public get storiesListOptions(): StoriesListOptions {\n    return this._storiesListOptions;\n  }\n\n  private _storyReaderOptions: StoryReaderOptions = StoryReaderOptionsDefault;\n\n  public setStoryReaderOptions(options: StoryReaderOptions): AppearanceManager {\n    // + icons overload\n\n    this._storyReaderOptions = mergeObjects(this._storyReaderOptions, options);\n    return this;\n  }\n\n  public get storyReaderOptions(): StoryReaderOptions {\n    return this._storyReaderOptions;\n  }\n\n  private _storyFavoriteReaderOptions: StoryFavoriteReaderOptions = StoryFavoriteReaderOptionsDefault;\n\n  public setStoryFavoriteReaderOptions(options: StoryFavoriteReaderOptions): AppearanceManager {\n    this._storyFavoriteReaderOptions = mergeObjects(this._storyFavoriteReaderOptions, options);\n    return this;\n  }\n\n  public get storyFavoriteReaderOptions(): StoryFavoriteReaderOptions {\n    return this._storyFavoriteReaderOptions;\n  }\n\n  private _goodsWidgetOptions: GoodsWidgetOptions = GoodsWidgetOptionsDefault;\n\n  public setGoodsWidgetOptions(options: GoodsWidgetOptions): AppearanceManager {\n    this._goodsWidgetOptions = mergeObjects(this._goodsWidgetOptions, options);\n    return this;\n  }\n\n  public get goodsWidgetOptions(): GoodsWidgetOptions {\n    return this._goodsWidgetOptions;\n  }\n\n}\n","import React, {Component, useEffect, useRef, useState} from 'react';\nimport {WebView} from 'react-native-webview';\n// import {Colors} from \"react-native/Libraries/NewAppScreen\";\nimport {\n  Dimensions,\n  ImageBackground,\n  SafeAreaView,\n  ScrollView,\n  StatusBar,\n  StyleSheet,\n  Text,\n  useColorScheme,\n  View,\n} from 'react-native';\n\nimport {Option} from \"../../global.h\";\nimport {StoriesListProps} from \"./StoriesList.h\";\nimport {IWidgetStoriesList} from \"../widget-stories-list\";\n\nfunction StoriesList({storyManager, appearanceManager}: StoriesListProps) {\n\n  // props - StoryManager\n  // создать инстанс WidgetStoriesList\n\n  const [widgetStoriesList, setWidgetStoriesList] = useState<Option<IWidgetStoriesList>>(null);\n\n  // get documentSrc && init fn\n\n  const viewRef = useRef<Option<WebView>>(null);\n  const [rpcBind, setRpcBind] = useState<Option<boolean>>(null);\n\n  useEffect(() => {\n    // передали опции, создали объект\n\n    // hook, not first render\n    // only when Some(storyManager)\n    if (widgetStoriesList === null) {\n      if (storyManager != null && appearanceManager != null) {\n        setWidgetStoriesList(storyManager.createWidgetStoriesList(appearanceManager));\n        setRpcBind(false);\n      }\n    }\n\n    // bind rpc\n    if (rpcBind === false && viewRef.current !== null) {\n      console.log('bind rpc');\n      widgetStoriesList?.createRpcServer<WebView>(viewRef.current);\n      setRpcBind(true);\n\n      // widgetLoaded\n\n    }\n\n\n    // привязали транспорт и события\n\n    // получили cb от виджета - готовы грузить сторис\n    // mounted()\n\n  },);\n\n  useEffect(() => {\n    // console.log('options', widgetStoriesList?.viewOptions);\n  });\n\n\n  // get view options\n\n  // bind rpc\n\n\n  // render if options exists\n  // onMessage={handler}\n  return (\n    <>\n      {widgetStoriesList &&\n      <>\n        <View {...widgetStoriesList?.containerOptions} >\n          <WebView nativeConfig={{props: {webContentsDebuggingEnabled: true, allowsInlineMediaPlayback: true}}}\n                   scalesPageToFit={false} originWhitelist={['*']}\n                   onMessage={e => {}}\n                   {...widgetStoriesList?.viewOptions} ref={viewRef}\n          />\n        </View>\n      </>\n      }\n\n      {/*<View style={{position: 'relative', height: 200}}>\n\n        <MyInlineWeb style={{width: '100%', height: webviewHeight,\n          backgroundColor: isDarkMode ? Colors.black : Colors.white,\n          // backgroundColor: 'transparent',\n        }}\n                     setScrollEnabled={setScrollEnabled} setWebviewHeight={setWebviewHeight} screenHeight={ScreenHeight}\n                     setWebViewStyle={setWebViewStyle}\n\n                     inputStoryState={inputStoryState}\n                     $storyState={$storyState}\n\n                     inputSessionState={inputSessionState}\n                     $sessionState={$sessionState}\n                     inputOpenStoryId={inputOpenStoryId}\n        />\n\n      </View>*/}\n\n    </>);\n\n}\n\nconst StoriesList2 = ({storyManager, appearanceManager}: StoriesListProps) => {\n\n  // props - StoryManager\n  // создать инстанс WidgetStoriesList\n\n  const widgetStoriesList = useRef<Option<IWidgetStoriesList>>(null);\n\n  // get documentSrc && init fn\n\n  useEffect(() => {\n    // передали опции, создали объект\n    widgetStoriesList.current = storyManager.createWidgetStoriesList(appearanceManager);\n\n    // привязали транспорт и события\n\n    // получили cb от виджета - готовы грузить сторис\n    // mounted()\n\n\n  }, []);\n\n  // render if options exists\n  return (\n\n    <View style={{position: 'relative', height: 200}}>\n\n      <MyInlineWeb style={{\n        width: '100%', height: webviewHeight,\n        backgroundColor: isDarkMode ? Colors.black : Colors.white,\n        // backgroundColor: 'transparent',\n      }}\n                   setScrollEnabled={setScrollEnabled} setWebviewHeight={setWebviewHeight} screenHeight={ScreenHeight}\n                   setWebViewStyle={setWebViewStyle}\n\n                   inputStoryState={inputStoryState}\n                   $storyState={$storyState}\n\n                   inputSessionState={inputSessionState}\n                   $sessionState={$sessionState}\n                   inputOpenStoryId={inputOpenStoryId}\n      />\n\n    </View>\n\n  );\n\n}\n\n\nconst MyInlineWeb = (props) => {\n\n  // constructor() {\n  //     super();\n  //     this.state = {loaded: false};\n  // }\n\n\n  const webViewMessageHandler = (event) => {\n    // console.log('log event list: ' + event.nativeEvent.data);\n    try {\n\n      if (event.nativeEvent.data) {\n        const data = JSON.parse(event.nativeEvent.data);\n        if (Array.isArray(data)) {\n          if (data[0] === 'event') {\n\n            if (data[1] === 'syncStore') {\n              props.inputStoryState(data[2]);\n              console.log('start sync: ' + data[2]['mutation']['type']);\n            }\n            if (data[1] === 'sessionInitInternal') {\n              props.inputSessionState(data[2]);\n              console.log('start sync: ' + data[2]);\n            }\n\n            if (data[1] === 'clickOnStoryInternal') {\n              props.inputOpenStoryId(data[2]['id']);\n\n\n              console.log('clickOnStoryInternal', data);\n            }\n\n          }\n\n\n          // if (data[0] === 'clickOnStory') {\n          //     this.props.setScrollEnabled(false);\n          //     this.props.setWebviewHeight(this.props.screenHeight);\n          //\n          //     this.props.setWebViewStyle({\n          //         // flex: 1,\n          //         position: 'absolute',\n          //         left: 0,\n          //         right: 0,\n          //         top: 0,\n          //         // bottom: 0,\n          //\n          //         // width: '100%',\n          //         height: this.props.screenHeight,\n          //         // height: webviewHeight,\n          //     });\n          //\n          // } else if (data[0] === 'closeStory') {\n          //     this.props.setScrollEnabled(true);\n          //     this.props.setWebviewHeight(200);\n          //\n          //     this.props.setWebViewStyle({\n          //         flex: 1,\n          //         // width: '100%',\n          //         // height: 200,\n          //     });\n          // }\n\n\n        }\n\n      }\n    } catch (e) {\n      // console.error(e);\n    }\n\n    // if (event.nativeEvent.data === 'clickOnStory') {\n    //     this.setState({\n    //         loaded: true\n    //     })\n    // }\n  }\n\n\n  console.log('render');\n\n  const debugging = `\n     // Debug\n     console = new Object();\n     console.log = function(log) {\n        window.ReactNativeWebView.postMessage(log);\n     };\n     console.debug = console.log;\n     console.info = console.log;\n     console.warn = console.log;\n     console.error = console.log;\n     `;\n\n  const baseUrl = 'https://sdk.test.inappstory.com';\n  // const baseUrl = 'http://localhost:8887';\n  const apiUrl = 'https://api.test.inappstory.com';\n  const buildVersion = 'v1.2.4';\n\n  const widgetParams = {\n    apiKey: 'test-key',\n    lang: 'en',\n\n    // apiKey: \"kDVSi0aLNaooemZ7bHrQJQdTqmOObvzH\", // prod\n    userId: null,\n\n    tags: \"producthunt\",\n    hasLike: true,\n    slider: {\n      title: {\n        content: 'The best stories',\n        color: '#222',\n        font: 'normal',\n        marginBottom: 20,\n      },\n      card: {\n        title: {\n          color: 'black',\n          font: '14px/16px \"Segoe UI Semibold\"',\n          padding: 8\n        },\n        gap: 10,\n        height: 100,\n        variant: 'quad',\n        border: {\n          radius: 20,\n          color: 'blue',\n          width: 2,\n          gap: 3,\n        },\n        boxShadow: null,\n        opacity: 1,\n        mask: {\n          color: 'rgba(34, 34, 34, 0.3)'\n        },\n        read: {\n          border: {\n            radius: null,\n            color: 'green',\n            width: null,\n            gap: null,\n          },\n          boxShadow: null,\n          opacity: null,\n          mask: {\n            color: 'rgba(34, 34, 34, 0.1)'\n          },\n        },\n      },\n      layout: {\n        height: 0,\n        backgroundColor: 'transparent'\n      },\n      sidePadding: 20,\n      topPadding: 20,\n      bottomPadding: 20,\n      bottomMargin: 17,\n      navigation: {\n        showControls: false,\n        controlsSize: 48,\n        controlsBackgroundColor: 'white',\n        controlsColor: 'black'\n      },\n    },\n    reader: {\n      closeButtonPosition: 'right',\n      scrollStyle: 'cube',\n    },\n    placeholders: {\n      user: 'Guest'\n    },\n    // optional handler\n    storyLinkHandleClick: function (payload) {\n      // default behaviour\n      window.open(payload.url, '_self');\n    },\n\n  };\n\n  // this.on('sessionInitInternal', (payload: any) => storyReader.sessionInit(payload));\n\n  const html = `\n\n    <head>\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, user-scalable=0, shrink-to-fit=no\">\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"${baseUrl}/css/storiesSlider.css?v=${buildVersion}\"/>\n\n        <script type=\"text/javascript\">\n            window.widgetConfig = {\n                \"api\":{\n                    \"url\": \"${apiUrl}\",\n                    \"version\": \"v2\",\n                    \"token\": \"${widgetParams.apiKey}\",\n                    \"lang\": \"${widgetParams.lang}\"\n                },\n                \"userId\":\"\",\n                \"tags\":\"\"\n            };\n            true;\n        </script>\n<script type=\"text/javascript\" src=\"${baseUrl}/js/storiesSlider.js?v=${buildVersion}\"></script>\n</head>\n<body>\n<div id=\"app\"><div id=\"_app\"></div></div>\n<script type=\"text/javascript\">\n    WStories.init(${JSON.stringify(widgetParams)});\n    window.cur.Rpc = {};\n    window.cur.Rpc.callMethod = (...args) => {\n         window.ReactNativeWebView.postMessage(JSON.stringify(args));\n    };\n    true;\n</script>\n</body>\n`;\n\n  const events = `\n                        '        // 4. Override default loading animation\\\\n' +\n                    '        stories.on(\\\\'startLoader\\\\', function (widget) {\\\\n' +\n                    '            widget.style.background = \\\\'url(\"https://inappstory.com/stories/loader.gif\") center / 45px auto no-repeat transparent\\\\';\\\\n' +\n                    '        });\\\\n' +\n                    '        stories.on(\\\\'endLoader\\\\', function (widget) {\\\\n' +\n                    '            widget.style.background = \\\\'none\\\\';\\\\n' +\n                    '        });\\\\n' +\n                    '        stories.on(\\\\'clickOnStory\\\\', (data) => {\\\\n' +\n                    '        window.ReactNativeWebView.postMessage(JSON.stringify([\"clickOnStory\", data]));' +\n                    '                })\\\\n' +\n                    '        stories.on(\\\\'closeStory\\\\', (data) => {\\\\n' +\n                    '        window.ReactNativeWebView.postMessage(JSON.stringify([\"closeStory\", data]));' +\n                    '                })\\\\n' +`;\n\n  return (\n    <WebView\n      style={props.style}\n      // nativeConfig={{props: {webContentsDebuggingEnabled: true}}}\n\n      scalesPageToFit={false}\n      originWhitelist={['*']}\n      onMessage={webViewMessageHandler}\n      // nativeConfig={{webContentsDebuggingEnabled: true}}\n      source={{\n        baseUrl: 'https://test.inappstory.com',\n        html,\n\n        html2: '' +\n          '<div>' +\n\n\n          '<!-- 1. The <iframe> (and Stories` widget) will be mounted to this <div> tag -->\\n' +\n          '<div id=\"stories_widget\"></div>\\n' +\n          '\\n' +\n          '<script>\\n' +\n          '    // 2. This code loads the web-sdk API code asynchronously \\n' +\n          '    // and create queue in global var window.IASReady.\\n' +\n          '\\n' +\n          '    window.IASReady = (function (d, s, id) {\\n' +\n          '        var js, fjs = d.getElementsByTagName(s)[0], st = window.IASReady || {};\\n' +\n          '        if (d.getElementById(id)) return st;\\n' +\n          '        js = d.createElement(s);\\n' +\n          '        js.id = id;\\n' +\n          '        js.src = \"https://sdk.inappstory.com/js/iframe_api.js?v=1\";\\n' +\n          '        js.async = true;\\n' +\n          '        fjs.parentNode.insertBefore(js, fjs);\\n' +\n          '        st._e = [];\\n' +\n          '        st.ready = function (f) {\\n' +\n          '            st._e.push(f);\\n' +\n          '        };\\n' +\n          '        return st;\\n' +\n          '    }(document, \"script\", \"ias-wjss\"));\\n' +\n          '\\n' +\n          '    // 3. This function creates an <iframe> (and Stories` widget)\\n' +\n          '    //    after the API code downloads.\\n' +\n          '    window.IASReady.ready(function () {\\n' +\n          '        var stories = new window.IAS.Stories(\"stories_widget\", {\\n' +\n          '            apiKey: \"kDVSi0aLNaooemZ7bHrQJQdTqmOObvzH\",\\n' +\n          '            userId: null,\\n' +\n          '            tags: \"producthunt\",\\n' +\n          '            hasLike: true,\\n' +\n          '            slider: {\\n' +\n          '                title: {\\n' +\n          '                    content: \\'The best stories\\',\\n' +\n          '                    color: \\'#fff\\',\\n' +\n          '                    font: \\'normal\\',\\n' +\n          '                    marginBottom: 20,\\n' +\n          '                },\\n' +\n          '                card: {\\n' +\n          '                    title: {\\n' +\n          '                        color: \\'black\\',\\n' +\n          '                        font: \\'14px/16px \"Segoe UI Semibold\"\\',\\n' +\n          '                        padding: 8\\n' +\n          '                    },\\n' +\n          '                    gap: 10,\\n' +\n          '                    height: 100,\\n' +\n          '                    variant: \\'quad\\',\\n' +\n          '                    border: {\\n' +\n          '                        radius: 20,\\n' +\n          '                        color: \\'blue\\',\\n' +\n          '                        width: 2,\\n' +\n          '                        gap: 3,\\n' +\n          '                    },\\n' +\n          '                    boxShadow: null,\\n' +\n          '                    opacity: 1,\\n' +\n          '                    mask: {\\n' +\n          '                        color: \\'rgba(34, 34, 34, 0.3)\\'\\n' +\n          '                    },\\n' +\n          '                    read: {\\n' +\n          '                        border: {\\n' +\n          '                            radius: null,\\n' +\n          '                            color: \\'green\\',\\n' +\n          '                            width: null,\\n' +\n          '                            gap: null,\\n' +\n          '                        },\\n' +\n          '                        boxShadow: null,\\n' +\n          '                        opacity: null,\\n' +\n          '                        mask: {\\n' +\n          '                            color: \\'rgba(34, 34, 34, 0.1)\\'\\n' +\n          '                        },\\n' +\n          '                    },\\n' +\n          '                },\\n' +\n          '                layout: {\\n' +\n          '                    height: 0,\\n' +\n          '                    backgroundColor: \\'transparent\\'\\n' +\n          '                },\\n' +\n          '                sidePadding: 20,\\n' +\n          '                topPadding: 20,\\n' +\n          '                bottomPadding: 20,\\n' +\n          '                bottomMargin: 17,\\n' +\n          '                navigation: {\\n' +\n          '                    showControls: false,\\n' +\n          '                    controlsSize: 48,\\n' +\n          '                    controlsBackgroundColor: \\'white\\',\\n' +\n          '                    controlsColor: \\'black\\'\\n' +\n          '                },\\n' +\n          '            },\\n' +\n          '            reader: {\\n' +\n          '                closeButtonPosition: \\'right\\',\\n' +\n          '                scrollStyle: \\'flat\\',\\n' +\n          '            },\\n' +\n          '            placeholders: {\\n' +\n          '                user: \\'Guest\\'\\n' +\n          '            },\\n' +\n          '            // optional handler\\n' +\n          '            storyLinkHandleClick: function (payload) {\\n' +\n          '                // default behaviour\\n' +\n          '                window.open(payload.url, \\'_self\\');\\n' +\n          '            },\\n' +\n          '        });\\n' +\n          '\\n' +\n          '        // 4. Override default loading animation\\n' +\n          '        stories.on(\\'startLoader\\', function (widget) {\\n' +\n          '            widget.style.background = \\'url(\"https://inappstory.com/stories/loader.gif\") center / 45px auto no-repeat transparent\\';\\n' +\n          '        });\\n' +\n          '        stories.on(\\'endLoader\\', function (widget) {\\n' +\n          '            widget.style.background = \\'none\\';\\n' +\n          '        });\\n' +\n          '        stories.on(\\'clickOnStory\\', (data) => {\\n' +\n          '        window.ReactNativeWebView.postMessage(JSON.stringify([\"clickOnStory\", data]));' +\n          '                })\\n' +\n          '        stories.on(\\'closeStory\\', (data) => {\\n' +\n          '        window.ReactNativeWebView.postMessage(JSON.stringify([\"closeStory\", data]));' +\n          '                })\\n' +\n          '' +\n          '' +\n          '\\n' +\n          '    });\\n' +\n          '</script>\\n' +\n          ''\n      }}\n    />\n  );\n}\n\nexport {StoriesList};\n","import {StoryManager as AbstractStoryManager} from \"../story-manager\";\nimport {IWidgetStoriesList} from \"../widget-stories-list\";\nimport {WidgetStoriesList} from \"../widget-stories-list/rn\";\nimport {Dict, Option} from \"../../global.h\";\nimport {AppearanceManager} from \"../story-manager/AppearanceManager\";\nimport {getUniqueId, getSystemName} from 'react-native-device-info';\nimport {ISessionInitData} from \"../story-manager/models/Session2\";\nimport {DeviceId} from \"../story-manager/models/storyManagerConfig/index.h\";\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport {IWidgetStoryReader} from \"../widget-story-reader\";\nimport {WidgetStoryReader} from \"../widget-story-reader/rn\";\nimport {CacheResourceModel} from \"../story-manager/models/session\";\nimport {StoryReaderOptions} from \"../widget-story-reader/index.h\";\nimport {STORY_READER_WINDOW_REFERER} from \"../story-manager/common.h\";\nimport {StatusBar} from \"react-native\";\n\n\nexport class StoryManager extends AbstractStoryManager {\n\n  createWidgetStoriesList(appearanceManager: AppearanceManager): IWidgetStoriesList {\n    const widget = new WidgetStoriesList(appearanceManager);\n\n    this.appearanceManager = appearanceManager;\n\n    widget.on(\"widgetLoaded\", () => {\n      this._storiesListWidgetLoaded(widget, appearanceManager);\n    });\n\n\n    return widget;\n  }\n\n  createWidgetStoryReader(setNeedFirstRender: (value: boolean) => void, detachComponent: () => void): IWidgetStoryReader {\n\n      const widget = new WidgetStoryReader(() => this.appearanceManager);\n\n      this.storyReaderNeedFirstRender = setNeedFirstRender;\n      this.storyReaderDetachComponent = detachComponent;\n\n      widget.on(\"widgetLoaded\", () => {\n        this._storyReaderWidgetLoaded(widget);\n      });\n\n\n      return widget;\n  }\n\n  getDeviceInfo(configDeviceIdChanged: (device_id: DeviceId) => void): Promise<ISessionInitData> {\n    // currently without cache to localStorage\n    const data: ISessionInitData = {\n      device_id: getUniqueId(),\n      platform: getSystemName() === \"Android\" ? \"android\" : \"ios\",\n      // todo - platform values from enum\n    };\n\n    return Promise.resolve(data);\n  }\n\n\n  async localStorageGet<T extends object>(key: string): Promise<Option<T>> {\n    try {\n      const jsonValue = await AsyncStorage.getItem(key);\n      return jsonValue != null ? JSON.parse(jsonValue) : null;\n    } catch(e) {\n      console.error(e);\n      return null;\n    }\n  }\n\n  async localStorageSet<T extends object>(key: string, data: T): Promise<void> {\n    try {\n      await AsyncStorage.setItem(key, JSON.stringify(data));\n      return;\n    } catch (e) {\n      console.error(e);\n      return;\n    }\n  }\n\n  async localStorageGetArray<T extends any>(key: string): Promise<Option<Array<T>>> {\n    return this.localStorageGet(key);\n  }\n\n  async localStorageSetArray(key: string, data: Array<any>): Promise<void> {\n    return this.localStorageSet(key, data);\n  }\n\n\n  protected completeInitStoryReader(storyReaderInstance: IWidgetStoryReader/*, appearanceManager: AppearanceManager*/, fonts: Array<CacheResourceModel>, overrideStoryReaderOptions: Pick<StoryReaderOptions, \"recycleStoriesList\" | \"closeOnLastSlideByTimer\"> = {}) {\n\n    // StatusBar\n    storyReaderInstance.on('openStoryReader', (options: { windowReferer: STORY_READER_WINDOW_REFERER }) => {\n      StatusBar.setHidden(true);\n    });\n\n    storyReaderInstance.on('closeStoryReader', (options: { windowReferer: STORY_READER_WINDOW_REFERER }) => {\n      StatusBar.setHidden(false);\n    });\n\n    return super.completeInitStoryReader(storyReaderInstance, fonts, overrideStoryReaderOptions);\n  }\n\n\n  }"],"names":["e","t","r","a","V","J","B","Array","isArray","n","length","node","from","source","parent","to","target","o","child","s","scope","l","meta","i","family","f","type","regional","c","u","Fe","p","links","d","owners","m","h","push","Re","g","id","Y","seq","next","reg","ye","ke","Ce","Ae","Se","Be","He","params","defer","page","stack","Ne","Ee","ge","Ge","isRoot","currentPage","forkPage","isWatch","Ue","$e","idx","fail","data","barrierID","fullID","priority","Te","has","add","ze","delete","store","I","Ke","pe","value","Le","current","Qe","op","E","compositeName","fullName","toString","template","xe","Je","create","graphite","ht","find","watch","Z","ut","map","name","fn","Ye","yt","$","filter","kt","le","he","filterMap","se","oe","defined","prepend","shortName","je","upward","mt","off","qe","set","lt","bt","ue","gt","after","plain","subscribers","Map","updates","defaultState","stateRef","getState","setState","nodeMap","reset","on","get","firstState","config","strict","be","before","tt","loader","unshift","of","defaultConfig","updateFilter","state","changed","ne","fe","dt","handler","getType","onCopy","unit","kind","use","finally","done","named","status","result","error","doneData","failData","getHandler","getCurrent","ie","req","St","ok","anyway","then","fx","runner","rs","rj","Promise","catch","Ve","inFlight","y","pending","et","Set","history","domains","stores","effects","events","hooks","event","effect","domain","onCreateEvent","xt","onCreateEffect","onCreateStore","onCreateDomain","createEvent","createEffect","createDomain","createStore","k","ct","b","v","Nt","forEach","clock","greedy","sid","Ze","slice","W","vt","wt","nativeTemplate","ft","targetTemplate","ae","me","sample","closure","de","isObject","rng","getRandomValues","crypto","bind","msCrypto","Error","rnds8","validate","uuid","REGEX","test","v4","options","buf","offset","rnds","random","arr","arguments","undefined","byteToHex","toLowerCase","TypeError","stringify","isNil","mergeObjects","obj1","obj2","trimStartSlash","str","replace","async","getRequestConfig","method","url","expand","completeDeviceData","getDeviceData","isEmpty","obj","Object","includes","constructor","entries","listType","compositeSessionIdRef","customTags","STORY_LIST_TYPE","onboarding","configForListRequest","storySlidesGetRequestConfig","allFields","join","fields","session_id","ids","replaceAll","val","match","replacement","String","RegExp","escapeRegExp","isFunction","func","isString","valueOf","getBlobURL","code","blob","Blob","URL","createObjectURL","worker","onMessage","onmessage","message","MessageType","RESPONSE","reqMap","MessageStatus","SUCCESS","raw","handleFxResponse","REQUEST","fxMap","console","log","sendMessage","serialized","ERROR","handleFx","fxReceiverDomain","fxSenderDomain","Defer","createDuplex","clientFxDomain","serverFxDomain","styles","StyleSheet","container","flex","justifyContent","alignItems","position","width","height","STORY_READER_WINDOW_REFERER","StoriesEvents","_","Symbol","observable","M","z","T","H","G","U","__proto__","K","L","Q","X","ee","te","hasRef","re","ve","we","Oe","sidRoot","De","_e","Ie","Me","first","last","size","We","Xe","rt","indexOf","splice","at","nt","pop","ot","clear","st","deep","ownerSet","unsubscribe","pt","loc","path","concat","unitId","thru","subscribe","isCombine","key","clone","field","defaultShape","qt","$storyManagerConfig","apiKey","storyManagerConfigChanged","storyManagerConfigTagsChanged","tags","storyManagerConfigUserIdChanged","userId","storyManagerConfigPlaceholdersChanged","placeholders","storyManagerConfigLangChanged","lang","storyManagerConfigIsSandboxChanged","isSandbox","Boolean","storyManagerConfigApiKeyChanged","$configDeviceId","configDeviceIdChanged","forward","$placeholders","sdkPlaceholdersChanged","createApi","addDefaultPlaceholders","_placeholders","item","Utility","cb","opt_timeout","called","setTimeout","formData","previousKey","keys","this","convertModelToFormData","append","Uint8Array","substr","baseURL","APIInstance","requestInterceptors","interceptors","request","interceptor","search","headers","body","JSON","response","fetch","credentials","json","headersRaw","fromEntries","statusText","Authorization","$session","_$session$getState","session","_$session$getState$se","uuidV4","process","env","BUILD_VERSION","expire_in","server_timestamp","content_base_url","user_key","share","is_allow_profiling","cache","fetchSessionFx","sessionChanged","sessionThumbViewsChanged","payload","API","post","os_name","window","isIos","Android","configData","user_id","features","StoryManager","getInstance","getDeviceInfo","$stories","$storiesIds","$storiesDefault","$storiesFavorite","$storiesOnboarding","default","favorite","is_opened","fetchStoriesFx","storyCheckLocalIsOpened","story","userKey","localStorageGetArray","$storiesIdsWithoutLoadedSlides","items","slidesLoaded","storyItemFavoriteChanged","storyItemLikeChanged","storyItemIsOpenedChanged","models","like","_$storyManagerConfig$","$storyContext","fetchStoryContextFx","storyContextChanged","context","fetchSessionAndStoriesCompositeFx","defaultList","onboardingList","favoriteList","onboardingTags","compositeRequest","getCompositeSubRequestDataFromRequestConfig","sessionGetRequestConfig","storyGetRequestConfig","success","compositeResponse","ref","qs","replacePlaceholders","placeholdersKey","hasOwnProperty","processStories","list","title","need_placeholders","_list$find","storiesListItemsAdded","storyList","storiesListIdsChanged","_list$find2","_list$find3","_list$find4","fetchStoriesSlidesCompositeFx","isStoryModel","x","fetchStoriesContextAndStorySlidesCompositeFx","storyContextGetRequestConfig","_data$i","assign","slides_html","_data$i3","_data$i3$body","_data$i4","_data$i4$body","slides_duration","_data$i5","_data$i5$body","_list$result$find","fetchSessionAndStoryDataCompositeFx","_$session$getState2","_$session$getState2$s","SharePageEvents","sessionModel","_list$find5","_list$result$find2","_list$find6","newState","_data","GoodsWidget","_StoryFavorite","getStoryListByType","getFontResources","_showStory","storyReaderInstance","openReaderData","windowReferer","storyContext","hasShare","closeReader","openReader","EventEmitter","callbacks","_callbacks","StoriesList","mountSelector","appearanceManager","storyListWidget","needLoader","instance","_loadStoriesList","_appearanceManager","storyListInstance","_storyReaderInstance","storyReaderInstancePromise","storyReaderInstancePromiseResolver","_goodsWidgetInstance","_storyReaderNeedFirstRender","_storyReaderDetachComponent","_storyReaderWidgetLoaded","completeInitStoryReader","storyReaderWidget","_storyFavoriteReaderInstance","storyFavoriteReaderInstancePromise","_loadedStoriesLength","defaultListLength","favoriteListLength","needFavorite","commonOptions","hasFavorite","_storiesListWidgetLoaded","storiesListOptions","setStories","getStoryFavoriteReaderInstance","fontResources","setFonts","setCallbacks","handleClickOnStoryDeepLink","navigator","FormData","sendBeacon","APISendBeacon","createFunctionWithTimeout","isDeeplink","handleStoryLinkClick","open","handleClickOnStory","handleFlushThumbViews","handleClickOnStoryInternal","SharePage","storyId","_showSharePage","_ref","closeGoodsWidget","sharePageOptions","sharePage","emit","START_LOADING","handleStartLoading","initStoryReader","closeOnLastSlideByTimer","recycleStoriesList","handleStoryReaderClose","listenerCount","CLOSE_STORY_READER","location","protocol","host","END_LOADING","handleStopLoading","destructor","storyLinkClickHandler","callback","openGoodsWidgetHandler","setTags","setUserId","setLang","setPlaceholders","setIsSandbox","setApiKey","storyReaderNeedFirstRender","storyReaderDetachComponent","resolve","reject","storyContextExists","getStoryReaderInstance","fonts","overrideStoryReaderOptions","_this$storyListInstan","onStoryOpened","localStorageSetArray","rpcCb","requestId","err","CLICK_ON_STORY","cbPayload","src","srcRef","once","storyFavoriteReaderInstance","init","storyFavoriteReaderOptions","focus","openStoryReader","closeStoryReader","onboardingStories","close","BlobContentType","Events","Widget","loaderContainer","_loaderContainer","widgetId","loading","enabled","startLoader","imgResource","isSecure","isSecureContext","checkUrlProtocol","BASE_URL","style","background","stopLoader","getGeneratedPageURL","html","css","js","cssTag","jsTag","CSS","JS","htmlVariant","HTML","srcdoc","getWidgetDocument","widgetParams","destroy","objId","rpc","RPC","innerHTML","count","IAS_OLD","version","MD5","j","q","w","charCodeAt","charAt","fromCharCode","A","extend","overwrite","_protocol","_base_domain","xdConnectionCallbacks","_apiKey","XDM","_domain","_path","xdReady","Observer","_rootId","Util","_session","main","api","login","proxy","_nameTransportPath","toServerFxDomain","toClientFxDomain","rpcDomains","RpcMessage","RpcMessageOnServer","widgetLoaded","clickOnStoryInternalEvent","flushThumbViewsEvent","clickOnStoryEvent","clickOnStoryDeepLinkEvent","nextID","WebViewWorkerServer","webview","_destructor","onMessageCb","messageListener","nativeEvent","parse","postMessage","arg","WidgetStoriesList","frameName","_this$callbacks","_this$callbacks3","_this$callbacks5","_this$callbacks7","widgetSrcFile","jsResourceGlobal","widgetEntrypoint","cssResourceGlobal","allowTransparency","overflowTouch","backgroundColor","layout","pageUrl","startHeight","card","topPadding","bottomPadding","bottomMargin","createView","document","querySelector","genKey","Math","ceil","mountView","attrs","div","createElement","frame","firstChild","self","frameBorder","insertBefore","containerOptions","storiesHeight","storiesLayoutHeight","storiesBackgroundColor","storiesListTopPadding","storiesListBottomPadding","storiesListBottomMargin","storiesTitle","content","extraCss","extraJs","defaults","maxWidth","minWidth","scrolling","hidden","parseFloat","parseInt","cssWidth","max","min","overflow","viewOptions","iframeOptions","allowtransparency","baseUrl","createRpcServer","functions","no_finish_loading","_init","jsResource","funcs","onDone","iter","super","iframe","_this$callbacks9","_this$callbacks11","_this$callbacks13","_this$callbacks15","callMethod","syncStoreHandle","StoryReaderCloseButtonPosition","StoryReaderSwipeStyle","StoryReaderOptionsDefault","closeButtonPosition","RIGHT","scrollStyle","FLAT","color","accentColor","custom","AppearanceCommonOptionsDefault","hasLike","onOpenReader","StoriesListCardViewVariant","StoriesListEvents","onReaderOpened","onReaderClosed","WidgetStoryReader","appearanceManagerGetter","storyReaderOptions","appearanceCommon","left","right","top","StoriesListOptionsDefault","font","marginBottom","padding","gap","variant","CIRCLE","border","radius","boxShadow","opacity","mask","opened","favoriteCard","sidePadding","navigation","showControls","controlsSize","controlsBackgroundColor","controlsColor","StoryFavoriteReaderOptionsDefault","GoodsWidgetRenderingType","GoodsWidgetOptionsDefault","goodsWidgetRenderingType","DEFAULT","useLayoutEffect","useEffect","setManagers","$managers","storyManager","_commonOptions","_storiesListOptions","_storyReaderOptions","_storyFavoriteReaderOptions","_goodsWidgetOptions","setCommonOptions","setStoriesListOptions","setStoryReaderOptions","setStoryFavoriteReaderOptions","setGoodsWidgetOptions","goodsWidgetOptions","widgetStoriesList","setWidgetStoriesList","useState","viewRef","useRef","rpcBind","setRpcBind","createWidgetStoriesList","React","View","WebView","nativeConfig","props","webContentsDebuggingEnabled","allowsInlineMediaPlayback","scalesPageToFit","originWhitelist","AbstractStoryManager","widget","createWidgetStoryReader","setNeedFirstRender","detachComponent","device_id","getUniqueId","platform","getSystemName","jsonValue","AsyncStorage","getItem","setItem","localStorageGet","localStorageSet","StatusBar","setHidden","widgetStoryReader","setWidgetStoryReader","needFirstRender","SafeAreaView","barStyle","createStoryManager","createAppearanceManager","managers","useReducer","useStore","willMount","useBeforeFirstRender"],"mappings":"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"}