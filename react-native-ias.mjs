function e(e){let{storyManager:t,appearanceManager:r}=e,[n,s]=V(null),o=K(null),[i,a]=V(null);return J((()=>{null===n&&null!=t&&null!=r&&(s(t.createWidgetStoriesList(r)),a(!1)),!1===i&&null!==o.current&&(console.log('bind rpc'),null==n||n.createRpcServer(o.current),a(!0))})),J((()=>{console.log({widgetStoriesListContainerOptions:null==n?void 0:n.containerOptions}),console.log({widgetStoriesListviewOptions:null==n?void 0:n.viewOptions})})),G.createElement(G.Fragment,null,n&&G.createElement(G.Fragment,null,G.createElement(X,null==n?void 0:n.containerOptions,G.createElement(z,Object.assign({nativeConfig:{props:{webContentsDebuggingEnabled:!0,allowsInlineMediaPlayback:!0}},scalesPageToFit:!1,originWhitelist:['*'],onMessage:()=>{}},null==n?void 0:n.viewOptions,{ref:o})))))}function t(e){let{storyManager:t}=e,[r,n]=V(null),[s,o]=V(!1),i=K(null),[a,l]=V(null);return J((()=>{null===r&&null!=t&&(console.log('createWidgetStoryReader'),n(t.createWidgetStoryReader(o,(()=>{console.log('[StoryReader] call detachComponent'),null==r||r.destructor(),l(null),n(null),o(!1),i.current=null}))),l(!1)),!1===a&&null!==i.current&&(console.log('bind rpc'),null==r||r.createRpcServer(i.current),l(!0))})),r&&s&&G.createElement(Q,{style:[ae.container,{backgroundColor:"#000"}]},G.createElement(Z,{barStyle:"light-content",backgroundColor:"#000"}),G.createElement(X,null==r?void 0:r.containerOptions,G.createElement(z,Object.assign({nativeConfig:{props:{webContentsDebuggingEnabled:!0,allowsInlineMediaPlayback:!0}},scalesPageToFit:!1,originWhitelist:['*'],onMessage:()=>{}},null==r?void 0:r.viewOptions,{ref:i}))))}function r(){}function n(){n.init.call(this)}function s(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function o(e,t,r){if(t)e.call(r);else for(var n=e.length,s=h(e,n),o=0;o<n;++o)s[o].call(r)}function i(e,t,r,n){if(t)e.call(r,n);else for(var s=e.length,o=h(e,s),i=0;i<s;++i)o[i].call(r,n)}function a(e,t,r,n,s){if(t)e.call(r,n,s);else for(var o=e.length,i=h(e,o),a=0;a<o;++a)i[a].call(r,n,s)}function l(e,t,r,n,s,o){if(t)e.call(r,n,s,o);else for(var i=e.length,a=h(e,i),l=0;l<i;++l)a[l].call(r,n,s,o)}function d(e,t,r,n){if(t)e.apply(r,n);else for(var s=e.length,o=h(e,s),i=0;i<s;++i)o[i].apply(r,n)}function c(e,t,n,o){var i,a,l,d;if('function'!=typeof n)throw new TypeError('"listener" argument must be a function');if((a=e._events)?(a.newListener&&(e.emit('newListener',t,n.listener?n.listener:n),a=e._events),l=a[t]):(a=e._events=new r,e._eventsCount=0),l){if('function'==typeof l?l=a[t]=o?[n,l]:[l,n]:o?l.unshift(n):l.push(n),!l.warned&&(i=s(e))&&i>0&&l.length>i){l.warned=!0;var c=new Error('Possible EventEmitter memory leak detected. '+l.length+' '+t+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name='MaxListenersExceededWarning',c.emitter=e,c.type=t,c.count=l.length,d=c,'function'==typeof console.warn?console.warn(d):console.log(d)}}else l=a[t]=n,++e._eventsCount;return e}function u(e,t,r){function n(){e.removeListener(t,n),s||(s=!0,r.apply(e,arguments))}var s=!1;return n.listener=r,n}function p(e){var t=this._events;if(t){var r=t[e];if('function'==typeof r)return 1;if(r)return r.length}return 0}function h(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}function f(e,t,r,n){(ke(e)||Re(e))&&('family'in e||'graphite'in e)||be(`${t}: expect ${r} to be a unit (store, event or effect)${n}`)}function g(e,t,r){if(Array.isArray(e))for(let n=0;n<e.length;n++)f(e[n],t,`${n} item of ${r}`,'');else f(e,t,r,' or array of units')}function y({node:e=[],from:t,source:r,parent:n=t||r,to:s,target:o,child:i=s||o,scope:a={},meta:l={},family:d={type:'regular'},regional:c}={}){let u=at(n),p=at(d.links),h=at(d.owners),f=[],g={};for(let t=0;t<e.length;t++){let r=e[t];r&&(f.push(r),lt(r,g))}let y={id:xe(),seq:f,next:at(i),meta:l,scope:a,family:{type:d.type||"crosslink",links:p,owners:h},reg:g};for(let e=0;e<p.length;e++)Ke(p[e]).push(y);for(let e=0;e<h.length;e++)Je(h[e]).push(y);for(let e=0;e<u.length;e++)u[e].next.push(y);return c&&nt&&rt(Qe(nt),[y]),y}function m(e,t,r){let n=Lt,s=null,o=vt;if(e.target&&(t=e.params,r=e.defer,n='page'in e?e.page:n,e.stack&&(s=e.stack),o=tt(e)||o,e=e.target),o&&vt&&o!==vt&&(vt=null),Array.isArray(e))for(let r=0;r<e.length;r++)ft('pure',n,Ve(e[r]),s,t[r],o);else ft('pure',n,Ve(e),s,t,o);if(r&&!St)return;let i,a,l,d,c,u,p={isRoot:St,currentPage:Lt,forkPage:vt,isWatch:wt};St=0;e:for(;d=ht();){let{idx:e,stack:t,type:r}=d;l=t.node,Lt=c=t.page,vt=tt(t),u=(c||l).reg;let n={fail:0,scope:l.scope};i=a=0;for(let s=e;s<l.seq.length&&!i;s++){let o=l.seq[s],d=o.data;switch(o.type){case"barrier":{let n=d.barrierID;c&&(n=`${c.fullID}_${n}`);let o=d.priority;if(s!==e||r!==o){mt.has(n)||(mt.add(n),gt(s,t,o,n));continue e}mt.delete(n);break}case'mov':{let e;switch(d.from){case"stack":e=Qe(t);break;case"a":case'b':e=t[d.from];break;case"value":e=d.store;break;case pe:u[d.store.id]||(t.page=c=Rt(c,d.store.id),u=c?c.reg:l.reg),e=je(u[d.store.id])}switch(d.to){case"stack":t.value=e;break;case"a":case'b':t[d.to]=e;break;case pe:_t(c,l,d.target.id).current=e}break}case'check':switch(d.type){case'defined':a=void 0===Qe(t);break;case'changed':a=Qe(t)===je(_t(c,l,d.store.id))}break;case"filter":a=!Ct(n,d,t);break;case'run':if(s!==e||"effect"!==r){gt(s,t,"effect");continue e}case'compute':wt='watch'===l.meta.op,t.value=Ct(n,d,t),wt=p.isWatch}i=n.fail||a}if(!i)for(let e=0;e<l.next.length;e++)ft('child',c,l.next[e],t,Qe(t),tt(t))}St=p.isRoot,Lt=p.currentPage,vt=tt(p)}function v(e,t="combine"){let r=t+'(',n='',s=0;for(let t in e){let o=e[t];if(null!=o&&(r+=n,r+=ge(o)?o.compositeName.fullName:o.toString()),s+=1,25===s)break;n=', '}return r+=')',r}function S(e,t){for(let r in e)t(e[r],r)}function w(e,t){let r=(e,...t)=>Lt?((e,t,r,n)=>{let s=Lt,o=null;if(t)for(o=Lt;o&&o.template!==t;)o=et(o);kt(o);let i=e.create(r,n);return kt(s),i})(r,n,e,t):r.create(e,t);r.graphite=y({meta:Ut("event",r,t,e),regional:1}),r.create=e=>(m(vt?vt.find(r):r,e),e),r.watch=Ee($t,r),r.map=e=>{let t,n;ke(e)&&(t=e,n=e.name,e=e.fn);let s=w(It(r,n),t);return Vt(r,s,fe,e),s},r.filter=e=>Kt(r,"filter",e.fn?e:e.fn,[Ne({fn:Ge})]),r.filterMap=e=>Kt(r,'filterMap',e,[He({fn:Ge}),Ae.defined()]),r.prepend=e=>{let t=w('* \u2192 '+r.shortName,{parent:et(r)}),n=st();return n&&Ve(t).seq.push(n.upward),Vt(t,r,'prepend',e),qt(r,t),t};let n=st();return r}function L(e,t){function r(e,t){l.off(e),Ze(l).set(e,Ht(Jt(e,l,'on',1,t,c)))}let n=Be(e),s=Be(e),o=Gt('updates'),i=st();n.after=[{type:'copy',to:s}],i&&i.plain.push(n,s);let a=n.id,l={subscribers:new Map,updates:o,defaultState:e,stateRef:n,getState(){let e,t=n;if(Lt){let t=Lt;for(;t&&!t.reg[a];)t=et(t);t&&(e=t)}return!e&&vt&&vt.reg[a]&&(e=vt),e&&(t=e.reg[a]),je(t)},setState(e){let t;vt&&(t=vt.nodeMap[Ve(l).id]),t||(t=l),m({target:t,params:e,defer:1})},reset(...e){for(let t of e)l.on(t,(()=>l.defaultState));return l},on(e,t){if(g(e,'.on','first argument'),Array.isArray(e))for(let n of e)r(n,t);else r(e,t);return l},off(e){let t=Ze(l).get(e);return t&&(t(),Ze(l).delete(e)),l},map(e,t){let r,s,o;ke(e)&&(r=e,s=e.name,t=e.firstState,e=e.fn);let i=l.getState(),a=st();a?o=null:void 0!==i&&(o=e(i,t));let d=L(o,{name:It(l,s),config:r,strict:0}),c=Jt(l,d,fe,0,e);return ze(d).before=[{type:fe,fn:e,from:n}],a&&(Tt(a.plain,n)||Tt(c.seq,a.loader)||c.seq.unshift(a.loader)),d},watch(e,t){if(!t||!ge(e)){let t=$t(l,e),r=st();return r?r.watch.push({of:n,fn:e}):e(l.getState()),t}return Re(t)||be('second argument should be a function'),e.watch((e=>t(l.getState(),e)))}},d=Ut(pe,l,t),c=l.defaultConfig.updateFilter;return l.graphite=y({scope:{state:n},node:[Ae.defined(),Ae.changed({store:s}),c&&De({store:s,to:"a"}),c&&Ne({fn:(e,t,{a:r})=>c(e,r)}),$e({store:n}),$e({store:s})],child:o,meta:d,regional:1}),jt&&void 0===e&&be("current state can't be undefined, use null instead"),rt(l,[o]),l}function b(e,t){let r=w(e,t),n=r.defaultConfig.handler||(()=>be(`no handler used in ${r.getType()}`)),s=Ve(r);s.meta.onCopy=['runner'],s.meta.unit=r.kind="effect",r.use=e=>(Re(e)||be('.use argument should be a function'),n=e,r);let o=r.finally=Gt('finally'),i=r.done=o.filterMap({named:'done',fn({status:e,params:t,result:r}){if('done'===e)return{params:t,result:r}}}),a=r.fail=o.filterMap({named:'fail',fn({status:e,params:t,error:r}){if('fail'===e)return{params:t,error:r}}}),l=r.doneData=i.map({named:'doneData',fn:({result:e})=>e}),d=r.failData=a.map({named:'failData',fn:({error:e})=>e}),c=y({scope:{getHandler:r.use.getCurrent=()=>n,finally:o},node:[We({fn({params:e,req:t},{finally:r,getHandler:n},s){let o,i=Yt({params:e,req:t,ok:1,anyway:r,stack:s}),a=Yt({params:e,req:t,ok:0,anyway:r,stack:s});try{o=n()(e)}catch(e){return void a(e)}ke(o)&&Re(o.then)?o.then(i,a):i(o)}})],meta:{op:'fx',fx:'runner',onCopy:['finally']}});s.scope.runner=c,s.seq.push(He({fn:(e,t,r)=>et(r)?{params:e,req:{rs(e){},rj(e){}}}:e}),We({fn:(e,{runner:t},r)=>(m({target:t,params:e,defer:1,forkPage:tt(r)}),e.params)})),r.create=e=>{let t=(()=>{let e={};return e.req=new Promise(((t,r)=>{e.rs=t,e.rj=r})),e.req.catch((()=>{})),e})(),n={params:e,req:t};if(vt){if(!wt){let e=vt;t.req.finally((()=>{bt(e)})).catch((()=>{}))}m(vt.find(r),n)}else m(r,n);return t.req};let u=r.inFlight=L(0,{named:'inFlight'}).on(r,(e=>e+1)).on(o,(e=>e-1)),p=r.pending=u.map({fn:e=>e>0,named:'pending'});return rt(r,[o,i,a,l,d,p,u,c]),r}function k(...e){let[[t,r],n]=Et(e),s={};return S(r,((e,r)=>{let o=s[r]=w(r,{parent:et(t),config:n});t.on(o,e),qt(t,o)})),s}function R(e,t){let r=new Set,n=new Set,s=new Set,o=new Set,i=y({family:{type:"domain"},regional:1}),a={history:{domains:r,stores:n,effects:s,events:o},graphite:i};i.meta=Ut("domain",a,t,e);let[l,d,c,u]=['onEvent','onEffect','onStore','onDomain'].map(Gt);a.hooks={event:l,effect:d,store:c,domain:u},a.onCreateEvent=Zt(l,o,a),a.onCreateEffect=Zt(d,s,a),a.onCreateStore=Zt(c,n,a),a.onCreateDomain=Zt(u,r,a),a.createEvent=a.event=(e,t)=>l(w(e,{parent:a,config:t})),a.createEffect=a.effect=(e,t)=>d(b(e,{parent:a,config:t})),a.createDomain=a.domain=(e,t)=>R({name:e,parent:a,config:t}),a.createStore=a.store=(e,t)=>c(L(e,{parent:a,config:t}));let p=et(a);return p&&(S(a.hooks,((e,t)=>{Wt({from:e,to:p.hooks[t]})})),p.hooks.domain(a)),a}function _(e,t){let r=w(t||v(e,'merge'));return g(e,'merge','first argument'),Wt({from:e,to:r,meta:{op:'merge'}}),r}function C(...e){let t,r,n,s,[[o,i,a],l]=Et(e);void 0===i&&ke(o)&&(e=>{let t=0;return((e,t)=>{er.forEach(t)})(0,(r=>{r in e&&(null==e[r]&&be(`sample: ${r} should be defined`),t=1)})),t})(o)&&(i=o.clock,a=o.fn,s=o.greedy,t=o.target,r=o.name,n=o.sid,o=o.source);let d=1;void 0===o&&(g(i,'sample','clock'),Array.isArray(i)&&(i=_(i)),o=i,d=0),d&&!ge(o)&&(o=((...e)=>{let t,r,n;xt(e[0],((t,r)=>{n=t,e=r}));let s,o,i=e[e.length-1];if(Re(i)?(r=e.slice(0,-1),t=i):r=e,1===r.length){let e=r[0];me(e)||(s=e,o=1)}return o||(s=r,t&&(t=zt(t))),ke(s)||be('shape should be an object'),Xt(Array.isArray(s),s,n,t)})(o)),void 0===i&&(i=o),g(i,'sample','clock'),r=l||r||o.shortName;let c=st(),u=!!t;t||(me(o)&&me(i)?t=L(a?a(je(ze(o)),je(ze(i))):je(ze(o)),{name:r,sid:n}):(t=w(r),c&&Ve(t).seq.push(c.loader)));let p=u&&ge(t)&&Ve(t).meta.nativeTemplate;if(me(o)){let e=ze(o);rt(o,[Nt(i,t,{scope:{fn:a,targetTemplate:p},node:[c&&c.loader,!s&&Pe({priority:"sampler"}),De({store:e,to:a?"a":"stack"}),a&&He({fn:Ue}),c&&u&&c.upward],meta:{op:"sample",sample:pe}})]),c&&(Tt(c.plain,e)||Tt(c.closure,e)||c.closure.push(e))}else{let e=Be(0),r=Be(),n=Be();c&&c.plain.push(e,r,n),y({parent:o,node:[$e({store:r}),De({from:"value",store:1,target:e})],family:{owners:[o,t,i],links:t},meta:{op:"sample",sample:'source'},regional:1}),rt(o,[Nt(i,t,{scope:{fn:a,targetTemplate:p},node:[c&&c.loader,$e({store:n}),De({store:e}),Ne({fn:e=>e}),!s&&Pe({priority:"sampler"}),De({store:r}),De({store:n,to:"a"}),a&&He({fn:qe}),c&&u&&c.upward],meta:{op:"sample",sample:'clock'}})])}return t}function O(e){return Array.isArray(e)}function I(e){let t=typeof e;return null!=e&&('object'===t||'function'===t)}function x(){if(!fr&&!(fr='undefined'!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||'undefined'!=typeof msCrypto&&'function'==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');return fr(gr)}function E(e){return'string'==typeof e&&yr.test(e)}function T(e,t,r){var n=(e=e||{}).random||(e.rng||x)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,t){r=r||0;for(var s=0;s<16;++s)t[r+s]=n[s];return t}return function(e,t){var r=arguments.length>1&&void 0!==t?t:0,n=(mr[e[r+0]]+mr[e[r+1]]+mr[e[r+2]]+mr[e[r+3]]+'-'+mr[e[r+4]]+mr[e[r+5]]+'-'+mr[e[r+6]]+mr[e[r+7]]+'-'+mr[e[r+8]]+mr[e[r+9]]+'-'+mr[e[r+10]]+mr[e[r+11]]+mr[e[r+12]]+mr[e[r+13]]+mr[e[r+14]]+mr[e[r+15]]).toLowerCase();if(!E(n))throw TypeError('Stringified UUID is invalid');return n}(n)}function F(e){return null==e}function M(e,t){return{...e,...t}}function P(e){return e.replace(/^\//,"")}async function D(){return{method:"post",url:"session/open",params:{expand:"cache"},data:_r(await Cr())}}function A(e){return[Object,Array].includes((e||{}).constructor)&&!Object.entries(e||{}).length}function H(e,t,r){let n="story";return e===Ir.onboarding&&(n="story-onboarding"),{method:"get",url:n,...Br(e,t,r)}}function N(e,t,r){void 0===t&&(t=!1);let n={url:`story/${e}`,method:"get",params:{expand:['slides_html','slides_duration'].join(',')}};return!t&&n.params&&(n.params.fields=['id','slides_html','slides_duration'].join(',')),null!==r&&n.params&&(n.params.session_id=r),n}function W(e,t){let r={url:"story-context",method:"get",params:{id:e.join(',')}};return null!==t&&r.params&&(r.params.session_id=t),r}function $(e,t,r){return String(e).replace(new RegExp((e=>e.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'))(t),'g'),(()=>r))}function B(e){return"function"==typeof e}function j(e){return null!=e&&"string"==typeof e.valueOf()}function q(e,t){let r=new Blob([e],{type:t});return URL.createObjectURL(r)}function U(e,t){((e,t)=>{let r=w();t.onmessage=r,r.watch((e=>{Object(e)===e&&e.sid&&e.id&&((e=>{if(e.type!==gn.RESPONSE)return;let t=xn.get(e.id);if(t)if(e.status===yn.SUCCESS)t.rs(e.result);else{if('raw'in e.error)return void t.rj(e.error.raw);let r=Error('');'name'in e.error&&(r.name=e.error.name),'message'in e.error&&(r.message=e.error.message),'stack'in e.error&&(r.stack=e.error.stack),'code'in e.error&&(r.code=e.error.code),t.rj(r)}})(e),(async(e,t)=>{if(e.type!==gn.REQUEST)return;let r=En.get(e.sid);r?(console.log({"onMessage watch":3,message:e}),await r(e.params).then((r=>{t.sendMessage({id:e.id,sid:e.sid,type:gn.RESPONSE,status:yn.SUCCESS,result:r})})).catch((r=>{let n={};r instanceof Error?(n.name=r.name,'code'in r&&(n.code=r.code),'message'in r&&(n.message=r.message),'stack'in r&&(n.stack=r.stack)):n.raw=r,t.sendMessage({id:e.id,sid:e.sid,type:gn.RESPONSE,status:yn.ERROR,error:n})}))):t.sendMessage({id:e.id,sid:e.sid,type:gn.RESPONSE,status:yn.ERROR,error:{name:'RemoteFXError',message:`Unknown sid "${e.sid}"`}})})(e,t))})),e.fxReceiverDomain.onCreateEffect((e=>{En.set(e.shortName,e)})),e.fxSenderDomain.onCreateEffect((e=>{console.log('fxSenderDomain onCreateEffect',{fx:e}),e.use((r=>{let n=new In;return t.sendMessage({id:n.id,sid:e.shortName,type:gn.REQUEST,params:r}),n.req}))}))})({fxSenderDomain:e.clientFxDomain,fxReceiverDomain:e.serverFxDomain},t)}import'react-native-get-random-values';import G,{useState as V,useRef as K,useEffect as J}from'react';import{WebView as z}from'react-native-webview';import{View as X,StyleSheet as Y,SafeAreaView as Q,StatusBar as Z}from'react-native';import ee from'./StoriesListClient.js';import te from'./StoriesListClient.css.js';import{getUniqueId as re,getSystemName as ne}from'react-native-device-info';import se from'@react-native-async-storage/async-storage';import oe from'./StoryReaderClient.js';import ie from'./StoryReaderClient.css.js';const ae=Y.create({container:{flex:1,justifyContent:"center",alignItems:"center",position:"absolute",width:"100%",height:"100%"}});let le,de,ce;r.prototype=Object.create(null),n.EventEmitter=n,n.usingDomains=!1,n.prototype.domain=void 0,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.init=function(){this.domain=null,n.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new r,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(e){if('number'!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return s(this)},n.prototype.emit=function(e,t,r,n){var s,c,u,p,h,f,g,y='error'===e;if(f=this._events)y=y&&null==f.error;else if(!y)return!1;if(g=this.domain,y){if(s=t,!g){if(s instanceof Error)throw s;var m=new Error('Uncaught, unspecified "error" event. ('+s+')');throw m.context=s,m}return s||(s=new Error('Uncaught, unspecified "error" event')),s.domainEmitter=this,s.domain=g,s.domainThrown=!1,g.emit('error',s),!1}if(!(c=f[e]))return!1;var v='function'==typeof c;switch(u=arguments.length){case 1:o(c,v,this);break;case 2:i(c,v,this,t);break;case 3:a(c,v,this,t,r);break;case 4:l(c,v,this,t,r,n);break;default:for(p=new Array(u-1),h=1;h<u;h++)p[h-1]=arguments[h];d(c,v,this,p)}return!0},n.prototype.on=n.prototype.addListener=function(e,t){return c(this,e,t,!1)},n.prototype.prependListener=function(e,t){return c(this,e,t,!0)},n.prototype.once=function(e,t){if('function'!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,u(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){if('function'!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,u(this,e,t)),this},n.prototype.removeListener=function(e,t){var n,s,o,i,a;if('function'!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(s=this._events))return this;if(!(n=s[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new r:(delete s[e],s.removeListener&&this.emit('removeListener',e,n.listener||t));else if('function'!=typeof n){for(o=-1,i=n.length;i-- >0;)if(n[i]===t||n[i].listener&&n[i].listener===t){a=n[i].listener,o=i;break}if(o<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new r,this;delete s[e]}else((e,t)=>{for(var r=t,n=r+1,s=e.length;n<s;r+=1,n+=1)e[r]=e[n];e.pop()})(n,o);s.removeListener&&this.emit('removeListener',e,a||t)}return this},n.prototype.off=function(e,t){return this.removeListener(e,t)},n.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new r,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new r:delete n[e]),this;if(0===arguments.length){for(var s,o=Object.keys(n),i=0;i<o.length;++i)'removeListener'!==(s=o[i])&&this.removeAllListeners(s);return this.removeAllListeners('removeListener'),this._events=new r,this._eventsCount=0,this}if('function'==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},n.prototype.listeners=function(e){var t,r,n=this._events;return r=n&&(t=n[e])?'function'==typeof t?[t.listener||t]:(e=>{for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t})(t):[],r},n.listenerCount=(e,t)=>'function'==typeof e.listenerCount?e.listenerCount(t):p.call(e,t),n.prototype.listenerCount=p,n.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]},(e=>{e[e.default=0]="default",e[e.favorite=1]="favorite"})(le||(le={})),(e=>{e[e.default=0]="default",e[e.onboarding=1]="onboarding",e[e.favorite=2]="favorite"})(de||(de={})),(ce||(ce={})).CLICK_ON_STORY="clickOnStoryLink";let ue='undefined'!=typeof Symbol&&Symbol.observable||'@@observable',pe='store',he='effect',fe='map',ge=e=>(Re(e)||ke(e))&&'kind'in e;const ye=e=>t=>ge(t)&&t.kind===e;let me=ye(pe),ve=ye("event"),Se=ye(he),we=ye("domain");var Le={__proto__:null,unit:ge,store:me,event:ve,effect:Se,domain:we};let be=e=>{throw Error(e)},ke=e=>'object'==typeof e&&null!==e,Re=e=>'function'==typeof e,_e=e=>{ke(e)||Re(e)||be('expect first argument be an object')};const Ce=()=>{let e=0;return()=>(++e).toString(36)};let Oe=Ce(),Ie=Ce(),xe=Ce(),Ee=(e,t)=>e.bind(null,t),Te=(e,t,r)=>e.bind(null,t,r);const Fe=(e,t,r)=>({id:Ie(),type:e,data:r,hasRef:t});let Me=0,Pe=({priority:e="barrier"})=>Fe("barrier",0,{barrierID:++Me,priority:e}),De=({from:e=pe,store:t,target:r,to:n=(r?pe:"stack")})=>Fe('mov',e===pe,{from:e,store:t,to:n,target:r}),Ae={defined:()=>Fe('check',0,{type:'defined'}),changed:({store:e})=>Fe('check',1,{type:'changed',store:e})},He=Te(Fe,'compute',0),Ne=Te(Fe,"filter",0),We=Te(Fe,'run',0),$e=({store:e})=>De({from:"stack",target:e}),Be=e=>({id:Ie(),current:e}),je=({current:e})=>e,qe=(e,{fn:t},{a:r})=>t(e,r),Ue=(e,{fn:t},{a:r})=>t(r,e),Ge=(e,{fn:t})=>t(e),Ve=e=>e.graphite||e,Ke=e=>e.family.owners,Je=e=>e.family.links,ze=e=>e.stateRef,Xe=e=>e.config,Ye=e=>e.\u0254,Qe=e=>e.value,Ze=e=>e.subscribers,et=e=>e.parent,tt=e=>e.forkPage,rt=(e,t)=>{let r=Ve(e);for(let e=0;e<t.length;e++){let n=Ve(t[e]);"domain"!==r.family.type&&(n.family.type="crosslink"),Ke(n).push(r),Je(r).push(n)}},nt=null,st=()=>nt,ot=e=>(e&&nt&&nt.sidRoot&&(e=`${nt.sidRoot}\u0254${e}`),e);const at=(e=[])=>{let t=[];if(Array.isArray(e))for(let r=0;r<e.length;r++)Array.isArray(e[r])?t.push(...e[r]):t.push(e[r]);else t.push(e);return t.map(Ve)};let lt=({hasRef:e,type:t,data:r},n)=>{let s;e&&(s=r.store,n[s.id]=s),'mov'===t&&r.to===pe&&(s=r.target,n[s.id]=s)},dt=null;const ct=(e,t)=>{if(!e)return t;if(!t)return e;let r,n=e.v.type===t.v.type;return(n&&e.v.id>t.v.id||!n&&"sampler"===e.v.type)&&(r=e,e=t,t=r),r=ct(e.r,t),e.r=e.l,e.l=r,e},ut=[];let pt=0;for(;pt<5;)ut.push({first:null,last:null,size:0}),pt+=1;const ht=()=>{for(let e=0;e<5;e++){let t=ut[e];if(t.size>0){if(2===e||3===e){t.size-=1;let e=dt.v;return dt=ct(dt.l,dt.r),e}1===t.size&&(t.last=null);let r=t.first;return t.first=r.r,t.size-=1,r.v}}},ft=(e,t,r,n,s,o)=>gt(0,{a:null,b:null,node:r,parent:n,value:s,page:t,forkPage:o},e),gt=(e,t,r,n=0)=>{let s=yt(r),o=ut[s],i={v:{idx:e,stack:t,type:r,id:n},l:0,r:0};2===s||3===s?dt=ct(dt,i):(0===o.size?o.first=i:o.last.r=i,o.last=i),o.size+=1},yt=e=>{switch(e){case'child':return 0;case'pure':return 1;case"barrier":return 2;case"sampler":return 3;case he:return 4;default:return-1}},mt=new Set;let vt,St=1,wt=0,Lt=null,bt=e=>{vt=e},kt=e=>{Lt=e};const Rt=(e,t)=>{if(e){for(;e&&!e.reg[t];)e=et(e);if(e)return e}return null},_t=(e,t,r)=>(Rt(e,r)||t).reg[r],Ct=(e,{fn:t},r)=>{try{return t(Qe(r),e.scope,r)}catch(t){e.fail=1}};let Ot=(e,t)=>''+e.shortName+t,It=(e,t)=>null==t?Ot(e,' \u2192 *'):t,xt=(e,t)=>{_e(e),Ye(e)&&t(Xe(e),Ye(e))},Et=e=>{let t;return xt(e[0],((r,n)=>{t=r,e=n})),[e,t]},Tt=(e,t)=>e.includes(t),Ft=(e,t)=>{let r=e.indexOf(t);-1!==r&&e.splice(r,1)};const Mt=(e,t)=>{Ft(e.next,t),Ft(Ke(e),t),Ft(Je(e),t)},Pt=(e,t,r)=>{let n;e.next.length=0,e.seq.length=0,e.scope=null;let s=Je(e);for(;n=s.pop();)Mt(n,e),(t||r&&!e.meta.sample||"crosslink"===n.family.type)&&Pt(n,t,'on'!==n.meta.op&&r);for(s=Ke(e);n=s.pop();)Mt(n,e),r&&"crosslink"===n.family.type&&Pt(n,t,'on'!==n.meta.op&&r)},Dt=e=>e.clear();let At=(e,{deep:t}={})=>{let r=0;if(e.ownerSet&&e.ownerSet.delete(e),me(e))Dt(Ze(e));else if(we(e)){r=1;let t=e.history;Dt(t.events),Dt(t.effects),Dt(t.stores),Dt(t.domains)}Pt(Ve(e),!!t,r)},Ht=e=>{let t=Te(At,e,void 0);return t.unsubscribe=t,t},Nt=(e,t,{node:r,scope:n,meta:s})=>y({node:r,parent:e,child:t,scope:n,meta:s,family:{owners:[e,t],links:t},regional:1}),Wt=e=>{let t;xt(e,((r,n)=>{t=r,e=n}));let{from:r,to:n,meta:s={op:'forward'}}=e;return g(r,'forward','"from"'),g(n,'forward','"to"'),t&&(s.config=t),Ht(y({parent:r,child:n,meta:s,family:{},regional:1}))},$t=(e,t)=>{if(Re(t)||be('.watch argument should be a function'),vt){let t=vt.nodeMap[Ve(e).id];t&&(e=t)}return Ht(y({scope:{fn:t},node:[We({fn:Ge})],parent:e,meta:{op:'watch'},family:{owners:e},regional:1}))};const Bt=(e,t)=>(ke(e)&&(Bt(Xe(e),t),null!=e.name&&(ke(e.name)?Bt(e.name,t):Re(e.name)?t.handler=e.name:t.name=e.name),e.loc&&(t.loc=e.loc),(e.sid||null===e.sid)&&(t.sid=e.sid),e.handler&&(t.handler=e.handler),e.updateFilter&&(t.updateFilter=e.updateFilter),et(e)&&(t.parent=et(e)),'strict'in e&&(t.strict=e.strict),e.named&&(t.named=e.named),Bt(Ye(e),t)),t);let jt,qt=(e,t,r="event")=>{et(e)&&et(e).hooks[r](t)},Ut=(e,t,r,n)=>{let s=Bt({name:n,config:r},{}),o="domain"===e,i=Oe(),{parent:a=null,sid:l=null,strict:d=1,named:c=null}=s,u=c||s.name||(o?'':i),p=((e,t)=>{let r,n,s,o=e;return t?(s=t.compositeName,0===e.length?(r=s.path,n=s.fullName):(r=s.path.concat([e]),n=0===s.fullName.length?e:s.fullName+'/'+e)):(r=0===e.length?[]:[e],n=e),{shortName:o,fullName:n,path:r}})(u,a),h={unit:t.kind=e,name:t.shortName=u,sid:t.sid=ot(l),named:c,unitId:t.id=i};return t.parent=a,t.compositeName=p,t.defaultConfig=s,t.thru=e=>e(t),t.getType=()=>p.fullName,o||(t.subscribe=e=>(_e(e),t.watch(Re(e)?e:t=>{e.next&&e.next(t)})),t[ue]=()=>t),jt=d,h},Gt=e=>w({named:e});const Vt=(e,t,r,n)=>Nt(e,t,{scope:{fn:n},node:[He({fn:Ge})],meta:{op:r}}),Kt=(e,t,r,n)=>{let s;ke(r)&&(s=r,r=r.fn);let o=w(Ot(e,' \u2192? *'),s);return Nt(e,o,{scope:{fn:r},node:n,meta:{op:t}}),o},Jt=(e,t,r,n,s,o)=>{let i=ze(t),a=[De({store:i,to:"a"}),He({fn:n?Ue:qe}),Ae.defined(),Ae.changed({store:i}),o&&Ne({fn:(e,t,{a:r})=>o(e,r)}),$e({store:i})];return Nt(e,t,{scope:{fn:s},node:a,meta:{op:r}})},zt=e=>t=>e(...t),Xt=(e,t,r,n)=>{let s=e?e=>e.slice():e=>({...e}),o=e?[]:{},i=s(o),a=Be(i),l=Be(1);a.type=e?'list':'shape';let d=L(i,{name:r||v(t)});Ve(d).meta.isCombine=1;let c=[Ae.defined(),De({store:a,to:"a"}),Ne({fn:(e,{key:t},{a:r})=>e!==r[t]}),De({store:l,to:'b'}),He({fn(e,{clone:t,key:r},n){n.b&&(n.a=t(n.a)),n.a[r]=e}}),De({from:"a",target:a}),De({from:"value",store:0,target:l}),Pe({priority:"barrier"}),De({from:"value",store:1,target:l}),De({store:a}),n&&He({fn:n}),Ae.changed({store:ze(d)})],u=a.before=[];return S(t,((e,t)=>{if(!me(e))return void(i[t]=o[t]=e);o[t]=e.defaultState,i[t]=e.getState(),Nt(e,d,{scope:{key:t,clone:s},node:c,meta:{op:'combine'}});let r=ze(e);u.push({type:'field',field:t,from:r})})),d.defaultShape=t,a.after=[n?{type:fe,to:ze(d),fn:n}:{type:'copy',to:ze(d)}],d.defaultState=n?ze(d).current=n(i):o,d};let Yt=({params:e,req:t,ok:r,anyway:n,stack:s})=>o=>m({target:[n,Qt],params:[r?{status:'done',params:e,result:o}:{status:'fail',params:e,error:o},{fn:r?t.rs:t.rj,value:o}],defer:1,page:s.page,forkPage:tt(s)}),Qt=y({node:[We({fn({fn:e,value:t}){e(t)}})],meta:{op:'fx',fx:'sidechain'}});const Zt=(e,t,r)=>(e.create=t=>(m(e,t),t),Ve(e).seq.push(He({fn:(e,t,r)=>(r.forkPage=null,e)})),e.watch((e=>{rt(r,[e]),t.add(e),e.ownerSet||(e.ownerSet=t),et(e)||(e.parent=r)})),rt(r,[e]),r=>(t.forEach(r),e.watch(r))),er=['source','clock','target'],tr=L({apiKey:"",isSandbox:!1}),rr=w();tr.on(rr,((e,t)=>t));const nr=w();tr.on(nr,((e,t)=>{let{tags:r}=t;return{...e,tags:r}}));const sr=w();tr.on(sr,((e,t)=>{let{userId:r}=t;return{...e,userId:r}}));const or=w();tr.on(or,((e,t)=>{let{placeholders:r}=t;return{...e,placeholders:r}}));const ir=w();tr.on(ir,((e,t)=>{let{lang:r}=t;return{...e,lang:r}}));const ar=w();tr.on(ar,((e,t)=>{let{isSandbox:r}=t;return{...e,isSandbox:r}}));const lr=w();tr.on(lr,((e,t)=>{let{apiKey:r}=t;return{...e,apiKey:r}}));const dr=L(''),cr=w();Wt({from:cr,to:dr});const ur=L({}),{sdkPlaceholdersChanged:pr}=k(ur,{sdkPlaceholdersChanged:(e,t)=>t,addDefaultPlaceholders:(e,t)=>{let r={};return O(t)&&t.forEach((e=>{I(e)&&void 0!==e.name&&void 0!==e.default_value&&(r[e.name]=e.default_value)})),r}});class hr{static createFunctionWithTimeout(e,t){function r(){n||(n=!0,e())}let n=!1;return setTimeout(r,t||1e3),r}static convertModelToFormData(e,t,r){t instanceof Object&&Object.keys(t).forEach((n=>{let s=t[n];if(s instanceof Object&&!Array.isArray(s))return this.convertModelToFormData(e,s,n);r&&(n=`${r}[${n}]`),Array.isArray(s)?s.forEach((t=>{e.append(`${n}[]`,t)})):e.append(n,s)}))}}for(var fr,gr=new Uint8Array(16),yr=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,mr=[],vr=0;vr<256;++vr)mr.push((vr+256).toString(16).substr(1));const Sr="https://api.inappstory.com",wr=new class{constructor(){this.requestInterceptors=[],this.interceptors={request:{use:e=>{this.requestInterceptors.push(e)}}}}get baseURL(){return tr.getState().isSandbox?"https://api.test.inappstory.com":Sr}async request(e){try{if(this.requestInterceptors.length)for(let t of this.requestInterceptors)t(e);let t=new URL(`/v2/${P(e.url)}`,this.baseURL);!F(e.params)&&I(e.params)&&(t.search='');let r='get';F(e.method)||(r=e.method);let n={};!F(e.headers)&&I(e.headers)&&(n=e.headers);let s=null;!F(e.data)&&I(e.data)&&(s=JSON.stringify(e.data),n["Content-Type"]="application/json");let o=await fetch(t.toString(),{method:r,body:s,headers:n,credentials:"omit"});return{data:await o.json(),headersRaw:o.headers,headers:Object.fromEntries([...o.headers]),status:o.status,statusText:o.statusText,ok:o.ok}}catch(e){throw e}}async post(e,t){return this.request({method:'post',url:e,data:t})}async get(e,t){return this.request({method:'get',url:e,params:t})}};wr.interceptors.request.use((e=>{var t,r;return e.headers=M(e.headers,{Authorization:`Bearer ${tr.getState().apiKey}`,"Accept-Language":tr.getState().lang,"Auth-Session-Id":null===(t=Lr.getState())||void 0===t||null===(r=t.session)||void 0===r?void 0:r.id,"X-Device-Id":dr.getState(),"X-User-Id":tr.getState().userId,"X-Request-Id":T(),"X-Sdk-Version":process.env.BUILD_VERSION}),e}));const Lr=L({session:{id:'',expire_in:0},server_timestamp:0,content_base_url:'',user_key:'',share:!1,is_allow_profiling:!1,cache:[],placeholders:[]}),br=b();Lr.on(br.doneData,((e,t)=>t));const kr=w(),Rr=b((e=>{wr.post('session/update',e)})).prepend((e=>({data:[[5,0,...e]]})));br.use((async()=>(await wr.post('session/open?expand=cache',_r(await Cr()))).data)),Wt({from:kr,to:Lr});const _r=e=>{'iOS'===e.os_name?window.isIos=!0:'Android'===e.os_name&&(window.Android=!0);let t=tr.getState();return t&&t.userId&&(e.user_id=t.userId),e.features='animation,data,deeplink,placeholder,resetTimers,gameReader,swipeUpItems',e},Cr=()=>ln.getInstance().getDeviceInfo(cr);let Or,Ir,xr;(e=>{e[e.default=0]="default",e[e.favorite=1]="favorite"})(Or||(Or={})),(e=>{e[e.default=0]="default",e[e.onboarding=1]="onboarding",e[e.favorite=2]="favorite"})(Ir||(Ir={})),(e=>{e.CLICK_ON_STORY="clickOnStoryLink"})(xr||(xr={}));const Er=L([]),Tr=L(new Map),Fr=L([]),Mr=L([]),Pr=L([]);Fr.on([Tr,Er],(()=>Er.getState().filter((e=>{var t;return-1!==(null!==(t=Tr.getState().get(Ir.default))&&void 0!==t?t:[]).indexOf(e.id)})))),Mr.on([Tr,Er],(()=>Er.getState().filter((e=>{var t;return-1!==(null!==(t=Tr.getState().get(Ir.favorite))&&void 0!==t?t:[]).indexOf(e.id)})))),Pr.on([Tr,Er],(()=>Er.getState().filter((e=>{var t;return-1!==(null!==(t=Tr.getState().get(Ir.onboarding))&&void 0!==t?t:[]).indexOf(e.id)&&!e.is_opened}))));const Dr=b(),Ar=async(e,t)=>{if(void 0===t&&(t=''),e.is_opened)return e.is_opened;let r=`u/${Lr.getState().user_key}/s_opened`||t;if(!A(r)){let t=await ln.getInstance().localStorageGetArray(r);if(O(t)||(t=[]),-1!==t.indexOf(e.id))return!0}return e.is_opened},Hr=Er.map((e=>e.filter((e=>!e.slidesLoaded)).map((e=>e.id)))),{storyItemFavoriteChanged:Nr,storyItemLikeChanged:Wr,storyItemIsOpenedChanged:$r}=k(Er,{storyItemFavoriteChanged:(e,t)=>{let{id:r,favorite:n}=t,s=e.slice(0),o=s.find((e=>e.id===r));return void 0!==o&&(o.favorite=n),s},storyItemLikeChanged:(e,t)=>{let{id:r,like:n}=t,s=e.slice(0),o=s.find((e=>e.id===r));return void 0!==o&&(o.like=n),s},storyItemIsOpenedChanged:(e,t)=>{let{id:r}=t,n=e.slice(0),s=n.find((e=>e.id===r));return void 0!==s&&(s.is_opened=!0),n}});Dr.use((async e=>{let{listType:t}=e;return wr.get('story',Br(t))}));const Br=(e,t,r)=>{var n;let s=null===(n=tr.getState())||void 0===n?void 0:n.tags,o={};return s&&O(s)&&s.length>0&&(o.tags=s.join(',')),void 0!==r&&O(r)&&r.length>0&&(o.tags=r.join(',')),e===Ir.favorite&&(o.favorite=1),t&&(o.session_id=t),{params:o}},jr=L(null),qr=b(),Ur=w();qr.use((async e=>{let{ids:t}=e;return wr.request(W(t))})),Wt({from:qr.done.filterMap((e=>{let t=e.result.data;if(t&&I(t))return{...t,ids:e.params.ids}})),to:jr}),Wt({from:Ur,to:jr});const Gr=b((async e=>{var t,r;let{defaultList:n,onboardingList:s,favoriteList:o,onboardingTags:i}=e,a=[],l=null;A(null===(t=Lr.getState())||void 0===t||null===(r=t.session)||void 0===r?void 0:r.id)&&(a.push(Vr(await D(),"session")),l="@{session.session.id}"),n&&a.push(Vr(H(Ir.default,l),"storyList")),o&&a.push(Vr(H(Ir.favorite,l),"storyFavoriteList")),s&&a.push(Vr(H(Ir.onboarding,l,i),"storyOnboardingList"));let d=await wr.post('composite',{compositeRequest:a});return d.data&&d.data.success&&d.data.compositeResponse&&Array.isArray(d.data.compositeResponse)?d.data.compositeResponse:[]})),Vr=(e,t)=>({path:e.url,qs:e.params,body:e.data,...e,ref:t}),Kr=e=>{for(let t in ur.getState())ur.getState().hasOwnProperty(t)&&(e=$(e,`%${t}%`,ur.getState()[t]));return e},Jr=e=>Array.isArray(e)?e.map((e=>({...e,title:e.need_placeholders?Kr(e.title):e.title,slidesLoaded:!1,is_opened:Ar(e)}))):[];Wt({from:Gr.doneData.filterMap((e=>{var t;return null===(t=e.find((e=>"session"===e.ref)))||void 0===t?void 0:t.body})),to:Lr}),C({source:Er,clock:Lr,fn:(e,t)=>e.map((e=>({...e,is_opened:Ar(e,t.user_key)}))),target:Er});const{storiesListItemsAdded:zr}=k(Er,{storiesListItemsAdded:(e,t)=>{let{storyList:r}=t,n=e.map((e=>e.id));return[...e,...r.filter((e=>-1===n.indexOf(e.id)))]}}),{storiesListIdsChanged:Xr}=k(Tr,{storiesListIdsChanged:(e,t)=>{let{listType:r,storyList:n}=t,s=new Map(e);return s.set(r,n.map((e=>e.id))),s}});Wt({from:Gr.doneData.filterMap((e=>{var t;let r=Jr(null===(t=e.find((e=>"storyList"===e.ref)))||void 0===t?void 0:t.body);if(r.length>0)return{listType:Ir.default,storyList:r}})),to:[zr,Xr]}),Wt({from:Gr.doneData.filterMap((e=>{var t;let r=Jr(null===(t=e.find((e=>"storyFavoriteList"===e.ref)))||void 0===t?void 0:t.body);if(r.length>0)return{listType:Ir.favorite,storyList:r}})),to:[zr,Xr]}),Wt({from:Gr.doneData.filterMap((e=>{var t;let r=Jr(null===(t=e.find((e=>"storyOnboardingList"===e.ref)))||void 0===t?void 0:t.body);if(r.length>0)return{listType:Ir.onboarding,storyList:r}})),to:[zr,Xr]});const Yr=b();Yr.use((async e=>{let t=e.ids.map((e=>Vr(N(e),`storySlides_${e}`))),r=await wr.post('composite',{compositeRequest:t});return r.data&&r.data.success&&r.data.compositeResponse&&Array.isArray(r.data.compositeResponse)?r.data.compositeResponse:[]}));const Qr=e=>e&&I(e)&&"id"in e,Zr=b();Zr.use((async e=>{let{ids:t,id:r}=e,n=[Vr(N(r),'storySlides'),Vr(W(t),'storyContext')],s=await wr.post('composite',{compositeRequest:n});return s.data&&s.data.success&&s.data.compositeResponse&&Array.isArray(s.data.compositeResponse)?s.data.compositeResponse:[]})),Er.on([Yr.doneData,Zr.doneData],((e,t)=>Array.isArray(t)&&Array.isArray(e)?e.map((e=>{for(let u=0;u<t.length;u++){var r,n,s,o,i,a,l,d,c;if(Qr(null===(r=t[u])||void 0===r?void 0:r.body)&&(null===(n=t[u])||void 0===n||null===(s=n.body)||void 0===s?void 0:s.id)===e.id)return Object.assign({},e,{slides_html:e.need_placeholders?Array.from(null===(o=t[u])||void 0===o||null===(i=o.body)||void 0===i?void 0:i.slides_html).map((e=>Kr(e))):Array.from(null===(a=t[u])||void 0===a||null===(l=a.body)||void 0===l?void 0:l.slides_html),slides_duration:null===(d=t[u])||void 0===d||null===(c=d.body)||void 0===c?void 0:c.slides_duration,slidesLoaded:!0,is_opened:Ar(e)})}return e})):e)),Wt({from:Zr.done.filterMap((e=>{var t;let r=null===(t=e.result.find((e=>"storyContext"===e.ref)))||void 0===t?void 0:t.body;if(r&&I(r))return{...r,ids:e.params.ids}})),to:jr});const en=b((async e=>{var t,r;let{id:n}=e,s=[],o=null;A(null===(t=Lr.getState())||void 0===t||null===(r=t.session)||void 0===r?void 0:r.id)&&(s.push(Vr(await D(),"session")),o="@{session.session.id}"),s.push(Vr(N(n,!0,o),"story")),s.push(Vr(W([n],o),'storyContext'));let i=await wr.post('composite',{compositeRequest:s});if(i.data&&i.data.success&&i.data.compositeResponse&&Array.isArray(i.data.compositeResponse))return i.data.compositeResponse;if(i.data&&!i.data.success)throw Error('composite request error:'+JSON.stringify(i.data.compositeResponse));return[]}));let tn;Wt({from:en.doneData.filterMap((e=>{var t;let r=null===(t=e.find((e=>"session"===e.ref)))||void 0===t?void 0:t.body;if(r&&I(r)&&r)return r})),to:Lr}),Wt({from:en.done.filterMap((e=>{var t;let r=null===(t=e.result.find((e=>"storyContext"===e.ref)))||void 0===t?void 0:t.body;if(r&&I(r))return{...r,ids:[e.params.id]}})),to:jr}),Er.on(en.doneData.filterMap((e=>{var t;let r=null===(t=e.find((e=>"story"===e.ref)))||void 0===t?void 0:t.body;if(r&&I(r))return r})),((e,t)=>{if(!Qr(t))return;let r=e.filter((e=>{var r;return e.id!==(null===(r=t)||void 0===r?void 0:r.id)})).slice(0);return t=Object.assign(t,{slides_html:t.need_placeholders?Array.from(t.slides_html).map((e=>Kr(e))):Array.from(t.slides_html),slides_duration:t.slides_duration,slidesLoaded:!0,is_opened:Ar(t)}),r.push(t),r})),(e=>{e.START_LOADING="startLoading",e.END_LOADING="endLoading",e.CLOSE_STORY_READER="closeStoryReader"})(tn||(tn={}));class rn{}class nn{}const sn=e=>{switch(e){case de.default:return Fr.getState();case de.favorite:return Mr.getState();case de.onboarding:return Pr.getState()}return[]},on=()=>Lr.getState().cache.filter((e=>'font-face'===e.type)),an=async(e,t)=>{let r=await en({id:e});var n,s;j(e)&&O(r)&&(e=null===(n=r.find((e=>'story'===e.ref)))||void 0===n||null===(s=n.body)||void 0===s?void 0:s.id,await qr({ids:[e]}));let o=Er.getState().find((t=>t.id===e));if(void 0!==o){let e={windowReferer:le.default,listType:de.default,id:o.id,storyContext:jr.getState(),storyList:[o],hasShare:Lr.getState().share};return t.openReader(e),!0}return!1};class ln extends n{constructor(e,t){return super(),this._callbacks={},this.StoriesList=class extends n{constructor(e,t,r){super(),this.storyListWidget=void 0,this.appearanceManager=void 0}async reload(e){var t;void 0===e&&(e={needLoader:!0});let r=!0;!1===(null===(t=e)||void 0===t?void 0:t.needLoader)&&(r=!1);try{return await ln.instance._loadStoriesList(this.storyListWidget,this.appearanceManager,this,!1,r),!0}catch(e){throw Error(e)}}},this._appearanceManager=null,this.storyListInstance=null,this._storyReaderInstance=null,this.storyReaderInstancePromise=null,this.storyReaderInstancePromiseResolver=null,this._goodsWidgetInstance=null,this._storyReaderNeedFirstRender=null,this._storyReaderDetachComponent=null,this._storyReaderWidgetLoaded=async e=>{this.completeInitStoryReader(e,on()),null!=this.storyReaderInstancePromiseResolver&&this.storyReaderInstancePromiseResolver(e)},this._storyFavoriteReaderInstance=null,this.storyFavoriteReaderInstancePromise=null,this._loadedStoriesLength={defaultListLength:0,favoriteListLength:0},this._loadStoriesList=async(e,t,r)=>{void 0===r&&(r=!0);let n=!0===t.commonOptions.hasFavorite&&r;await Gr({defaultList:!0,onboardingList:!1,favoriteList:n})},this._storiesListWidgetLoaded=async(e,t)=>{let r=t.storiesListOptions;C({source:Fr,clock:Fr,target:b((t=>{this._loadedStoriesLength.defaultListLength=t.length,e.setStories({listType:de.default,storyList:t})}))}),t.commonOptions.hasFavorite&&C({source:Mr,clock:Mr,target:b((async t=>{this._loadedStoriesLength.favoriteListLength=t.length,e.setStories({listType:de.favorite,storyList:t}),(await this.getStoryFavoriteReaderInstance()).setStories({listType:de.favorite,storyList:t})}))}),await this._loadStoriesList(e,t,!0);let n=on();return e.setFonts(n),tr.getState(),e.setCallbacks({handleClickOnStoryDeepLink:e=>{((e,t,r)=>{if("sendBeacon"in navigator){var n,s;let i=`${o=Sr,o.replace(/\/$/,"")}/${P(e)}?access_token=${tr.getState().apiKey}&session_id=${null===(n=Lr.getState())||void 0===n||null===(s=n.session)||void 0===s?void 0:s.id}`,a=new FormData;Object.keys(t).forEach((e=>{hr.convertModelToFormData(a,t[e],e)})),navigator.sendBeacon(i,a),r()}else wr.post(e,t).then((()=>r()),(()=>r()));var o})('session/update',{data:[[1,0,e.id,0,0]]},hr.createFunctionWithTimeout((()=>{e.isDeeplink&&e.url&&(null!=r&&r.handleStoryLinkClick&&B(null==r?void 0:r.handleStoryLinkClick)?null==r||r.handleStoryLinkClick(e):window.open(e.url,'_self'))})))},handleClickOnStory:()=>{},handleFlushThumbViews:e=>{Rr(e)},handleClickOnStoryInternal:e=>this.handleClickOnStoryInternal(e)}),e.on('clickOnFavoriteCellInternal',(async e=>{let t={...e,storyList:sn(de.favorite)};(await this.getStoryFavoriteReaderInstance()).openReader(t)})),this.storyListInstance=e,{storyListWidget:e,appearanceManager:t}},this.SharePage=class extends n{constructor(e,t,r,n){return super(),this.storyReaderWidget=void 0,this.appearanceManager=void 0,this.options={},r&&(this.options=r),ln.instance._showSharePage(e,t,this.options,this).then((e=>{let{storyReaderInstance:t,appearanceManager:r}=e;this.storyReaderWidget=t,this.appearanceManager=r})),this}async closeStoryReader(){this.storyReaderWidget&&(ln.instance.closeGoodsWidget(),this.storyReaderWidget.closeReader())}},this._showSharePage=async(e,t,r,n)=>{setTimeout((()=>{n.emit(tn.START_LOADING),B(r.handleStartLoading)&&r.handleStartLoading()}));let s=!1,o=null;try{o=await this.initStoryReader(t,on(),{closeOnLastSlideByTimer:!1,recycleStoriesList:!1}),o.on('closeStoryReader',(()=>{if(B(r.handleStoryReaderClose)||n.listenerCount(tn.CLOSE_STORY_READER)>0)try{B(r.handleStoryReaderClose)&&r.handleStoryReaderClose(),n.emit(tn.CLOSE_STORY_READER)}catch(e){console.error(e)}else{let e=window.location!=window.parent.location?window.parent.location:window.location;window.open(`${e.protocol}//${e.host}`,'_parent')}})),s=await an(e,o)}catch(e){}return n.emit(tn.END_LOADING,{result:s}),B(r.handleStopLoading)&&r.handleStopLoading(s),{storyReaderInstance:o,appearanceManager:t,result:s}},ln.instance?console.warn("StoryManager singleton is created multiple times\nuse IAS.StoryManager.getInstance() instead"):(rr(e),e.placeholders&&pr(e.placeholders),t&&I(t)&&(this._callbacks=t),ln.instance=this),ln.instance}destructor(){delete ln.instance}set storyLinkClickHandler(e){B(e)&&(this._callbacks.storyLinkClickHandler=e)}set openGoodsWidgetHandler(e){B(e)&&(this._callbacks.openGoodsWidgetHandler=e)}get openGoodsWidgetHandler(){return this._callbacks.openGoodsWidgetHandler}static getInstance(){if(!ln.instance)throw new Error("Error - use new IAS.StoryManager(). For first init - with config");return ln.instance}setTags(e){O(e)&&nr({tags:e})}getTags(){var e;return null!==(e=tr.getState().tags)&&void 0!==e?e:[]}setUserId(e){(j(e)||'number'==typeof e)&&sr({userId:e})}setLang(e){j(e)&&ir({lang:e})}setPlaceholders(e){I(e)&&or({placeholders:e})}setIsSandbox(e){ar({isSandbox:Boolean(e)})}setApiKey(e){lr({apiKey:e})}get appearanceManager(){return this._appearanceManager}set appearanceManager(e){this._appearanceManager=e}set storyReaderNeedFirstRender(e){this._storyReaderNeedFirstRender=e}set storyReaderDetachComponent(e){this._storyReaderDetachComponent=e}get storyReaderInstance(){return this._storyReaderInstance}async getStoryReaderInstance(){return new Promise((e=>{null==this._storyReaderInstance?(null==this.storyReaderInstancePromise&&(null!=this._storyReaderNeedFirstRender&&this._storyReaderNeedFirstRender(!0),this.storyReaderInstancePromise=new Promise((e=>this.storyReaderInstancePromiseResolver=e))),this.storyReaderInstancePromise.then((t=>{this._storyReaderInstance=t,e(t)}))):e(this._storyReaderInstance)}))}async getStoryFavoriteReaderInstance(){return new Promise(((e,t)=>{null===this._storyFavoriteReaderInstance?null!==this.storyFavoriteReaderInstancePromise?this.storyFavoriteReaderInstancePromise.then((t=>{this._storyFavoriteReaderInstance=t,e(t)})):t('_storyFavoriteReaderInstance not inited yet'):e(this._storyFavoriteReaderInstance)}))}async handleClickOnStoryInternal(e){console.log('clickOnStoryInternalEvent 3'),console.log('[handleClickOnStoryInternal] -- open Reader',e);let t=jr.getState(),r=null!==t;t&&Hr.getState().length>0&&t.ids!==Hr.getState()&&(r=!1);let n=sn(e.listType).find((t=>t.id===e.id));r||!n||n.slidesLoaded?r?n&&n.slidesLoaded||await Yr({ids:[e.id]}):Hr.getState().length&&await qr({ids:Hr.getState()}):await Zr({ids:Hr.getState(),id:e.id});let s={...e,storyContext:jr.getState(),storyList:sn(e.listType),hasShare:Lr.getState().share},o=await this.getStoryReaderInstance();console.log('clickOnStoryInternalEvent 4',o),o.openReader(s);let i=Hr.getState();i.length>0&&await Yr({ids:i}),o.setStories({listType:e.listType,storyList:sn(e.listType)})}completeInitStoryReader(e,t,r){return e.setFonts(t),e.setCallbacks({}),e.on('storyOpenedInternal',(e=>{var t;return null===(t=this.storyListInstance)||void 0===t?void 0:t.onStoryOpened(e)})),e.on('setStoryOpened',(async t=>{if(!A(Lr.getState().user_key)){let e=`u/${Lr.getState().user_key}/s_opened`,r=await this.localStorageGetArray(e);O(r)||(r=[]),r.push(t.data.id),r=[...new Set(r)],this.localStorageSetArray(e,r)}$r({id:t.data.id}),e.rpcCb(t.cb,{requestId:t.id,success:!0,data:t.data,err:''})})),e.on('updateStoryFavorite',(async t=>{let r=!1,n={favorite:void 0},s='';try{let e=await wr.post(`story-favorite/${t.data.id}`,{value:t.data.favorite});void 0!==e.data.favorite?(r=!0,n.favorite=Boolean(e.data.favorite),Nr({id:t.data.id,favorite:n.favorite}),Xr(!1===n.favorite?{listType:de.favorite,storyList:Mr.getState().filter((e=>e.id!==t.data.id))}:{listType:de.favorite,storyList:[...Mr.getState(),...Er.getState().filter((e=>e.id===t.data.id))]})):s='response.data.favorite is undefined'}catch(e){s=e.toString()}e.rpcCb(t.cb,{requestId:t.id,success:r,data:n,err:s})})),e.on('updateStoryLike',(async t=>{let r=!1,n={like:void 0},s='';try{let e=await wr.post(`story-like/${t.data.id}`,{value:t.data.like});void 0!==e.data.like?(r=!0,n.like=e.data.like):s='response.data.like is undefined'}catch(e){s=e.toString()}e.rpcCb(t.cb,{requestId:t.id,success:r,data:n,err:s})})),e.on('getStorySharePath',(async t=>{let r=!1,n={url:void 0},s='';try{let e=await wr.get(`story-share/${t.data.id}`);void 0!==e.data.url?(r=!0,n.url=e.data.url,Wr({id:t.data.id,url:n.url})):s='response.data.url is undefined'}catch(e){s=e.toString()}e.rpcCb(t.cb,{requestId:t.id,success:r,data:n,err:s})})),e.on('updateStoriesStat',(async t=>{let r=!1,n={},s='';try{let e=await wr.post("session/update",t.data);void 0!==e.data?(r=!0,n=e.data):s='response.data is undefined'}catch(e){s=e.toString()}e.rpcCb(t.cb,{requestId:t.id,success:r,data:n,err:s})})),e.on('clickOnButton',(e=>{if(B(this._callbacks.storyLinkClickHandler)||this.listenerCount(ce.CLICK_ON_STORY)>0){let t={src:'storyReader',srcRef:'default',data:e};try{B(this._callbacks.storyLinkClickHandler)&&this._callbacks.storyLinkClickHandler(t),this.emit(ce.CLICK_ON_STORY,t)}catch(e){console.error(e)}}else window.open(e.url,'_self')})),e.on('clickOnSwipeUpGoods',(t=>{e&&(this._goodsWidgetInstance=new rn(this,appearanceManager,e,t),this._goodsWidgetInstance.once('close',(t=>{this._goodsWidgetInstance=null,e&&e.closeGoodsWidget(t)})))})),e.on('openStoryReader',(()=>{})),e.on('closeStoryReader',(()=>{var e;null===(e=ln.instance)||void 0===e||e.closeGoodsWidget(),null!=this._storyReaderDetachComponent&&this._storyReaderDetachComponent(),this.storyReaderInstancePromise=null,this._storyReaderInstance=null})),e}async initStoryFavoriteReader(e,t){if(null!==this._storyFavoriteReaderInstance)return this._storyFavoriteReaderInstance;let r=new nn('body',{});return await r.init('body',{options:e.storyFavoriteReaderOptions,storiesListOptions:e.storiesListOptions}),r.setFonts(t),r.setCallbacks({}),r.on('closeReader',(()=>{try{window.focus()}catch(e){console.error(e)}})),r.on('clickOnStoryInternal',(e=>this.handleClickOnStoryInternal(e))),(await this.getStoryReaderInstance()).on('openStoryReader',(e=>r.openStoryReader(e))),(await this.getStoryReaderInstance()).on('closeStoryReader',(e=>r.closeStoryReader(e))),r}async showOnboardingStories(e,t){let r=on();await Gr({defaultList:!1,onboardingList:!0,favoriteList:!1,onboardingTags:t}),null===this.storyReaderInstancePromise&&(this.storyReaderInstancePromise=this.initStoryReader(e,r));let n=Pr.getState();if(n.length>0){let e={windowReferer:le.default,listType:de.onboarding,id:n[0].id};return await this.handleClickOnStoryInternal(e),!0}return!1}async showStory(e,t,r){on();let n=await this.getStoryReaderInstance();return await an(e,n)}async closeStoryReader(){if(null===this.storyReaderInstancePromise)return!1;let e=await this.getStoryReaderInstance();this.closeGoodsWidget(),e.closeReader()}closeGoodsWidget(){this._goodsWidgetInstance&&(this._goodsWidgetInstance.close(),this._goodsWidgetInstance=null)}}let dn;var cn;ln.instance=void 0,(e=>{e.CSS="text/css",e.JS="text/javascript",e.HTML="text/html"})(dn||(dn={})),(e=>{e.START_LOADER="startLoader",e.END_LOADER="endLoader"})(cn||(cn={}));class un extends n{get loaderContainer(){return this._loaderContainer}setCallbacks(e){this.callbacks=e}constructor(){super(),this.widgetId=void 0,this.callbacks={},this.obj=void 0,this._loaderContainer=null}async init(e,t){}loading(e,t){}startLoader(){let e=(e=>{let t=window.isSecureContext;return void 0===t&&'https:'===window.location.protocol&&(t=!0),t?e:e.replace(/^https:\/\//,'http://')})(`${process.env.BASE_URL}/v${process.env.BUILD_VERSION}/dist/images/loader.gif`);this.loaderContainer.style.background=`url("${e}") center center no-repeat transparent`}stopLoader(){this.loaderContainer.style.background='none'}getGeneratedPageURL(e){let{html:t,css:r,js:n}=e,s='',o='';null!==r&&(s=`<link rel="stylesheet" type="text/css" href="${q(r,dn.CSS)}" />`),null!==n&&(o=`<script >${q(n,dn.JS)}</script>`);let i=`\n    <html>\n      <head>\n        <meta name="viewport" content="width=device-width, initial-scale=1">\n        ${s}\n        ${o}\n      </head>\n      <body>\n        ${t||''}\n      </body>\n    </html>\n  `;null!==r&&(s=`<style>${r}</style>`),null!==n&&(o=`<script>${n}</script>`);let a=`\n    <html>\n      <head>\n        <meta name="viewport" content="width=device-width, initial-scale=1">\n        ${s}\n        ${o}\n      </head>\n      <body>\n        ${t||''}\n      </body>\n    </html>\n        `;return{src:q(i,dn.HTML),srcdoc:a}}getWidgetDocument(e){return''}destroy(e,t){var r=un.RPC[e];r||r.destroy(),obj.innerHTML=''}}un.count=0,un.RPC={};class pn{}pn.version='v1',pn.MD5=e=>{var t=(e,t)=>{var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r},r=(e,r,n,s,o,i)=>t(((e,t)=>e<<t|e>>>32-t)(t(t(r,e),t(s,i)),o),n),n=(e,t,n,s,o,i,a)=>r(t&n|~t&s,e,t,o,i,a),s=(e,t,n,s,o,i,a)=>r(t&s|n&~s,e,t,o,i,a),o=(e,t,n,s,o,i,a)=>r(t^n^s,e,t,o,i,a),i=(e,t,n,s,o,i,a)=>r(n^(t|~s),e,t,o,i,a);return(e=>{for(var t,r="0123456789abcdef",n="",s=0,o=e.length;s<o;s++)t=e.charCodeAt(s),n+=r.charAt(t>>>4&15)+r.charAt(15&t);return n})((e=>(e=>{for(var t="",r=0,n=32*e.length;r<n;r+=8)t+=String.fromCharCode(e[r>>5]>>>r%32&255);return t})(((e,r)=>{var a,l,d,c,u=1732584193,p=-271733879,h=-1732584194,f=271733878;e[r>>5]|=128<<r%32,e[14+(r+64>>>9<<4)]=r;for(var g=0,y=e.length;g<y;g+=16)a=u,l=p,d=h,c=f,u=n(u,p,h,f,e[g+0],7,-680876936),f=n(f,u,p,h,e[g+1],12,-389564586),h=n(h,f,u,p,e[g+2],17,606105819),p=n(p,h,f,u,e[g+3],22,-1044525330),u=n(u,p,h,f,e[g+4],7,-176418897),f=n(f,u,p,h,e[g+5],12,1200080426),h=n(h,f,u,p,e[g+6],17,-1473231341),p=n(p,h,f,u,e[g+7],22,-45705983),u=n(u,p,h,f,e[g+8],7,1770035416),f=n(f,u,p,h,e[g+9],12,-1958414417),h=n(h,f,u,p,e[g+10],17,-42063),p=n(p,h,f,u,e[g+11],22,-1990404162),u=n(u,p,h,f,e[g+12],7,1804603682),f=n(f,u,p,h,e[g+13],12,-40341101),h=n(h,f,u,p,e[g+14],17,-1502002290),p=n(p,h,f,u,e[g+15],22,1236535329),u=s(u,p,h,f,e[g+1],5,-165796510),f=s(f,u,p,h,e[g+6],9,-1069501632),h=s(h,f,u,p,e[g+11],14,643717713),p=s(p,h,f,u,e[g+0],20,-373897302),u=s(u,p,h,f,e[g+5],5,-701558691),f=s(f,u,p,h,e[g+10],9,38016083),h=s(h,f,u,p,e[g+15],14,-660478335),p=s(p,h,f,u,e[g+4],20,-405537848),u=s(u,p,h,f,e[g+9],5,568446438),f=s(f,u,p,h,e[g+14],9,-1019803690),h=s(h,f,u,p,e[g+3],14,-187363961),p=s(p,h,f,u,e[g+8],20,1163531501),u=s(u,p,h,f,e[g+13],5,-1444681467),f=s(f,u,p,h,e[g+2],9,-51403784),h=s(h,f,u,p,e[g+7],14,1735328473),p=s(p,h,f,u,e[g+12],20,-1926607734),u=o(u,p,h,f,e[g+5],4,-378558),f=o(f,u,p,h,e[g+8],11,-2022574463),h=o(h,f,u,p,e[g+11],16,1839030562),p=o(p,h,f,u,e[g+14],23,-35309556),u=o(u,p,h,f,e[g+1],4,-1530992060),f=o(f,u,p,h,e[g+4],11,1272893353),h=o(h,f,u,p,e[g+7],16,-155497632),p=o(p,h,f,u,e[g+10],23,-1094730640),u=o(u,p,h,f,e[g+13],4,681279174),f=o(f,u,p,h,e[g+0],11,-358537222),h=o(h,f,u,p,e[g+3],16,-722521979),p=o(p,h,f,u,e[g+6],23,76029189),u=o(u,p,h,f,e[g+9],4,-640364487),f=o(f,u,p,h,e[g+12],11,-421815835),h=o(h,f,u,p,e[g+15],16,530742520),p=o(p,h,f,u,e[g+2],23,-995338651),u=i(u,p,h,f,e[g+0],6,-198630844),f=i(f,u,p,h,e[g+7],10,1126891415),h=i(h,f,u,p,e[g+14],15,-1416354905),p=i(p,h,f,u,e[g+5],21,-57434055),u=i(u,p,h,f,e[g+12],6,1700485571),f=i(f,u,p,h,e[g+3],10,-1894986606),h=i(h,f,u,p,e[g+10],15,-1051523),p=i(p,h,f,u,e[g+1],21,-2054922799),u=i(u,p,h,f,e[g+8],6,1873313359),f=i(f,u,p,h,e[g+15],10,-30611744),h=i(h,f,u,p,e[g+6],15,-1560198380),p=i(p,h,f,u,e[g+13],21,1309151649),u=i(u,p,h,f,e[g+4],6,-145523070),f=i(f,u,p,h,e[g+11],10,-1120210379),h=i(h,f,u,p,e[g+2],15,718787259),p=i(p,h,f,u,e[g+9],21,-343485551),u=t(u,a),p=t(p,l),h=t(h,d),f=t(f,c);return[u,p,h,f]})((e=>{var t,r,n=Array(e.length>>2);for(t=0,r=n.length;t<r;t++)n[t]=0;for(t=0,r=8*e.length;t<r;t+=8)n[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return n})(e),8*e.length)))((e=>{for(var t,r,n="",s=-1,o=e.length;++s<o;)t=e.charCodeAt(s),r=s+1<o?e.charCodeAt(s+1):0,55296<=t&&t<=56319&&56320<=r&&r<=57343&&(t=65536+((1023&t)<<10)+(1023&r),s++),t<=127?n+=String.fromCharCode(t):t<=2047?n+=String.fromCharCode(192|t>>>6&31,128|63&t):t<=65535?n+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):t<=2097151&&(n+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return n})(e)))},pn.extend=(e,t,r)=>{for(let n in t)t.hasOwnProperty(n)&&(r||void 0===e[n])&&(e[n]=t[n]);return e},pn._protocol='https:',pn._base_domain='',pn.Widget=un,pn.xdConnectionCallbacks=void 0,pn.init=void 0,pn._apiKey=void 0,pn.userId=void 0,pn.XDM=void 0,pn._domain=void 0,pn._path=void 0,pn.xdReady=void 0,pn.Observer=void 0,pn._rootId=void 0,pn.Util=void 0,pn.xdConnectionCallbacks?setTimeout((()=>{for(var e;e=pn.xdConnectionCallbacks.pop();)e()}),0):(pn.extend(pn,{version:1,_apiKey:null,_session:null,_domain:{main:pn._protocol+'//sdk-narrator.kiozk.ru/',api:pn._protocol+'//api-narrator.kiozk.ru/'},_path:{login:'authorize',proxy:'fxdm_oauth_proxy.html'},_rootId:'ias_api_transport',_nameTransportPath:'',xdReady:!1}),pn.init=e=>{if(pn._apiKey=null,!e.apiKey)throw Error('IAS_OLD.init() called without an apiKey');return pn._apiKey=e.apiKey,pn.userId=e.userId,!0});const hn=R("serverFxDomainWidgetStoriesList"),fn=R("clientFxDomainWidgetStoriesList");let gn,yn,mn={serverFxDomain:hn,clientFxDomain:fn},vn=fn.effect("RpcMessage"),Sn=fn.effect("setStories"),wn=fn.effect("setFonts"),Ln=hn.effect("RpcMessageOnServer"),bn=hn.effect("widgetLoaded"),kn=hn.effect("clickOnStoryInternalEvent"),Rn=hn.effect("flushThumbViewsEvent"),_n=hn.effect("clickOnStoryEvent"),Cn=hn.effect("clickOnStoryDeepLinkEvent");(e=>{e[e.REQUEST=0]="REQUEST",e[e.RESPONSE=1]="RESPONSE"})(gn||(gn={})),(e=>{e[e.SUCCESS=0]="SUCCESS",e[e.ERROR=1]="ERROR"})(yn||(yn={}));let On=0;class In{constructor(){this.id=++On,this.rs=()=>{},this.rj=()=>{},this.req=void 0,xn.set(this.id,this);let e=new Promise(((e,t)=>{this.rs=e,this.rj=t}));e.finally((()=>{xn.delete(this.id)})).catch((()=>{})),this.req=e}}const xn=new Map,En=new Map;class Tn{constructor(e){this.webview=e,this._destructor=void 0,this.onMessageCb=null,e.onMessage=e=>this.messageListener(e),this._destructor=()=>{}}destructor(){this._destructor()}messageListener(e){console.log("messageListener server",{"event.nativeEvent.data":e.nativeEvent.data,this:this});let t={};try{t=JSON.parse(e.nativeEvent.data)}catch(e){console.error(e)}B(this.onMessageCb)&&(console.log("messageListener server 3",{data:t}),this.onMessageCb(t))}sendMessage(e){console.log('sendMessage from server',{message:e});try{this.webview.postMessage(JSON.stringify(e))}catch(e){console.log(e)}}set onmessage(e){this.onMessageCb=e}}Ln.use((async e=>[e+" :125"])),window.RpcMessage=vn,console.log('changed');class Fn extends un{constructor(e){super(),this.appearanceManager=e,this.storiesListOptions=void 0,this.rpc=void 0,this.frameName='',this.storiesListOptions={...e.storiesListOptions,hasFavorite:e.commonOptions.hasFavorite},this.widgetId=++un.count,bn.use((()=>{this.emit("widgetLoaded")})),kn.use((e=>{var t,r;console.log('clickOnStoryInternalEvent 1'),B(null===(t=this.callbacks)||void 0===t?void 0:t.handleClickOnStoryInternal)&&(console.log('clickOnStoryInternalEvent 2'),null===(r=this.callbacks)||void 0===r||r.handleClickOnStoryInternal(e))})),Rn.use((e=>{var t,r;B(null===(t=this.callbacks)||void 0===t?void 0:t.handleFlushThumbViews)&&(null===(r=this.callbacks)||void 0===r||r.handleFlushThumbViews(e))})),_n.use((e=>{var t,r;B(null===(t=this.callbacks)||void 0===t?void 0:t.handleClickOnStory)&&(null===(r=this.callbacks)||void 0===r||r.handleClickOnStory(e))})),Cn.use((e=>{var t,r;B(null===(t=this.callbacks)||void 0===t?void 0:t.handleClickOnStoryDeepLink)&&(null===(r=this.callbacks)||void 0===r||r.handleClickOnStoryDeepLink(e))}))}get widgetSrcFile(){return ee}get widgetEntrypoint(){return`\n      <head>\n        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, shrink-to-fit=no">\n        <style type="text/css">${te}</style>\n      </head>\n      <div id="app"><div id="_app"></div></div>\n      <script type="text/javascript">${ee}</script>\n      <script type="text/javascript">\n        window.storiesList = (function () {\n          var self = window.storiesList || {};\n          self._e = self._e || [];\n          self.ready = self.ready || function (f) {self._e.push(f);};\n          return self;\n        }());\n\n        window.storiesList.ready(function () {\n          window.storiesList.init(${JSON.stringify(this.storiesListOptions)});\n        });\n\n      </script>`}async mount(e,t){let r={allowTransparency:!0,overflowTouch:!1,backgroundColor:t.layout.backgroundColor,width:'auto',height:0,pageUrl:'',startHeight:0};r.startHeight=t.layout.height?t.layout.height:t.title?50+t.card.height+t.topPadding+t.bottomPadding+t.bottomMargin:t.card.height+t.topPadding+t.bottomPadding+t.bottomMargin,this.createView(e,r)}createView(e,t){'body'===e||document.querySelector(e)}extend(e,t){for(var r in t)e[r]&&'object'==typeof e[r]?this.extend(e[r],t[r]):e[r]=t[r]}genKey(){for(var e='',t=0;t<5;t++)e+=Math.ceil(15*Math.random()).toString(16);return e}mountView(e,t,r){this.frameName='fXD'+this.genKey();let n=document.createElement('div');n.innerHTML='<iframe name="'+this.frameName+'" '+(r||'')+'></iframe>';let s=n.firstChild,o=this;return setTimeout((()=>{s.frameBorder='0',t&&o.extend(s,t),e.insertBefore(s,e.firstChild)}),0),s}get containerOptions(){var e,t,r,n;let s={storiesHeight:(null===(e=this.storiesListOptions.card)||void 0===e?void 0:e.height)||70,storiesLayoutHeight:(null===(t=this.storiesListOptions.layout)||void 0===t?void 0:t.height)||0,storiesBackgroundColor:(null===(r=this.storiesListOptions.layout)||void 0===r?void 0:r.backgroundColor)||'transparent',storiesListTopPadding:this.storiesListOptions.topPadding||20,storiesListBottomPadding:this.storiesListOptions.bottomPadding||20,storiesListBottomMargin:this.storiesListOptions.bottomMargin||20,storiesTitle:(null===(n=this.storiesListOptions.title)||void 0===n?void 0:n.content)||'',extraCss:this.storiesListOptions.extraCss||null,extraJs:null},o={maxWidth:0,startHeight:70,minWidth:150,storiesHeight:70,scrolling:!1,hidden:!1};o.startHeight=s.storiesLayoutHeight?parseFloat(s.storiesLayoutHeight):s.storiesTitle?50+parseFloat(s.storiesHeight||o.storiesHeight)+parseFloat(s.storiesListTopPadding)+parseFloat(s.storiesListBottomPadding)+parseFloat(s.storiesListBottomMargin):parseFloat(s.storiesHeight||o.storiesHeight)+parseFloat(s.storiesListTopPadding)+parseFloat(s.storiesListBottomPadding)+parseFloat(s.storiesListBottomMargin);let i=parseInt(0,10),a=i?Math.max(o.minWidth,Math.min(1e4,i))+'px':'100%',l={style:{}};return l.style.width=a,l.style.overflow='hidden',l.style.height=(o.startHeight||200)+'px',{style:{position:'relative',height:parseInt(l.style.height),width:l.style.width}}}get viewOptions(){var e,t,r,n;this.frameName||(this.frameName='fXD'+this.genKey());let s={allowTransparency:!0,overflowTouch:!1,backgroundColor:this.storiesListOptions.layout.backgroundColor,width:0,height:0,pageUrl:'',startHeight:0},o={storiesHeight:(null===(e=this.storiesListOptions.card)||void 0===e?void 0:e.height)||70,storiesLayoutHeight:(null===(t=this.storiesListOptions.layout)||void 0===t?void 0:t.height)||0,storiesBackgroundColor:(null===(r=this.storiesListOptions.layout)||void 0===r?void 0:r.backgroundColor)||'transparent',storiesListTopPadding:this.storiesListOptions.topPadding||20,storiesListBottomPadding:this.storiesListOptions.bottomPadding||20,storiesListBottomMargin:this.storiesListOptions.bottomMargin||20,storiesTitle:(null===(n=this.storiesListOptions.title)||void 0===n?void 0:n.content)||'',extraCss:this.storiesListOptions.extraCss||null,extraJs:null},i={maxWidth:0,startHeight:70,storiesHeight:70,minWidth:150,scrolling:!1,hidden:!1};i.startHeight=o.storiesLayoutHeight?parseFloat(o.storiesLayoutHeight):o.storiesTitle?50+parseFloat(o.storiesHeight||i.storiesHeight)+parseFloat(o.storiesListTopPadding)+parseFloat(o.storiesListBottomPadding)+parseFloat(o.storiesListBottomMargin):parseFloat(o.storiesHeight||i.storiesHeight)+parseFloat(o.storiesListTopPadding)+parseFloat(o.storiesListBottomPadding)+parseFloat(o.storiesListBottomMargin);let a=parseInt(0,10),l=a?Math.max(i.minWidth,Math.min(1e4,a))+'px':'100%',d={src:'',id:'iaswidget'+this.widgetId,allowtransparency:Boolean(s.allowTransparency).toString(),style:{backgroundColor:s.backgroundColor||'transparent'}};return d.width=-1!=l.indexOf('%')?l:parseInt(l)||l,d.height=i.startHeight||'100%',d.style.width='1px',d.style.minWidth='100%',d.style["*width"]='100%',d.scrolling='no',d.style.overflow='hidden',{style:{width:'100%',height:d.height},source:{html:this.widgetEntrypoint,baseUrl:'https://sdk.inappstory.com'}}}createRpcServer(e){U(mn,new Tn(e))}async init(e,t){var r,n,s,o;let i={storiesHeight:(null===(r=t.card)||void 0===r?void 0:r.height)||70,storiesLayoutHeight:(null===(n=t.layout)||void 0===n?void 0:n.height)||0,storiesBackgroundColor:(null===(s=t.layout)||void 0===s?void 0:s.backgroundColor)||'transparent',storiesListTopPadding:t.topPadding||20,storiesListBottomPadding:t.bottomPadding||20,storiesListBottomMargin:t.bottomMargin||20,storiesTitle:(null===(o=t.title)||void 0===o?void 0:o.content)||'',extraCss:t.extraCss||null,extraJs:null},a={allowTransparency:!0,overflowTouch:!1};a.backgroundColor=i.storiesBackgroundColor;var l={startHeight:70,minWidth:150,storiesHeight:70};l.startHeight=i.storiesLayoutHeight?parseFloat(i.storiesLayoutHeight):i.storiesTitle?50+parseFloat(i.storiesHeight||l.storiesHeight)+parseFloat(i.storiesListTopPadding)+parseFloat(i.storiesListBottomPadding)+parseFloat(i.storiesListBottomMargin):parseFloat(i.storiesHeight||l.storiesHeight)+parseFloat(i.storiesListTopPadding)+parseFloat(i.storiesListBottomPadding)+parseFloat(i.storiesListBottomMargin),document.querySelector('body'),document.querySelector('html');let d=this,c={event:(e,t)=>{d.emit(e,t)}};return i.extraJs=null,a.no_finish_loading=!0,this._init(e,a,i,t,c,l,(()=>{}),null,null)}getWidgetDocument(e){let t=`${process.env.BASE_URL}/v${process.env.BUILD_VERSION}/dist/js/storiesList.js`;return t=ee,`\n        <script type="text/javascript" src="${t}"></script>\n        <div id="app"><div id="_app"></div></div>\n        <script type="text/javascript">\n          window.storiesList.init(${JSON.stringify(e)});\n        </script>\n`}async _init(e,t,r,n,s,o,i,a,l){s.event=(e,t)=>this.emit(e,t);let d=super._init(e,t,r,n,s,o,((e,t,r)=>{this.rpc=r}),a,l);return this.on('clickOnStoryInternal',(e=>{var t,r;B(null===(t=this.callbacks)||void 0===t?void 0:t.handleClickOnStoryInternal)&&(null===(r=this.callbacks)||void 0===r||r.handleClickOnStoryInternal(e))})),this.on('flushThumbViews',(e=>{var t,r;B(null===(t=this.callbacks)||void 0===t?void 0:t.handleFlushThumbViews)&&(null===(r=this.callbacks)||void 0===r||r.handleFlushThumbViews(e))})),this.on('clickOnStory',(e=>{var t,r;B(null===(t=this.callbacks)||void 0===t?void 0:t.handleClickOnStory)&&(null===(r=this.callbacks)||void 0===r||r.handleClickOnStory(e))})),this.on('clickOnStoryDeepLink',(e=>{var t,r;B(null===(t=this.callbacks)||void 0===t?void 0:t.handleClickOnStoryDeepLink)&&(null===(r=this.callbacks)||void 0===r||r.handleClickOnStoryDeepLink(e))})),this.on('syncStore',(()=>{})),d}onStoryOpened(e){this.rpc.callMethod('onStoryOpened',e)}syncStoreHandle(e){this.rpc.callMethod('onSyncStore',e)}setStories(e){Sn(e)}setFonts(e){wn(e)}}let Mn,Pn;(e=>{e.LEFT="left",e.RIGHT="right"})(Mn||(Mn={})),(e=>{e.FLAT="flat",e.COVER="cover",e.CUBE="cube"})(Pn||(Pn={}));const Dn={closeButtonPosition:Mn.RIGHT,scrollStyle:Pn.FLAT,loader:{default:{color:null,accentColor:null},custom:null},recycleStoriesList:!1,closeOnLastSlideByTimer:!0},An={hasFavorite:!1,hasLike:!1,hasShare:!1},Hn=R("serverFxDomainWidgetStory"),Nn=R("clientFxDomainWidgetStory");let Wn={serverFxDomain:Hn,clientFxDomain:Nn},$n=Nn.effect("RpcMessage"),Bn=Nn.effect("setStories"),jn=Nn.effect("setFonts"),qn=Nn.effect("onOpenReader");Nn.effect("onCloseReader");let Un,Gn,Vn=Hn.effect("RpcMessageOnServer"),Kn=Hn.effect("widgetLoaded"),Jn=Hn.effect("onReaderOpened"),zn=Hn.effect("onReaderClosed");Vn.use((async e=>[e+" :125"])),window.RpcMessage=$n;class Xn extends un{constructor(e,t){void 0===t&&(t={}),super(),this.appearanceManagerGetter=e,this.overrideStoryReaderOptions=t,this.rpc=void 0,this.frameName='',this.widgetId=++un.count,Kn.use((()=>{this.emit("widgetLoaded")})),Jn.use((e=>{this.emit('openStoryReader',e)})),zn.use((e=>{this.emit('closeStoryReader',e)}))}get storyReaderOptions(){let e=this.appearanceManagerGetter();return null!=e?{...e.storyReaderOptions,appearanceCommon:e.commonOptions,...this.overrideStoryReaderOptions}:{...Dn,appearanceCommon:An,...this.overrideStoryReaderOptions}}get widgetSrcFile(){return oe}get widgetEntrypoint(){return`\n      <head>\n        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, shrink-to-fit=no">\n        <style type="text/css">${ie}</style>\n      </head>\n      <div id="app"><div id="_app"></div></div>\n      <script type="text/javascript">${oe}</script>\n      <script type="text/javascript">\n        window.storiesList = (function () {\n          var self = window.storiesList || {};\n          self._e = self._e || [];\n          self.ready = self.ready || function (f) {self._e.push(f);};\n          return self;\n        }());\n\n        window.storyReader.ready(function () {\n          window.storyReader.init(${JSON.stringify(this.storyReaderOptions)});\n        });\n\n      </script>`}async mount(e,t){let r={allowTransparency:!0,overflowTouch:!1,backgroundColor:t.layout.backgroundColor,width:'auto',height:0,pageUrl:'',startHeight:0};r.startHeight=t.layout.height?t.layout.height:t.title?50+t.card.height+t.topPadding+t.bottomPadding+t.bottomMargin:t.card.height+t.topPadding+t.bottomPadding+t.bottomMargin,this.createView(e,r)}createView(e,t){'body'===e||document.querySelector(e)}extend(e,t){for(var r in t)e[r]&&'object'==typeof e[r]?this.extend(e[r],t[r]):e[r]=t[r]}genKey(){for(var e='',t=0;t<5;t++)e+=Math.ceil(15*Math.random()).toString(16);return e}mountView(e,t,r){this.frameName='fXD'+this.genKey();let n=document.createElement('div');n.innerHTML='<iframe name="'+this.frameName+'" '+(r||'')+'></iframe>';let s=n.firstChild,o=this;return setTimeout((()=>{s.frameBorder='0',t&&o.extend(s,t),e.insertBefore(s,e.firstChild)}),0),s}get containerOptions(){return{style:{backgroundColor:'transparent',position:'relative',height:'100%',width:'100%'}}}get viewOptions(){this.frameName||(this.frameName='fXD'+this.genKey());let e={extraCss:null,extraJs:null},t={maxWidth:0,startHeight:70,storiesHeight:70,minWidth:150,scrolling:!1,hidden:!1};t.startHeight=parseFloat(t.storiesHeight)+parseFloat(e.storiesListTopPadding)+parseFloat(e.storiesListBottomPadding)+parseFloat(e.storiesListBottomMargin);let r=parseInt('100%',10),n=r?Math.max(t.minWidth,Math.min(1e4,r))+'px':'100%';return Boolean(!0).toString(),-1!=n.indexOf('%')||parseInt(n),{style:{backgroundColor:'transparent',position:'absolute',left:0,right:0,top:0,height:"100%",width:'100%'},source:{html:this.widgetEntrypoint,baseUrl:'https://sdk.inappstory.com'}}}createRpcServer(e){U(Wn,new Tn(e))}async init(e,t){var r,n,s,o;let i={storiesHeight:(null===(r=t.card)||void 0===r?void 0:r.height)||70,storiesLayoutHeight:(null===(n=t.layout)||void 0===n?void 0:n.height)||0,storiesBackgroundColor:(null===(s=t.layout)||void 0===s?void 0:s.backgroundColor)||'transparent',storiesListTopPadding:t.topPadding||20,storiesListBottomPadding:t.bottomPadding||20,storiesListBottomMargin:t.bottomMargin||20,storiesTitle:(null===(o=t.title)||void 0===o?void 0:o.content)||'',extraCss:t.extraCss||null,extraJs:null},a={allowTransparency:!0,overflowTouch:!1};a.backgroundColor=i.storiesBackgroundColor;var l={startHeight:70,minWidth:150,storiesHeight:70};l.startHeight=i.storiesLayoutHeight?parseFloat(i.storiesLayoutHeight):i.storiesTitle?50+parseFloat(i.storiesHeight||l.storiesHeight)+parseFloat(i.storiesListTopPadding)+parseFloat(i.storiesListBottomPadding)+parseFloat(i.storiesListBottomMargin):parseFloat(i.storiesHeight||l.storiesHeight)+parseFloat(i.storiesListTopPadding)+parseFloat(i.storiesListBottomPadding)+parseFloat(i.storiesListBottomMargin),document.querySelector('body'),document.querySelector('html');let d=this,c={event:(e,t)=>{d.emit(e,t)}};return i.extraJs=null,a.no_finish_loading=!0,this._init(e,a,i,t,c,l,(()=>{}),null,null)}getWidgetDocument(e){let t=`${process.env.BASE_URL}/v${process.env.BUILD_VERSION}/dist/js/storiesList.js`;return t=oe,`\n        <script type="text/javascript" src="${t}"></script>\n        <div id="app"><div id="_app"></div></div>\n        <script type="text/javascript">\n          window.storyReader.init(${JSON.stringify(e)});\n        </script>\n`}async _init(e,t,r,n,s,o,i,a,l){s.event=(e,t)=>this.emit(e,t);let d=super._init(e,t,r,n,s,o,((e,t,r)=>{this.rpc=r}),a,l);return this.on('clickOnStoryInternal',(e=>{var t,r;B(null===(t=this.callbacks)||void 0===t?void 0:t.handleClickOnStoryInternal)&&(null===(r=this.callbacks)||void 0===r||r.handleClickOnStoryInternal(e))})),this.on('flushThumbViews',(e=>{var t,r;B(null===(t=this.callbacks)||void 0===t?void 0:t.handleFlushThumbViews)&&(null===(r=this.callbacks)||void 0===r||r.handleFlushThumbViews(e))})),this.on('clickOnStory',(e=>{var t,r;B(null===(t=this.callbacks)||void 0===t?void 0:t.handleClickOnStory)&&(null===(r=this.callbacks)||void 0===r||r.handleClickOnStory(e))})),this.on('clickOnStoryDeepLink',(e=>{var t,r;B(null===(t=this.callbacks)||void 0===t?void 0:t.handleClickOnStoryDeepLink)&&(null===(r=this.callbacks)||void 0===r||r.handleClickOnStoryDeepLink(e))})),this.on('syncStore',(()=>{})),d}onStoryOpened(e){this.rpc.callMethod('onStoryOpened',e)}syncStoreHandle(e){this.rpc.callMethod('onSyncStore',e)}openReader(e){qn(e)}setStories(e){Bn(e)}setFonts(e){jn(e)}destructor(){}}class Yn extends ln{createWidgetStoriesList(e){let t=new Fn(e);return this.appearanceManager=e,t.on("widgetLoaded",(()=>{this._storiesListWidgetLoaded(t,e)})),t}createWidgetStoryReader(e,t){let r=new Xn((()=>this.appearanceManager));return this.storyReaderNeedFirstRender=e,this.storyReaderDetachComponent=t,r.on("widgetLoaded",(()=>{this._storyReaderWidgetLoaded(r)})),r}getDeviceInfo(e){let t={device_id:re(),platform:"Android"===ne()?"android":"ios"};return Promise.resolve(t)}async localStorageGet(e){try{let t=await se.getItem(e);return null!=t?JSON.parse(t):null}catch(e){return console.error(e),null}}async localStorageSet(e,t){try{return void await se.setItem(e,JSON.stringify(t))}catch(e){return void console.error(e)}}async localStorageGetArray(e){return this.localStorageGet(e)}async localStorageSetArray(e,t){return this.localStorageSet(e,t)}completeInitStoryReader(e,t,r){return void 0===r&&(r={}),e.on('openStoryReader',(()=>{Z.setHidden(!0)})),e.on('closeStoryReader',(()=>{Z.setHidden(!1)})),super.completeInitStoryReader(e,t,r)}}(e=>{e.CIRCLE="circle",e.QUAD="quad",e.RECTANGLE="rectangle"})(Un||(Un={})),(e=>{e.START_LOADER="startLoader",e.END_LOADER="endLoader"})(Gn||(Gn={}));const Qn={title:{content:'',color:'#ffffff',font:'normal',marginBottom:20},card:{title:{font:'normal',color:'#ffffff',padding:15},gap:10,height:70,variant:Un.CIRCLE,border:{radius:0,color:'black',width:2,gap:3},boxShadow:null,opacity:null,mask:{color:null},opened:{border:{radius:null,color:null,width:null,gap:null},boxShadow:null,opacity:null,mask:{color:null}}},favoriteCard:{title:{content:'\u0418\u0437\u0431\u0440\u0430\u043d\u043d\u043e\u0435',font:'normal',color:'#000',padding:15},gap:10,height:70,variant:Un.CIRCLE,border:{radius:0,color:'black',width:2,gap:3},boxShadow:null,opacity:null,mask:{color:null},opened:{border:{radius:null,color:null,width:null,gap:null},boxShadow:null,opacity:null,mask:{color:null}}},sidePadding:20,topPadding:20,bottomPadding:20,bottomMargin:17,layout:{height:0,backgroundColor:'transparent'},navigation:{showControls:!1,controlsSize:48,controlsBackgroundColor:'white',controlsColor:'black'}};let Zn,es;(e=>{e.LEFT="left",e.RIGHT="right"})(Zn||(Zn={})),(e=>{e.FLAT="flat",e.COVER="cover",e.CUBE="cube"})(es||(es={}));const ts={closeButtonPosition:Zn.RIGHT,scrollStyle:es.FLAT,loader:{default:{color:null,accentColor:null},custom:null},recycleStoriesList:!1,closeOnLastSlideByTimer:!0},rs={title:{content:'\u0421\u043e\u0445\u0440\u0430\u043d\u0435\u043d\u043d\u044b\u0435 \u0438\u0441\u0442\u043e\u0440\u0438\u0438'}};let ns;(e=>{e.DEFAULT="default",e.CUSTOM_CARD="customCard",e.CUSTOM_WIDGET="customWidget"})(ns||(ns={}));const ss={goodsWidgetRenderingType:ns.DEFAULT,loader:{default:{color:null,accentColor:null},custom:null}};class os{constructor(){this._commonOptions=An,this._storiesListOptions=Qn,this._storyReaderOptions=ts,this._storyFavoriteReaderOptions=rs,this._goodsWidgetOptions=ss}setCommonOptions(e){return this._commonOptions=M(this._commonOptions,e),this}get commonOptions(){return this._commonOptions}setStoriesListOptions(e){return this._storiesListOptions=M(this._storiesListOptions,e),this}get storiesListOptions(){return this._storiesListOptions}setStoryReaderOptions(e){return this._storyReaderOptions=M(this._storyReaderOptions,e),this}get storyReaderOptions(){return this._storyReaderOptions}setStoryFavoriteReaderOptions(e){return this._storyFavoriteReaderOptions=M(this._storyFavoriteReaderOptions,e),this}get storyFavoriteReaderOptions(){return this._storyFavoriteReaderOptions}setGoodsWidgetOptions(e){return this._goodsWidgetOptions=M(this._goodsWidgetOptions,e),this}get goodsWidgetOptions(){return this._goodsWidgetOptions}}let is='undefined'!=typeof window?G.useLayoutEffect:G.useEffect;const as=w(),ls=L(!0).on(as,((e,t)=>t)),ds=w(),cs=L({storyManager:null,appearanceManager:null}).on(ds,((e,t)=>t));let us=(e,t)=>(((e,t)=>{if(void 0===t&&(t=!1),t)!0===ls.getState()&&(e(),as(!1));else{let t=K(!0);t.current&&(e(),t.current=!1)}})((()=>{ds({storyManager:e(),appearanceManager:t()})}),!0),(e=>{Le.store(e)||(()=>{throw Error('expect useStore argument to be a store')})();let t=e.getState(),r=G.useReducer((e=>e+1),0)[1],n=G.useRef({store:e,value:t,pending:0});return is((()=>{let t=e.updates.watch((e=>{let t=n.current;t.pending||(t.value=e,t.pending=1,r(),t.pending=0)})),s=e.getState(),o=n.current;return o.store===e&&o.value!==s&&(o.value=s,o.pending=1,r(),o.pending=0),o.store=e,t}),[e]),t})(cs));export{os as AppearanceManager,e as StoriesList,Yn as StoryManager,t as StoryReader,us as useIas};
//# sourceMappingURL=react-native-ias.mjs.map
