{"version":3,"file":"react-native-ias.mjs","sources":["react-native-ias/../rn-sdk/StoriesList.tsx","react-native-ias/../rn-sdk/StoryReader.tsx","react-native-ias/../../node_modules/effector/effector.mjs","react-native-ias/../helpers/isArray.ts","react-native-ias/../helpers/isObject.ts","react-native-ias/../../node_modules/uuid/dist/esm-browser/rng.js","react-native-ias/../../node_modules/uuid/dist/esm-browser/validate.js","react-native-ias/../../node_modules/uuid/dist/esm-browser/v4.js","react-native-ias/../../node_modules/uuid/dist/esm-browser/stringify.js","react-native-ias/../helpers/isNil.ts","react-native-ias/../helpers/mergeObjects.ts","react-native-ias/../helpers/trimStartSlash.ts","react-native-ias/../story-manager/models/session/init.ts","react-native-ias/../helpers/isEmpty.ts","react-native-ias/../story-manager/models/story/init.ts","react-native-ias/../story-manager/models/storyContext/init.ts","react-native-ias/../stories_widget/util/string.ts","react-native-ias/../helpers/isFunction.ts","react-native-ias/../helpers/isString.ts","react-native-ias/../widget/utils.ts","react-native-ias/../rpc/remoteFX/server.ts","react-native-ias/../rpc/remoteFX/duplex.ts","react-native-ias/../story-manager/common.h.ts","react-native-ias/../story-manager/models/storyManagerConfig/index.ts","react-native-ias/../story-manager/types/storyManager/storyManager.ts","react-native-ias/../story-manager/models/placeholder/index.ts","react-native-ias/../helpers/utility.ts","react-native-ias/../../node_modules/uuid/dist/esm-browser/regex.js","react-native-ias/../story-manager/api/index.ts","react-native-ias/../story-manager/models/session/index.ts","react-native-ias/../story-manager/types/index.ts","react-native-ias/../story-manager/models/story/index.ts","react-native-ias/../story-manager/models/storyContext/index.ts","react-native-ias/../story-manager/models/init.ts","react-native-ias/../story-manager/sharePage.h.ts","react-native-ias/../story-manager/index.ts","react-native-ias/../helpers/trimEndSlash.ts","react-native-ias/../helpers/isNumber.ts","react-native-ias/../helpers/uniq.ts","react-native-ias/../widget/index.ts","react-native-ias/../helpers/media.ts","react-native-ias/../widget/md5.js","react-native-ias/../widget-stories-list/rpc.ts","react-native-ias/../rpc/index.h.ts","react-native-ias/../rpc/WebViewWorkerServer.ts","react-native-ias/../widget-stories-list/rn.ts","react-native-ias/../widget-story-reader/index.h.ts","react-native-ias/../story-manager/appearanceCommon.h.ts","react-native-ias/../widget-story-reader/rpc.ts","react-native-ias/../widget-stories-list/index.h.ts","react-native-ias/../widget-story-reader/rn.ts","react-native-ias/../rn-sdk/StoryManager.ts","react-native-ias/../story-manager/types/storyManager/storyReader.ts","react-native-ias/../story-manager/types/storyManager/storyFavoriteReader.ts","react-native-ias/../story-manager/types/storyManager/goodsWidget.ts","react-native-ias/../story-manager/AppearanceManager.ts","react-native-ias/../../node_modules/effector-react/effector-react.mjs","react-native-ias/../rn-sdk/useIas.ts"],"sourcesContent":["import React, {Component, useEffect, useRef, useState} from 'react';\nimport {WebView} from 'react-native-webview';\n// import {Colors} from \"react-native/Libraries/NewAppScreen\";\nimport {\n  Dimensions,\n  ImageBackground,\n  SafeAreaView,\n  ScrollView,\n  StatusBar,\n  StyleSheet,\n  Text,\n  useColorScheme,\n  View,\n} from 'react-native';\n\nimport {Option} from \"../../global.h\";\nimport {StoriesListProps} from \"./StoriesList.h\";\nimport {IWidgetStoriesList} from \"../widget-stories-list\";\n\nfunction StoriesList({storyManager, appearanceManager}: StoriesListProps) {\n\n  // props - StoryManager\n  // создать инстанс WidgetStoriesList\n\n  const [widgetStoriesList, setWidgetStoriesList] = useState<Option<IWidgetStoriesList>>(null);\n\n  // get documentSrc && init fn\n\n  const viewRef = useRef<Option<WebView>>(null);\n  const [rpcBind, setRpcBind] = useState<Option<boolean>>(null);\n\n  useEffect(() => {\n    // передали опции, создали объект\n\n    // hook, not first render\n    // only when Some(storyManager)\n    if (widgetStoriesList === null) {\n      if (storyManager != null && appearanceManager != null) {\n        setWidgetStoriesList(storyManager.createWidgetStoriesList(appearanceManager));\n        setRpcBind(false);\n      }\n    }\n\n    // bind rpc\n    if (rpcBind === false && viewRef.current !== null) {\n      console.log('bind rpc');\n      widgetStoriesList?.createRpcServer<WebView>(viewRef.current);\n      setRpcBind(true);\n\n      // widgetLoaded\n\n    }\n\n\n    // привязали транспорт и события\n\n    // получили cb от виджета - готовы грузить сторис\n    // mounted()\n\n  },);\n\n  useEffect(() => {\n\n    console.log({widgetStoriesListContainerOptions: widgetStoriesList?.containerOptions});\n    console.log({widgetStoriesListviewOptions: widgetStoriesList?.viewOptions});\n\n  });\n\n\n  // get view options\n\n  // bind rpc\n\n\n  // render if options exists\n  // onMessage={handler}\n  return (\n    <>\n      {widgetStoriesList &&\n      <>\n        <View {...widgetStoriesList?.containerOptions} >\n          <WebView nativeConfig={{props: {webContentsDebuggingEnabled: true, allowsInlineMediaPlayback: true}}}\n                   scalesPageToFit={false} originWhitelist={['*']}\n                   onMessage={e => {}}\n                   {...widgetStoriesList?.viewOptions} ref={viewRef}\n          />\n        </View>\n      </>\n      }\n\n      {/*<View style={{position: 'relative', height: 200}}>\n\n        <MyInlineWeb style={{width: '100%', height: webviewHeight,\n          backgroundColor: isDarkMode ? Colors.black : Colors.white,\n          // backgroundColor: 'transparent',\n        }}\n                     setScrollEnabled={setScrollEnabled} setWebviewHeight={setWebviewHeight} screenHeight={ScreenHeight}\n                     setWebViewStyle={setWebViewStyle}\n\n                     inputStoryState={inputStoryState}\n                     $storyState={$storyState}\n\n                     inputSessionState={inputSessionState}\n                     $sessionState={$sessionState}\n                     inputOpenStoryId={inputOpenStoryId}\n        />\n\n      </View>*/}\n\n    </>);\n\n}\n\nconst StoriesList2 = ({storyManager, appearanceManager}: StoriesListProps) => {\n\n  // props - StoryManager\n  // создать инстанс WidgetStoriesList\n\n  const widgetStoriesList = useRef<Option<IWidgetStoriesList>>(null);\n\n  // get documentSrc && init fn\n\n  useEffect(() => {\n    // передали опции, создали объект\n    widgetStoriesList.current = storyManager.createWidgetStoriesList(appearanceManager);\n\n    // привязали транспорт и события\n\n    // получили cb от виджета - готовы грузить сторис\n    // mounted()\n\n\n  }, []);\n\n  // render if options exists\n  return (\n\n    <View style={{position: 'relative', height: 200}}>\n\n      <MyInlineWeb style={{\n        width: '100%', height: webviewHeight,\n        backgroundColor: isDarkMode ? Colors.black : Colors.white,\n        // backgroundColor: 'transparent',\n      }}\n                   setScrollEnabled={setScrollEnabled} setWebviewHeight={setWebviewHeight} screenHeight={ScreenHeight}\n                   setWebViewStyle={setWebViewStyle}\n\n                   inputStoryState={inputStoryState}\n                   $storyState={$storyState}\n\n                   inputSessionState={inputSessionState}\n                   $sessionState={$sessionState}\n                   inputOpenStoryId={inputOpenStoryId}\n      />\n\n    </View>\n\n  );\n\n}\n\n\nconst MyInlineWeb = (props) => {\n\n  // constructor() {\n  //     super();\n  //     this.state = {loaded: false};\n  // }\n\n\n  const webViewMessageHandler = (event) => {\n    // console.log('log event list: ' + event.nativeEvent.data);\n    try {\n\n      if (event.nativeEvent.data) {\n        const data = JSON.parse(event.nativeEvent.data);\n        if (Array.isArray(data)) {\n          if (data[0] === 'event') {\n\n            if (data[1] === 'syncStore') {\n              props.inputStoryState(data[2]);\n              console.log('start sync: ' + data[2]['mutation']['type']);\n            }\n            if (data[1] === 'sessionInitInternal') {\n              props.inputSessionState(data[2]);\n              console.log('start sync: ' + data[2]);\n            }\n\n            if (data[1] === 'clickOnStoryInternal') {\n              props.inputOpenStoryId(data[2]['id']);\n\n\n              console.log('clickOnStoryInternal', data);\n            }\n\n          }\n\n\n          // if (data[0] === 'clickOnStory') {\n          //     this.props.setScrollEnabled(false);\n          //     this.props.setWebviewHeight(this.props.screenHeight);\n          //\n          //     this.props.setWebViewStyle({\n          //         // flex: 1,\n          //         position: 'absolute',\n          //         left: 0,\n          //         right: 0,\n          //         top: 0,\n          //         // bottom: 0,\n          //\n          //         // width: '100%',\n          //         height: this.props.screenHeight,\n          //         // height: webviewHeight,\n          //     });\n          //\n          // } else if (data[0] === 'closeStory') {\n          //     this.props.setScrollEnabled(true);\n          //     this.props.setWebviewHeight(200);\n          //\n          //     this.props.setWebViewStyle({\n          //         flex: 1,\n          //         // width: '100%',\n          //         // height: 200,\n          //     });\n          // }\n\n\n        }\n\n      }\n    } catch (e) {\n      // console.error(e);\n    }\n\n    // if (event.nativeEvent.data === 'clickOnStory') {\n    //     this.setState({\n    //         loaded: true\n    //     })\n    // }\n  }\n\n\n  console.log('render');\n\n  const debugging = `\n     // Debug\n     console = new Object();\n     console.log = function(log) {\n        window.ReactNativeWebView.postMessage(log);\n     };\n     console.debug = console.log;\n     console.info = console.log;\n     console.warn = console.log;\n     console.error = console.log;\n     `;\n\n  const baseUrl = 'https://sdk.test.inappstory.com';\n  // const baseUrl = 'http://localhost:8887';\n  const apiUrl = 'https://api.test.inappstory.com';\n  const buildVersion = 'v1.2.4';\n\n  const widgetParams = {\n    apiKey: 'test-key',\n    lang: 'en',\n\n    // apiKey: \"kDVSi0aLNaooemZ7bHrQJQdTqmOObvzH\", // prod\n    userId: null,\n\n    tags: \"producthunt\",\n    hasLike: true,\n    slider: {\n      title: {\n        content: 'The best stories',\n        color: '#222',\n        font: 'normal',\n        marginBottom: 20,\n      },\n      card: {\n        title: {\n          color: 'black',\n          font: '14px/16px \"Segoe UI Semibold\"',\n          padding: 8\n        },\n        gap: 10,\n        height: 100,\n        variant: 'quad',\n        border: {\n          radius: 20,\n          color: 'blue',\n          width: 2,\n          gap: 3,\n        },\n        boxShadow: null,\n        opacity: 1,\n        mask: {\n          color: 'rgba(34, 34, 34, 0.3)'\n        },\n        read: {\n          border: {\n            radius: null,\n            color: 'green',\n            width: null,\n            gap: null,\n          },\n          boxShadow: null,\n          opacity: null,\n          mask: {\n            color: 'rgba(34, 34, 34, 0.1)'\n          },\n        },\n      },\n      layout: {\n        height: 0,\n        backgroundColor: 'transparent'\n      },\n      sidePadding: 20,\n      topPadding: 20,\n      bottomPadding: 20,\n      bottomMargin: 17,\n      navigation: {\n        showControls: false,\n        controlsSize: 48,\n        controlsBackgroundColor: 'white',\n        controlsColor: 'black'\n      },\n    },\n    reader: {\n      closeButtonPosition: 'right',\n      scrollStyle: 'cube',\n    },\n    placeholders: {\n      user: 'Guest'\n    },\n    // optional handler\n    storyLinkHandleClick: function (payload) {\n      // default behaviour\n      window.open(payload.url, '_self');\n    },\n\n  };\n\n  // this.on('sessionInitInternal', (payload: any) => storyReader.sessionInit(payload));\n\n  const html = `\n\n    <head>\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, user-scalable=0, shrink-to-fit=no\">\n        <link rel=\"stylesheet\" type=\"text/css\" href=\"${baseUrl}/css/storiesSlider.css?v=${buildVersion}\"/>\n\n        <script type=\"text/javascript\">\n            window.widgetConfig = {\n                \"api\":{\n                    \"url\": \"${apiUrl}\",\n                    \"version\": \"v2\",\n                    \"token\": \"${widgetParams.apiKey}\",\n                    \"lang\": \"${widgetParams.lang}\"\n                },\n                \"userId\":\"\",\n                \"tags\":\"\"\n            };\n            true;\n        </script>\n<script type=\"text/javascript\" src=\"${baseUrl}/js/storiesSlider.js?v=${buildVersion}\"></script>\n</head>\n<body>\n<div id=\"app\"><div id=\"_app\"></div></div>\n<script type=\"text/javascript\">\n    WStories.init(${JSON.stringify(widgetParams)});\n    window.cur.Rpc = {};\n    window.cur.Rpc.callMethod = (...args) => {\n         window.ReactNativeWebView.postMessage(JSON.stringify(args));\n    };\n    true;\n</script>\n</body>\n`;\n\n  const events = `\n                        '        // 4. Override default loading animation\\\\n' +\n                    '        stories.on(\\\\'startLoader\\\\', function (widget) {\\\\n' +\n                    '            widget.style.background = \\\\'url(\"https://inappstory.com/stories/loader.gif\") center / 45px auto no-repeat transparent\\\\';\\\\n' +\n                    '        });\\\\n' +\n                    '        stories.on(\\\\'endLoader\\\\', function (widget) {\\\\n' +\n                    '            widget.style.background = \\\\'none\\\\';\\\\n' +\n                    '        });\\\\n' +\n                    '        stories.on(\\\\'clickOnStory\\\\', (data) => {\\\\n' +\n                    '        window.ReactNativeWebView.postMessage(JSON.stringify([\"clickOnStory\", data]));' +\n                    '                })\\\\n' +\n                    '        stories.on(\\\\'closeStory\\\\', (data) => {\\\\n' +\n                    '        window.ReactNativeWebView.postMessage(JSON.stringify([\"closeStory\", data]));' +\n                    '                })\\\\n' +`;\n\n  return (\n    <WebView\n      style={props.style}\n      // nativeConfig={{props: {webContentsDebuggingEnabled: true}}}\n\n      scalesPageToFit={false}\n      originWhitelist={['*']}\n      onMessage={webViewMessageHandler}\n      // nativeConfig={{webContentsDebuggingEnabled: true}}\n      source={{\n        baseUrl: 'https://test.inappstory.com',\n        html,\n\n        html2: '' +\n          '<div>' +\n\n\n          '<!-- 1. The <iframe> (and Stories` widget) will be mounted to this <div> tag -->\\n' +\n          '<div id=\"stories_widget\"></div>\\n' +\n          '\\n' +\n          '<script>\\n' +\n          '    // 2. This code loads the web-sdk API code asynchronously \\n' +\n          '    // and create queue in global var window.IASReady.\\n' +\n          '\\n' +\n          '    window.IASReady = (function (d, s, id) {\\n' +\n          '        var js, fjs = d.getElementsByTagName(s)[0], st = window.IASReady || {};\\n' +\n          '        if (d.getElementById(id)) return st;\\n' +\n          '        js = d.createElement(s);\\n' +\n          '        js.id = id;\\n' +\n          '        js.src = \"https://sdk.inappstory.com/js/iframe_api.js?v=1\";\\n' +\n          '        js.async = true;\\n' +\n          '        fjs.parentNode.insertBefore(js, fjs);\\n' +\n          '        st._e = [];\\n' +\n          '        st.ready = function (f) {\\n' +\n          '            st._e.push(f);\\n' +\n          '        };\\n' +\n          '        return st;\\n' +\n          '    }(document, \"script\", \"ias-wjss\"));\\n' +\n          '\\n' +\n          '    // 3. This function creates an <iframe> (and Stories` widget)\\n' +\n          '    //    after the API code downloads.\\n' +\n          '    window.IASReady.ready(function () {\\n' +\n          '        var stories = new window.IAS.Stories(\"stories_widget\", {\\n' +\n          '            apiKey: \"kDVSi0aLNaooemZ7bHrQJQdTqmOObvzH\",\\n' +\n          '            userId: null,\\n' +\n          '            tags: \"producthunt\",\\n' +\n          '            hasLike: true,\\n' +\n          '            slider: {\\n' +\n          '                title: {\\n' +\n          '                    content: \\'The best stories\\',\\n' +\n          '                    color: \\'#fff\\',\\n' +\n          '                    font: \\'normal\\',\\n' +\n          '                    marginBottom: 20,\\n' +\n          '                },\\n' +\n          '                card: {\\n' +\n          '                    title: {\\n' +\n          '                        color: \\'black\\',\\n' +\n          '                        font: \\'14px/16px \"Segoe UI Semibold\"\\',\\n' +\n          '                        padding: 8\\n' +\n          '                    },\\n' +\n          '                    gap: 10,\\n' +\n          '                    height: 100,\\n' +\n          '                    variant: \\'quad\\',\\n' +\n          '                    border: {\\n' +\n          '                        radius: 20,\\n' +\n          '                        color: \\'blue\\',\\n' +\n          '                        width: 2,\\n' +\n          '                        gap: 3,\\n' +\n          '                    },\\n' +\n          '                    boxShadow: null,\\n' +\n          '                    opacity: 1,\\n' +\n          '                    mask: {\\n' +\n          '                        color: \\'rgba(34, 34, 34, 0.3)\\'\\n' +\n          '                    },\\n' +\n          '                    read: {\\n' +\n          '                        border: {\\n' +\n          '                            radius: null,\\n' +\n          '                            color: \\'green\\',\\n' +\n          '                            width: null,\\n' +\n          '                            gap: null,\\n' +\n          '                        },\\n' +\n          '                        boxShadow: null,\\n' +\n          '                        opacity: null,\\n' +\n          '                        mask: {\\n' +\n          '                            color: \\'rgba(34, 34, 34, 0.1)\\'\\n' +\n          '                        },\\n' +\n          '                    },\\n' +\n          '                },\\n' +\n          '                layout: {\\n' +\n          '                    height: 0,\\n' +\n          '                    backgroundColor: \\'transparent\\'\\n' +\n          '                },\\n' +\n          '                sidePadding: 20,\\n' +\n          '                topPadding: 20,\\n' +\n          '                bottomPadding: 20,\\n' +\n          '                bottomMargin: 17,\\n' +\n          '                navigation: {\\n' +\n          '                    showControls: false,\\n' +\n          '                    controlsSize: 48,\\n' +\n          '                    controlsBackgroundColor: \\'white\\',\\n' +\n          '                    controlsColor: \\'black\\'\\n' +\n          '                },\\n' +\n          '            },\\n' +\n          '            reader: {\\n' +\n          '                closeButtonPosition: \\'right\\',\\n' +\n          '                scrollStyle: \\'flat\\',\\n' +\n          '            },\\n' +\n          '            placeholders: {\\n' +\n          '                user: \\'Guest\\'\\n' +\n          '            },\\n' +\n          '            // optional handler\\n' +\n          '            storyLinkHandleClick: function (payload) {\\n' +\n          '                // default behaviour\\n' +\n          '                window.open(payload.url, \\'_self\\');\\n' +\n          '            },\\n' +\n          '        });\\n' +\n          '\\n' +\n          '        // 4. Override default loading animation\\n' +\n          '        stories.on(\\'startLoader\\', function (widget) {\\n' +\n          '            widget.style.background = \\'url(\"https://inappstory.com/stories/loader.gif\") center / 45px auto no-repeat transparent\\';\\n' +\n          '        });\\n' +\n          '        stories.on(\\'endLoader\\', function (widget) {\\n' +\n          '            widget.style.background = \\'none\\';\\n' +\n          '        });\\n' +\n          '        stories.on(\\'clickOnStory\\', (data) => {\\n' +\n          '        window.ReactNativeWebView.postMessage(JSON.stringify([\"clickOnStory\", data]));' +\n          '                })\\n' +\n          '        stories.on(\\'closeStory\\', (data) => {\\n' +\n          '        window.ReactNativeWebView.postMessage(JSON.stringify([\"closeStory\", data]));' +\n          '                })\\n' +\n          '' +\n          '' +\n          '\\n' +\n          '    });\\n' +\n          '</script>\\n' +\n          ''\n      }}\n    />\n  );\n}\n\nexport {StoriesList};\n","import React, {useEffect, useRef, useState} from 'react';\nimport {WebView} from 'react-native-webview';\n// import {Colors} from \"react-native/Libraries/NewAppScreen\";\nimport {SafeAreaView, StatusBar, View, StyleSheet} from \"react-native\";\n\nimport {Option} from \"../../global.h\";\nimport {IWidgetStoryReader} from \"../widget-story-reader\";\nimport {StoryReaderProps} from \"./StoryReader.h\";\n\nfunction StoryReader({storyManager}: StoryReaderProps) {\n\n  // props - StoryManager\n  // создать инстанс WidgetStoriesList\n\n  const [widgetStoryReader, setWidgetStoryReader] = useState<Option<IWidgetStoryReader>>(null);\n\n  const [needFirstRender, setNeedFirstRender] = useState(false);\n\n\n\n  // get documentSrc && init fn\n\n  const viewRef = useRef<Option<WebView>>(null);\n  const [rpcBind, setRpcBind] = useState<Option<boolean>>(null);\n\n\n  // useFirstRender\n    // useBeforeFirstRender\n\n  useEffect(() => {\n    // передали опции, создали объект\n\n    // hook, not first render\n    // only when Some(storyManager)\n    if (widgetStoryReader === null) {\n      if (storyManager != null) {\n        console.log('createWidgetStoryReader');\n        setWidgetStoryReader(storyManager.createWidgetStoryReader(setNeedFirstRender, () => {\n\n          console.log('[StoryReader] call detachComponent');\n\n          widgetStoryReader?.destructor();\n          setRpcBind(null);\n          setWidgetStoryReader(null);\n          setNeedFirstRender(false);\n          viewRef.current = null;\n\n        }));\n        setRpcBind(false);\n      }\n    }\n\n    // bind rpc\n    if (rpcBind === false && viewRef.current !== null) {\n      console.log('bind rpc');\n      widgetStoryReader?.createRpcServer<WebView>(viewRef.current);\n      setRpcBind(true);\n\n      // widgetLoaded\n\n    }\n\n\n    // привязали транспорт и события\n\n    // получили cb от виджета - готовы грузить сторис\n    // mounted()\n\n  },);\n\n  // useEffect(() => {\n    // console.log('options [widgetStoryReader]', widgetStoryReader?.viewOptions);\n  // });\n\n\n  // get view options\n\n  // bind rpc\n\n\n  // render if options exists\n  // onMessage={handler}\n  return (\n      widgetStoryReader && needFirstRender &&\n        <SafeAreaView style={[styles.container, {backgroundColor: \"#000\"}]}>\n          <StatusBar barStyle=\"light-content\" backgroundColor=\"#000\"/>\n\n          <View {...widgetStoryReader?.containerOptions} >\n            <WebView nativeConfig={{props: {webContentsDebuggingEnabled: true, allowsInlineMediaPlayback: true}}}\n                     scalesPageToFit={false} originWhitelist={['*']}\n                     onMessage={e => {}}\n                     {...widgetStoryReader?.viewOptions} ref={viewRef}\n            />\n          </View>\n        </SafeAreaView>\n    );\n\n  // {/*<View style={{position: 'relative', height: 200}}>\n  //\n  //       <MyInlineWeb style={{width: '100%', height: webviewHeight,\n  //         backgroundColor: isDarkMode ? Colors.black : Colors.white,\n  //         // backgroundColor: 'transparent',\n  //       }}\n  //                    setScrollEnabled={setScrollEnabled} setWebviewHeight={setWebviewHeight} screenHeight={ScreenHeight}\n  //                    setWebViewStyle={setWebViewStyle}\n  //\n  //                    inputStoryState={inputStoryState}\n  //                    $storyState={$storyState}\n  //\n  //                    inputSessionState={inputSessionState}\n  //                    $sessionState={$sessionState}\n  //                    inputOpenStoryId={inputOpenStoryId}\n  //       />\n  //\n  //     </View>*/}\n\n}\n\nconst styles = StyleSheet.create({\n  container: {flex: 1, justifyContent: \"center\", alignItems: \"center\", position: \"absolute\", width: \"100%\", height: \"100%\"},\n});\n\nexport {StoryReader};\n","function e(e,t,r,a){(V(e)||J(e))&&('family'in e||'graphite'in e)||B(`${t}: expect ${r} to be a unit (store, event or effect)${a}`)}function t(t,r,a){if(Array.isArray(t))for(let n=0;n<t.length;n++)e(t[n],r,`${n} item of ${a}`,'');else e(t,r,a,' or array of units')}function r(e,t){let r=ge(e).meta;Ce={parent:Ce,value:e,template:r.template||je(),sidRoot:r.sidRoot||Ce&&Ce.sidRoot};try{return t()}finally{Ce=xe(Ce)}}function a({node:e=[],from:t,source:r,parent:a=t||r,to:n,target:o,child:s=n||o,scope:l={},meta:i={},family:f={type:'regular'},regional:c}={}){let u=Fe(a),p=Fe(f.links),d=Fe(f.owners),m=[],h={};for(let t=0;t<e.length;t++){let r=e[t];r&&(m.push(r),Re(r,h))}let g={id:Y(),seq:m,next:Fe(s),meta:i,scope:l,family:{type:f.type||\"crosslink\",links:p,owners:d},reg:h};for(let e=0;e<p.length;e++)ye(p[e]).push(g);for(let e=0;e<d.length;e++)ke(d[e]).push(g);for(let e=0;e<u.length;e++)u[e].next.push(g);return c&&Ce&&Ae(Se(Ce),[g]),g}function n(e,t,r){let a=Be,n=null,o=He;if(e.target&&(t=e.params,r=e.defer,a='page'in e?e.page:a,e.stack&&(n=e.stack),o=Ne(e)||o,e=e.target),o&&He&&o!==He&&(He=null),Array.isArray(e))for(let r=0;r<e.length;r++)Ee('pure',a,ge(e[r]),n,t[r],o);else Ee('pure',a,ge(e),n,t,o);if(r&&!Ge)return;let s,l,i,f,c,u,p={isRoot:Ge,currentPage:Be,forkPage:He,isWatch:Ue};Ge=0;e:for(;f=$e();){let{idx:e,stack:t,type:r}=f;i=t.node,Be=c=t.page,He=Ne(t),u=(c||i).reg;let a={fail:0,scope:i.scope};s=l=0;for(let n=e;n<i.seq.length&&!s;n++){let o=i.seq[n],f=o.data;switch(o.type){case\"barrier\":{let a=f.barrierID;c&&(a=`${c.fullID}_${a}`);let o=f.priority;if(n!==e||r!==o){Te.has(a)||(Te.add(a),ze(n,t,o,a));continue e}Te.delete(a);break}case'mov':{let e;switch(f.from){case\"stack\":e=Se(t);break;case\"a\":case'b':e=t[f.from];break;case\"value\":e=f.store;break;case I:u[f.store.id]||(t.page=c=Ke(c,f.store.id),u=c?c.reg:i.reg),e=pe(u[f.store.id])}switch(f.to){case\"stack\":t.value=e;break;case\"a\":case'b':t[f.to]=e;break;case I:Le(c,i,f.target.id).current=e}break}case'check':switch(f.type){case'defined':l=void 0===Se(t);break;case'changed':l=Se(t)===pe(Le(c,i,f.store.id))}break;case\"filter\":l=!Qe(a,f,t);break;case'run':if(n!==e||\"effect\"!==r){ze(n,t,\"effect\");continue e}case'compute':Ue='watch'===i.meta.op,t.value=Qe(a,f,t),Ue=p.isWatch}s=a.fail||l}if(!s)for(let e=0;e<i.next.length;e++)Ee('child',c,i.next[e],t,Se(t),Ne(t))}Ge=p.isRoot,Be=p.currentPage,He=Ne(p)}function o(e,t=\"combine\"){let r=t+'(',a='',n=0;for(let t in e){let o=e[t];if(null!=o&&(r+=a,r+=E(o)?o.compositeName.fullName:o.toString()),n+=1,25===n)break;a=', '}return r+=')',r}function s(e,t){let r=l(t,xe(e));if(e.shortName=t,!e.compositeName)return void(e.compositeName=r);let a=e.compositeName;a.path=r.path,a.shortName=r.shortName,a.fullName=r.fullName}function l(e,t){let r,a,n,o=e;return t?(n=t.compositeName,0===e.length?(r=n.path,a=n.fullName):(r=n.path.concat([e]),a=0===n.fullName.length?e:n.fullName+'/'+e)):(r=0===e.length?[]:[e],a=e),{shortName:o,fullName:a,path:r}}function i(e,t){for(let r in e)t(e[r],r)}function f(e,t){e.forEach(t)}function c(e,t){let r=(e,...t)=>Be?((e,t,r,a)=>{let n=Be,o=null;if(t)for(o=Be;o&&o.template!==t;)o=xe(o);Je(o);let s=e.create(r,a);return Je(n),s})(r,o,e,t):r.create(e,t);r.graphite=a({meta:ht(\"event\",r,t,e),regional:1}),r.create=e=>(n(He?He.find(r):r,e),e),r.watch=Z(ut,r),r.map=e=>{let t,a;V(e)&&(t=e,a=e.name,e=e.fn);let n=c(Ye(r,a),t);return yt(r,n,$,e),n},r.filter=e=>kt(r,\"filter\",e.fn?e:e.fn,[le({fn:he})]),r.filterMap=e=>kt(r,'filterMap',e,[se({fn:he}),oe.defined()]),r.prepend=e=>{let t=c('* → '+r.shortName,{parent:xe(r)}),a=je();return a&&ge(t).seq.push(a.upward),yt(t,r,'prepend',e),mt(r,t),t};let o=je();return r}function u(e,r){function o(e,t){p.off(e),qe(p).set(e,lt(bt(e,p,'on',1,t,m)))}let s=ue(e),l=ue(e),i=gt('updates'),f=je();s.after=[{type:'copy',to:l}],f&&f.plain.push(s,l);let c=s.id,p={subscribers:new Map,updates:i,defaultState:e,stateRef:s,getState(){let e,t=s;if(Be){let t=Be;for(;t&&!t.reg[c];)t=xe(t);t&&(e=t)}return!e&&He&&He.reg[c]&&(e=He),e&&(t=e.reg[c]),pe(t)},setState(e){let t;He&&(t=He.nodeMap[ge(p).id]),t||(t=p),n({target:t,params:e,defer:1})},reset(...e){for(let t of e)p.on(t,(()=>p.defaultState));return p},on(e,r){if(t(e,'.on','first argument'),Array.isArray(e))for(let t of e)o(t,r);else o(e,r);return p},off(e){let t=qe(p).get(e);return t&&(t(),qe(p).delete(e)),p},map(e,t){let r,a,n;V(e)&&(r=e,a=e.name,t=e.firstState,e=e.fn);let o=p.getState(),l=je();l?n=null:void 0!==o&&(n=e(o,t));let i=u(n,{name:Ye(p,a),config:r,strict:0}),f=bt(p,i,$,0,e);return be(i).before=[{type:$,fn:e,from:s}],l&&(tt(l.plain,s)||tt(f.seq,l.loader)||f.seq.unshift(l.loader)),i},watch(e,t){if(!t||!E(e)){let t=ut(p,e),r=je();return r?r.watch.push({of:s,fn:e}):e(p.getState()),t}return J(t)||B('second argument should be a function'),e.watch((e=>t(p.getState(),e)))}},d=ht(I,p,r),m=p.defaultConfig.updateFilter;return p.graphite=a({scope:{state:s},node:[oe.defined(),oe.changed({store:l}),m&&ne({store:l,to:\"a\"}),m&&le({fn:(e,t,{a:r})=>m(e,r)}),fe({store:s}),fe({store:l})],child:i,meta:d,regional:1}),dt&&void 0===e&&B(\"current state can't be undefined, use null instead\"),Ae(p,[i]),p}function p(...e){let t,r,a;Ze(e[0],((t,r)=>{a=t,e=r}));let n,o,s=e[e.length-1];if(J(s)?(r=e.slice(0,-1),t=s):r=e,1===r.length){let e=r[0];W(e)||(n=e,o=1)}return o||(n=r,t&&(t=vt(t))),V(n)||B('shape should be an object'),wt(Array.isArray(n),n,a,t)}function d(){let e={};return e.req=new Promise(((t,r)=>{e.rs=t,e.rj=r})),e.req.catch((()=>{})),e}function m(e,t){let r=c(e,t),o=r.defaultConfig.handler||(()=>B(`no handler used in ${r.getType()}`)),s=ge(r);s.meta.onCopy=['runner'],s.meta.unit=r.kind=\"effect\",r.use=e=>(J(e)||B('.use argument should be a function'),o=e,r);let l=r.finally=gt('finally'),i=r.done=l.filterMap({named:'done',fn({status:e,params:t,result:r}){if('done'===e)return{params:t,result:r}}}),f=r.fail=l.filterMap({named:'fail',fn({status:e,params:t,error:r}){if('fail'===e)return{params:t,error:r}}}),p=r.doneData=i.map({named:'doneData',fn:({result:e})=>e}),m=r.failData=f.map({named:'failData',fn:({error:e})=>e}),h=a({scope:{getHandler:r.use.getCurrent=()=>o,finally:l},node:[ie({fn({params:e,req:t},{finally:r,getHandler:a},n){let o,s=St({params:e,req:t,ok:1,anyway:r,stack:n}),l=St({params:e,req:t,ok:0,anyway:r,stack:n});try{o=a()(e)}catch(e){return void l(e)}V(o)&&J(o.then)?o.then(s,l):s(o)}})],meta:{op:'fx',fx:'runner',onCopy:['finally']}});s.scope.runner=h,s.seq.push(se({fn:(e,t,r)=>xe(r)?{params:e,req:{rs(e){},rj(e){}}}:e}),ie({fn:(e,{runner:t},r)=>(n({target:t,params:e,defer:1,forkPage:Ne(r)}),e.params)})),r.create=e=>{let t=d(),a={params:e,req:t};if(He){if(!Ue){let e=He;t.req.finally((()=>{Ve(e)})).catch((()=>{}))}n(He.find(r),a)}else n(r,a);return t.req};let g=r.inFlight=u(0,{named:'inFlight'}).on(r,(e=>e+1)).on(l,(e=>e-1)),y=r.pending=g.map({fn:e=>e>0,named:'pending'});return Ae(r,[l,i,f,p,m,y,g,h]),r}function h(e){let t;Ze(e,((r,a)=>{t=r,e=a}));let{source:r,effect:a,mapParams:o}=e;o||(o=r?(e,t)=>t:e=>e);let s,l=m(e,t),{runner:i}=ge(l).scope,f=({params:e,req:t},{finally:r,effect:a},s)=>{let l,i=St({params:e,req:t,ok:0,anyway:r,stack:s});try{l=o(e,s.a)}catch(e){return i(e)}n({target:a,params:{params:l,req:{rs:St({params:e,req:t,ok:1,anyway:r,stack:s}),rj:i}},page:s.page,defer:1})};if(r){let e;W(r)?(e=r,Ae(r,[l])):(e=p(r),Ae(l,[e]));let t=ne({from:I,store:be(e),to:\"a\"});s=[ie({fn:e=>e}),t,se({fn:f})],Re(t,i.reg)}else s=[ie({fn:f})];return Ae(a,[l]),i.scope.effect=a,i.meta.onCopy.push(\"effect\"),i.seq.splice(0,1,...s),mt(a,l,\"effect\"),l}function g(...e){let[[t,r],a]=et(e),n={};return i(r,((e,r)=>{let o=n[r]=c(r,{parent:xe(t),config:a});t.on(o,e),mt(t,o)})),n}function y(e,t){let r=new Set,n=new Set,o=new Set,s=new Set,l=a({family:{type:\"domain\"},regional:1}),f={history:{domains:r,stores:n,effects:o,events:s},graphite:l};l.meta=ht(\"domain\",f,t,e);let[p,d,h,g]=['onEvent','onEffect','onStore','onDomain'].map(gt);f.hooks={event:p,effect:d,store:h,domain:g},f.onCreateEvent=xt(p,s,f),f.onCreateEffect=xt(d,o,f),f.onCreateStore=xt(h,n,f),f.onCreateDomain=xt(g,r,f),f.createEvent=f.event=(e,t)=>p(c(e,{parent:f,config:t})),f.createEffect=f.effect=(e,t)=>d(m(e,{parent:f,config:t})),f.createDomain=f.domain=(e,t)=>y({name:e,parent:f,config:t}),f.createStore=f.store=(e,t)=>h(u(e,{parent:f,config:t}));let k=xe(f);return k&&(i(f.hooks,((e,t)=>{ct({from:e,to:k.hooks[t]})})),k.hooks.domain(f)),f}function k(e){K(e);let t=_ in e?e[_]():e;t.subscribe||B('expect observable to have .subscribe');let r=c(),a=ee(st,r,void 0);return t.subscribe({next:r,error:a,complete:a}),r}function b(e,r){let a=c(r||o(e,'merge'));return t(e,'merge','first argument'),ct({from:e,to:a,meta:{op:'merge'}}),a}function v(...e){let r,n,o,s,[[l,i,d],m]=et(e);void 0===i&&V(l)&&(e=>{let t=0;return f(Nt,(r=>{r in e&&(null==e[r]&&B(`sample: ${r} should be defined`),t=1)})),t})(l)&&(i=l.clock,d=l.fn,s=l.greedy,r=l.target,n=l.name,o=l.sid,l=l.source);let h=1;void 0===l&&(t(i,'sample','clock'),Array.isArray(i)&&(i=b(i)),l=i,h=0),h&&!E(l)&&(l=p(l)),void 0===i&&(i=l),t(i,'sample','clock'),n=m||n||l.shortName;let g=je(),y=!!r;r||(W(l)&&W(i)?r=u(d?d(pe(be(l)),pe(be(i))):pe(be(l)),{name:n,sid:o}):(r=c(n),g&&ge(r).seq.push(g.loader)));let k=y&&E(r)&&ge(r).meta.nativeTemplate;if(W(l)){let e=be(l);Ae(l,[ft(i,r,{scope:{fn:d,targetTemplate:k},node:[g&&g.loader,!s&&ae({priority:\"sampler\"}),ne({store:e,to:d?\"a\":\"stack\"}),d&&se({fn:me}),g&&y&&g.upward],meta:{op:\"sample\",sample:I}})]),g&&(tt(g.plain,e)||tt(g.closure,e)||g.closure.push(e))}else{let e=ue(0),t=ue(),n=ue();g&&g.plain.push(e,t,n),a({parent:l,node:[fe({store:t}),ne({from:\"value\",store:1,target:e})],family:{owners:[l,r,i],links:r},meta:{op:\"sample\",sample:'source'},regional:1}),Ae(l,[ft(i,r,{scope:{fn:d,targetTemplate:k},node:[g&&g.loader,fe({store:n}),ne({store:e}),le({fn:e=>e}),!s&&ae({priority:\"sampler\"}),ne({store:t}),ne({store:n,to:\"a\"}),d&&se({fn:de}),g&&y&&g.upward],meta:{op:\"sample\",sample:'clock'}})])}return r}function w(...e){let r={op:'guard'},n='guard',[[o,s],l]=et(e);l&&(r.config=l,l.name&&(n=l.name)),s||(s=o,o=s.source);let{filter:i,greedy:f,clock:u,name:d=n}=s,m=s.target||c(d,r.config),h=E(i),g=1;return void 0===o&&(t(u,'guard','clock'),Array.isArray(u)&&(u=b(u)),o=u,g=0),g&&!E(o)&&(o=p(o)),u&&(t(u,'guard','clock'),o=v({source:o,clock:u,greedy:f,fn:h?null:(e,t)=>({source:e,clock:t})})),t(m,'guard','target'),h?v({source:i,clock:o,target:a({node:[le({fn:({guard:e})=>e}),se({fn:({data:e})=>e})],child:m,meta:r,family:{owners:[o,i,m,...[].concat(u||[])],links:m},regional:1}),fn:(e,t)=>({guard:e,data:t}),greedy:f,name:d}):(J(i)||B('`filter` should be function or unit'),ft(o,m,{scope:{fn:i},node:u?[le({fn:({source:e,clock:t},{fn:r})=>r(e,t)}),se({fn:({source:e})=>e})]:[le({fn:he})],meta:r})),m}function S(e,t,r){if(W(e))return e;if(E(e)){let a,n=xe(e);return T(e)&&(a=u(t,{parent:n,name:e.shortName,ɔ:r}).on(e,((e,t)=>t))),H(e)&&(a=u(t,{parent:n,name:e.shortName,ɔ:r}).on(e.done,((e,{result:t})=>t))),n&&n.hooks.store(a),a}let a=Array.isArray(e)?[]:{};return i(e,((e,t)=>{a[t]=W(e)?e:u(e,{name:t})})),a}function q(...e){let t,[[r,n],o]=et(e),s=!n;s&&(t=r.cases,n=r.match,r=r.source);let l=W(n),f=!E(n)&&J(n),u=!l&&!f&&V(n);t||(t={}),s||(u||B('match should be an object'),i(n,((e,r)=>{t[r]=c(o)})),t.__=c(o));let p,d=je(),m=new Set([].concat(r,Object.values(t))),h=Object.keys(l||f?t:n);if(l||f)l&&m.add(n),p=[l&&ae({priority:'sampler'}),l&&ne({store:be(n),to:'a'}),le({fn(e,t,r){let a=String(l?r.a:n(e));At(t,tt(h,a)?a:'__',e,r)}})];else if(u){let e=ue({});e.type='shape';let t,r=e.before=[],a=[ne({store:e,to:\"a\"}),se({fn(e,{key:t},{a:r}){r[t]=e}})],o=[];i(n,((n,s)=>{if(E(n)){t=1,o.push(s),m.add(n);let l=ft(n,[],{node:a,scope:{key:s}});if(W(n)){e.current[s]=n.getState();let t=be(n);r.push({type:'field',field:s,from:t}),d&&(tt(d.plain,t)||l.seq.unshift(d.loader))}}})),t&&d&&d.plain.push(e),p=[t&&ae({priority:'sampler'}),t&&ne({store:e,to:'a'}),le({fn(e,t,r){for(let a=0;a<h.length;a++){let s=h[a];if(tt(o,s)?r.a[s]:n[s](e))return void At(t,s,e,r)}At(t,'__',e,r)}})]}else B('expect match to be unit, function or object');if(a({meta:{onCopy:Object.keys(t),op:'split'},parent:r,scope:t,node:p,family:{type:'crosslink',owners:Array.from(m)},regional:1}),!s)return t}function x(e,{values:t}){let r=V(e)&&e.cloneOf;G(e)||r||B('first argument of hydrate should be domain or scope'),V(t)||B('values property should be an object');let a,o,s=j(t);if(r)a=[],o=[],i(s,((t,r)=>{let n=e.sidMap[r];n&&(a.push(n),o.push(t),e.changedStores.add(n.meta.forkOf.id))}));else{let t=(({flatGraphUnits:e,values:t,collectWatches:r})=>{let a=[],n=[],o={},s=new Set,l=Object.getOwnPropertyNames(t);return f(e,(e=>{let{reg:f}=e,{op:c,unit:u,sid:p}=e.meta;if(u===I&&p&&tt(l,p)){let{state:r}=e.scope;r.current=t[p],s.add(r)}if(r&&'watch'===c){let t=e.family.owners[0];t.meta.unit===I&&(a.push(e),n.push(t.scope.state))}i(f,((e,t)=>{o[t]=e}))})),f(P(N(o)),(e=>{(e=>{let t=0;if(e.before&&!s.has(e)&&f(e.before,(r=>{switch(r.type){case $:e.current=r.fn(r.from.current);break;case'field':{let a=r.from;t||(t=1,e.current=Array.isArray(e.current)?[...e.current]:{...e.current}),e.current[r.field]=a.current;break}}})),!e.after)return;let r=e.current;f(e.after,(e=>{let t=e.to;switch(e.type){case'copy':t.current=r;break;case $:t.current=e.fn(r)}}))})(o[e])})),{storeWatches:a,storeWatchesRefs:n}})({flatGraphUnits:R(e),values:s,collectWatches:1});a=t.storeWatches,o=t.storeWatchesRefs.map((({current:e})=>e))}n({target:a,params:o,forkPage:r?e:0})}function N(e){let t=Object.values(e),r={};return f(t,(({id:e})=>{r[e]=[]})),f(t,(({id:e,before:t,after:a})=>{t&&f(t,(t=>{r[t.from.id].push(e)})),a&&f(a,(t=>{r[e].push(t.to.id)}))})),r}function A({clones:e,changedStores:t},{ignore:r=[],onlyChanges:a}={}){let n={};return f(e,(({meta:e,scope:r,reg:o})=>{if(e.unit!==I)return;let{sid:s}=e;s&&(!a&&!e.isCombine||t.has(e.forkOf.id))&&(n[s]=o[r.state.id].current)})),f(r,(({sid:e})=>{e&&delete n[e]})),n}function C(e){He||B('scopeBind cannot be called outside of forked .watch');let t=He,r=He.find(e);return H(e)?e=>{let a=d();n({target:r,params:{params:e,req:a},forkPage:t})}:e=>(n({target:r,params:e,forkPage:t}),e)}function j(e,t=(()=>{})){if(e instanceof Map){let r={};for(let[a,n]of e)E(a)||B('Map key should be a unit'),t(a,n),r[a.sid]=n;return r}return e}function O(e,{values:t,handlers:r}={}){G(e)||B('first argument of fork should be domain');let n=!!t;t=j(t||{},(e=>!W(e)&&B('Values map can contain only stores as keys')));let o=(e=>{function t(e){let t=ge(e),a=r.indexOf(t);if(-1===a){let r='unit';e!==t&&e.id!==e.shortName&&(r=e.shortName),B(`${r} not found in forked scope`)}return p[a]}let r=R(e),n=new Map,o=new Set,s=se({fn:(e,t,r)=>((!r.node.meta.isCombine||xe(r)&&'combine'!==xe(r).node.meta.op)&&o.add(r.node.meta.forkOf.id),e)}),l=a({scope:{defers:[],inFlight:0,fxID:0},node:[se({fn(e,t,r){r.parent?'finally'===r.parent.node.meta.named?t.inFlight-=1:(t.inFlight+=1,t.fxID+=1):t.fxID+=1}}),ae({priority:\"sampler\"}),ie({fn(e,t){let{inFlight:r,defers:a,fxID:n}=t;r>0||0===a.length||Promise.resolve().then((()=>{t.fxID===n&&f(a.splice(0,a.length),(e=>{Ve(e.parentFork),e.rs(e.value)}))}))}})],meta:{unit:\"forkInFlightCounter\"}}),c={},u={},p=r.map((e=>{let{seq:t,next:r,meta:n,scope:o}=e,s=a({node:t.map((e=>({id:e.id,type:e.type,data:{...e.data},hasRef:e.hasRef}))),child:[...r],meta:{forkOf:e,...n},scope:{...o}});return s.family={type:e.family.type,links:[...ke(e)],owners:[...ye(e)]},c[e.id]=s,n.sid&&(u[n.sid]=s),s})),d={};return f(p,(e=>{let{reg:r,scope:a,meta:{onCopy:o,op:c,unit:u}}=e;switch(i(r,((e,t)=>{let a=n.get(e);a||(a={id:e.id,current:e.current},n.set(e,a)),d[t]=r[t]=a})),o&&f(o,(e=>{let r=a[e];a[e]=Array.isArray(r)?r.map(t):t(r)})),D(e,((e,r,a)=>{a[r]=t(e)})),c||u){case I:e.meta.wrapped=(e=>({kind:I,getState:()=>e.reg[e.scope.state.id].current,updates:{watch:Z(ut,e)},graphite:e,family:e.family}))(e),e.meta.sid&&e.seq.push(s);break;case M:e.next.push(l);break;case'fx':a.finally.next.push(l)}})),{cloneOf:e,changedStores:o,nodeMap:c,sidMap:u,clones:p,find:t,reg:d,getState:e=>t(e).meta.wrapped.getState(),graphite:a({family:{type:\"domain\",links:[l,...p]},meta:{unit:'fork'},scope:{forkInFlightCounter:l}})}})(e);if(n&&(()=>{let r=R(e),a={},n={},s=new Set,l=new Set,c=Object.getOwnPropertyNames(t);f(r,(({reg:e,meta:t})=>{let{nativeTemplate:r}=t;i(e,((e,t)=>{a[t]=e,r&&l.add(t)}))})),f(o.clones,(e=>{let{reg:r}=e,{unit:a,sid:l}=e.meta;if(a===I&&l&&tt(c,l)){let{state:a}=e.scope;r[a.id].current=t[l],s.add(a),o.changedStores.add(e.meta.forkOf.id)}i(r,((e,t)=>{n[t]=e}))})),f(P(N(a),l),(e=>{((e,t)=>{let r=0;if(t&&t.before&&!s.has(e)&&f(t.before,(t=>{switch(t.type){case $:e.current=t.fn(n[t.from.id].current);break;case'field':{let a=n[t.from.id];r||(r=1,e.current=Array.isArray(e.current)?[...e.current]:{...e.current}),e.current[t.field]=a.current;break}}})),!t||!t.after)return;let a=e.current;f(t.after,(e=>{let t=n[e.to.id];switch(e.type){case'copy':t.current=a;break;case $:t.current=e.fn(a)}}))})(n[e],a[e])}))})(),r){r=j(r,(e=>!H(e)&&B(\"Handlers map can contain only effects as keys\")));let e=Object.keys(r);f(o.clones,(({scope:t,meta:a})=>{a.sid&&tt(e,a.sid)&&(t.runner.scope.getHandler=()=>r[a.sid])}))}return o}function P(e,t){function r(e){s[e]=1;let t=a[e];for(let e=0;e<t.length;e++){let a=t[e];s[a]||o[a]||r(a)}s[e]=0,o[e]=1,n.push(e)}let a={};for(let t in e)a[t]=[...new Set(e[t])];let n=[],o={},s={};for(let e in a)o[e]||s[e]||r(e);if(n.reverse(),t&&t.size>0){let e,r=[],o=[...t];for(;e=o.shift();)r.push(e),f(a[e],(e=>{tt(r,e)||tt(o,e)||o.push(e)}));f(r,(e=>{rt(n,e)}))}return n}function F(e,{scope:t,params:r}){if(!E(e))return Promise.reject(Error('first argument should be unit'));let a=d();a.parentFork=He;let{forkInFlightCounter:o}=t.graphite.scope;o.scope.defers.push(a);let s=[t.find(e)],l=[];return H(e)?l.push({params:r,req:{rs(e){a.value={status:'done',value:e}},rj(e){a.value={status:'fail',value:e}}}}):l.push(r),s.push(o),l.push(null),n({target:s,params:l,forkPage:t}),a.req}function R(e){let t=[];return function e(r){tt(t,r)||(t.push(r),D(r,e))}(ge(e)),t}function D(e,t){let r=e.meta.unit;'fork'!==r&&\"forkInFlightCounter\"!==r&&(f(e.next,t),f(ye(e),t),f(ke(e),t))}let _='undefined'!=typeof Symbol&&Symbol.observable||'@@observable',I='store',M='effect',$='map',E=e=>(J(e)||V(e))&&'kind'in e;const z=e=>t=>E(t)&&t.kind===e;let W=z(I),T=z(\"event\"),H=z(M),G=z(\"domain\");var U={__proto__:null,unit:E,store:W,event:T,effect:H,domain:G};let B=e=>{throw Error(e)},V=e=>'object'==typeof e&&null!==e,J=e=>'function'==typeof e,K=e=>{V(e)||J(e)||B('expect first argument be an object')};const L=()=>{let e=0;return()=>(++e).toString(36)};let Q=L(),X=L(),Y=L(),Z=(e,t)=>e.bind(null,t),ee=(e,t,r)=>e.bind(null,t,r);const te=(e,t,r)=>({id:X(),type:e,data:r,hasRef:t});let re=0,ae=({priority:e=\"barrier\"})=>te(\"barrier\",0,{barrierID:++re,priority:e}),ne=({from:e=I,store:t,target:r,to:a=(r?I:\"stack\")})=>te('mov',e===I,{from:e,store:t,to:a,target:r}),oe={defined:()=>te('check',0,{type:'defined'}),changed:({store:e})=>te('check',1,{type:'changed',store:e})},se=ee(te,'compute',0),le=ee(te,\"filter\",0),ie=ee(te,'run',0),fe=({store:e})=>ne({from:\"stack\",target:e});var ce={__proto__:null,barrier:ae,mov:ne,check:oe,compute:se,filter:le,run:ie,update:fe};let ue=e=>({id:X(),current:e}),pe=({current:e})=>e,de=(e,{fn:t},{a:r})=>t(e,r),me=(e,{fn:t},{a:r})=>t(r,e),he=(e,{fn:t})=>t(e),ge=e=>e.graphite||e,ye=e=>e.family.owners,ke=e=>e.family.links,be=e=>e.stateRef,ve=e=>e.config,we=e=>e.ɔ,Se=e=>e.value,qe=e=>e.subscribers,xe=e=>e.parent,Ne=e=>e.forkPage,Ae=(e,t)=>{let r=ge(e);for(let e=0;e<t.length;e++){let a=ge(t[e]);\"domain\"!==r.family.type&&(a.family.type=\"crosslink\"),ye(a).push(r),ke(r).push(a)}},Ce=null,je=()=>Ce&&Ce.template,Oe=e=>(e&&Ce&&Ce.sidRoot&&(e=`${Ce.sidRoot}ɔ${e}`),e),Pe=({sid:e,name:t,loc:n,method:o,fn:s})=>r(a({meta:{sidRoot:Oe(e),name:t,loc:n,method:o}}),s);const Fe=(e=[])=>{let t=[];if(Array.isArray(e))for(let r=0;r<e.length;r++)Array.isArray(e[r])?t.push(...e[r]):t.push(e[r]);else t.push(e);return t.map(ge)};let Re=({hasRef:e,type:t,data:r},a)=>{let n;e&&(n=r.store,a[n.id]=n),'mov'===t&&r.to===I&&(n=r.target,a[n.id]=n)},De=null;const _e=(e,t)=>{if(!e)return t;if(!t)return e;let r,a=e.v.type===t.v.type;return(a&&e.v.id>t.v.id||!a&&\"sampler\"===e.v.type)&&(r=e,e=t,t=r),r=_e(e.r,t),e.r=e.l,e.l=r,e},Ie=[];let Me=0;for(;Me<5;)Ie.push({first:null,last:null,size:0}),Me+=1;const $e=()=>{for(let e=0;e<5;e++){let t=Ie[e];if(t.size>0){if(2===e||3===e){t.size-=1;let e=De.v;return De=_e(De.l,De.r),e}1===t.size&&(t.last=null);let r=t.first;return t.first=r.r,t.size-=1,r.v}}},Ee=(e,t,r,a,n,o)=>ze(0,{a:null,b:null,node:r,parent:a,value:n,page:t,forkPage:o},e),ze=(e,t,r,a=0)=>{let n=We(r),o=Ie[n],s={v:{idx:e,stack:t,type:r,id:a},l:0,r:0};2===n||3===n?De=_e(De,s):(0===o.size?o.first=s:o.last.r=s,o.last=s),o.size+=1},We=e=>{switch(e){case'child':return 0;case'pure':return 1;case\"barrier\":return 2;case\"sampler\":return 3;case M:return 4;default:return-1}},Te=new Set;let He,Ge=1,Ue=0,Be=null,Ve=e=>{He=e},Je=e=>{Be=e};const Ke=(e,t)=>{if(e){for(;e&&!e.reg[t];)e=xe(e);if(e)return e}return null},Le=(e,t,r)=>(Ke(e,r)||t).reg[r],Qe=(e,{fn:t},r)=>{try{return t(Se(r),e.scope,r)}catch(t){console.error(t),e.fail=1}};let Xe=(e,t)=>''+e.shortName+t,Ye=(e,t)=>null==t?Xe(e,' → *'):t,Ze=(e,t)=>{K(e),we(e)&&t(ve(e),we(e))},et=e=>{let t;return Ze(e[0],((r,a)=>{t=r,e=a})),[e,t]},tt=(e,t)=>e.includes(t),rt=(e,t)=>{let r=e.indexOf(t);-1!==r&&e.splice(r,1)};const at=(e,t)=>{rt(e.next,t),rt(ye(e),t),rt(ke(e),t)},nt=(e,t,r)=>{let a;e.next.length=0,e.seq.length=0,e.scope=null;let n=ke(e);for(;a=n.pop();)at(a,e),(t||r&&!e.meta.sample||\"crosslink\"===a.family.type)&&nt(a,t,'on'!==a.meta.op&&r);for(n=ye(e);a=n.pop();)at(a,e),r&&\"crosslink\"===a.family.type&&nt(a,t,'on'!==a.meta.op&&r)},ot=e=>e.clear();let st=(e,{deep:t}={})=>{let r=0;if(e.ownerSet&&e.ownerSet.delete(e),W(e))ot(qe(e));else if(G(e)){r=1;let t=e.history;ot(t.events),ot(t.effects),ot(t.stores),ot(t.domains)}nt(ge(e),!!t,r)},lt=e=>{let t=ee(st,e,void 0);return t.unsubscribe=t,t},ft=(e,t,{node:r,scope:n,meta:o})=>a({node:r,parent:e,child:t,scope:n,meta:o,family:{owners:[e,t],links:t},regional:1}),ct=e=>{let r;Ze(e,((t,a)=>{r=t,e=a}));let{from:n,to:o,meta:s={op:'forward'}}=e;return t(n,'forward','\"from\"'),t(o,'forward','\"to\"'),r&&(s.config=r),lt(a({parent:n,child:o,meta:s,family:{},regional:1}))},ut=(e,t)=>{if(J(t)||B('.watch argument should be a function'),He){let t=He.nodeMap[ge(e).id];t&&(e=t)}return lt(a({scope:{fn:t},node:[ie({fn:he})],parent:e,meta:{op:'watch'},family:{owners:e},regional:1}))};const pt=(e,t)=>(V(e)&&(pt(ve(e),t),null!=e.name&&(V(e.name)?pt(e.name,t):J(e.name)?t.handler=e.name:t.name=e.name),e.loc&&(t.loc=e.loc),(e.sid||null===e.sid)&&(t.sid=e.sid),e.handler&&(t.handler=e.handler),e.updateFilter&&(t.updateFilter=e.updateFilter),xe(e)&&(t.parent=xe(e)),'strict'in e&&(t.strict=e.strict),e.named&&(t.named=e.named),pt(we(e),t)),t);let dt,mt=(e,t,r=\"event\")=>{xe(e)&&xe(e).hooks[r](t)},ht=(e,t,r,a)=>{let n=pt({name:a,config:r},{}),o=\"domain\"===e,s=Q(),{parent:i=null,sid:f=null,strict:c=1,named:u=null}=n,p=u||n.name||(o?'':s),d=l(p,i),m={unit:t.kind=e,name:t.shortName=p,sid:t.sid=Oe(f),named:u,unitId:t.id=s};if(t.parent=i,t.compositeName=d,t.defaultConfig=n,t.thru=e=>e(t),t.getType=()=>d.fullName,!o){t.subscribe=e=>(K(e),t.watch(J(e)?e:t=>{e.next&&e.next(t)})),t[_]=()=>t;let e=je();e&&(m.nativeTemplate=e)}return dt=c,m},gt=e=>c({named:e});const yt=(e,t,r,a)=>ft(e,t,{scope:{fn:a},node:[se({fn:he})],meta:{op:r}}),kt=(e,t,r,a)=>{let n;V(r)&&(n=r,r=r.fn);let o=c(Xe(e,' →? *'),n);return ft(e,o,{scope:{fn:r},node:a,meta:{op:t}}),o},bt=(e,t,r,a,n,o)=>{let s=be(t),l=[ne({store:s,to:\"a\"}),se({fn:a?me:de}),oe.defined(),oe.changed({store:s}),o&&le({fn:(e,t,{a:r})=>o(e,r)}),fe({store:s})],i=je();if(i&&(l.unshift(i.loader),l.push(i.upward),W(e))){let t=be(e);tt(i.plain,t)||(tt(i.closure,t)||i.closure.push(t),s.before||(s.before=[]),s.before.push({type:'closure',of:t}))}return ft(e,t,{scope:{fn:n},node:l,meta:{op:r}})},vt=e=>t=>e(...t),wt=(e,t,r,a)=>{let n=e?e=>e.slice():e=>({...e}),s=e?[]:{},l=je(),f=n(s),c=ue(f),p=ue(1);c.type=e?'list':'shape',l&&l.plain.push(c,p);let d=u(f,{name:r||o(t)});ge(d).meta.isCombine=1;let m=[oe.defined(),ne({store:c,to:\"a\"}),le({fn:(e,{key:t},{a:r})=>e!==r[t]}),ne({store:p,to:'b'}),se({fn(e,{clone:t,key:r},a){a.b&&(a.a=t(a.a)),a.a[r]=e}}),ne({from:\"a\",target:c}),ne({from:\"value\",store:0,target:p}),ae({priority:\"barrier\"}),ne({from:\"value\",store:1,target:p}),ne({store:c}),a&&se({fn:a}),oe.changed({store:be(d)})],h=c.before=[];return i(t,((e,t)=>{if(!W(e))return void(f[t]=s[t]=e);s[t]=e.defaultState,f[t]=e.getState();let r=ft(e,d,{scope:{key:t,clone:n},node:m,meta:{op:'combine'}}),a=be(e);h.push({type:'field',field:t,from:a}),l&&(tt(l.plain,a)||r.seq.unshift(l.loader))})),d.defaultShape=t,c.after=[a?{type:$,to:be(d),fn:a}:{type:'copy',to:be(d)}],l||(d.defaultState=a?be(d).current=a(f):s),d};let St=({params:e,req:t,ok:r,anyway:a,stack:o})=>s=>n({target:[a,qt],params:[r?{status:'done',params:e,result:s}:{status:'fail',params:e,error:s},{fn:r?t.rs:t.rj,value:s}],defer:1,page:o.page,forkPage:Ne(o)}),qt=a({node:[ie({fn({fn:e,value:t}){e(t)}})],meta:{op:'fx',fx:'sidechain'}});const xt=(e,t,r)=>(e.create=t=>(n(e,t),t),ge(e).seq.push(se({fn:(e,t,r)=>(r.forkPage=null,e)})),e.watch((e=>{Ae(r,[e]),t.add(e),e.ownerSet||(e.ownerSet=t),xe(e)||(e.parent=r)})),Ae(r,[e]),r=>(t.forEach(r),e.watch(r))),Nt=['source','clock','target'],At=(e,t,r,a)=>{let o=e[t];o&&n({target:o,params:Array.isArray(o)?o.map((()=>r)):r,defer:1,stack:a})},Ct=\"21.8.12\";export{F as allSettled,h as attach,st as clearNode,p as combine,g as createApi,y as createDomain,m as createEffect,c as createEvent,a as createNode,u as createStore,p as createStoreObject,O as fork,ct as forward,k as fromObservable,w as guard,x as hydrate,U as is,n as launch,b as merge,S as restore,v as sample,C as scopeBind,A as serialize,s as setStoreName,q as split,ce as step,Ct as version,Pe as withFactory,r as withRegion};\n//# sourceMappingURL=effector.mjs.map\n","export function isArray(value: any): boolean {\n  return Array.isArray(value);\n}","export function isObject(value: any) {\n  const type = typeof value;\n  return value != null && (type === 'object' || type === 'function');\n}","// Unique ID creation requires a high quality random # generator. In the browser we therefore\n// require the crypto API and do not support built-in fallback to lower quality random number\n// generators (like Math.random()).\nvar getRandomValues;\nvar rnds8 = new Uint8Array(16);\nexport default function rng() {\n  // lazy load so that environments that need to polyfill have a chance to do so\n  if (!getRandomValues) {\n    // getRandomValues needs to be invoked in a context where \"this\" is a Crypto implementation. Also,\n    // find the complete implementation of crypto (msCrypto) on IE11.\n    getRandomValues = typeof crypto !== 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto) || typeof msCrypto !== 'undefined' && typeof msCrypto.getRandomValues === 'function' && msCrypto.getRandomValues.bind(msCrypto);\n\n    if (!getRandomValues) {\n      throw new Error('crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported');\n    }\n  }\n\n  return getRandomValues(rnds8);\n}","import REGEX from './regex.js';\n\nfunction validate(uuid) {\n  return typeof uuid === 'string' && REGEX.test(uuid);\n}\n\nexport default validate;","import rng from './rng.js';\nimport stringify from './stringify.js';\n\nfunction v4(options, buf, offset) {\n  options = options || {};\n  var rnds = options.random || (options.rng || rng)(); // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n\n  rnds[6] = rnds[6] & 0x0f | 0x40;\n  rnds[8] = rnds[8] & 0x3f | 0x80; // Copy bytes to buffer, if provided\n\n  if (buf) {\n    offset = offset || 0;\n\n    for (var i = 0; i < 16; ++i) {\n      buf[offset + i] = rnds[i];\n    }\n\n    return buf;\n  }\n\n  return stringify(rnds);\n}\n\nexport default v4;","import validate from './validate.js';\n/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\n\nvar byteToHex = [];\n\nfor (var i = 0; i < 256; ++i) {\n  byteToHex.push((i + 0x100).toString(16).substr(1));\n}\n\nfunction stringify(arr) {\n  var offset = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n  // Note: Be careful editing this code!  It's been tuned for performance\n  // and works in ways you may not expect. See https://github.com/uuidjs/uuid/pull/434\n  var uuid = (byteToHex[arr[offset + 0]] + byteToHex[arr[offset + 1]] + byteToHex[arr[offset + 2]] + byteToHex[arr[offset + 3]] + '-' + byteToHex[arr[offset + 4]] + byteToHex[arr[offset + 5]] + '-' + byteToHex[arr[offset + 6]] + byteToHex[arr[offset + 7]] + '-' + byteToHex[arr[offset + 8]] + byteToHex[arr[offset + 9]] + '-' + byteToHex[arr[offset + 10]] + byteToHex[arr[offset + 11]] + byteToHex[arr[offset + 12]] + byteToHex[arr[offset + 13]] + byteToHex[arr[offset + 14]] + byteToHex[arr[offset + 15]]).toLowerCase(); // Consistency check for valid UUID.  If this throws, it's likely due to one\n  // of the following:\n  // - One or more input array values don't map to a hex octet (leading to\n  // \"undefined\" in the uuid)\n  // - Invalid input values for the RFC `version` or `variant` fields\n\n  if (!validate(uuid)) {\n    throw TypeError('Stringified UUID is invalid');\n  }\n\n  return uuid;\n}\n\nexport default stringify;","export function isNil(value: any): boolean {\n  return value == null;\n}","export function mergeObjects<T extends Object, M extends Object>(obj1: T, obj2: M): T & M {\n  return {...obj1, ...obj2};\n}","export function trimStartSlash(str: String) {\n  return str.replace(/^\\//, \"\");\n}","import {forward} from 'effector';\nimport {$session, fetchSessionFx, sessionChanged, SessionModel} from './';\nimport API, {ApiRequestConfig} from './../../api';\nimport {debug} from \"../../../stories_widget/util/debug\";\nimport {ISessionInitData} from \"../Session2\";\nimport {$storyManagerConfig, configDeviceIdChanged} from \"../storyManagerConfig\";\nimport {Option} from \"../../../../global.h\";\nimport {StoryManager} from \"../../index\";\n\n\n// import {fetchUsersFx, $usersMap} from './';\n\n// fetchUsersFx.use(async () => fetch('/users'))\n//\n// addUserFx.use(async user =>\n//     fetch('/users', {\n//         method: 'POST',\n//         body: JSON.stringify(user),\n//     }),\n// )\n//\n// $usersMap.on(fetchUsersFx.doneData, (_, users) => users)\n//\n// forward({\n//     from: addUserFx.doneData,\n//     to: fetchUsersFx,\n// })\n\nexport async function getRequestConfig(): Promise<ApiRequestConfig> {\n    return {\n        method: \"post\",\n        url: \"session/open\",\n        params: {expand: \"cache\"},\n        data: completeDeviceData(await getDeviceData())\n    } as ApiRequestConfig;\n}\n\n\n// после запроса создать модель ?\n// can pass params\nfetchSessionFx.use(async () => {\n    // todo try catch\n    const response = await API.post<SessionModel>('session/open?expand=cache', completeDeviceData(await getDeviceData()));\n    // create instance via Abstract model ?\n  // или взять только поля из типа и их сохранить\n    return response.data;\n});\n\nforward({\n    from: sessionChanged,\n    to: $session\n});\n\n// forward({\n//     from: fetchSessionFx.doneData,\n//     to: $session\n// });\n\n// fetchSessionFx({});\n\nconst completeDeviceData = (data: ISessionInitData) => {\n    if (data.os_name === 'iOS') {\n        (window as any).isIos = true;\n    } else if (data.os_name === 'Android') {\n        (window as any).Android = true;\n    }\n\n    const configData = $storyManagerConfig.getState();\n    if (configData && configData.userId) {\n        data.user_id = configData.userId;\n    }\n\n    data.features = 'animation,data,deeplink,placeholder,resetTimers,gameReader,swipeUpItems';\n\n    // dispatch an action\n    // не нужно ?\n    // store.dispatch('user/updateDeviceId', data.device_id);\n\n    // debug(data)\n    return data;\n};\n\n// this.getDeviceId().then((data: ISessionInitData) => {\n//\n//     if (data.os_name === 'iOS') {\n//         (<any>window).isIos = true;\n//     } else if (data.os_name === 'Android') {\n//         (<any>window).Android = true;\n//     }\n//\n//     if (store.getters['shared/options']?.userId) {\n//         data.user_id = store.getters['shared/options']?.userId;\n//     }\n//\n//     // переехали в запрос списков\n//     // if (store.getters['stories/options']?.tags) {\n//     //     data.tags = store.getters['stories/options']?.tags;\n//     // }\n//\n//     data.features = 'animation,data,deeplink,placeholder,resetTimers,gameReader';\n//\n//     // dispatch an action\n//     // не нужно ?\n//     store.dispatch('user/updateDeviceId', data.device_id);\n//\n//     debug(data)\n//\n//     Session2.fetch(data).then(session => {\n//         sessionInitInProcess = false;\n//         // TODO activeModel - set\n//         if (!session) {\n//             reject(`Key session not exists in response ${session}`)\n//         }\n//\n//         // sync\n//         store.commit('shared/setSession', {session})\n//\n//\n//         //\n//\n//         ///,  и в Reader виджет вынести\n//\n//         if (session.rawData && session.rawData.share) {\n//             store.commit('shared/setHasShare', {status: true})\n//         }\n//\n//         store.commit('shared/addDefaultPlaceholders', {value: session.placeholders});\n//\n//\n//         resolve(session)\n//\n//         // save all to store\n//\n//         //   \"session\": {\n//         //     \"id\": \"3edd5f192dd39045c05f26f450205426\",\n//         //     \"expire_in\": 3600\n//         //   },\n//         //   \"server_timestamp\": 1531471495\n//\n//         // resolve(val)\n//     }, error => {\n//         sessionInitInProcess = false;\n//         debug(error);\n//     })\n//\n// });\n\n// move to helper\nconst getDeviceData = (): Promise<ISessionInitData> => {\n  return StoryManager.getInstance().getDeviceInfo(configDeviceIdChanged);\n}","export function isEmpty(obj: any): boolean {\n  return [Object, Array].includes((obj || {}).constructor) && !Object.entries((obj || {})).length;\n}","import {fetchStoriesFx, StoryModel} from './';\nimport API, {ApiRequestConfig} from './../../api';\nimport {$storyManagerConfig} from \"../storyManagerConfig\";\nimport {STORY_LIST_TYPE} from \"../../types\";\nimport {Option} from \"../../../../global.h\";\nimport {isArray} from \"../../../helpers/isArray\";\n\n\n// import {fetchUsersFx, $usersMap} from './';\n\n// fetchUsersFx.use(async () => fetch('/users'))\n//\n// addUserFx.use(async user =>\n//     fetch('/users', {\n//         method: 'POST',\n//         body: JSON.stringify(user),\n//     }),\n// )\n//\n// $usersMap.on(fetchUsersFx.doneData, (_, users) => users)\n//\n// forward({\n//     from: addUserFx.doneData,\n//     to: fetchUsersFx,\n// })\n\n\n// после запроса создать модель ?\n// can pass params\n\nexport function getRequestConfig(listType: STORY_LIST_TYPE, compositeSessionIdRef?: Option<string>, customTags?: Array<string>): ApiRequestConfig {\n    let url = \"story\";\n    if (listType === STORY_LIST_TYPE.onboarding) {\n        url = \"story-onboarding\";\n    }\n    return {\n        method: \"get\",\n        url,\n        ...configForListRequest(listType, compositeSessionIdRef, customTags)\n    } as ApiRequestConfig;\n}\n\nexport function storySlidesGetRequestConfig(id: number | string, allFields = false, compositeSessionIdRef?: Option<string>): ApiRequestConfig {\n  const config: ApiRequestConfig = {\n    url: `story/${id}`,\n    method: \"get\",\n    params: {expand: ['slides_html', 'slides_duration'].join(',')},\n  };\n  if (!allFields && config.params) {\n    config.params.fields = ['id', 'slides_html', 'slides_duration'].join(',');\n  }\n  if (compositeSessionIdRef !== null && config.params) {\n    config.params.session_id = compositeSessionIdRef;\n  }\n  return config;\n}\n\n\n\nfetchStoriesFx.use(async ({listType}) => API.get<StoryModel>('story', configForListRequest(listType)));\n\nconst configForListRequest = (listType: STORY_LIST_TYPE, compositeSessionIdRef?: Option<string>, customTags?: Array<string>) => {\n    let tags = $storyManagerConfig.getState()?.tags;\n    const params: {tags?: Option<string>, favorite?: number, session_id?: string} = {};\n    if (tags && isArray(tags) && tags.length > 0) {\n        params.tags = tags.join(',');\n    }\n    if (customTags !== undefined && isArray(customTags) && customTags.length > 0) {\n      params.tags = customTags.join(',');\n    }\n    if (listType === STORY_LIST_TYPE.favorite) {\n        params.favorite = 1;\n    }\n\n    if (compositeSessionIdRef) {\n        params.session_id = compositeSessionIdRef;\n    }\n    return {params};\n};\n\n\n// forward({\n//     from: fetchSessionFx.doneData,\n//     to: $session\n// });\n\n// fetchSessionFx({});","import {$storyContext, fetchStoryContextFx, storyContextChanged} from './';\nimport API, {ApiRequestConfig} from './../../api';\nimport {forward} from \"effector\";\nimport {Option} from \"../../../../global.h\";\nimport {isObject} from \"../../../helpers/isObject\";\n\n// после запроса создать модель ?\n// can pass params\n\n\nexport function getRequestConfig(ids: Array<number | string>, compositeSessionIdRef?: Option<string>): ApiRequestConfig {\n  const config: ApiRequestConfig = {\n    url: `story-context`,\n    method: \"get\",\n    params: {\n      id: ids.join(',')\n    },\n  };\n  if (compositeSessionIdRef !== null && config.params) {\n    config.params.session_id = compositeSessionIdRef;\n  }\n  return config;\n}\n\nfetchStoryContextFx.use(async ({ids}) => API.request(getRequestConfig(ids)));\n\nforward({from: fetchStoryContextFx.done.filterMap(payload => {\n    const context = payload.result.data;\n    if (context && isObject(context)) {\n      return {...context, ids: payload.params.ids};\n    }\n    return undefined;\n  }), to: $storyContext});\nforward({from: storyContextChanged, to: $storyContext});","//Taken from https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions\r\nfunction escapeRegExp(val: string) {\r\n  return val.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'); // $& means the whole matched string\r\n}\r\n\r\n// replaceAll does not work in safari\r\nexport function replaceAll(val: string, match: string, replacement: string) {\r\n  return String(val).replace(new RegExp(escapeRegExp(match), 'g'), () => replacement);\r\n}","export function isFunction(func: any): boolean {\n  return typeof func === \"function\";\n}","export function isString(str: any){\n  if (str != null && typeof str.valueOf() === \"string\") {\n    return true\n  }\n  return false\n}","export function extend(target: any, source: any, overwrite: boolean): any {\n  for (const key in source) {\n    if (source.hasOwnProperty(key)) {\n      if (overwrite || target[key] === undefined) {\n        target[key] = source[key];\n      }\n    }\n  }\n  return target;\n}\n\nexport enum BlobContentType {\n  CSS = 'text/css',\n  JS = 'text/javascript',\n  HTML = 'text/html',\n}\n\nexport function getBlobURL(code: string, type: BlobContentType): string {\n  const blob = new Blob([code], {type})\n  return URL.createObjectURL(blob)\n}","import {createEvent, clearNode, Effect, Domain} from \"effector\";\nimport {IWorkerServer} from \"../IWorkerServer\";\nimport {Dict} from \"../../../global.h\";\nimport {IWorkerClient} from \"../IWorkerClient\";\nimport {create as createDuplex} from \"./duplex\";\n\n\nexport function create(domains: {serverFxDomain: Domain, clientFxDomain: Domain}, worker: IWorkerClient) {\n\n  createDuplex({\n    fxSenderDomain: domains.clientFxDomain,\n    fxReceiverDomain: domains.serverFxDomain\n  }, worker);\n\n}\n\n","import {createEvent, Effect} from \"effector\";\nimport {IWorkerServer} from \"../IWorkerServer\";\nimport {IWorkerClient} from \"../IWorkerClient\";\nimport {RpcDomains} from \"./duplex.h\";\nimport {Message, MessageStatus, MessageType} from \"../index.h\";\nimport {Option, Dict} from \"../../../global.h\";\n\nlet nextID = 0;\n\nclass Defer {\n\n  public id = ++nextID;\n  public rs: (data: any) => void = () => {\n  };\n  public rj: (error: any) => void = () => {\n  };\n  public req: Promise<any>;\n\n  constructor() {\n    reqMap.set(this.id, this);\n    const req = new Promise((rs, rj) => {\n      this.rs = rs;\n      this.rj = rj;\n    })\n    req\n      .finally(() => {\n        reqMap.delete(this.id)\n      })\n      .catch(() => {\n      })\n    this.req = req;\n  }\n}\n\nconst reqMap = new Map<number, Defer>();\n\nconst fxMap = new Map<string, Effect<any, any, any>>();\n\n\nexport function create(domains: RpcDomains, worker: IWorkerServer | IWorkerClient) {\n\n  const onMessage = createEvent<Dict>();\n\n  worker.onmessage = onMessage;\n\n  onMessage.watch((data) => {\n    if (Object(data) !== data) return;\n    if (!data.sid) return;\n    if (!data.id) return;\n\n    handleFxResponse(data as Message);\n    handleFx(data as Message, worker);\n  });\n\n\n  // fx for work on this side\n  domains.fxReceiverDomain.onCreateEffect((fx: Effect<any, any, any>) => {\n    // fx.sid only with \"effector/babel-plugin\"\n\n    // console.log('onCreateEffect', {fx});\n\n    fxMap.set(fx.shortName, fx);\n  });\n\n  // fx for send from this side\n  domains.fxSenderDomain.onCreateEffect((fx: Effect<any, any, any>) => {\n    console.log('fxSenderDomain onCreateEffect', {fx});\n\n    fx.use(params => {\n      const defer = new Defer();\n      worker.sendMessage({\n        id: defer.id,\n        // use (fx.sid || fx.shortName) only with \"effector/babel-plugin\"\n        sid: fx.shortName,\n        type: MessageType.REQUEST,\n        params,\n      });\n      return defer.req;\n    });\n  });\n\n\n}\n\nfunction handleFxResponse(message: Message) {\n  if (message.type !== MessageType.RESPONSE) return;\n  const req = reqMap.get(message.id);\n  if (!req) return;\n  if (message.status === MessageStatus.SUCCESS) {\n    req.rs(message.result);\n  } else {\n    if ('raw' in message.error) {\n      req.rj(message.error.raw);\n      return;\n    }\n    const error = Error('');\n    if ('name' in message.error) error.name = message.error.name;\n    if ('message' in message.error) error.message = message.error.message;\n    if ('stack' in message.error) error.stack = message.error.stack;\n    if ('code' in message.error) (error as any).code = message.error.code;\n    req.rj(error);\n  }\n}\n\nasync function handleFx(message: Message, worker: IWorkerServer | IWorkerClient) {\n  if (message.type !== MessageType.REQUEST) return;\n  const fx = fxMap.get(message.sid);\n  if (!fx) {\n    worker.sendMessage({\n      id: message.id,\n      sid: message.sid,\n      type: MessageType.RESPONSE,\n      status: MessageStatus.ERROR,\n      error: {\n        name: 'RemoteFXError',\n        message: `Unknown sid \"${message.sid}\"`,\n      },\n    });\n    return;\n  }\n  console.log({\"onMessage watch\": 3, message});\n  await fx(message.params)\n    .then(result => {\n      //@ts-ignore\n      worker.sendMessage({\n        id: message.id,\n        sid: message.sid,\n        type: MessageType.RESPONSE,\n        status: MessageStatus.SUCCESS,\n        result,\n      })\n    })\n    .catch(error => {\n      const serialized: {\n        raw?: any,\n        name?: any,\n        code?: any,\n        message?: any,\n        stack?: any,\n      } = {};\n\n      if (error instanceof Error) {\n        serialized.name = (error as any).name;\n        if ('code' in error) serialized.code = (error as any).code;\n        if ('message' in error) serialized.message = (error as any).message;\n        if ('stack' in error) serialized.stack = (error as any).stack;\n      } else {\n        serialized.raw = error;\n      }\n      worker.sendMessage({\n        id: message.id,\n        sid: message.sid,\n        type: MessageType.RESPONSE,\n        status: MessageStatus.ERROR,\n        error: serialized,\n      });\n\n    })\n\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n","import {MutationPayload} from \"vuex\";\n\nimport {StoryContextModel} from \"./models/storyContext\";\nimport {StoryModel} from \"./models/story\";\nimport {Brand} from \"../../global.h\";\n\nexport type Url = Brand<string, \"url\">;\n\nexport type ClickOnStoryInternalPayload = {\n    id: number;\n    listType: STORY_LIST_TYPE;\n    windowReferer: STORY_READER_WINDOW_REFERER\n};\nexport type ClickOnStoryInternalWithDataPayload = ClickOnStoryInternalPayload & {\n    storyContext: StoryContextModel,\n    storyList: Array<StoryModel>,\n};\n\nexport type ClickOnButtonPayload = {\n    id: number;\n    index: number;\n    url: Url;\n    elementId: string;\n};\n\nexport type ClickOnStoryPayload = ClickOnButtonPayload & {\n    isDeeplink: boolean;\n};\n\nexport type ClickOnFavoriteCellInternalPayload = {\n    id: number;\n    storyList: Array<StoryModel>;\n    listType: STORY_LIST_TYPE;\n};\n\nexport type SyncStoreEvent = {\n    mutation: MutationPayload;\n};\n\nexport enum STORY_READER_WINDOW_REFERER {\n    default,\n    favorite\n}\n\nexport type FontResource = {\n    type: 'font-face',\n    weight: string,\n    style: string,\n    title: string,\n    family: string,\n    url: string,\n};\n\n\nexport enum STORY_LIST_TYPE {\n    default,\n    onboarding,\n    favorite\n}\n\nexport enum StoriesEvents {\n    CLICK_ON_STORY = 'clickOnStoryLink',\n}\n\nexport type ClickOnSwipeUpPayload = ClickOnButtonPayload & {\n    modeDesktop: boolean;\n    width: number;\n    height: number;\n    verticalMargin: number;\n};\n","// import {createStore, createEffect} from 'effector'\n\n// export const fetchUsersFx = createEffect()\n//\n// //imagine initially we have users list as a key-value store\n// export const $usersMap = createStore({})\n//\n// //we need array representaion for our UI tasks\n// export const $users = $usersMap.map(usersMap => Object.values(usersMap))\n\n\nimport {createApi, createEvent, createStore, forward, Event} from 'effector';\nimport {StoryManagerConfig, StoryManagerConfigDefault} from \"../../types/storyManager/storyManager\";\nimport {DeviceId} from \"./index.h\";\n\nconst $storyManagerConfig = createStore<StoryManagerConfig>(StoryManagerConfigDefault);\n\n// const {storyManagerConfigChanged}: {storyManagerConfigChanged: Event<StoryManagerConfig>} = createApi($storyManagerConfig, {\n//   storyManagerConfigChanged: (state, config) => config,\n// });\n\nconst storyManagerConfigChanged = createEvent<StoryManagerConfig>();\n$storyManagerConfig.on(storyManagerConfigChanged, (state, config) => config);\n\nconst storyManagerConfigTagsChanged = createEvent<Pick<StoryManagerConfig, \"tags\">>();\n$storyManagerConfig.on(storyManagerConfigTagsChanged, (state, {tags}) => ({...state, tags}));\n\nconst storyManagerConfigUserIdChanged = createEvent<Pick<StoryManagerConfig, \"userId\">>();\n$storyManagerConfig.on(storyManagerConfigUserIdChanged, (state, {userId}) => ({...state, userId}));\n\nconst storyManagerConfigPlaceholdersChanged = createEvent<Pick<StoryManagerConfig, \"placeholders\">>();\n$storyManagerConfig.on(storyManagerConfigPlaceholdersChanged, (state, {placeholders}) => ({...state, placeholders}));\n\nconst storyManagerConfigLangChanged = createEvent<Pick<StoryManagerConfig, \"lang\">>();\n$storyManagerConfig.on(storyManagerConfigLangChanged, (state, {lang}) => ({...state, lang}));\n\nconst storyManagerConfigIsSandboxChanged = createEvent<Pick<StoryManagerConfig, \"isSandbox\">>();\n$storyManagerConfig.on(storyManagerConfigIsSandboxChanged, (state, {isSandbox}) => ({...state, isSandbox}));\n\nconst storyManagerConfigApiKeyChanged = createEvent<Pick<StoryManagerConfig, \"apiKey\">>();\n$storyManagerConfig.on(storyManagerConfigApiKeyChanged, (state, {apiKey}) => ({...state, apiKey}));\n\n\n// $config.watch(s => console.log(s));\n\n\nconst $configDeviceId = createStore<DeviceId>('' as DeviceId);\nconst configDeviceIdChanged = createEvent<DeviceId>();\nforward({\n    from: configDeviceIdChanged,\n    to: $configDeviceId\n});\n\n\nexport {$storyManagerConfig, storyManagerConfigChanged, $configDeviceId, configDeviceIdChanged, storyManagerConfigTagsChanged, storyManagerConfigPlaceholdersChanged, storyManagerConfigUserIdChanged, storyManagerConfigLangChanged, storyManagerConfigIsSandboxChanged, storyManagerConfigApiKeyChanged};\n","import {Dict, Optional} from \"../index\";\n\nexport type StoryManagerConfig = {\n  isSandbox?: boolean;\n  apiKey: string;\n  userId?: Optional<string|number>;\n  tags?: Optional<Array<string>>;\n  placeholders?: Optional<Dict<string>>;\n  lang?: Optional<'ru' | 'en'>;\n};\n\n\nconst StoryManagerConfigDefault: StoryManagerConfig = {\n  apiKey: \"\",\n  isSandbox: false,\n};\n\nexport {StoryManagerConfigDefault};","import {createApi, createStore} from 'effector';\nimport {SessionPlaceholderModel} from \"../session\";\nimport {isArray} from \"../../../helpers/isArray\";\nimport {isObject} from \"../../../helpers/isObject\";\n\nexport type Placeholders = Dict<string>;\nconst $placeholders = createStore<Placeholders>({});\n\nconst {sdkPlaceholdersChanged, addDefaultPlaceholders} = createApi($placeholders, {\n  sdkPlaceholdersChanged: (state: Placeholders, data: Placeholders) => data,\n  addDefaultPlaceholders: (state: Placeholders, data: Array<SessionPlaceholderModel>) => {\n    let _placeholders: Placeholders = {};\n    if (isArray(data)) {\n      data.forEach(item => {\n        if (isObject(item) && item['name'] !== undefined && item['default_value'] !== undefined) {\n          _placeholders[item['name']] = item['default_value'];\n        }\n      });\n    }\n    return _placeholders;\n  }\n});\n\nexport {$placeholders, sdkPlaceholdersChanged, addDefaultPlaceholders};\n","import {IData} from \"../story-manager/types\";\n\nexport class Utility {\n    public static createFunctionWithTimeout(cb: () => void, opt_timeout?: number): () => void {\n        let called = false;\n\n        function fn() {\n            if (!called) {\n                called = true;\n                cb();\n            }\n        }\n\n        setTimeout(fn, opt_timeout || 1000);\n        return fn;\n    }\n\n    public static convertModelToFormData(formData: FormData, data: IData, previousKey?: string) {\n        if (data instanceof Object) {\n            Object.keys(data).forEach(key => {\n                const value = (data as any)[key];\n                if (value instanceof Object && !Array.isArray(value)) {\n                    return this.convertModelToFormData(formData, value, key);\n                }\n                if (previousKey) {\n                    key = `${previousKey}[${key}]`;\n                }\n                if (Array.isArray(value)) {\n                    value.forEach(val => {\n                        formData.append(`${key}[]`, val);\n                    });\n                } else {\n                    formData.append(key, value);\n                }\n            });\n        }\n    }\n\n    // public static convertModelToFormData(model: any, form?: FormData, namespace = ''): FormData {\n    //     let formData = form || new FormData();\n    //     let formKey;\n    //\n    //     for (let propertyName in model) {\n    //         if (!model.hasOwnProperty(propertyName) || !model[propertyName]) continue;\n    //         let formKey = namespace ? `${namespace}[${propertyName}]` : propertyName;\n    //         if (model[propertyName] instanceof Date)\n    //             formData.append(formKey, model[propertyName].toISOString());\n    //         else if (model[propertyName] instanceof Array) {\n    //             model[propertyName].forEach((element: any, index: any) => {\n    //                 const tempFormKey = `${formKey}[${index}]`;\n    //                 this.convertModelToFormData(element, formData, tempFormKey);\n    //             });\n    //         }\n    //         else if (typeof model[propertyName] === 'object' && !(model[propertyName] instanceof File))\n    //             this.convertModelToFormData(model[propertyName], formData, formKey);\n    //         else\n    //             formData.append(formKey, model[propertyName].toString());\n    //     }\n    //     return formData;\n    // }\n}","export default /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;","\n\nimport {$storyManagerConfig, $configDeviceId} from \"../models/storyManagerConfig\";\nimport {$session} from \"../models/session\";\n\nimport {Utility} from \"../../helpers/utility\";\n\n// import {stringify as qsStringify} from \"qs\";\nfunction qsStringify(elements: Dict) {\nreturn '';\n}\n\nconst baseURL = process.env.API_URL as string;\nconst baseURLSandbox = process.env.API_URL_SANDBOX as string;\nconst apiVersion = 'v2';\n\nexport type ApiRequestConfigMethod = 'get' | 'post' | 'patch' | 'put' | 'delete';\n\nexport type ApiRequestConfig = {\n  url: string,\n  method: ApiRequestConfigMethod,\n  params?: Dict,\n  data?: Dict,\n  headers?: Dict\n}\n\nexport type ApiResponse<ResponseData = {}> = {\n  data: ResponseData,\n  headersRaw: Headers,\n  headers: Dict<string>,\n  status: number,\n  statusText: string,\n  ok: boolean,\n}\n\nclass API {\n  public get baseURL() {\n    return $storyManagerConfig.getState().isSandbox ? baseURLSandbox : baseURL;\n  }\n  private requestInterceptors: Array<(config: ApiRequestConfig) => void> = [];\n\n  public interceptors = {\n    request: {\n      use: (cb: (config: ApiRequestConfig) => void) => {\n        this.requestInterceptors.push(cb);\n      }\n    }\n  }\n\n  public async request<ResponseData>(config: ApiRequestConfig): Promise<ApiResponse<ResponseData>> {\n    try {\n\n      if (this.requestInterceptors.length) {\n        for (const interceptor of this.requestInterceptors) {\n          interceptor(config);\n        }\n      }\n\n      let url = new URL(`/${apiVersion}/${trimStartSlash(config.url)}`, this.baseURL);\n      if (!isNil(config.params) && isObject(config.params)) {\n        url.search = qsStringify(config.params);\n      }\n\n      let method = 'get';\n      if (!isNil(config.method)) {\n        method = config.method;\n      }\n\n      let headers: Dict = {};\n      if (!isNil(config.headers) && isObject(config.headers)) {\n        headers = config.headers;\n      }\n\n      let body = null;\n      if (!isNil(config.data) && isObject(config.data)) {\n        body = JSON.stringify(config.data);\n        headers[\"Content-Type\"] = \"application/json\";\n      }\n\n      const response = await fetch(url.toString(), {\n        method, body, headers, credentials: \"omit\"\n      });\n      const json = await response.json();\n\n\n      return {\n        data: json as ResponseData,\n        headersRaw: response.headers,\n        headers: Object.fromEntries([...response.headers]),\n        status: response.status,\n        statusText: response.statusText,\n        ok: response.ok\n      };\n\n    } catch (e) {\n      throw e;\n    }\n\n  }\n\n  public async post<ResponseData>(path: string, data: Dict) {\n    return this.request<ResponseData>({method: 'post', url: path, data});\n  }\n\n  public async get<ResponseData>(path: string, params: Dict) {\n    return this.request<ResponseData>({method: 'get', url: path, params});\n  }\n\n\n\n}\n\nconst APIInstance = new API();\n\nimport {v4 as uuidV4} from \"uuid\";\nimport {Dict} from \"../../../global.h\";\nimport {isNil} from \"../../helpers/isNil\";\nimport {isObject} from \"../../helpers/isObject\";\nimport {mergeObjects} from \"../../helpers/mergeObjects\";\nimport {trimStartSlash} from \"../../helpers/trimStartSlash\";\nimport {trimEndSlash} from \"../../helpers/trimEndSlash\";\n\nAPIInstance.interceptors.request.use(config => {\n\n  config.headers = mergeObjects(config.headers,  {\n    Authorization: `Bearer ${$storyManagerConfig.getState().apiKey}`,\n    \"Accept-Language\": $storyManagerConfig.getState().lang,\n    \"Auth-Session-Id\": $session.getState()?.session?.id,\n    \"X-Device-Id\": $configDeviceId.getState(),\n    \"X-User-Id\": $storyManagerConfig.getState().userId,\n    \"X-Request-Id\": uuidV4(),\n    \"X-Sdk-Version\": process.env.BUILD_VERSION,\n\n    // \"User-Agent\":\n    });\n\n  return config;\n\n});\n\nexport function APISendBeacon(path: string, data: Dict, cb: () => void): void {\n  if (\"sendBeacon\" in navigator) {\n\n    const url = `${trimEndSlash(baseURL)}/${trimStartSlash(path)}?access_token=${$storyManagerConfig.getState().apiKey}&session_id=${$session.getState()?.session?.id}`;\n\n    const formData = new FormData();\n    Object.keys(data).forEach((key) => {\n      Utility.convertModelToFormData(formData, data[key], key);\n    });\n\n    navigator.sendBeacon(url, formData);\n\n    cb();\n\n  } else {\n    APIInstance.post(path, data).then(() => cb(), () => cb());\n  }\n}\n\nexport default APIInstance;\n\n// usage\n/**\n * import API from '../api';\n *\n * const response = await API.delete(`users/${this.state.id}`);\n * console.log(response);\n * console.log(response.data);\n *\n *\n *\n * init sdk\n * первый же запрос - open session\n * и дальше готовы к работе\n *\n *\n *\n */","// import {createStore, createEffect} from 'effector'\n\n// export const fetchUsersFx = createEffect()\n//\n// //imagine initially we have users list as a key-value store\n// export const $usersMap = createStore({})\n//\n// //we need array representation for our UI tasks\n// export const $users = $usersMap.map(usersMap => Object.values(usersMap))\n\nimport API from './../../api';\nimport {createStore, createEvent, createEffect, createDomain, forward} from 'effector';\n\nexport type CacheResourceModel = {\n  url: string,\n  weight: string,\n  style: string,\n  title: string,\n  family: string,\n  type: 'font-face' | 'file',\n  format: string\n};\n\nexport type SessionPlaceholderModel = {\n  name: string,\n  default_value: string\n};\n\nexport type SessionInnerModel = {\n  id: string,\n  expire_in: number\n};\n\nexport type SessionModel = {\n  session: SessionInnerModel,\n  server_timestamp: number,\n  content_base_url: string,\n  user_key: string, // Anonymized user id\n  share: boolean, // Flag allow user share or not\n  is_allow_profiling: boolean, // Flag allow collect profiling for this session\n  cache: Array<CacheResourceModel>,\n  placeholders: Array<SessionPlaceholderModel>,\n};\n\nconst $session = createStore<SessionModel>({\n  session: {id: '', expire_in: 0},\n  server_timestamp: 0,\n  content_base_url: '',\n  user_key: '',\n  share: false,\n  is_allow_profiling: false,\n  cache: [],\n  placeholders: []\n});\n\nconst fetchSessionFx = createEffect<{}, SessionModel, Error>();\n\n$session.on(fetchSessionFx.doneData, (_, session: SessionModel) => session);\n\nconst sessionChanged = createEvent<SessionModel>();\n\n// const configChanged = createEvent<WidgetStoriesConfig>();\n// forward({\n//     from: configChanged,\n//     to: $config\n// });\n//\n// $session.watch(s => console.log(s));\n\n\nconst sessionHandleFlushThumbViewsFx = createEffect((payload: {data: Array<any>}) => {\n  API.post('session/update', payload);\n});\n\nconst sessionThumbViewsChanged = sessionHandleFlushThumbViewsFx.prepend((ids: Array<number>) => ({\n    // state.data.push([\n    //     action,\n    //     state.lastIndex,\n    //     storyId,\n    //     slideIndex,\n    //     slideDuration\n    // ]);\n    // state.lastIndex++\n    data: [[\n      5, //action: 5, // Прочтение\n      0, // lastIndex\n      ...ids,  // ids story,\n    ]]\n  })\n);\n\n\n\n\n\nexport {$session, fetchSessionFx, sessionChanged, sessionThumbViewsChanged};\n","import {MutationPayload} from \"vuex\";\r\n\r\nimport {StoryContextModel} from \"~/src/storyManager/models/storyContext\";\r\nimport {StoryModel} from \"~/src/storyManager/models/story\";\r\n\r\nexport type Url = Brand<string, \"url\">;\r\n\r\nexport type ClickOnStoryInternalPayload = {\r\n    id: number;\r\n    listType: STORY_LIST_TYPE;\r\n    windowReferer: STORY_READER_WINDOW_REFERER\r\n};\r\nexport type ClickOnStoryInternalWithDataPayload = ClickOnStoryInternalPayload & {\r\n  storyContext: StoryContextModel,\r\n  storyList: Array<StoryModel>,\r\n};\r\n\r\n\r\n\r\nexport type ClickOnButtonPayload = {\r\n    id: number;\r\n    index: number;\r\n    url: Url;\r\n    elementId: string;\r\n};\r\n\r\nexport type ClickOnStoryPayload = ClickOnButtonPayload & {\r\n    isDeeplink: boolean;\r\n};\r\n\r\nexport type ClickOnFavoriteCellInternalPayload = {\r\n    id: number;\r\n  storyList: Array<StoryModel>;\r\n  listType: STORY_LIST_TYPE;\r\n};\r\n\r\nexport type SyncStoreEvent = {\r\n    mutation: MutationPayload;\r\n};\r\n\r\nexport enum STORY_READER_WINDOW_REFERER {\r\n    default,\r\n    favorite\r\n}\r\n\r\nexport type FontResource = {\r\n  type: 'font-face',\r\n  weight: string,\r\n  style: string,\r\n  title: string,\r\n  family: string,\r\n  url: string,\r\n};\r\n\r\n\r\nexport enum STORY_LIST_TYPE {\r\n  default,\r\n  onboarding,\r\n  favorite\r\n}\r\n\r\nexport interface IData {\r\n  [key: string]: any;\r\n}\r\n\r\nexport type Optional<T> = T | null;\r\n\r\nexport type Dict<T = any> = {\r\n  [key: string]: T;\r\n}\r\n\r\n\r\nexport enum StoriesEvents {\r\n  CLICK_ON_STORY = 'clickOnStoryLink',\r\n}\r\n\r\nexport type ClickOnSwipeUpPayload = ClickOnButtonPayload & {\r\n  modeDesktop: boolean;\r\n  width: number;\r\n  height: number;\r\n  verticalMargin: number;\r\n};","// import {createStore, createEffect} from 'effector'\n\n// export const fetchUsersFx = createEffect()\n//\n// //imagine initially we have users list as a key-value store\n// export const $usersMap = createStore({})\n//\n// //we need array representation for our UI tasks\n// export const $users = $usersMap.map(usersMap => Object.values(usersMap))\n\n\nimport {createApi, createEffect, createStore} from 'effector';\nimport {STORY_LIST_TYPE} from \"../../types\";\nimport {$session} from \"../session\";\nimport {StoryManager} from \"../../index\";\nimport {isArray} from \"../../../helpers/isArray\";\nimport {isEmpty} from \"../../../helpers/isEmpty\";\n\nexport type StoryModel = {\n  id: number,\n  title: string,\n  title_color: string,\n  background: string, // img/video\n  background_color: string,\n  image: string,\n  display_to: number,\n  display_from: number,\n  slides_html: Array<number>, // expand\n  slides_duration: Array<number>,\n  favorite: boolean,\n  like: boolean,\n  slides_count: number,\n  deeplink: string,\n  hide_in_reader: boolean,\n  disable_close: boolean,\n  like_functional: boolean,\n  favorite_functional: boolean,\n  share_functional: boolean,\n  is_opened: boolean,\n  tags: string,\n  has_audio: boolean,\n  video_cover: string,\n  need_placeholders: boolean,\n  has_swipe_up: boolean,\n  sharePath: string,\n\n  slidesLoaded: boolean\n\n\n};\n\nconst $stories = createStore<Array<StoryModel>>([]);\nconst $storiesIds = createStore<Map<STORY_LIST_TYPE, Array<number>>>(new Map());\n\nconst $storiesDefault = createStore<Array<StoryModel>>([]);\nconst $storiesFavorite = createStore<Array<StoryModel>>([]);\nconst $storiesOnboarding = createStore<Array<StoryModel>>([]);\n\n$storiesDefault.on<any>([$storiesIds, $stories], (state, ids) => $stories.getState().filter(item => ($storiesIds.getState().get(STORY_LIST_TYPE.default) ?? []).indexOf(item.id) !== -1));\n$storiesFavorite.on<any>([$storiesIds, $stories], (state, ids) => $stories.getState().filter(item => ($storiesIds.getState().get(STORY_LIST_TYPE.favorite) ?? []).indexOf(item.id) !== -1));\n// width filter by ```is_opened```\n$storiesOnboarding.on<any>([$storiesIds, $stories], (state, ids) => $stories.getState().filter(item => ($storiesIds.getState().get(STORY_LIST_TYPE.onboarding) ?? []).indexOf(item.id) !== -1 && !item.is_opened));\n\n\nconst fetchStoriesFx = createEffect<{ listType: STORY_LIST_TYPE }, Array<StoryModel>, Error>();\n\n// localData isOpened\n// $stories.on(fetchStoriesFx.doneData, (_, stories: Array<StoryModel>) => stories);\n\nconst storyCheckLocalIsOpened = async (story: StoryModel, userKey: string = '') => {\n  if (story.is_opened) {\n    return story.is_opened;\n  }\n  const key = `u/${$session.getState().user_key}/s_opened` || userKey;\n  if (!isEmpty(key)) {\n    let data = await StoryManager.getInstance().localStorageGetArray<number>(key);\n    if (!isArray(data)) {\n      data = [];\n    }\n    if (data.indexOf(story.id) !== -1) {\n      return true;\n    }\n  }\n  return story.is_opened;\n}\n\n// const configChanged = createEvent<WidgetStoriesConfig>();\n// forward({\n//     from: configChanged,\n//     to: $config\n// });\n//\n// $stories.watch(s => console.log(`$stories.watch}`, s));\n// $storiesIds.watch(s => console.log(`$storiesIds.watch}`, s));\n// $storiesDefault.watch(s => console.log(`$storiesDefault.watch}`, s));\n// $storiesFavorite.watch(s => console.log(`$storiesFavorite.watch}`, s));\n// $storiesOnboarding.watch(s => console.log(`$storiesOnboarding.watch}`, s));\n\nconst $storiesIdsWithoutLoadedSlides = $stories.map(items => items.filter(item => !item.slidesLoaded).map(item => item.id));\n\nconst {storyItemFavoriteChanged, storyItemLikeChanged, storyItemIsOpenedChanged} = createApi($stories, {\n  storyItemFavoriteChanged: (state, {id, favorite}) => {\n    const models = state.slice(0);\n    const story = models.find(_ => _.id === id);\n    if (story !== undefined) {\n      story.favorite = favorite;\n    }\n    return models;\n  },\n  storyItemLikeChanged: (state, {id, like}) => {\n    const models = state.slice(0);\n    const story = models.find(_ => _.id === id);\n    if (story !== undefined) {\n      story.like = like;\n    }\n    return models;\n  },\n  storyItemIsOpenedChanged: (state, {id}) => {\n    const models = state.slice(0);\n    const story = models.find(_ => _.id === id);\n    if (story !== undefined) {\n      story.is_opened = true;\n    }\n    return models;\n  },\n\n});\n\n// const {storyFavoriteAdded, storyFavoriteDeleted} = createApi($storiesFavorite, {\n//     storyFavoriteAdded: (state, story: StoryModel) => state.concat([story]),\n//     storyFavoriteDeleted: (state, story: StoryModel) => state.filter(item => item.id !== story.id),\n//   }\n// );\n\nexport {\n  $stories,\n  $storiesIds,\n  fetchStoriesFx,\n  $storiesIdsWithoutLoadedSlides,\n  $storiesFavorite,\n  $storiesOnboarding,\n  $storiesDefault,\n  storyItemFavoriteChanged,\n  storyItemLikeChanged,\n  storyItemIsOpenedChanged,\n  storyCheckLocalIsOpened\n};\n","\n\n// context - for list ids\n\n\n\n\n\n// import {createStore, createEffect} from 'effector'\n\n// export const fetchUsersFx = createEffect()\n//\n// //imagine initially we have users list as a key-value store\n// export const $usersMap = createStore({})\n//\n// //we need array representation for our UI tasks\n// export const $users = $usersMap.map(usersMap => Object.values(usersMap))\n\n\nimport {createStore, createEvent, createEffect, createDomain, forward} from 'effector';\nimport {Option} from \"../../../../global.h\";\nimport {ApiResponse} from \"../../api\";\n\nexport type StoryContextModel = Option<{\n  style: string,\n  script: string,\n  ids: Array<number>\n}>;\n\nconst $storyContext = createStore<StoryContextModel>(null);\n// реализацию надо здесь же и писать\nconst fetchStoryContextFx = createEffect<{ids: Array<number>}, ApiResponse<StoryContextModel>, Error>();\nconst storyContextChanged = createEvent<StoryContextModel>();\n\n// $storyContext.watch((s, p) => console.log(`$storyContext.watch}`, s, p));\n\nexport {$storyContext, fetchStoryContextFx, storyContextChanged};\n","import './storyManagerConfig/init';\nimport './session/init';\nimport './story/init';\n\nimport API, {ApiRequestConfig} from './../api';\nimport {createApi, createEffect, Event, forward, sample} from \"effector\";\nimport {$session, SessionModel} from \"./session\";\nimport {getRequestConfig as sessionGetRequestConfig} from \"./session/init\";\nimport {getRequestConfig as storyContextGetRequestConfig} from \"./storyContext/init\";\nimport {\n  getRequestConfig as storyGetRequestConfig,\n  storySlidesGetRequestConfig\n} from \"./story/init\";\nimport {$stories, $storiesIds, storyCheckLocalIsOpened, StoryModel} from \"./story\";\nimport {$storyContext, StoryContextModel} from \"./storyContext\";\nimport {replaceAll} from \"../../stories_widget/util/string\";\nimport {$placeholders} from \"./placeholder\";\nimport {STORY_LIST_TYPE} from \"../types\";\nimport {Option, Dict} from \"../../../global.h\";\nimport {isEmpty} from \"../../helpers/isEmpty\";\nimport {isObject} from \"../../helpers/isObject\";\n\n\ntype CompositeResponseData<T = Dict<any>> = {\n  success: boolean,\n  compositeResponse: Array<{\n    ref: string,\n    body: T\n  }>,\n};\n\n\nconst fetchSessionAndStoriesCompositeFx = createEffect<{ defaultList: boolean, favoriteList: boolean, onboardingList: boolean, onboardingTags?: Array<string> },\n  Array<Dict>,\n  Error>(async ({defaultList, onboardingList, favoriteList, onboardingTags}): Promise<Array<Dict>> => {\n\n  // TODO custom tags for each list requests\n\n  const compositeRequest: Array<CompositeSubRequestData> = [];\n\n  const sessionId = $session.getState()?.session?.id;\n  let compositeSessionIdRef: Option<string> = null;\n  if (isEmpty(sessionId)) {\n    compositeRequest.push(getCompositeSubRequestDataFromRequestConfig(await sessionGetRequestConfig(), \"session\"));\n    compositeSessionIdRef = \"@{session.session.id}\";\n  }\n\n  if (defaultList) {\n    compositeRequest.push(getCompositeSubRequestDataFromRequestConfig(storyGetRequestConfig(STORY_LIST_TYPE.default, compositeSessionIdRef), \"storyList\"));\n  }\n\n  if (favoriteList) {\n    compositeRequest.push(getCompositeSubRequestDataFromRequestConfig(storyGetRequestConfig(STORY_LIST_TYPE.favorite, compositeSessionIdRef), \"storyFavoriteList\"));\n  }\n\n  if (onboardingList) {\n    compositeRequest.push(getCompositeSubRequestDataFromRequestConfig(storyGetRequestConfig(STORY_LIST_TYPE.onboarding, compositeSessionIdRef, onboardingTags), \"storyOnboardingList\"));\n  }\n\n  // todo try catch\n  const response = (await API.post<CompositeResponseData<Array<StoryModel>>>('composite', {compositeRequest}));\n\n  // console.log({data: response.data});\n\n  if (response.data && response.data.success && response.data.compositeResponse && Array.isArray(response.data.compositeResponse)) {\n    return response.data.compositeResponse;\n  }\n  return [];\n});\n\n// $session.on(fetchSessionFx.doneData, (_, session: Dict) => session);\n\n// const configChanged = createEvent<WidgetStoriesConfig>();\n// forward({\n//     from: configChanged,\n//     to: $config\n// });\n//\n\n// forward({\n//     from: fetchSessionFx.doneData,\n//     to: $session\n// });\n\ntype CompositeSubRequestData =\n  Pick<ApiRequestConfig, \"method\">\n  & { path?: string, qs?: Option<Dict>, body?: Option<Dict>, ref: string };\n\nconst getCompositeSubRequestDataFromRequestConfig = (config: ApiRequestConfig, ref: string): CompositeSubRequestData => {\n  const requestData: CompositeSubRequestData = {path: config.url, qs: config.params, body: config.data, ...config, ref};\n  return requestData;\n}\n\n\nconst replacePlaceholders = (value: string): string => {\n  for (let placeholdersKey in $placeholders.getState()) {\n    if ($placeholders.getState().hasOwnProperty(placeholdersKey)) {\n      value = replaceAll(value, `%${placeholdersKey}%`, $placeholders.getState()[placeholdersKey])\n    }\n  }\n  return value;\n};\n\nconst processStories = (list: Array<StoryModel> | undefined) => Array.isArray(list) ? list.map(item => ({\n  ...item,\n  title: item.need_placeholders ? replacePlaceholders(item.title) : item.title,\n  slidesLoaded: false,\n  is_opened: storyCheckLocalIsOpened(item)\n} as StoryModel)) : [];\n\n// продумать как проверять наличие полей в моделях\nforward({\n  from: fetchSessionAndStoriesCompositeFx.doneData.filterMap(list => list.find(item => item.ref === \"session\")?.body),\n  to: $session\n});\n\nsample({\n  source: $stories,\n  clock: $session,\n  fn: (source, clock) => source.map(item => ({...item, is_opened: storyCheckLocalIsOpened(item, clock.user_key)})),\n  target: $stories\n});\n\ntype StoriesListChangedEvent = {\n  listType: STORY_LIST_TYPE,\n  storyList: Array<StoryModel>\n};\nconst {storiesListItemsAdded} = createApi($stories, {\n    storiesListItemsAdded: (state, {listType, storyList}: StoriesListChangedEvent) => {\n      const ids = state.map(_ => _.id);\n      return [...state, ...storyList.filter(item => ids.indexOf(item.id) === -1)];\n    },\n\n  }\n);\nconst {storiesListIdsChanged} = createApi($storiesIds, {\n  storiesListIdsChanged: (state, {listType, storyList}: StoriesListChangedEvent) => {\n    const ids = new Map(state);\n    ids.set(listType, storyList.map(item => item.id));\n    return ids;\n  },\n});\n\nforward({\n  from: fetchSessionAndStoriesCompositeFx.doneData.filterMap(list => {\n    const storyList = processStories(list.find(item => item.ref === \"storyList\")?.body);\n    if (storyList.length > 0) {\n      return {\n        listType: STORY_LIST_TYPE.default,\n        storyList\n      };\n    }\n    return undefined;\n  }),\n  to: [storiesListItemsAdded, storiesListIdsChanged]\n});\nforward({\n  from: fetchSessionAndStoriesCompositeFx.doneData.filterMap(list => {\n    const storyList = processStories(list.find(item => item.ref === \"storyFavoriteList\")?.body);\n    if (storyList.length > 0) {\n      return {\n        listType: STORY_LIST_TYPE.favorite,\n        storyList\n      };\n    }\n    return undefined;\n  }),\n  to: [storiesListItemsAdded, storiesListIdsChanged]\n});\nforward({\n  from: fetchSessionAndStoriesCompositeFx.doneData.filterMap(list => {\n    // undefined - to prevent store trigger\n    const storyList = processStories(list.find(item => item.ref === \"storyOnboardingList\")?.body);\n\n    if (storyList.length > 0) {\n      return {\n        listType: STORY_LIST_TYPE.onboarding,\n        storyList\n      };\n    }\n    return undefined;\n  }),\n  to: [storiesListItemsAdded, storiesListIdsChanged]\n});\n\n\nconst fetchStoriesSlidesCompositeFx = createEffect<{ ids: Array<number> }, Array<{ body: StoryModel }>, Error>();\n\nfetchStoriesSlidesCompositeFx.use(async (params): Promise<Array<{ body: StoryModel }>> => {\n  const compositeRequest = params.ids.map(id => getCompositeSubRequestDataFromRequestConfig(storySlidesGetRequestConfig(id), `storySlides_${id}`));\n\n  // todo try catch\n  const response = await API.post<CompositeResponseData<StoryModel>>('composite', {compositeRequest});\n\n  // console.log({data: response.data});\n\n  if (response.data && response.data.success && response.data.compositeResponse && Array.isArray(response.data.compositeResponse)) {\n    return response.data.compositeResponse;\n  }\n  return [];\n});\n\nconst isStoryModel = (x: any): x is StoryModel => x && isObject(x) && (\"id\" in x);\nconst storySlidesReducer = (state: Array<StoryModel>, data: Array<{ body: StoryModel | StoryContextModel }>): Array<StoryModel> => {\n  if (Array.isArray(data) && Array.isArray(state)) {\n    return state.map(item => {\n      for (let i = 0; i < data.length; i++) {\n        // @ts-ignore\n        if (isStoryModel(data[i]?.body) && data[i]?.body?.id === item.id) {\n          return Object.assign({}, item, {\n            // @ts-ignore\n            slides_html: item.need_placeholders ? Array.from(data[i]?.body?.slides_html).map(item => replacePlaceholders(item)) : Array.from(data[i]?.body?.slides_html),\n            // @ts-ignore\n            slides_duration: data[i]?.body?.slides_duration,\n            slidesLoaded: true,\n            is_opened: storyCheckLocalIsOpened(item),\n          });\n        }\n      }\n      return item;\n    });\n  }\n  return state;\n};\n\n\nconst fetchStoriesContextAndStorySlidesCompositeFx = createEffect<{ ids: Array<number>, id: number }, Array<{ ref: string, body: StoryModel | StoryContextModel }>, Error>();\nfetchStoriesContextAndStorySlidesCompositeFx.use(async ({\n                                                          ids,\n                                                          id\n                                                        }): Promise<Array<{ ref: string, body: StoryModel | StoryContextModel }>> => {\n  const compositeRequest = [\n    getCompositeSubRequestDataFromRequestConfig(storySlidesGetRequestConfig(id), 'storySlides'),\n    getCompositeSubRequestDataFromRequestConfig(storyContextGetRequestConfig(ids), 'storyContext'),\n  ];\n\n  // todo try catch\n  const response = await API.post<CompositeResponseData<StoryModel|StoryContextModel>>('composite', {compositeRequest});\n\n  // console.log({data: response.data});\n\n  if (response.data && response.data.success && response.data.compositeResponse && Array.isArray(response.data.compositeResponse)) {\n    return response.data.compositeResponse;\n  }\n  return [];\n});\n\n// slides\n$stories.on<any>([fetchStoriesSlidesCompositeFx.doneData, fetchStoriesContextAndStorySlidesCompositeFx.doneData], storySlidesReducer);\n\nforward({\n  from: fetchStoriesContextAndStorySlidesCompositeFx.done.filterMap(list => {\n    const context = list.result.find(item => item.ref === \"storyContext\")?.body;\n    if (context && isObject(context)) {\n      return {...context, ids: list.params.ids};\n    }\n    return undefined;\n  }) as Event<Option<StoryContextModel>>,\n  to: $storyContext\n});\n\n// context and slides composite\n\n\n// split({\n//     source: fetchSessionAndStoriesCompositeFx,\n//     match: {\n//         session:\n//     }\n//\n// });\n\n\n/**\n * For load session, context, slides\n */\nconst fetchSessionAndStoryDataCompositeFx = createEffect<{ id: number | string}, Array<{ ref: string, body: SessionModel | StoryModel | StoryContextModel }>,\n  Error>(async ({id}): Promise<Array<{ ref: string, body: SessionModel | StoryModel | StoryContextModel }>> => {\n\n  const compositeRequest: Array<CompositeSubRequestData> = [];\n\n  const sessionId = $session.getState()?.session?.id;\n  let compositeSessionIdRef: Option<string> = null;\n  if (isEmpty(sessionId)) {\n    compositeRequest.push(getCompositeSubRequestDataFromRequestConfig(await sessionGetRequestConfig(), \"session\"));\n    compositeSessionIdRef = \"@{session.session.id}\";\n  }\n\n  compositeRequest.push(getCompositeSubRequestDataFromRequestConfig(storySlidesGetRequestConfig(id, true, compositeSessionIdRef), `story`));\n  compositeRequest.push(getCompositeSubRequestDataFromRequestConfig(storyContextGetRequestConfig([id], compositeSessionIdRef), 'storyContext'));\n\n  // todo try catch\n  const response = await API.post<CompositeResponseData<StoryModel|SessionModel|StoryContextModel>>('composite', {compositeRequest});\n\n  // console.log({data: response.data});\n\n  if (response.data && response.data.success && response.data.compositeResponse && Array.isArray(response.data.compositeResponse)) {\n    return response.data.compositeResponse;\n  }\n  if (response.data && !response.data.success) {\n    // todo 404 - part\n    // each - find error\n    throw Error('composite request error:' + JSON.stringify(response.data.compositeResponse));\n  }\n\n\n  return [];\n});\n\nconst isSessionModel = (item: any): item is SessionModel => {\n  return !!item\n}\nforward({\n  from: fetchSessionAndStoryDataCompositeFx.doneData.filterMap(list => {\n    const sessionModel = list.find(item => item.ref === \"session\")?.body;\n    if (sessionModel && isObject(sessionModel) && isSessionModel(sessionModel)) {\n      return sessionModel;\n    }\n    return undefined;\n  }),\n  to: $session\n});\n\nforward({\n  from: fetchSessionAndStoryDataCompositeFx.done.filterMap(list => {\n    const context = list.result.find(item => item.ref === \"storyContext\")?.body;\n    if (context && isObject(context)) {\n      // ids from back\n      return {...context, ids: [list.params.id]};\n    }\n    return undefined;\n  }) as Event<Option<StoryContextModel>>,\n  to: $storyContext\n});\n\n// slides\n$stories.on(fetchSessionAndStoryDataCompositeFx.doneData.filterMap(list => {\n  const story = list.find(item => item.ref === \"story\")?.body;\n  if (story && isObject(story)) {\n    return story;\n  }\n  return undefined;\n}), (state: Array<StoryModel>, data): Array<StoryModel> | undefined => {\n  if (!isStoryModel(data)) {\n    return undefined;\n  }\n\n  const newState = state.filter(_ => _.id !== (data as any)?.id).slice(0);\n  data = Object.assign(data, {\n    // @ts-ignore\n    slides_html: data.need_placeholders ? Array.from(data.slides_html).map(item => replacePlaceholders(item)) : Array.from(data.slides_html),\n    // @ts-ignore\n    slides_duration: data.slides_duration,\n    slidesLoaded: true,\n    is_opened: storyCheckLocalIsOpened(data),\n  });\n\n  newState.push(data);\n  return newState;\n});\n\n\n\nexport {\n  fetchSessionAndStoriesCompositeFx,\n  fetchStoriesSlidesCompositeFx,\n  fetchStoriesContextAndStorySlidesCompositeFx,\n  storiesListIdsChanged,\n  fetchSessionAndStoryDataCompositeFx\n};\n\n\n\n\n\n\n\n","import {Option, Dict} from \"../../global.h\";\r\n\r\nexport enum SharePageEvents {\r\n  START_LOADING = 'startLoading',\r\n  END_LOADING = 'endLoading',\r\n  CLOSE_STORY_READER = 'closeStoryReader',\r\n}\r\n\r\n\r\nexport type SharePageOptions = {\r\n\r\n  handleStartLoading?: () => void;\r\n  handleStopLoading?: (result: boolean) => void;\r\n\r\n  handleStoryReaderClose?: () => void;\r\n}\r\n","import {Dict, Option} from \"../../global.h\";\nimport {EventEmitter} from \"events\";\nimport {StoryManagerConfig} from \"./index.h\";\nimport {\n  ClickOnButtonPayload,\n  ClickOnFavoriteCellInternalPayload,\n  ClickOnStoryInternalPayload, ClickOnSwipeUpPayload,\n  StoriesEvents,\n  STORY_LIST_TYPE,\n  STORY_READER_WINDOW_REFERER\n} from \"./common.h\";\nimport {\n  $storyManagerConfig, configDeviceIdChanged, DeviceId, storyManagerConfigApiKeyChanged,\n  storyManagerConfigChanged, storyManagerConfigIsSandboxChanged,\n  storyManagerConfigLangChanged,\n  storyManagerConfigPlaceholdersChanged,\n  storyManagerConfigTagsChanged,\n  storyManagerConfigUserIdChanged\n} from \"./models/storyManagerConfig\";\nimport {sdkPlaceholdersChanged} from \"./models/placeholder\";\n\nimport {IWidgetStoriesList} from \"../widget-stories-list\";\n\n\n// import _StoryReader from \"./widget/_StoryReader\";\n\n// import {GoodsWidget} from \"~/src/storyManager/goodsWidget/GoodsWidget\";\n//\n// import _StoryFavorite from \"~/src/storyManager/widget/_StoryFavorite\";\n\nclass _StoryReader {}\nclass GoodsWidget {}\nclass _StoryFavorite {}\n\n\n// import {StoriesListClickEvent, StoriesListEvents} from \"./storiesList.h\";\n\nimport {\n  fetchSessionAndStoriesCompositeFx,\n  fetchSessionAndStoryDataCompositeFx,\n  fetchStoriesContextAndStorySlidesCompositeFx,\n  fetchStoriesSlidesCompositeFx,\n  storiesListIdsChanged\n} from \"./models/init\";\nimport {ObjectId} from \"../widget\";\nimport {createEffect, sample} from \"effector\";\nimport {\n  $stories,\n  $storiesDefault,\n  $storiesFavorite,\n  $storiesIdsWithoutLoadedSlides,\n  $storiesOnboarding,\n  storyItemFavoriteChanged,\n  storyItemIsOpenedChanged,\n  storyItemLikeChanged,\n  StoryModel\n} from \"./models/story\";\nimport API, {APISendBeacon} from \"./api\";\nimport {Utility} from \"../helpers/utility\";\nimport {$session, CacheResourceModel, sessionThumbViewsChanged} from \"./models/session\";\nimport {$storyContext, fetchStoryContextFx} from \"./models/storyContext\";\nimport {AppearanceManager} from \"./AppearanceManager\";\nimport {SharePageEvents, SharePageOptions} from \"./sharePage.h\";\nimport {StoryReaderOptions} from \"../widget-story-reader/index.h\";\nimport {ISessionInitData} from \"./models/Session2\";\nimport {IWidgetStoryReader} from \"../widget-story-reader\";\nimport {isArray} from \"../helpers/isArray\";\nimport {isFunction} from \"../helpers/isFunction\";\nimport {isString} from \"../helpers/isString\";\nimport {isEmpty} from \"../helpers/isEmpty\";\nimport {isObject} from \"../helpers/isObject\";\nimport {isNumber} from \"../helpers/isNumber\";\nimport {uniq} from \"../helpers/uniq\";\n\nclass StoriesList extends EventEmitter {\n\n}\n\nclass SharePage extends EventEmitter {\n\n}\n\nconst getStoryListByType = (listType: STORY_LIST_TYPE): Array<StoryModel> => {\n  switch (listType) {\n    case STORY_LIST_TYPE.default:\n      return $storiesDefault.getState();\n    case STORY_LIST_TYPE.favorite:\n      return $storiesFavorite.getState();\n    case STORY_LIST_TYPE.onboarding:\n      return $storiesOnboarding.getState();\n  }\n  return [];\n};\n\nconst getFontResources = () => $session.getState().cache.filter(item => item.type === 'font-face');\n\nconst _showStory = async (id: number | string, storyReaderInstance: _StoryReader) => {\n\n  // try catch if 200 - загружено а не 404\n\n  const resp = await fetchSessionAndStoryDataCompositeFx({id});\n  if (isString(id)) {\n    // get numeric id from response\n    if (isArray(resp)) {\n      id = (resp.find(_ => _.ref === 'story')?.body as StoryModel)?.id;\n      await fetchStoryContextFx({ids: [id]});\n    }\n  }\n\n  const story = $stories.getState().find(item => item.id === id);\n  // debug - console.log (if active)\n  // console.log({story, state: $stories.getState()});\n\n  if (story !== undefined) {\n\n    const openReaderData = {\n      windowReferer: STORY_READER_WINDOW_REFERER.default,\n      listType: STORY_LIST_TYPE.default,\n      id: story.id,\n      storyContext: $storyContext.getState(),\n      storyList: [story],\n      hasShare: $session.getState().share\n    }\n\n\n    // TODO закрыть если что то открыто\n    // storyReaderInstance.closeReader(); // создать метод\n    storyReaderInstance.openReader(openReaderData);\n    return true;\n  }\n\n  // не false a exception\n  return false;\n};\n\n\nexport abstract class StoryManager extends EventEmitter {\n\n  private static instance?: StoryManager;\n\n\n\n\n  //Assign \"new StoryManager()\" here to avoid lazy initialisation\n\n\n  protected constructor(config: StoryManagerConfig, callbacks?: Dict<Function>) {\n    super();\n\n    if (!StoryManager.instance) {\n      storyManagerConfigChanged(config);\n\n      // и вынести в дополнение в отдельный метод для StoryManager\n      if (config.placeholders) {\n        sdkPlaceholdersChanged(config.placeholders);\n      }\n\n      if (callbacks && isObject(callbacks)) {\n        this._callbacks = callbacks;\n      }\n\n      StoryManager.instance = this;\n\n    } else {\n      console.warn(\"StoryManager singleton is created multiple times\\nuse IAS.StoryManager.getInstance() instead\");\n    }\n\n    return StoryManager.instance;\n  }\n\n  public destructor() {\n    // TODO\n    // close reader and others\n\n    delete StoryManager.instance;\n  }\n\n  private _callbacks: Dict<any> = {};\n\n  public set storyLinkClickHandler(callback: Function) {\n    if (isFunction(callback)) {\n      this._callbacks.storyLinkClickHandler = callback;\n    }\n  }\n\n  // SkuList => SkuFilledList\n  public set openGoodsWidgetHandler(callback: (skuList: Array<Dict>) => Promise<Array<Dict>>) {\n    if (isFunction(callback)) {\n      this._callbacks.openGoodsWidgetHandler = callback;\n    }\n  }\n\n  public get openGoodsWidgetHandler() {\n    return this._callbacks.openGoodsWidgetHandler;\n  }\n\n  static getInstance(): StoryManager {\n    if (!StoryManager.instance) {\n      throw new Error(\"Error - use new IAS.StoryManager(). For first init - with config\");\n      // или разрешить в getInstance передавтаь конфиг для первого вызова\n    }\n    // StoryManager.instance = StoryManager.instance || new StoryManager();\n    return StoryManager.instance;\n  }\n\n\n  public abstract createWidgetStoriesList(appearanceManager: AppearanceManager): IWidgetStoriesList;\n\n  public abstract createWidgetStoryReader(setNeedFirstRender: (value: boolean) => void, detachComponent: () => void): IWidgetStoryReader;\n\n  public abstract getDeviceInfo(configDeviceIdChanged: (device_id: DeviceId) => void): Promise<ISessionInitData>;\n\n  public abstract localStorageGet<T extends object>(key: string): Promise<Option<T>>;\n  // data - object like model or simple value, not JSON encoded string\n  public abstract localStorageSet(key: string, data: object): Promise<void>;\n\n  public abstract localStorageGetArray<T extends any>(key: string): Promise<Option<Array<T>>>;\n  // data - object like model or simple value, not JSON encoded string\n  public abstract localStorageSetArray(key: string, data: Array<any>): Promise<void>;\n\n\n  /**\n   * StoriesList\n   *\n   * интерфейс для DOM-sdk\n   */\n  public StoriesList = class extends EventEmitter {\n    private storyListWidget!: IWidgetStoriesList;\n    private appearanceManager!: AppearanceManager;\n\n    constructor(mountSelector: string, appearanceManager: AppearanceManager, ref: string = 'default') {\n      super();\n\n      // Factory\n\n      // StoryManager.instance,some = this.factoryMethod\n\n      // StoryManager.instance._storiesList(mountSelector, appearanceManager, this).then(({\n      //                                                                                    storyListWidget,\n      //                                                                                    appearanceManager\n      //                                                                                  }) => {\n      //   this.storyListWidget = storyListWidget;\n      //   this.appearanceManager = appearanceManager;\n      // });\n      // return this;\n\n\n    }\n\n    public async reload(options: { needLoader: boolean } = {needLoader: true}) {\n      let needLoader = true;\n      if (options?.needLoader === false) {\n        needLoader = false;\n      }\n      try {\n        await StoryManager.instance._loadStoriesList(this.storyListWidget, this.appearanceManager, this, false, needLoader);\n        return true;\n      } catch (e) {\n        throw Error(e as string);\n      }\n    }\n\n  }\n\n\n  public setTags(tags: Array<string>): void {\n    if (isArray(tags)) {\n      storyManagerConfigTagsChanged({tags});\n    } else {\n      // throw Error;\n    }\n  }\n\n  public getTags(): Array<string> {\n    return $storyManagerConfig.getState().tags ?? [];\n  }\n\n  public setUserId(userId: string | number): void {\n    if (isString(userId) || isNumber(userId)) {\n      storyManagerConfigUserIdChanged({userId});\n    }\n  }\n\n  public setLang(lang: 'ru' | 'en'): void {\n    if (isString(lang)) {\n      storyManagerConfigLangChanged({lang});\n    }\n  }\n\n  public setPlaceholders(placeholders: Dict<string>): void {\n    if (isObject(placeholders)) {\n      storyManagerConfigPlaceholdersChanged({placeholders});\n    }\n  }\n\n  public setIsSandbox(value: boolean): void {\n    storyManagerConfigIsSandboxChanged({isSandbox: Boolean(value)});\n  }\n\n  public setApiKey(apiKey: string): void {\n    storyManagerConfigApiKeyChanged({apiKey});\n  }\n\n\n  // story Builder ?\n  // update config (set new user or tags)\n  // основная установка через init + возможность update каждого параметра\n\n\n  // tags - для каждого списка - свои теги\n  // идея с разными списками сторис\n\n  //\n\n  private _appearanceManager: Option<AppearanceManager> = null;\n  protected get appearanceManager() {\n    return this._appearanceManager;\n  }\n  protected set appearanceManager(_: Option<AppearanceManager>) {\n    this._appearanceManager = _;\n  }\n\n  private storyListInstance: Option<IWidgetStoriesList> = null;\n\n  private _storyReaderInstance: Option<IWidgetStoryReader> = null;\n  private storyReaderInstancePromise: Option<Promise<IWidgetStoryReader>> = null;\n  private storyReaderInstancePromiseResolver: Option<(value: IWidgetStoryReader) => void> = null;\n\n  private _goodsWidgetInstance: Option<GoodsWidget> = null;\n\n  private _storyReaderNeedFirstRender: Option<(value: boolean) => void> = null;\n  protected set storyReaderNeedFirstRender (cb: (value: boolean) => void) {\n    this._storyReaderNeedFirstRender = cb;\n  }\n\n  private _storyReaderDetachComponent: Option<() => void> = null;\n  protected set storyReaderDetachComponent (cb: () => void) {\n    this._storyReaderDetachComponent = cb;\n  }\n\n  public get storyReaderInstance(): Option<IWidgetStoryReader> {\n    return this._storyReaderInstance;\n  }\n\n  private async getStoryReaderInstance(): Promise<IWidgetStoryReader> {\n\n    // если есть контейнер - инициализируем в нем\n\n    // if (this.storyReaderInstancePromise === null) {\n    //   this.storyReaderInstancePromise = this.initStoryReader(appearanceManager, fontResources);\n    // }\n\n    return new Promise((resolve, reject) => {\n      if (this._storyReaderInstance == null) {\n\n        if (this.storyReaderInstancePromise == null) {\n\n          if (this._storyReaderNeedFirstRender != null) {\n            this._storyReaderNeedFirstRender(true);\n          }\n          // create promise\n          // wait for widgetLoaded\n          this.storyReaderInstancePromise = new Promise<IWidgetStoryReader>((resolve, reject) => this.storyReaderInstancePromiseResolver = resolve);\n          // this.storyReaderInstancePromise = this.initStoryReader(appearanceManager, getFontResources());\n        }\n\n        this.storyReaderInstancePromise.then(_ => {\n          this._storyReaderInstance = _;\n          resolve(_);\n        });\n      } else {\n        resolve(this._storyReaderInstance);\n      }\n    });\n  }\n\n\n\n  // вынести в отдельный класс это все\n  protected _storyReaderWidgetLoaded = async (storyReaderWidget: IWidgetStoryReader) => {\n\n    this.completeInitStoryReader(storyReaderWidget, getFontResources());\n    if (this.storyReaderInstancePromiseResolver != null) {\n      this.storyReaderInstancePromiseResolver(storyReaderWidget);\n    }\n\n  }\n\n  private _storyFavoriteReaderInstance: Option<_StoryFavorite> = null;\n  private storyFavoriteReaderInstancePromise: Option<Promise<_StoryFavorite>> = null;\n\n  private async getStoryFavoriteReaderInstance(): Promise<_StoryFavorite> {\n    return new Promise((resolve, reject) => {\n      if (this._storyFavoriteReaderInstance === null) {\n        if (this.storyFavoriteReaderInstancePromise !== null) {\n          this.storyFavoriteReaderInstancePromise.then(_ => {\n            this._storyFavoriteReaderInstance = _;\n            resolve(_);\n          });\n        } else {\n          reject('_storyFavoriteReaderInstance not inited yet');\n        }\n      } else {\n        resolve(this._storyFavoriteReaderInstance);\n      }\n    });\n  }\n\n\n  private _loadedStoriesLength = {\n    defaultListLength: 0,\n    favoriteListLength: 0\n  };\n  // версия для dom-sdk - с loader\n  // private _loadStoriesList = async (storyListWidget: IWidgetStoriesList, appearanceManager: AppearanceManager, storiesList: StoriesList, needFavorite = true, needLoader = true) => {\n  //\n  //   const storiesListOptions = appearanceManager.storiesListOptions;\n  //\n  //   if (needLoader) {\n  //     // loader\n  //     if (storiesListOptions.handleStartLoading && isFunction(storiesListOptions.handleStartLoading) || storiesList.listenerCount(StoriesListEvents.START_LOADER) !== 0) {\n  //       if (storiesListOptions.handleStartLoading && isFunction(storiesListOptions.handleStartLoading)) {\n  //         storiesListOptions.handleStartLoading(storyListWidget.loaderContainer);\n  //       } else {\n  //         storiesList.emit(StoriesListEvents.START_LOADER, storyListWidget.loaderContainer);\n  //       }\n  //     } else {\n  //       storyListWidget.startLoader();\n  //     }\n  //   }\n  //\n  //   const favoriteList = (appearanceManager.commonOptions.hasFavorite === true ? true : false) && needFavorite;\n  //\n  //   await fetchSessionAndStoriesCompositeFx({defaultList: true, onboardingList: false, favoriteList});\n  //\n  //\n  //\n  //   if (needLoader) {\n  //     // stop loader\n  //     // emit все равно делать\n  //     // и самим стопать если нет подписки\n  //     if (storiesListOptions.handleStopLoading && isFunction(storiesListOptions.handleStopLoading) || storiesList.listenerCount(StoriesListEvents.END_LOADER) !== 0) {\n  //       if (storiesListOptions.handleStopLoading && isFunction(storiesListOptions.handleStopLoading)) {\n  //         storiesListOptions.handleStopLoading(storyListWidget.loaderContainer, this._loadedStoriesLength);\n  //       } else {\n  //         storiesList.emit(StoriesListEvents.END_LOADER, storyListWidget.loaderContainer, this._loadedStoriesLength);\n  //       }\n  //     } else {\n  //       storyListWidget.stopLoader();\n  //     }\n  //   }\n  // }\n\n  private _loadStoriesList = async (storyListWidget: IWidgetStoriesList, appearanceManager: AppearanceManager, needFavorite = true) => {\n    const favoriteList = (appearanceManager.commonOptions.hasFavorite === true ? true : false) && needFavorite;\n    await fetchSessionAndStoriesCompositeFx({defaultList: true, onboardingList: false, favoriteList});\n  }\n\n\n  // private _storiesList = async (mountSelector: string, appearanceManager: AppearanceManager, storiesList: StoriesList):\n  //   Promise<{ storyListWidget: IWidgetStoriesList, appearanceManager: AppearanceManager }> => {\n  //\n  //\n  //   const storiesListOptions = appearanceManager.storiesListOptions;\n  //\n  //   // await create and mount widget -- after inited - we can pass data them\n  //   const storyListWidget = this.createWidgetStoriesList(mountSelector, {});\n  //\n  //   // init widget\n  //   await storyListWidget.init(mountSelector as ObjectId, {\n  //     ...storiesListOptions,\n  //     hasFavorite: appearanceManager.commonOptions.hasFavorite\n  //   });\n  //\n  //   sample({\n  //     source: $storiesDefault,\n  //     clock: $storiesDefault,\n  //     target: createEffect((storyList: Array<StoryModel>) => {\n  //       this._loadedStoriesLength.defaultListLength = storyList.length;\n  //       storyListWidget.setStories({\n  //         listType: STORY_LIST_TYPE.default,\n  //         storyList\n  //       });\n  //     })\n  //   });\n  //\n  //   if (appearanceManager.commonOptions.hasFavorite) {\n  //     sample({\n  //       source: $storiesFavorite,\n  //       clock: $storiesFavorite,\n  //       target: createEffect(async (storyList: Array<StoryModel>) => {\n  //         this._loadedStoriesLength.favoriteListLength = storyList.length;\n  //         storyListWidget.setStories({\n  //           listType: STORY_LIST_TYPE.favorite,\n  //           storyList\n  //         });\n  //         (await this.getStoryFavoriteReaderInstance()).setStories({\n  //           listType: STORY_LIST_TYPE.favorite,\n  //           storyList\n  //         });\n  //       })\n  //     });\n  //   }\n  //\n  //   // session - init if empty\n  //   // load and render\n  //\n  //   // if not opened\n  //   // Session.open\n  //\n  //   // config - move to models/config\n  //\n  //   // placeholders -- мерджить с конфигом и применять к моделям\n  //   // from common config (not from storyList config)\n  //\n  //   await this._loadStoriesList(storyListWidget, appearanceManager, storiesList, true, true);\n  //\n  //   const fontResources = getFontResources();\n  //   storyListWidget.setFonts(fontResources);\n  //\n  //   const params = $storyManagerConfig.getState();\n  //   storyListWidget.setCallbacks({\n  //     // deeplink from list\n  //     handleClickOnStoryDeepLink: (payload: StoriesListClickEvent) => {\n  //\n  //       // public event\n  //\n  //       // просто клик на ячейку\n  //       // if (config?.handleClickOnStory && isFunction(config?.handleClickOnStory)) {\n  //       //   config?.handleClickOnStory(payload);\n  //       // }\n  //\n  //\n  //       const dataForSending = {\n  //         // state.data.push([\n  //         //     action,\n  //         //     state.lastIndex,\n  //         //     storyId,\n  //         //     slideIndex,\n  //         //     slideDuration\n  //         // ]);\n  //         // state.lastIndex++\n  //         data: [[\n  //           1, //action: 1, // Прочтение\n  //           0, // lastIndex\n  //           payload.id, // storyId: e.storyId, // id story,\n  //           0, // slideIndex: 0, // индекс слайда\n  //           0, //slideDuration: 0\n  //         ]]\n  //       };\n  //\n  //       APISendBeacon('session/update', dataForSending, Utility.createFunctionWithTimeout(() => {\n  //\n  //\n  //         if (payload.isDeeplink && payload.url) {\n  //\n  //           // или событие\n  //           if (storiesListOptions?.handleStoryLinkClick && isFunction(storiesListOptions?.handleStoryLinkClick)) {\n  //             storiesListOptions?.handleStoryLinkClick(payload);\n  //           } else {\n  //             window.open(payload.url, '_self');\n  //           }\n  //         }\n  //\n  //       }));\n  //     },\n  //\n  //     // public event\n  //     handleClickOnStory: (payload: any) => {\n  //       // if (storiesListOptions?.handleClickOnStory && isFunction(storiesListOptions?.handleClickOnStory)) {\n  //       //   storiesListOptions?.handleClickOnStory(payload);\n  //       // }\n  //     },\n  //\n  //     handleFlushThumbViews: (payload: Array<number>) => {\n  //       // console.log('handleFlushThumbViews', payload);\n  //       sessionThumbViewsChanged(payload);\n  //     },\n  //\n  //\n  //     handleClickOnStoryInternal: (payload: ClickOnStoryInternalPayload) => this.handleClickOnStoryInternal(payload)\n  //\n  //\n  //   });\n  //\n  //\n  //   storyListWidget.on('clickOnFavoriteCellInternal', async (payload: ClickOnFavoriteCellInternalPayload) => {\n  //     const openReaderData = {\n  //       ...payload,\n  //       // storyContext: $storyContext.getState(),\n  //       storyList: getStoryListByType(STORY_LIST_TYPE.favorite),\n  //     };\n  //     (await this.getStoryFavoriteReaderInstance()).openReader(openReaderData);\n  //   });\n  //\n  //\n  //   // await fetchSessionFx({});\n  //   //\n  //   // // fetch default list\n  //   // await fetchStoriesFx({listType: STORY_LIST_TYPE.default});\n  //\n  //\n  //   // components api interface\n  //   // глобальный флаг - выбираем фабрику для интерфейса\n  //   // сами компоненты уже используют abstract functions\n  //   // и здесь отвтеная часть реагется\n  //   // storyListWidget object\n  //   // storyReaderWidget object etc\n  //   // favoriteReaderWidget object\n  //   // msgpack\n  //   // story manager хранит у себя виджеты и их rpc (внутри виджетов ?) (в parent class - field)\n  //\n  //\n  //   // все же грузить вместе с лентой\n  //   // let storyReaderInstancePromise: Option<Promise<_StoryReader>> = null;\n  //   // if (this.storyReaderInstance === null) {\n  //   //   storyReaderInstancePromise = this.initStoryReader($config.getState(), fontResources);\n  //   // }\n  //\n  //   this.storyListInstance = storyListWidget;\n  //\n  //   if (this.storyReaderInstancePromise === null) {\n  //     this.storyReaderInstancePromise = this.initStoryReader(appearanceManager, fontResources);\n  //   }\n  //\n  //   if (this.storyFavoriteReaderInstancePromise === null) {\n  //     this.storyFavoriteReaderInstancePromise = this.initStoryFavoriteReader(appearanceManager, fontResources);\n  //   }\n  //\n  //   return {storyListWidget, appearanceManager};\n  //\n  // }\n\n  // базовая версия без лоадера\n\n  // вынести в отдельный класс эт овсе\n  protected _storiesListWidgetLoaded = async (storyListWidget: IWidgetStoriesList, appearanceManager: AppearanceManager) => {\n\n    const storiesListOptions = appearanceManager.storiesListOptions;\n\n    sample({\n      source: $storiesDefault,\n      clock: $storiesDefault,\n      target: createEffect((storyList: Array<StoryModel>) => {\n        this._loadedStoriesLength.defaultListLength = storyList.length;\n        storyListWidget.setStories({\n          listType: STORY_LIST_TYPE.default,\n          storyList\n        });\n      })\n    });\n\n    if (appearanceManager.commonOptions.hasFavorite) {\n      sample({\n        source: $storiesFavorite,\n        clock: $storiesFavorite,\n        target: createEffect(async (storyList: Array<StoryModel>) => {\n          this._loadedStoriesLength.favoriteListLength = storyList.length;\n          storyListWidget.setStories({\n            listType: STORY_LIST_TYPE.favorite,\n            storyList\n          });\n          (await this.getStoryFavoriteReaderInstance()).setStories({\n            listType: STORY_LIST_TYPE.favorite,\n            storyList\n          });\n        })\n      });\n    }\n\n    // session - init if empty\n    // load and render\n\n    // if not opened\n    // Session.open\n\n    // config - move to models/config\n\n    // placeholders -- мерджить с конфигом и применять к моделям\n    // from common config (not from storyList config)\n\n    // needFavorite\n    await this._loadStoriesList(storyListWidget, appearanceManager, true);\n\n    const fontResources = getFontResources();\n    storyListWidget.setFonts(fontResources);\n\n    const params = $storyManagerConfig.getState();\n    storyListWidget.setCallbacks({\n      // deeplink from list\n      handleClickOnStoryDeepLink: (payload: StoriesListClickEvent) => {\n\n        // public event\n\n        // просто клик на ячейку\n        // if (config?.handleClickOnStory && isFunction(config?.handleClickOnStory)) {\n        //   config?.handleClickOnStory(payload);\n        // }\n\n\n        const dataForSending = {\n          // state.data.push([\n          //     action,\n          //     state.lastIndex,\n          //     storyId,\n          //     slideIndex,\n          //     slideDuration\n          // ]);\n          // state.lastIndex++\n          data: [[\n            1, //action: 1, // Прочтение\n            0, // lastIndex\n            payload.id, // storyId: e.storyId, // id story,\n            0, // slideIndex: 0, // индекс слайда\n            0, //slideDuration: 0\n          ]]\n        };\n\n        APISendBeacon('session/update', dataForSending, Utility.createFunctionWithTimeout(() => {\n\n\n          if (payload.isDeeplink && payload.url) {\n\n            // или событие\n            if (storiesListOptions?.handleStoryLinkClick && isFunction(storiesListOptions?.handleStoryLinkClick)) {\n              storiesListOptions?.handleStoryLinkClick(payload);\n            } else {\n              window.open(payload.url, '_self');\n            }\n          }\n\n        }));\n      },\n\n      // public event\n      handleClickOnStory: (payload: any) => {\n        // if (storiesListOptions?.handleClickOnStory && isFunction(storiesListOptions?.handleClickOnStory)) {\n        //   storiesListOptions?.handleClickOnStory(payload);\n        // }\n      },\n\n      handleFlushThumbViews: (payload: Array<number>) => {\n        // console.log('handleFlushThumbViews', payload);\n        sessionThumbViewsChanged(payload);\n      },\n\n\n      handleClickOnStoryInternal: (payload: ClickOnStoryInternalPayload) => this.handleClickOnStoryInternal(payload),\n\n    });\n\n\n    storyListWidget.on('clickOnFavoriteCellInternal', async (payload: ClickOnFavoriteCellInternalPayload) => {\n      const openReaderData = {\n        ...payload,\n        // storyContext: $storyContext.getState(),\n        storyList: getStoryListByType(STORY_LIST_TYPE.favorite),\n      };\n      (await this.getStoryFavoriteReaderInstance()).openReader(openReaderData);\n    });\n\n\n    // await fetchSessionFx({});\n    //\n    // // fetch default list\n    // await fetchStoriesFx({listType: STORY_LIST_TYPE.default});\n\n\n    // components api interface\n    // глобальный флаг - выбираем фабрику для интерфейса\n    // сами компоненты уже используют abstract functions\n    // и здесь отвтеная часть реагется\n    // storyListWidget object\n    // storyReaderWidget object etc\n    // favoriteReaderWidget object\n    // msgpack\n    // story manager хранит у себя виджеты и их rpc (внутри виджетов ?) (в parent class - field)\n\n\n    // все же грузить вместе с лентой\n    // let storyReaderInstancePromise: Option<Promise<_StoryReader>> = null;\n    // if (this.storyReaderInstance === null) {\n    //   storyReaderInstancePromise = this.initStoryReader($config.getState(), fontResources);\n    // }\n\n    this.storyListInstance = storyListWidget;\n\n    // не будем сразу инициализировать\n\n    // if (this.storyReaderInstancePromise == null) {\n    //   this.storyReaderInstancePromise = this.initStoryReader(appearanceManager, fontResources);\n    // }\n    //\n    // if (this.storyFavoriteReaderInstancePromise == null) {\n    //   this.storyFavoriteReaderInstancePromise = this.initStoryFavoriteReader(appearanceManager, fontResources);\n    // }\n\n    return {storyListWidget, appearanceManager};\n\n  }\n\n  private async handleClickOnStoryInternal(payload: ClickOnStoryInternalPayload) {\n    // load expand story, img resources,\n    // create story reader instance\n    // open story reader\n\n    console.log('clickOnStoryInternalEvent 3');\n    console.log('[handleClickOnStoryInternal] -- open Reader', payload);\n\n\n    // state - loading\n\n    // open / close iframe container\n    // with - sbHelper.setScrollbar(); (open)\n\n\n    // load all slides\n    // await fetchStoriesSlidesCompositeFx({ids: $storiesIdsWithoutLoadedSlides.getState()});\n\n\n    // load expand target story and list context\n\n\n    // context и ids slides -- грузить только для нужного списка\n    const storyContext = $storyContext.getState();\n    // неправильно, нужно - сравиниать со спиком, который щас открываем\n    let storyContextExists = storyContext !== null/* && storyContext.ids === $storiesIdsWithoutLoadedSlides.getState()*/;\n    if (storyContext && $storiesIdsWithoutLoadedSlides.getState().length > 0) {\n      if (storyContext.ids !== $storiesIdsWithoutLoadedSlides.getState()) {\n        storyContextExists = false;\n      }\n    }\n    // TODO  $storiesIdsWithoutLoadedSlides.getState() -- для нужного списка фильтровать или для каждой сторис грузить отдельно layout\n    // у каждой сторис просто хранить ее layout (ее кастомная часть, а общую - в context стили общие и проетка) частная -- стили и виджеты)\n    const story = getStoryListByType(payload.listType).find(_ => _.id === payload.id);\n    if (!storyContextExists && (story && !story.slidesLoaded)) {\n      await fetchStoriesContextAndStorySlidesCompositeFx({\n        ids: $storiesIdsWithoutLoadedSlides.getState(),\n        id: payload.id\n      });\n    } else {\n      if (!storyContextExists) {\n        if ($storiesIdsWithoutLoadedSlides.getState().length) {\n          await fetchStoryContextFx({ids: $storiesIdsWithoutLoadedSlides.getState()});\n        }\n      } else if (!story || !story.slidesLoaded) {\n        await fetchStoriesSlidesCompositeFx({ids: [payload.id]});\n      }\n    }\n\n// beforehand - open reader with loader screen\n\n// list type\n// this.storyReaderInstance.setStories($stories.getState());\n// this.storyReaderInstance.setStoriesContext($storyContext.getState());\n\n\n    const openReaderData = {\n      ...payload,\n      storyContext: $storyContext.getState(),\n      storyList: getStoryListByType(payload.listType),\n      hasShare: $session.getState().share\n    }\n\n\n// run example app - in server env + README\n// without chrome server\n\n\n    // try catch\n    const storyReaderInstance = await this.getStoryReaderInstance();\n    // if (this._storyReaderNeedFirstRender != null) {\n    //   this._storyReaderNeedFirstRender(true);\n    // }\n\n    console.log('clickOnStoryInternalEvent 4', storyReaderInstance);\n\n    storyReaderInstance.openReader(openReaderData);\n\n    // fetch other slides\n    const ids = $storiesIdsWithoutLoadedSlides.getState();\n    if (ids.length > 0) {\n      await fetchStoriesSlidesCompositeFx({ids});\n    }\n\n    // set stories\n    storyReaderInstance.setStories({listType: payload.listType, storyList: getStoryListByType(payload.listType)});\n\n  }\n\n  // composite для expand сторис\n  // react library\n  // add method - close reader из вне\n\n\n  protected completeInitStoryReader(storyReaderInstance: IWidgetStoryReader/*, appearanceManager: AppearanceManager*/, fonts: Array<CacheResourceModel>, overrideStoryReaderOptions: Pick<StoryReaderOptions, \"recycleStoriesList\" | \"closeOnLastSlideByTimer\"> = {}) {\n    // инстанс виджета создается через JSX\n    // const storyReaderInstance = new _StoryReader('body', {});\n\n    // await storyReaderInstance.init('body' as ObjectId, {\n    //   ...appearanceManager.storyReaderOptions,\n    //   appearanceCommon: appearanceManager.commonOptions,\n    //   ...overrideStoryReaderOptions\n    // });\n\n\n\n    storyReaderInstance.setFonts(fonts);\n\n    // set all callbacks\n    storyReaderInstance.setCallbacks({\n      // public events\n\n\n    });\n\n    // todo избавиться от этой связи -- storyListInstance\n    // т.к. может быть мнго списоков в менеджере\n\n    storyReaderInstance.on('storyOpenedInternal', (payload: { id: number }) => this.storyListInstance?.onStoryOpened(payload));\n\n    storyReaderInstance.on('setStoryOpened', async (payload: { listTYpe: STORY_LIST_TYPE, id: string, data: any, cb: string }) => {\n      // update store and localStorage\n\n      if (!isEmpty($session.getState().user_key)) {\n        const key = `u/${$session.getState().user_key}/s_opened`;\n        let data = await this.localStorageGetArray<number>(key);\n        if (!isArray(data)) {\n          data = [];\n        }\n        data.push(payload.data.id);\n        data = uniq(data);\n        this.localStorageSetArray(key, data)\n      }\n\n\n      // @ts-ignore\n      storyItemIsOpenedChanged({id: payload.data.id});\n\n      storyReaderInstance.rpcCb(payload.cb, {requestId: payload.id, success: true, data: payload.data, err: ''});\n\n    });\n\n    storyReaderInstance.on('updateStoryFavorite', async (payload: { listTYpe: STORY_LIST_TYPE, id: string, data: any, cb: string }) => {\n\n      // console.log('updateStoryFavorite', payload);\n      // call api and update model in store\n      let success = false;\n      const data: { favorite: undefined | boolean } = {\n        favorite: undefined\n      };\n      let err = '';\n      try {\n        const response = await API.post<Dict<any>>(`story-favorite/${payload.data.id}`, {value: payload.data.favorite});\n        if (response.data.favorite !== undefined) {\n          success = true;\n          data.favorite = Boolean(response.data.favorite);\n\n          // @ts-ignore\n          storyItemFavoriteChanged({id: payload.data.id, favorite: data.favorite});\n          if (data.favorite === false) {\n            // @ts-ignore\n            storiesListIdsChanged({\n              listType: STORY_LIST_TYPE.favorite,\n              storyList: $storiesFavorite.getState().filter(_ => _.id !== payload.data.id)\n            });\n          } else {\n            // @ts-ignore\n            storiesListIdsChanged({\n              listType: STORY_LIST_TYPE.favorite,\n              storyList: [...$storiesFavorite.getState(), ...$stories.getState().filter(_ => _.id === payload.data.id)]\n            });\n          }\n\n        } else {\n          err = 'response.data.favorite is undefined';\n        }\n      } catch (e) {\n        // @ts-ignore\n        err = e.toString();\n      }\n\n      storyReaderInstance.rpcCb(payload.cb, {requestId: payload.id, success, data, err});\n\n    });\n\n    storyReaderInstance.on('updateStoryLike', async (payload: { listTYpe: STORY_LIST_TYPE, id: string, data: any, cb: string }) => {\n\n      // console.log('updateStoryLike', payload);\n      // call api and update model in store\n      let success = false;\n      const data: { like: undefined | number } = {\n        like: undefined\n      };\n      let err = '';\n      try {\n        const response = await API.post<Dict<any>>(`story-like/${payload.data.id}`, {value: payload.data.like});\n        if (response.data.like !== undefined) {\n          success = true;\n          data.like = response.data.like;\n\n          // @ts-ignore\n          // в effector не надо ?\n          // storyItemLikeChanged({id: payload.data.id, like: data.like});\n        } else {\n          err = 'response.data.like is undefined';\n        }\n      } catch (e) {\n        // @ts-ignore\n        err = e.toString();\n      }\n\n      storyReaderInstance.rpcCb(payload.cb, {requestId: payload.id, success, data, err});\n\n    });\n\n    storyReaderInstance.on('getStorySharePath', async (payload: { listTYpe: STORY_LIST_TYPE, id: string, data: any, cb: string }) => {\n\n      let success = false;\n      const data: { url: undefined | number } = {\n        url: undefined\n      };\n      let err = '';\n      try {\n        const response = await API.get<Dict<any>>(`story-share/${payload.data.id}`);\n        if (response.data.url !== undefined) {\n          success = true;\n          data.url = response.data.url;\n\n          // @ts-ignore\n          storyItemLikeChanged({id: payload.data.id, url: data.url});\n        } else {\n          err = 'response.data.url is undefined';\n        }\n      } catch (e) {\n        // @ts-ignore\n        err = e.toString();\n      }\n\n      storyReaderInstance.rpcCb(payload.cb, {requestId: payload.id, success, data, err});\n\n    });\n\n    storyReaderInstance.on('updateStoriesStat', async (payload: { listTYpe: STORY_LIST_TYPE, id: string, data: any, cb: string }) => {\n\n      // console.log('updateStoryLike', payload);\n      // call api and update model in store\n      let success = false;\n      let data: Dict = {};\n      let err = '';\n      try {\n        const response = await API.post<Dict<any>>(`session/update`, payload.data);\n        if (response.data !== undefined) {\n          success = true;\n          data = response.data;\n        } else {\n          err = 'response.data is undefined';\n        }\n      } catch (e) {\n        // @ts-ignore\n        err = e.toString();\n      }\n\n      storyReaderInstance.rpcCb(payload.cb, {requestId: payload.id, success, data, err});\n\n    });\n\n\n    // button from slide\n    storyReaderInstance.on('clickOnButton', (payload: ClickOnButtonPayload) => {\n      if (isFunction(this._callbacks.storyLinkClickHandler) || this.listenerCount(StoriesEvents.CLICK_ON_STORY) > 0) {\n        const cbPayload = {src: 'storyReader', srcRef: 'default', data: payload};\n        try {\n          if (isFunction(this._callbacks.storyLinkClickHandler)) {\n            this._callbacks.storyLinkClickHandler(cbPayload);\n          }\n          this.emit(StoriesEvents.CLICK_ON_STORY, cbPayload);\n        } catch (e) {\n          console.error(e)\n        }\n      } else {\n        window.open(payload.url, '_self');\n      }\n    });\n\n\n    // SwipeUpGoods\n    // map - по названи. события - какой тип payload\n    storyReaderInstance.on('clickOnSwipeUpGoods', (payload: ClickOnSwipeUpPayload) => {\n      if (storyReaderInstance) {\n        this._goodsWidgetInstance = new GoodsWidget(this, appearanceManager, storyReaderInstance, payload);\n\n        this._goodsWidgetInstance.once('close', (data: { elementId: string }) => {\n          this._goodsWidgetInstance = null;\n\n          if (storyReaderInstance) {\n            // on close - for resumeUI\n            storyReaderInstance.closeGoodsWidget(data);\n          }\n        });\n      }\n    });\n\n    // StatusBar\n    storyReaderInstance.on('openStoryReader', (options: { windowReferer: STORY_READER_WINDOW_REFERER }) => {\n\n    });\n\n    storyReaderInstance.on('closeStoryReader', (options: { windowReferer: STORY_READER_WINDOW_REFERER }) => {\n      StoryManager.instance?.closeGoodsWidget();\n\n      // detach View\n      if (this._storyReaderDetachComponent != null) {\n        this._storyReaderDetachComponent();\n      }\n      this.storyReaderInstancePromise = null;\n      this._storyReaderInstance = null;\n\n    });\n\n\n    return storyReaderInstance;\n  }\n\n\n  private async initStoryFavoriteReader(appearanceManager: AppearanceManager, fonts: Array<CacheResourceModel>) {\n    if (this._storyFavoriteReaderInstance !== null) {\n      return this._storyFavoriteReaderInstance;\n    }\n    const storyFavoriteReaderInstance = new _StoryFavorite('body', {});\n    await storyFavoriteReaderInstance.init('body' as ObjectId, {\n      options: appearanceManager.storyFavoriteReaderOptions,\n      storiesListOptions: appearanceManager.storiesListOptions\n    });\n    storyFavoriteReaderInstance.setFonts(fonts);\n\n    // set all callbacks\n    storyFavoriteReaderInstance.setCallbacks({\n      // public events\n\n\n    });\n\n    storyFavoriteReaderInstance.on('closeReader', () => {\n      try {\n        window.focus()\n      } catch (e) {\n        console.error(e)\n      }\n    });\n\n    storyFavoriteReaderInstance.on('clickOnStoryInternal', (payload: ClickOnStoryInternalPayload) => this.handleClickOnStoryInternal(payload));\n\n\n    (await this.getStoryReaderInstance()).on('openStoryReader', (options: { windowReferer: STORY_READER_WINDOW_REFERER }) => storyFavoriteReaderInstance.openStoryReader(options));\n    (await this.getStoryReaderInstance()).on('closeStoryReader', (options: { windowReferer: STORY_READER_WINDOW_REFERER }) => storyFavoriteReaderInstance.closeStoryReader(options));\n\n    return storyFavoriteReaderInstance;\n  }\n\n\n  // tags ref appearanceManager\n  public async showOnboardingStories(appearanceManager: AppearanceManager, customTags?: Array<string>) {\n    const fontResources = getFontResources();\n\n\n    await fetchSessionAndStoriesCompositeFx({\n      defaultList: false,\n      onboardingList: true,\n      favoriteList: false,\n      onboardingTags: customTags\n    });\n\n\n    if (this.storyReaderInstancePromise === null) {\n      // TODO config - separte\n      this.storyReaderInstancePromise = this.initStoryReader(appearanceManager, fontResources);\n    }\n\n    // стор может не успеть обновиться ?\n    const onboardingStories = $storiesOnboarding.getState();\n\n    if (onboardingStories.length > 0) {\n      const payload: ClickOnStoryInternalPayload = {\n        windowReferer: STORY_READER_WINDOW_REFERER.default,\n        listType: STORY_LIST_TYPE.onboarding,\n        id: onboardingStories[0].id\n      };\n      await this.handleClickOnStoryInternal(payload);\n      return true;\n    }\n    return false;\n\n  }\n\n  public async showStory(id: number | string, appearanceManager: AppearanceManager, ref: string = 'default') {\n\n    const fontResources = getFontResources();\n\n    // if (this.storyReaderInstancePromise === null) {\n    //   // TODO config - sepaarte\n    //   this.storyReaderInstancePromise = this.initStoryReader(appearanceManager, fontResources);\n    // }\n\n    const storyReaderInstance = await this.getStoryReaderInstance();\n\n    return await _showStory(id, storyReaderInstance);\n  }\n\n  public async closeStoryReader() {\n    if (this.storyReaderInstancePromise === null) {\n      return false;\n    }\n    const storyReaderInstance = await this.getStoryReaderInstance();\n    this.closeGoodsWidget();\n    storyReaderInstance.closeReader();\n  }\n\n  public closeGoodsWidget() {\n    if (this._goodsWidgetInstance) {\n      this._goodsWidgetInstance.close();\n      this._goodsWidgetInstance = null;\n    }\n  }\n\n\n  public SharePage = class extends EventEmitter {\n\n    private storyReaderWidget!: Option<_StoryReader>;\n    private appearanceManager!: AppearanceManager;\n    private options: SharePageOptions = {};\n\n    constructor(storyId: number | string, appearanceManager: AppearanceManager, options?: SharePageOptions, ref: string = 'default') {\n      super();\n\n      if (options) this.options = options;\n\n      StoryManager.instance._showSharePage(storyId, appearanceManager, this.options, this).then(({\n                                                                                     storyReaderInstance,\n                                                                                     appearanceManager,\n                                                                                     result\n                                                                                   }) => {\n        this.storyReaderWidget = storyReaderInstance;\n        this.appearanceManager = appearanceManager;\n      });\n\n      return this;\n    }\n\n    public async closeStoryReader() {\n      if (this.storyReaderWidget) {\n        StoryManager.instance.closeGoodsWidget();\n        this.storyReaderWidget.closeReader();\n      }\n    }\n\n  }\n\n  private _showSharePage = async (storyId: number | string, appearanceManager: AppearanceManager, sharePageOptions: SharePageOptions, sharePage: SharePage) => {\n\n    setTimeout(() => {\n      sharePage.emit(SharePageEvents.START_LOADING);\n      if (isFunction(sharePageOptions.handleStartLoading)) sharePageOptions.handleStartLoading();\n    });\n\n    let result = false;\n    let storyReaderInstance: Option<_StoryReader> = null;\n    try {\n\n      storyReaderInstance = await this.initStoryReader(appearanceManager, getFontResources(), {\n        closeOnLastSlideByTimer: false,\n        recycleStoriesList: false\n      });\n\n      storyReaderInstance.on('closeStoryReader', (options: { windowReferer: STORY_READER_WINDOW_REFERER }) => {\n\n          if (isFunction(sharePageOptions.handleStoryReaderClose) || sharePage.listenerCount(SharePageEvents.CLOSE_STORY_READER) > 0) {\n            // const cbPayload = {src: 'storyReader', srcRef: 'default'};\n            try {\n              if (isFunction(sharePageOptions.handleStoryReaderClose)) {\n                sharePageOptions.handleStoryReaderClose();\n              }\n              sharePage.emit(SharePageEvents.CLOSE_STORY_READER);\n            } catch (e) {\n              console.error(e)\n            }\n          } else {\n\n              const isIframe = window.location != window.parent.location;\n              const location = isIframe ? window.parent.location : window.location;\n              // window.location = `${location.protocol}//${location.host}`\n              window.open(`${location.protocol}//${location.host}`, '_parent');\n\n          }\n\n      });\n\n      // show story inner\n      result = await _showStory(storyId, storyReaderInstance);\n\n    } catch (e) {\n\n    }\n    sharePage.emit(SharePageEvents.END_LOADING, {result});\n    if (isFunction(sharePageOptions.handleStopLoading)) sharePageOptions.handleStopLoading(result);\n\n    return {storyReaderInstance, appearanceManager, result};\n\n  }\n\n\n}\n","export function trimEndSlash(str: String) {\n  return str.replace(/\\/$/, \"\");\n}","export function isNumber(value: any) {\n  return typeof value === 'number';\n}","export function uniq(array: Array<any>) {\n  return [...new Set(array)];\n}","import {EventEmitter} from 'events';\nimport {BlobContentType, getBlobURL, extend} from \"./utils\";\nimport {md5} from \"./md5\";\nimport {checkUrlProtocol} from \"../helpers/media\";\nimport {Brand, Option, Dict} from \"../../global.h\";\n\ndeclare global {\n  interface Window {\n    scrollNode: any; // browser env\n    iasAsyncInitCallbacks: Array<() => void>;\n  }\n}\n\n// env c URL test / prod\n\n\ninterface IAbstractModel {\n  [key: string]: any\n}\n\n\nenum Events {\n  START_LOADER = 'startLoader',\n  END_LOADER = 'endLoader',\n}\n\nenum BlobType {\n\n}\n\nexport type ObjectId = Brand<string, \"objectId\">\n\n/*\nФабрика\nсоздание и вставка в виджета в разметку\nAdapter\niframe или View.webview\nобщение - класс Transport - может быть общий\nWebView onMessage={this.webViewMessageHandler}\n\n */\n\nexport default class Widget extends EventEmitter {\n  static count: number = 0;\n  static RPC: any = {};\n  protected widgetId!: number | string;\n\n  public callbacks: Dict<any> = {};\n\n  private obj!: HTMLElement;\n  private _loaderContainer: Option<HTMLElement> = null;\n  public get loaderContainer() {\n    // if (!this._loaderContainer) {\n    //   const _loaderContainer = document.createElement('div');\n    //   this.obj.style.position = 'relative';\n    //   _loaderContainer.style.position = 'absolute';\n    //   _loaderContainer.style.left = _loaderContainer.style.top = _loaderContainer.style.right = _loaderContainer.style.bottom = '0px';\n    //   _loaderContainer.style.pointerEvents = 'none';\n    //   this.obj.prepend(_loaderContainer);\n    //   this._loaderContainer = _loaderContainer;\n    // }\n    return this._loaderContainer;\n  }\n\n  public setCallbacks(callbacks: Dict<any>) {\n    this.callbacks = callbacks;\n  }\n\n  constructor() {\n    super();\n\n    // const self = this;\n    // let obj: Option<HTMLElement> = null;\n    // if (objId === 'body') {\n    //   obj = document.body;\n    // } else {\n    //   obj = document.querySelector(objId);\n    // }\n    //\n    // if (obj) {\n    //   this.obj = obj;\n    // }\n\n    this.loaderContainer;\n    // setTimeout(async () => await self.init(objId, options, params, funcs, defaults, onDone, widgetId, iter), 0);\n  }\n\n  public async init(mountSelector: string, options: Dict) {\n    const params = {};\n    const funcs = {};\n    const defaults = {};\n    const onDone = () => {\n    };\n    const widgetId = null;\n    const iter = null;\n\n    // return this._init(mountSelector as ObjectId, options, params, {}, funcs, defaults, onDone, widgetId, iter);\n  }\n\n  // protected async _init(mountSelector: ObjectId, options: Dict, params: Dict, widgetParams: Dict, funcs: Dict, defaults: Dict, onDone: (obj: any, iframe: any, rpc: any) => void, widgetId: Option<string | number>, iter: Option<number>) {\n  //\n  //   params = params || {};\n  //   funcs = funcs || {};\n  //\n  //   const self = this;\n  //   let obj: Option<HTMLElement> = null;\n  //   if (mountSelector === 'body') {\n  //     obj = document.body;\n  //   } else {\n  //     obj = document.querySelector(mountSelector);\n  //   }\n  //   this.widgetId = widgetId || (++Widget.count);\n  //\n  //   if (!obj) {\n  //     let _iter = iter || 0;\n  //     if (_iter > 10) {\n  //       throw Error('IAS_OLD.Widget: object #' + mountSelector + ' not found.');\n  //     }\n  //     setTimeout(async () => {\n  //       await self._init(mountSelector, options, params, widgetParams, funcs, defaults, onDone, self.widgetId, _iter + 1);\n  //     }, 500);\n  //\n  //     return;\n  //   }\n  //\n  //\n  //   options = options || {};\n  //   defaults = defaults || {};\n  //   funcs = funcs || {};\n  //\n  //   if (options.preview) {\n  //     params.preview = 1;\n  //     delete options['preview'];\n  //   }\n  //   var ifr, url, urlQueryString, encodedParam, rpc: any, iframe: any, i,\n  //     base_domain = options.base_domain || IAS_OLD._protocol + '//sdk-narrator.kiozk.ru',\n  //     // base_domain = options.base_domain || IAS_OLD._protocol + '//sdk-nar-nar.test.kiozk.ru',\n  //     width: number = options.width === 'auto' ? (obj.clientWidth || obj.offsetWidth || defaults.minWidth) | 0 : parseInt(options.width || 0, 10);\n  //   const cssWidth: string = width ? (Math.max(defaults.minWidth || 200, Math.min(defaults.maxWidth || 10000, width)) + 'px') : '100%';\n  //\n  //   if (!defaults.fullScreen) {\n  //     obj.style.width = cssWidth;\n  //     obj.style.overflow = 'hidden';\n  //\n  //     if (options.height) {\n  //       params.height = options.height;\n  //       obj.style.height = options.height + 'px';\n  //     } else {\n  //       obj.style.height = (defaults.startHeight || 200) + 'px';\n  //     }\n  //\n  //     if (options.overflowTouch) {\n  //       obj.style['overflow'] = 'auto';\n  //       (<any>obj).style['-webkit-overflow-scrolling'] = 'touch';\n  //     }\n  //   }\n  //\n  //\n  //   if (cssWidth === '100%') params.startWidth = (obj.clientWidth || obj.offsetWidth) | 0;\n  //   if (!params.url) params.url = options.pageUrl || location.href.replace(/#.*$/, '');\n  //\n  //   // const widgetUrl = 'stories.php';\n  //   // url = base_domain + '/' + widgetUrl;\n  //   // urlQueryString = '';\n  //   // if (!options.noDefaultParams) {\n  //   //     urlQueryString += '&appKey=' + IAS_OLD._apiKey + '&width=' + encodeURIComponent(cssWidth)\n  //   // }\n  //   // urlQueryString += '&_ver=' + IAS_OLD.version\n  //   params.url = params.url || \"\";\n  //   params.referrer = params.referrer || document.referrer || \"\";\n  //   params.title = params.title || document.title || \"\";\n  //   params.userId = params.userId || '';\n  //\n  //   params.origin = window.location.protocol + '//' + window.location.hostname;\n  //\n  //   // for (i in params) {\n  //   //     if (params.hasOwnProperty(i)) {\n  //   //         if (typeof (params[i]) == 'number') {\n  //   //             encodedParam = params[i];\n  //   //         } else {\n  //   //             try {\n  //   //                 encodedParam = encodeURIComponent(params[i]);\n  //   //             } catch (e) {\n  //   //                 encodedParam = '';\n  //   //             }\n  //   //         }\n  //   //         urlQueryString += '&' + i + '=' + encodedParam;\n  //   //     }\n  //   // }\n  //   // urlQueryString += '&' + (+new Date()).toString(16);\n  //   // url += '?' + urlQueryString.substr(1);\n  //\n  //   const iframeDocumentResources = {\n  //     html: this.getWidgetDocument(widgetParams), css: params.extraCss ?? null, js: params.extraJs ?? null\n  //   };\n  //   let blobUrl = this.getGeneratedPageURL(iframeDocumentResources);\n  //\n  //\n  //   funcs.onStartLoading && funcs.onStartLoading();\n  //   if (!options.no_loading) {\n  //     self.loading(this.loaderContainer, true);\n  //   }\n  //\n  //   funcs.showLoader = function (enable: boolean) {\n  //     IAS_OLD.Util.Loader(enable);\n  //   };\n  //   funcs.publish = function () {\n  //     var args = Array.prototype.slice.call(arguments);\n  //     args.push(self.widgetId);\n  //     IAS_OLD.Observer.publish.apply(IAS_OLD.Observer, args);\n  //   };\n  //   funcs.onInit = function () {\n  //     if (!options.no_finish_loading) {\n  //       self.loading(this.loaderContainer, false);\n  //     }\n  //     // if (funcs.onReady) funcs.onReady();\n  //     if (options.onReady) options.onReady();\n  //   };\n  //   funcs.hideLoader = function () {\n  //     self.loading(this.loaderContainer, false);\n  //   }\n  //   funcs.resize = function (e: number, cb: () => void) {\n  //     if (obj) {\n  //       obj.style.height = e + 'px';\n  //       var el = document.getElementById('iaswidget' + self.widgetId);\n  //       if (el) {\n  //         el.style.height = e + 'px';\n  //       }\n  //     }\n  //   };\n  //   funcs.resizeWidget = function (width: string, height: string) {\n  //     const newWidth = parseInt(width);\n  //     const newHeight = parseInt(height);\n  //     var widgetElem = document.getElementById('iaswidget' + self.widgetId);\n  //     if (isFinite(newWidth)) {\n  //       if (obj) {\n  //         obj.style.width = newWidth + 'px';\n  //         if (widgetElem) {\n  //           widgetElem.style.width = newWidth + 'px';\n  //         }\n  //       }\n  //     }\n  //     if (isFinite(newHeight)) {\n  //       if (obj) {\n  //         obj.style.height = newHeight + 'px';\n  //         if (widgetElem) {\n  //           widgetElem.style.height = newHeight + 'px';\n  //         }\n  //       }\n  //     }\n  //     if (options.onResizeWidget) options.onResizeWidget();\n  //   };\n  //\n  //   rpc = IAS_OLD.Widget.RPC[self.widgetId] = new window.fastXDM.Server(funcs, function (origin: string) {\n  //     if (!origin) return true;\n  //     origin = origin.toLowerCase();\n  //     return true;\n  //     // TODO вернуть обратно\n  //     return (origin.match(/(\\.|\\/)inappstory\\.com($|\\/|\\?)/));\n  //   }, {safe: true});\n  //\n  //   const iframeOptions: Dict<any> = {\n  //     src: '',\n  //     id: 'iaswidget' + self.widgetId,\n  //     allowTransparency: options.allowTransparency || false,\n  //     style: {\n  //       backgroundColor: options.backgroundColor || 'transparent',\n  //     }\n  //   };\n  //\n  //   if (!defaults.fullScreen) {\n  //     iframeOptions.width = (cssWidth.indexOf('%') != -1) ? cssWidth : (parseInt(cssWidth) || cssWidth);\n  //     iframeOptions.height = defaults.startHeight || '100%';\n  //\n  //     // for correct @media in iframe work - pass innerWidth instead of clientWidth\n  //     // plus parent div overflow: hidden\n  //     // width: cssWidth === '100%' ? '100%' : cssWidth,\n  //     // https://stackoverflow.com/questions/23083462/how-to-get-an-iframe-to-be-responsive-in-ios-safari\n  //     iframeOptions.style.width = '1px';\n  //     iframeOptions.style.minWidth = '100%';\n  //     iframeOptions.style[\"*width\"] = '100%';\n  //   } else {\n  //     iframeOptions.style.position = 'fixed';\n  //     iframeOptions.style.left = 0;\n  //     iframeOptions.style.top = 0;\n  //     iframeOptions.style.padding = 0;\n  //     iframeOptions.style.border = 0;\n  //     iframeOptions.style.zIndex = 1002;\n  //     iframeOptions.style.width = '100%';\n  //     iframeOptions.style.height = '100%';\n  //   }\n  //\n  //   if (defaults.scrolling) {\n  //     iframeOptions.scrolling = 'yes';\n  //   } else {\n  //     iframeOptions.scrolling = 'no';\n  //     iframeOptions.style.overflow = 'hidden';\n  //   }\n  //\n  //   if (defaults.hidden) {\n  //     iframeOptions.style.display = 'none';\n  //   }\n  //\n  //\n  //   if (await isWindowSupportIframeBlobSrc()) {\n  //     iframeOptions.src = blobUrl.src;\n  //   } else {\n  //     //@ts-ignore\n  //     iframeOptions.srcdoc = blobUrl.srcdoc;\n  //   }\n  //\n  //\n  //   iframe = IAS_OLD.Widget.RPC[self.widgetId].append(obj, iframeOptions);\n  //   onDone && setTimeout(function () {\n  //     onDone(obj, iframe || obj?.firstChild, rpc);\n  //   }, 10);\n  //\n  //\n  //   this.emit('ready');\n  //\n  //   // on initDone from iframe\n  //\n  //   // this.on('sessionInitInternal', (payload: any) => storyReader.sessionInit(payload));\n  //\n  //\n  //   return new Promise((resolve, reject) => {\n  //     this.on('widgetLoaded', () => {\n  //       // console.log('widgetLoaded');\n  //       resolve(true)\n  //     });\n  //   });\n  //\n  // }\n\n  loading(obj: any, enabled: boolean) {\n    // if (enabled) {\n    //   this.emit(Events.START_LOADER, obj);\n    // } else {\n    //   this.emit(Events.END_LOADER, obj);\n    // }\n    //\n    //\n    // if (this.listenerCount(Events.START_LOADER) === 0) {\n    //   obj.style.background = enabled ? 'url(\"' + IAS_OLD._protocol + '//sdk-narrator.kiozk.ru/images/upload2.gif\") center center no-repeat transparent' : 'none';\n    // }\n  }\n\n  startLoader() {\n    const baseUrl = process.env.BASE_URL;\n    const buildVersion = process.env.BUILD_VERSION;\n\n    // todo можно BASE_URL менять в процессе сборки\n    let imgResource = checkUrlProtocol(`${baseUrl}/v${buildVersion}/dist/images/loader.gif`);\n    if (process.env.NODE_ENV === \"development\") {\n      imgResource = checkUrlProtocol(`${baseUrl}/images/loader.gif`);\n    }\n\n    this.loaderContainer.style.background = `url(\"${imgResource}\") center center no-repeat transparent`;\n  }\n  stopLoader() {\n    this.loaderContainer.style.background = 'none';\n  }\n\n\n  getGeneratedPageURL({html, css, js}: { html: string, css: Option<string>, js: Option<string> }) {\n    let cssTag = '';\n    let jsTag = '';\n    if (css !== null) {\n      cssTag = `<link rel=\"stylesheet\" type=\"text/css\" href=\"${getBlobURL(css, BlobContentType.CSS)}\" />`;\n    }\n    if (js !== null) {\n      jsTag = `<script >${getBlobURL(js, BlobContentType.JS)}</script>`;\n    }\n    const source = `\n    <html>\n      <head>\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n        ${cssTag}\n        ${jsTag}\n      </head>\n      <body>\n        ${html || ''}\n      </body>\n    </html>\n  `;\n\n    if (css !== null) {\n      cssTag = `<style>${css}</style>`;\n    }\n    if (js !== null) {\n      jsTag = `<script>${js}</script>`;\n    }\n    let htmlVariant = `\n    <html>\n      <head>\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1\">\n        ${cssTag}\n        ${jsTag}\n      </head>\n      <body>\n        ${html || ''}\n      </body>\n    </html>\n        `;\n    return {src: getBlobURL(source, BlobContentType.HTML), srcdoc: htmlVariant};\n  }\n\n  getWidgetDocument(widgetParams: Dict): string {\n    return '';\n  }\n\n  destroy(widgetId: string, objId: string) {\n    // var obj = document.getElementById(objId);\n    // if (!obj) {\n    //   throw Error('IAS_OLD.Widget: object #' + objId + ' not found.');\n    // }\n    var rpc = Widget.RPC[widgetId];\n    if (!rpc) {\n      rpc.destroy();\n    }\n    // TODO destroy APP\n    obj.innerHTML = '';\n  }\n\n\n}\n\n\nexport class IAS_OLD {\n  static version = 'v1';\n  static MD5: any = md5;\n  static extend: any = extend;\n\n  static readonly _protocol = 'https:';\n  static readonly _base_domain = '';\n\n  static Widget: any = Widget;\n\n  // static Stories = Stories;\n  // static StoryReader = StoryReader;\n\n\n  static xdConnectionCallbacks: Array<any>;\n  static init: any;\n  static _apiKey: any;\n  static userId: any;\n\n  static XDM: any;\n  static _domain: any;\n  static _path: any;\n  static xdReady: any;\n  static Observer: any;\n\n  static _rootId: any;\n\n  static Util: any;\n\n}\n\n\nif (!IAS_OLD.xdConnectionCallbacks) {\n\n  IAS_OLD.extend(IAS_OLD, {\n    version: 1,\n    _apiKey: null,\n    _session: null,\n    _domain: {\n      // main: IAS_OLD._protocol + '//sdk-narrator.kiozk.ru/',\n      main: IAS_OLD._protocol + '//sdk-narrator.kiozk.ru/',\n      api: IAS_OLD._protocol + '//api-narrator.kiozk.ru/'\n    },\n    _path: {\n      login: 'authorize',\n      proxy: 'fxdm_oauth_proxy.html'\n    },\n    _rootId: 'ias_api_transport',\n    _nameTransportPath: '',\n    xdReady: false,\n\n  });\n\n  IAS_OLD.init = function (options: Dict) {\n    var body, root;\n\n    IAS_OLD._apiKey = null;\n\n    if (!options.apiKey) {\n      throw Error('IAS_OLD.init() called without an apiKey');\n    }\n    IAS_OLD._apiKey = options.apiKey;\n\n    IAS_OLD.userId = options.userId;\n    return true;\n\n  };\n\n\n} else { // if IAS_OLD.xdConnectionCallbacksready\n  setTimeout(function () {\n    var callback;\n    while (callback = IAS_OLD.xdConnectionCallbacks.pop()) {\n      callback();\n    }\n  }, 0);\n\n  // if (IAS_OLD.Widget && !IAS_OLD.Widget._constructor) {\n  //     IAS_OLD.Widget = false;\n  // }\n}\n\n\n\n\n\n\n\n","export function onAllMediaLoaded(slideBox: HTMLElement, cb: Function) {\n  const loadMedia = function (media: HTMLMediaElement | HTMLImageElement) {\n    return new Promise(function (resolve, reject) {\n      if (media.tagName.toLowerCase() === 'img' && media instanceof HTMLImageElement) {\n        const imageLoadHandler = () => {\n          // first frame after load\n          requestAnimationFrame(\n            () =>  // startRender\n              //Rendering start\n              requestAnimationFrame(() => {\n                resolve(media);\n                media.removeEventListener('load', imageLoadHandler);\n              })\n          );\n        };\n        media.addEventListener('load', imageLoadHandler);\n        if (media.complete && media.naturalHeight !== 0) {\n          // resolve(media)\n\n          // first frame after load\n          requestAnimationFrame(\n            function () { // startRender\n              //Rendering start\n              requestAnimationFrame(function () {\n                resolve(media);\n                // console.log('img already loaded');\n              });\n            }\n          );\n\n        }\n      } else if (media.tagName.toLowerCase() === 'video' && media instanceof HTMLMediaElement) {\n        if (media.oncanplaythrough !== undefined) {\n          const oncanplaythroughHandler = () =>\n            //Rendering start\n            requestAnimationFrame(() => requestAnimationFrame(() => {\n                resolve(media);\n                media.removeEventListener('canplaythrough', oncanplaythroughHandler);\n                // console.log('video - canplaythrough');\n              })\n            )\n          ;\n          // first frame after load\n          // startRender\n          media.addEventListener('canplaythrough', oncanplaythroughHandler);\n          media.load();\n        } else {\n          const videLoadHandler = () =>\n            //Rendering start\n            requestAnimationFrame(() => requestAnimationFrame(() => {\n                resolve(media);\n                media.removeEventListener('canplay', videLoadHandler);\n                // console.log('video - load');\n              })\n            );\n\n          media.addEventListener('canplay', videLoadHandler);\n          media.load();\n        }\n\n      }\n\n      media.addEventListener('error', function (err: any) {\n        reject(err)\n      });\n\n    });\n  };\n\n  const mediaElements = slideBox.querySelectorAll<HTMLMediaElement | HTMLImageElement>('img,video');\n\n  let i;\n  let promises = [];\n  for (i = 0; i < mediaElements.length; ++i) {\n    promises.push(loadMedia(mediaElements[i]));\n  }\n  // не должно быть fallback\n  // const fallbackTimeout = setTimeout(() => cb(), 300);\n  if (promises.length > 0) {\n    // минимальная задержка 300ms\n    promises.push(new Promise((resolve, reject) => setTimeout(resolve, 300)));\n  }\n  Promise.all(promises).then((values) => {\n    // clearTimeout(fallbackTimeout);\n    cb();\n  });\n}\n\nexport function checkUrlProtocol(url: string): string {\n  let isSecure = (window as any).isSecureContext;\n  if (isSecure === undefined) {\n    if ((window as any).location.protocol === 'https:') {\n      isSecure = true;\n    }\n  }\n  if (!isSecure) {\n    return url.replace(/^https:\\/\\//, 'http://');\n  }\n\n  return url;\n}","/*\r\n * Based on JavaScript implementation of the RSA Data Security, Inc. MD5 Message\r\n * Copyright (C) Paul Johnston 1999 - 2009\r\n * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet\r\n * Distributed under the BSD License\r\n */\r\nexport function md5(n) {\r\n        var j = function(o, r) {\r\n            var q = (o & 65535) + (r & 65535), p = (o >> 16) + (r >> 16) + (q >> 16);\r\n            return (p << 16) | (q & 65535)\r\n        }, g  = function(o, p) {\r\n            return (o << p) | (o >>> (32 - p))\r\n        }, k  = function(w, r, p, o, v, u) {\r\n            return j(g(j(j(r, w), j(o, u)), v), p)\r\n        }, a  = function(q, p, w, v, o, u, r) {\r\n            return k((p & w) | ((~p) & v), q, p, o, u, r)\r\n        }, h  = function(q, p, w, v, o, u, r) {\r\n            return k((p & v) | (w & (~v)), q, p, o, u, r)\r\n        }, c  = function(q, p, w, v, o, u, r) {\r\n            return k(p ^ w ^ v, q, p, o, u, r)\r\n        }, m  = function(q, p, w, v, o, u, r) {\r\n            return k(w ^ (p | (~v)), q, p, o, u, r)\r\n        }, b  = function(A, u) {\r\n            var z                           = 1732584193, y = -271733879, w = -1732584194, v = 271733878, r, q, p, o;\r\n            A[u >> 5] |= 128 << ((u) % 32);\r\n            A[(((u + 64) >>> 9) << 4) + 14] = u;\r\n            for (var t = 0, s = A.length; t < s; t += 16) {\r\n                r = z;\r\n                q = y;\r\n                p = w;\r\n                o = v;\r\n                z = a(z, y, w, v, A[t + 0], 7, -680876936);\r\n                v = a(v, z, y, w, A[t + 1], 12, -389564586);\r\n                w = a(w, v, z, y, A[t + 2], 17, 606105819);\r\n                y = a(y, w, v, z, A[t + 3], 22, -1044525330);\r\n                z = a(z, y, w, v, A[t + 4], 7, -176418897);\r\n                v = a(v, z, y, w, A[t + 5], 12, 1200080426);\r\n                w = a(w, v, z, y, A[t + 6], 17, -1473231341);\r\n                y = a(y, w, v, z, A[t + 7], 22, -45705983);\r\n                z = a(z, y, w, v, A[t + 8], 7, 1770035416);\r\n                v = a(v, z, y, w, A[t + 9], 12, -1958414417);\r\n                w = a(w, v, z, y, A[t + 10], 17, -42063);\r\n                y = a(y, w, v, z, A[t + 11], 22, -1990404162);\r\n                z = a(z, y, w, v, A[t + 12], 7, 1804603682);\r\n                v = a(v, z, y, w, A[t + 13], 12, -40341101);\r\n                w = a(w, v, z, y, A[t + 14], 17, -1502002290);\r\n                y = a(y, w, v, z, A[t + 15], 22, 1236535329);\r\n                z = h(z, y, w, v, A[t + 1], 5, -165796510);\r\n                v = h(v, z, y, w, A[t + 6], 9, -1069501632);\r\n                w = h(w, v, z, y, A[t + 11], 14, 643717713);\r\n                y = h(y, w, v, z, A[t + 0], 20, -373897302);\r\n                z = h(z, y, w, v, A[t + 5], 5, -701558691);\r\n                v = h(v, z, y, w, A[t + 10], 9, 38016083);\r\n                w = h(w, v, z, y, A[t + 15], 14, -660478335);\r\n                y = h(y, w, v, z, A[t + 4], 20, -405537848);\r\n                z = h(z, y, w, v, A[t + 9], 5, 568446438);\r\n                v = h(v, z, y, w, A[t + 14], 9, -1019803690);\r\n                w = h(w, v, z, y, A[t + 3], 14, -187363961);\r\n                y = h(y, w, v, z, A[t + 8], 20, 1163531501);\r\n                z = h(z, y, w, v, A[t + 13], 5, -1444681467);\r\n                v = h(v, z, y, w, A[t + 2], 9, -51403784);\r\n                w = h(w, v, z, y, A[t + 7], 14, 1735328473);\r\n                y = h(y, w, v, z, A[t + 12], 20, -1926607734);\r\n                z = c(z, y, w, v, A[t + 5], 4, -378558);\r\n                v = c(v, z, y, w, A[t + 8], 11, -2022574463);\r\n                w = c(w, v, z, y, A[t + 11], 16, 1839030562);\r\n                y = c(y, w, v, z, A[t + 14], 23, -35309556);\r\n                z = c(z, y, w, v, A[t + 1], 4, -1530992060);\r\n                v = c(v, z, y, w, A[t + 4], 11, 1272893353);\r\n                w = c(w, v, z, y, A[t + 7], 16, -155497632);\r\n                y = c(y, w, v, z, A[t + 10], 23, -1094730640);\r\n                z = c(z, y, w, v, A[t + 13], 4, 681279174);\r\n                v = c(v, z, y, w, A[t + 0], 11, -358537222);\r\n                w = c(w, v, z, y, A[t + 3], 16, -722521979);\r\n                y = c(y, w, v, z, A[t + 6], 23, 76029189);\r\n                z = c(z, y, w, v, A[t + 9], 4, -640364487);\r\n                v = c(v, z, y, w, A[t + 12], 11, -421815835);\r\n                w = c(w, v, z, y, A[t + 15], 16, 530742520);\r\n                y = c(y, w, v, z, A[t + 2], 23, -995338651);\r\n                z = m(z, y, w, v, A[t + 0], 6, -198630844);\r\n                v = m(v, z, y, w, A[t + 7], 10, 1126891415);\r\n                w = m(w, v, z, y, A[t + 14], 15, -1416354905);\r\n                y = m(y, w, v, z, A[t + 5], 21, -57434055);\r\n                z = m(z, y, w, v, A[t + 12], 6, 1700485571);\r\n                v = m(v, z, y, w, A[t + 3], 10, -1894986606);\r\n                w = m(w, v, z, y, A[t + 10], 15, -1051523);\r\n                y = m(y, w, v, z, A[t + 1], 21, -2054922799);\r\n                z = m(z, y, w, v, A[t + 8], 6, 1873313359);\r\n                v = m(v, z, y, w, A[t + 15], 10, -30611744);\r\n                w = m(w, v, z, y, A[t + 6], 15, -1560198380);\r\n                y = m(y, w, v, z, A[t + 13], 21, 1309151649);\r\n                z = m(z, y, w, v, A[t + 4], 6, -145523070);\r\n                v = m(v, z, y, w, A[t + 11], 10, -1120210379);\r\n                w = m(w, v, z, y, A[t + 2], 15, 718787259);\r\n                y = m(y, w, v, z, A[t + 9], 21, -343485551);\r\n                z = j(z, r);\r\n                y = j(y, q);\r\n                w = j(w, p);\r\n                v = j(v, o)\r\n            }\r\n            return [z, y, w, v]\r\n        }, f  = function(r) {\r\n            var q = \"\", s = -1, p = r.length, o, t;\r\n            while (++s < p) {\r\n                o = r.charCodeAt(s);\r\n                t = s + 1 < p ? r.charCodeAt(s + 1) : 0;\r\n                if (55296 <= o && o <= 56319 && 56320 <= t && t <= 57343) {\r\n                    o = 65536 + ((o & 1023) << 10) + (t & 1023);\r\n                    s++\r\n                }\r\n                if (o <= 127) {\r\n                    q += String.fromCharCode(o)\r\n                } else {\r\n                    if (o <= 2047) {\r\n                        q += String.fromCharCode(192 | ((o >>> 6) & 31), 128 | (o & 63))\r\n                    } else {\r\n                        if (o <= 65535) {\r\n                            q += String.fromCharCode(224 | ((o >>> 12) & 15), 128 | ((o >>> 6) & 63), 128 | (o & 63))\r\n                        } else {\r\n                            if (o <= 2097151) {\r\n                                q += String.fromCharCode(240 | ((o >>> 18) & 7), 128 | ((o >>> 12) & 63), 128 | ((o >>> 6) & 63), 128 | (o & 63))\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return q\r\n        }, e  = function(p) {\r\n            var o = Array(p.length >> 2), r, q;\r\n            for (r = 0, q = o.length; r < q; r++) {\r\n                o[r] = 0\r\n            }\r\n            for (r = 0, q = p.length * 8; r < q; r += 8) {\r\n                o[r >> 5] |= (p.charCodeAt(r / 8) & 255) << (r % 32)\r\n            }\r\n            return o\r\n        }, l  = function(p) {\r\n            var o = \"\";\r\n            for (var r = 0, q = p.length * 32; r < q; r += 8) {\r\n                o += String.fromCharCode((p[r >> 5] >>> (r % 32)) & 255)\r\n            }\r\n            return o\r\n        }, d  = function(o) {\r\n            return l(b(e(o), o.length * 8))\r\n        }, i  = function(q) {\r\n            var t = \"0123456789abcdef\", p = \"\", o;\r\n            for (var s = 0, r = q.length; s < r; s++) {\r\n                o = q.charCodeAt(s);\r\n                p += t.charAt((o >>> 4) & 15) + t.charAt(o & 15)\r\n            }\r\n            return p\r\n        };\r\n        return i(d(f(n)))\r\n    }\r\n","import {createDomain, Effect} from 'effector';\nimport {\n  ClickOnStoryInternalPayload,\n  ClickOnStoryPayload,\n  FontResource,\n  STORY_LIST_TYPE\n} from \"../story-manager/common.h\";\nimport {Dict} from \"../../global.h\";\n\n// use name|sid or  \"effector/babel-plugin\"\nconst toServerFxDomain = createDomain(\"serverFxDomainWidgetStoriesList\");\nconst toClientFxDomain = createDomain(\"clientFxDomainWidgetStoriesList\");\n\nexport {toServerFxDomain as serverFxDomain, toClientFxDomain as clientFxDomain}\n\nexport const rpcDomains = {\n  serverFxDomain: toServerFxDomain,\n  clientFxDomain: toClientFxDomain\n}\n\n// export const workerMessage = domain.effect<string, string[]>();\n// export const failure = domain.effect<void, any>();\n// export const ping: Effect<{now: number}, {ping: number}> = domain.effect();\n\n\n\nexport const RpcMessage = toClientFxDomain.effect<string, string[]>(\"RpcMessage\");\nexport const setStories = toClientFxDomain.effect<{listType: STORY_LIST_TYPE, storyList: Array<Dict>}, void>(\"setStories\");\nexport const setFonts = toClientFxDomain.effect<FontResource, void>(\"setFonts\");\n\nexport const RpcMessageOnServer = toServerFxDomain.effect<string, string[]>(\"RpcMessageOnServer\");\n\n\nexport const widgetLoaded = toServerFxDomain.effect<void, void>(\"widgetLoaded\");\nexport const clickOnStoryInternalEvent = toServerFxDomain.effect<ClickOnStoryInternalPayload, void>(\"clickOnStoryInternalEvent\");\nexport const flushThumbViewsEvent = toServerFxDomain.effect<Array<number>, void>(\"flushThumbViewsEvent\");\nexport const clickOnStoryEvent = toServerFxDomain.effect<ClickOnStoryPayload, void>(\"clickOnStoryEvent\");\nexport const clickOnStoryDeepLinkEvent = toServerFxDomain.effect<ClickOnStoryPayload, void>(\"clickOnStoryDeepLinkEvent\");\n\n\n","export enum MessageType {\n  REQUEST,\n  RESPONSE\n}\n\nexport enum MessageStatus {\n  SUCCESS,\n  ERROR\n}\n\nexport type Message = {\n  type: MessageType,\n  id: number,\n  sid: string,\n  params?: any,\n  status?: MessageStatus,\n  error?: any,\n  result?: any,\n};\n","import {IWorkerServer} from \"./IWorkerServer\";\nimport {Option, Dict} from \"../../global.h\";\n\nimport {Message} from \"./index.h\";\nimport WebView from \"react-native-webview\";\nimport {isFunction} from \"../helpers/isFunction\";\n\n\nexport class WebViewWorkerServer implements IWorkerServer {\n\n  private readonly _destructor;\n  constructor(private webview: WebView) {\n    const messageListener = (event: MessageEvent) => this.messageListener(event);\n    // @ts-ignore\n    webview.onMessage = messageListener;\n      // webview.addEventListener(\"message\", messageListener, false);\n    // this._destructor = () => webview.removeEventListener(\"message\", this.messageListener);\n    this._destructor = () => {};\n  }\n\n  public destructor() {\n    this._destructor();\n  }\n\n\n  messageListener(event: MessageEvent) {\n    //@ts-ignore\n    console.log(\"messageListener server\", {\"event.nativeEvent.data\": event.nativeEvent.data, \"this\": this});\n\n    let data = {};\n    try {\n      data = JSON.parse(event.nativeEvent.data);\n    } catch (e) {\n      console.error(e);\n    }\n\n    // TODO  check из какого webview пришло сообщение\n\n    if (isFunction(this.onMessageCb)) {\n      //@ts-ignore\n      console.log(\"messageListener server 3\", {data});\n      //@ts-ignore\n      this.onMessageCb(data);\n    }\n\n  }\n\n  sendMessage(message: Message) {\n    console.log('sendMessage from server', {message});\n    // this.contentWindow?.postMessage(message, this.origin);\n    try {\n      // https://github.com/react-native-webview/react-native-webview/blob/master/src/WebView.ios.tsx\n      this.webview.postMessage(JSON.stringify(message));\n    } catch (e) {\n      console.log(e);\n    }\n  }\n\n  private onMessageCb: Option<(data: Dict) => void> = null;\n  set onmessage(cb: (data: Dict) => void) {\n    this.onMessageCb = cb;\n  }\n\n}","import {Dict, Option} from \"../../global.h\";\nimport Widget, {ObjectId} from \"../widget\";\nimport {ClickOnStoryInternalPayload, ClickOnStoryPayload, SyncStoreEvent} from \"../story-manager/common.h\";\nimport {StoriesListOptions} from \"./index.h\";\nimport {AppearanceCommonOptions} from \"../story-manager/appearanceCommon.h\";\nimport {IWidgetStoriesList} from \"./index\";\nimport {AppearanceManager} from \"../story-manager/AppearanceManager\";\nimport {CreateViewOptions} from \"./rn.h\";\n\ndeclare global {\n  interface Window {\n    scrollNode: any; // browser env\n    fastXDM: any;\n    iasAsyncInitCallbacks: Array<() => void>;\n  }\n}\n\nimport {\n  rpcDomains,\n  RpcMessage,\n  RpcMessageOnServer,\n  widgetLoaded,\n  setStories,\n  setFonts,\n  clickOnStoryInternalEvent, flushThumbViewsEvent, clickOnStoryEvent, clickOnStoryDeepLinkEvent\n} from \"./rpc\";\nimport {create as createRpcServer} from \"../rpc/remoteFX/server\";\nimport {IframeWorkerServer} from \"../rpc/IframeWorkerServer\";\nimport {ReactEventHandler, SyntheticEvent} from \"react\";\nimport WebView from \"react-native-webview\";\nimport {WebViewWorkerServer} from \"../rpc/WebViewWorkerServer\";\n\n\nRpcMessageOnServer.use(async arg => {\n  return [arg + \" :125\"];\n});\n\n\n//@ts-ignore\nwindow.RpcMessage = RpcMessage;\n// const result = await workerMessage('foo bar  baz bam')\n\n// const jsResourceGlobal = new URL(\"./StoriesListClient.umd.js\", import.meta.url);\n// const cssResourceGlobal = new URL(\"./StoriesListClient.umd.css\", import.meta.url);\n\n// escaped content\n// @ts-ignore\nimport jsResourceGlobal from \"../../packages/react-native-ias/StoriesListClient.js\";\n// @ts-ignore\nimport cssResourceGlobal from \"../../packages/react-native-ias/StoriesListClient.css.js\";\nimport {isFunction} from \"../helpers/isFunction\";\nconsole.log('changed');\n\n// const jsResourceGlobal = \"\";\n// const cssResourceGlobal = \"\";\n\n\nclass WidgetStoriesList extends Widget implements IWidgetStoriesList {\n\n  private readonly storiesListOptions: StoriesListOptions & Pick<AppearanceCommonOptions, \"hasFavorite\">;\n\n  constructor(private appearanceManager: AppearanceManager) {\n    super();\n\n    this.storiesListOptions = {\n      ...appearanceManager.storiesListOptions,\n      hasFavorite: appearanceManager.commonOptions.hasFavorite\n    }\n\n    this.widgetId = ++Widget.count;\n\n    // вынести в общую часть\n    widgetLoaded.use(() => {\n      this.emit(\"widgetLoaded\");\n    });\n\n    clickOnStoryInternalEvent.use(payload => {\n      console.log('clickOnStoryInternalEvent 1');\n      if (isFunction(this.callbacks?.handleClickOnStoryInternal)) {\n        console.log('clickOnStoryInternalEvent 2');\n        this.callbacks?.handleClickOnStoryInternal(payload);\n      }\n    });\n\n    flushThumbViewsEvent.use(payload => {\n      if (isFunction(this.callbacks?.handleFlushThumbViews)) {\n        this.callbacks?.handleFlushThumbViews(payload);\n      }\n    });\n\n    // public event\n    clickOnStoryEvent.use(\n      payload => {\n        if (isFunction(this.callbacks?.handleClickOnStory)) {\n          this.callbacks?.handleClickOnStory(payload);\n        }\n      }\n    );\n\n    // click on deep link from story list\n    clickOnStoryDeepLinkEvent.use(payload => {\n      if (isFunction(this.callbacks?.handleClickOnStoryDeepLink)) {\n        this.callbacks?.handleClickOnStoryDeepLink(payload);\n      }\n    });\n\n    // storyReader.on('storyOpenedInternal', (payload: {id: number}) => this.onStoryOpened(payload));\n\n\n    // storyReader.on('favoriteStoryInternal', (payload: {id: number, value: boolean}) => this.onStoryFavoriteChange(payload));\n\n\n\n  }\n\n  public get widgetSrcFile(): string | URL {\n    return jsResourceGlobal;\n  }\n\n  public get widgetEntrypoint(): string {\n    return `\n      <head>\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, user-scalable=0, shrink-to-fit=no\">\n        <style type=\"text/css\">${cssResourceGlobal}</style>\n      </head>\n      <div id=\"app\"><div id=\"_app\"></div></div>\n      <script type=\"text/javascript\">${jsResourceGlobal}</script>\n      <script type=\"text/javascript\">\n        window.storiesList = (function () {\n          var self = window.storiesList || {};\n          self._e = self._e || [];\n          self.ready = self.ready || function (f) {self._e.push(f);};\n          return self;\n        }());\n\n        window.storiesList.ready(function () {\n          window.storiesList.init(${JSON.stringify(this.storiesListOptions)});\n        });\n\n      </script>`;\n  }\n\n\n  private rpc: any;\n\n  public async mount(mountSelector: string, storiesListOptions: StoriesListOptions & Pick<AppearanceCommonOptions, \"hasFavorite\">): Promise<boolean> {\n    // создаем iframe\n    // по завершению - mounted();\n\n\n    const options: CreateViewOptions = {\n      allowTransparency: true,\n      overflowTouch: false,\n      backgroundColor: storiesListOptions.layout.backgroundColor,\n      width: 'auto',\n      height: 0,\n      pageUrl: '',\n      startHeight: 0\n    };\n\n    // todo непонятно как высоту с учетом title рассчитывать\n    if (storiesListOptions.layout.height) {\n      options.startHeight = storiesListOptions.layout.height;\n    } else {\n      if (!storiesListOptions.title) {\n        options.startHeight = storiesListOptions.card.height + storiesListOptions.topPadding + storiesListOptions.bottomPadding + storiesListOptions.bottomMargin;\n      } else {\n        // line height + margin-bottom\n        options.startHeight = 50 + storiesListOptions.card.height + storiesListOptions.topPadding + storiesListOptions.bottomPadding + storiesListOptions.bottomMargin;\n      }\n    }\n\n    this.createView(mountSelector, options);\n\n  }\n\n\n  private createView(mountSelector: string, options: CreateViewOptions) {\n    const self = this;\n    let obj: Option<HTMLElement> = null;\n    if (mountSelector === 'body') {\n      obj = document.body;\n    } else {\n      obj = document.querySelector(mountSelector);\n    }\n\n\n    if (obj) {\n\n\n    }\n  }\n\n  private extend(obj1: Dict, obj2: Dict) {\n    for (var i in obj2) {\n      if (obj1[i] && typeof (obj1[i]) === 'object') {\n        this.extend(obj1[i], obj2[i])\n      } else {\n        obj1[i] = obj2[i];\n      }\n    }\n  }\n\n  private genKey() {\n    var key = '';\n    for (var i = 0; i < 5; i++) {\n      key += Math.ceil(Math.random() * 15).toString(16);\n    }\n    return key;\n  }\n\n  private frameName: string = '';\n\n  private mountView(obj: HTMLElement, options: Dict, attrs?: Dict) {\n\n    this.frameName = 'fXD' + this.genKey();\n\n    const div = document.createElement('div');\n    div.innerHTML = '<iframe name=\"' + this.frameName + '\" ' + (attrs || '') + '></iframe>';\n    const frame = div.firstChild as HTMLIFrameElement;\n    const self = this;\n\n    setTimeout(function () {\n      frame.frameBorder = '0';\n      if (options) self.extend(frame, options);\n      obj.insertBefore(frame, obj.firstChild);\n\n      //             this.caller = obj.contentWindow;\n      //             this.frame  = obj;\n      // rpcServerStart\n\n      // self.start(frame);\n\n    }, 0);\n\n    return frame;\n  }\n\n\n  // container options\n  public get containerOptions(): Dict {\n    const options: CreateViewOptions = {\n      allowTransparency: true,\n      overflowTouch: false,\n      backgroundColor: this.storiesListOptions.layout.backgroundColor,\n      width: 0,\n      height: 0,\n      pageUrl: '',\n      startHeight: 0\n    };\n\n\n    //\n    // // todo непонятно как высоту с учетом title рассчитывать\n    // if (this.storiesListOptions.layout.height) {\n    //   options.startHeight = this.storiesListOptions.layout.height;\n    // } else {\n    //   if (!this.storiesListOptions.title) {\n    //     options.startHeight = this.storiesListOptions.card.height + this.storiesListOptions.topPadding + this.storiesListOptions.bottomPadding + this.storiesListOptions.bottomMargin;\n    //   } else {\n    //     // line height + margin-bottom\n    //     options.startHeight = 50 + this.storiesListOptions.card.height + this.storiesListOptions.topPadding + this.storiesListOptions.bottomPadding + this.storiesListOptions.bottomMargin;\n    //   }\n    // }\n\n    let params: Dict<any> = {\n      // настройки storiesList виджета\n      storiesHeight: this.storiesListOptions.card?.height || 70,\n      storiesLayoutHeight: this.storiesListOptions.layout?.height || 0,\n      storiesBackgroundColor: this.storiesListOptions.layout?.backgroundColor || 'transparent',\n      storiesListTopPadding: this.storiesListOptions.topPadding || 20,\n      storiesListBottomPadding: this.storiesListOptions.bottomPadding || 20,\n      storiesListBottomMargin: this.storiesListOptions.bottomMargin || 20,\n      storiesTitle: this.storiesListOptions.title?.content || '',\n\n      extraCss: this.storiesListOptions.extraCss || null,\n      extraJs: null,\n\n    };\n\n    let defaults = {\n      maxWidth: 0,\n      startHeight: 70,\n      minWidth: 150,\n      storiesHeight: 70,\n      scrolling: false,\n      hidden: false\n    };\n\n    // todo непонятно как высоту с учетом title рассчитывать\n    if (params.storiesLayoutHeight) {\n      defaults.startHeight = parseFloat(params.storiesLayoutHeight);\n    } else {\n      if (!params.storiesTitle) {\n        defaults.startHeight = parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      } else {\n        // line height + margin-bottom\n        defaults.startHeight = 50 + parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      }\n    }\n\n\n    let width: number = options.width === 'auto' ? (/*obj.clientWidth || obj.offsetWidth || */defaults.minWidth) | 0 : parseInt(options.width || 0, 10);\n\n    const cssWidth: string = width ? (Math.max(defaults.minWidth || 200, Math.min(defaults.maxWidth || 10000, width)) + 'px') : '100%';\n\n    const containerOptions: Dict = {\n      style: {}\n    };\n\n    containerOptions.style.width = cssWidth;\n    containerOptions.style.overflow = 'hidden';\n\n    if (options.height) {\n      // params.height = options.height;\n      containerOptions.style.height = options.height + 'px';\n    } else {\n      containerOptions.style.height = (defaults.startHeight || 200) + 'px';\n    }\n\n    if (options.overflowTouch) {\n      containerOptions.style.overflow = 'auto';\n      containerOptions.style.WebkitOverflowScrolling = 'touch';\n    }\n\n    return {\n      style: {\n        position: 'relative',\n        height: parseInt(containerOptions.style.height),\n        width: containerOptions.style.width\n      }\n    };\n\n    // return containerOptions;\n  }\n\n\n  public get viewOptions(): Dict {\n    if (!this.frameName) {\n      this.frameName = 'fXD' + this.genKey();\n    }\n\n    const options: CreateViewOptions = {\n      allowTransparency: true,\n      overflowTouch: false,\n      backgroundColor: this.storiesListOptions.layout.backgroundColor,\n      width: 0,\n      height: 0,\n      pageUrl: '',\n      startHeight: 0\n    };\n\n    // // todo непонятно как высоту с учетом title рассчитывать\n    // if (this.storiesListOptions.layout.height) {\n    //   options.startHeight = this.storiesListOptions.layout.height;\n    // } else {\n    //   if (!this.storiesListOptions.title) {\n    //     options.startHeight = this.storiesListOptions.card.height + this.storiesListOptions.topPadding + this.storiesListOptions.bottomPadding + this.storiesListOptions.bottomMargin;\n    //   } else {\n    //     // line height + margin-bottom\n    //     options.startHeight = 50 + this.storiesListOptions.card.height + this.storiesListOptions.topPadding + this.storiesListOptions.bottomPadding + this.storiesListOptions.bottomMargin;\n    //   }\n    // }\n\n\n    // todo in common part\n    let params: Dict<any> = {\n      // настройки storiesList виджета\n      storiesHeight: this.storiesListOptions.card?.height || 70,\n      storiesLayoutHeight: this.storiesListOptions.layout?.height || 0,\n      storiesBackgroundColor: this.storiesListOptions.layout?.backgroundColor || 'transparent',\n      storiesListTopPadding: this.storiesListOptions.topPadding || 20,\n      storiesListBottomPadding: this.storiesListOptions.bottomPadding || 20,\n      storiesListBottomMargin: this.storiesListOptions.bottomMargin || 20,\n      storiesTitle: this.storiesListOptions.title?.content || '',\n\n      extraCss: this.storiesListOptions.extraCss || null,\n      extraJs: null,\n\n    };\n\n    let defaults = {\n      maxWidth: 0,\n      startHeight: 70,\n      storiesHeight: 70,\n      minWidth: 150,\n      scrolling: false,\n      hidden: false\n    };\n\n    // todo непонятно как высоту с учетом title рассчитывать\n    if (params.storiesLayoutHeight) {\n      defaults.startHeight = parseFloat(params.storiesLayoutHeight);\n    } else {\n      if (!params.storiesTitle) {\n        defaults.startHeight = parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      } else {\n        // line height + margin-bottom\n        defaults.startHeight = 50 + parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      }\n    }\n\n\n    let width: number = options.width === 'auto' ? (/*obj.clientWidth || obj.offsetWidth || */defaults.minWidth) | 0 : parseInt(options.width || 0, 10);\n\n    const cssWidth: string = width ? (Math.max(defaults.minWidth || 200, Math.min(defaults.maxWidth || 10000, width)) + 'px') : '100%';\n\n\n    const iframeOptions: Dict<any> = {\n      src: '',\n      id: 'iaswidget' + this.widgetId,\n      allowtransparency: Boolean(options.allowTransparency || false).toString(),\n      style: {\n        backgroundColor: options.backgroundColor || 'transparent',\n      }\n    };\n\n    iframeOptions.width = (cssWidth.indexOf('%') != -1) ? cssWidth : (parseInt(cssWidth) || cssWidth);\n    iframeOptions.height = defaults.startHeight || '100%';\n\n    // for correct @media in iframe work - pass innerWidth instead of clientWidth\n    // plus parent div overflow: hidden\n    // width: cssWidth === '100%' ? '100%' : cssWidth,\n    // https://stackoverflow.com/questions/23083462/how-to-get-an-iframe-to-be-responsive-in-ios-safari\n    iframeOptions.style.width = '1px';\n    iframeOptions.style.minWidth = '100%';\n    iframeOptions.style[\"*width\"] = '100%';\n\n\n    if (defaults.scrolling) {\n      iframeOptions.scrolling = 'yes';\n    } else {\n      iframeOptions.scrolling = 'no';\n      iframeOptions.style.overflow = 'hidden';\n    }\n\n    if (defaults.hidden) {\n      iframeOptions.style.display = 'none';\n    }\n\n\n    // if (isWindowSupportIframeBlobSrcSync()) {\n    //   iframeOptions.src = blobUrl.src;\n    // } else {\n    //   //@ts-ignore\n    //   iframeOptions.srcDoc = blobUrl.srcdoc;\n    // }\n\n    return {\n      style: {\n        width: '100%',\n        height: iframeOptions.height\n      },\n      // не нужно для WebView\n      // onLoad: WidgetStoriesList.onViewFirstLoad,\n\n      source: {\n        html: this.widgetEntrypoint, baseUrl: 'https://sdk.inappstory.com'\n      }\n    };\n\n    return {\n      name: this.frameName,\n      frameBorder: '0',\n      ...iframeOptions,\n      // onLoad: WidgetStoriesList.onViewFirstLoad\n    };\n\n  }\n\n\n  public createRpcServer(worker: any) {\n    createRpcServer(rpcDomains, new WebViewWorkerServer(worker));\n  }\n\n\n  public async init(mountSelector: string, storiesListOptions: StoriesListOptions & Pick<AppearanceCommonOptions, \"hasFavorite\">) {\n\n    let params: Dict<any> = {\n        // настройки storiesList виджета\n        storiesHeight: storiesListOptions.card?.height || 70,\n        storiesLayoutHeight: storiesListOptions.layout?.height || 0,\n        storiesBackgroundColor: storiesListOptions.layout?.backgroundColor || 'transparent',\n        storiesListTopPadding: storiesListOptions.topPadding || 20,\n        storiesListBottomPadding: storiesListOptions.bottomPadding || 20,\n        storiesListBottomMargin: storiesListOptions.bottomMargin || 20,\n        storiesTitle: storiesListOptions.title?.content || '',\n\n        extraCss: storiesListOptions.extraCss || null,\n        extraJs: null,\n\n      },\n      widgetRoot: any,\n      widget: any,\n      rpc: any,\n      inFullScreenMode = false,\n      scrollPosition = [0, 0],\n      options: Dict<any> = {};\n\n    options.allowTransparency = true;\n    options.overflowTouch = false;\n\n    options.backgroundColor = params.storiesBackgroundColor;\n\n    var defaults = {\n      startHeight: 70,\n      minWidth: 150,\n      storiesHeight: 70\n    };\n\n    // todo непонятно как высоту с учетом title рассчитывать\n    if (params.storiesLayoutHeight) {\n      defaults.startHeight = parseFloat(params.storiesLayoutHeight);\n    } else {\n      if (!params.storiesTitle) {\n        defaults.startHeight = parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      } else {\n        // line height + margin-bottom\n        defaults.startHeight = 50 + parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      }\n    }\n\n    var body = document.querySelector('body'),\n      html = document.querySelector('html'),\n      zIndex = options.zIndex || 10000;\n\n    const self = this;\n\n    const functions = {\n\n      // TODO add class to body\n\n      // switchToFullScreen: function () {\n      //     if (inFullScreenMode) {\n      //         return;\n      //     }\n      //\n      //     scrollPosition = IAS_OLD.Util.getScroll();\n      //\n      //     if (body) {\n      //         body.style.setProperty('user-select', 'none');\n      //         body.style.setProperty('-webkit-user-select', 'none');\n      //\n      //         body.style.setProperty('overflow', 'hidden');\n      //         body.style.setProperty('-webkit-overflow-scrolling', 'touch');\n      //     }\n      //\n      //     if (html) {\n      //         html.style.setProperty('position', 'fixed');\n      //         html.style.setProperty('overflow', 'hidden');\n      //     }\n      //\n      //     if (widgetRoot && widget) {\n      //         // получаем текущее смещение от начала viewport\n      //         const viewportOffset = widgetRoot.getBoundingClientRect();\n      //         const offsetTop = viewportOffset.top;\n      //\n      //         widget.style.setProperty('position', 'fixed')\n      //         widget.style.setProperty('top', '0')\n      //         widget.style.setProperty('bottom', '0')\n      //         widget.style.setProperty('left', '0')\n      //         widget.style.setProperty('right', '0')\n      //         widget.style.setProperty('height', '0')\n      //         widget.style.setProperty('min-height', '100%')\n      //         widget.style.setProperty('max-height', '100%')\n      //\n      //         widget.style.setProperty('z-index', zIndex)\n      //\n      //         rpc.callMethod('onEnterFullScreen', {offsetTop: offsetTop})\n      //\n      //     }\n      //\n      //     inFullScreenMode = true;\n      //\n      //     // newWidth  = parseInt(newWidth);\n      //     // newHeight = parseInt(newHeight);\n      //     // var widgetElem = document.getElementById('iaswidget' + widgetId);\n      //     // if (isFinite(newWidth)) {\n      //     //   obj.style.width = newWidth + 'px';\n      //     //   if (widgetElem) {\n      //     //     widgetElem.style.width = newWidth + 'px';\n      //     //   }\n      //     // }\n      //     // if (isFinite(newHeight)) {\n      //     //   obj.style.height = newHeight + 'px';\n      //     //   if (widgetElem) {\n      //     //     widgetElem.style.height = newHeight + 'px';\n      //     //   }\n      //     // }\n      //     // if (options.onResizeWidget) options.onResizeWidget();\n      //     //\n      //\n      //\n      // },\n      // switchFromFullScreen: function () {\n      //     if (!inFullScreenMode) {\n      //         return;\n      //     }\n      //\n      //     if (widgetRoot && widget) {\n      //         widget.style.setProperty('position', '')\n      //         widget.style.setProperty('top', '')\n      //         widget.style.setProperty('bottom', '')\n      //         widget.style.setProperty('left', '')\n      //         widget.style.setProperty('right', '')\n      //         widget.style.setProperty('height', isFinite(defaults['startHeight']) ? defaults['startHeight'] + 'px' : '100%')\n      //         widget.style.setProperty('min-height', '')\n      //         widget.style.setProperty('max-height', '')\n      //         widget.style.setProperty('z-index', '')\n      //\n      //         rpc.callMethod('onLeaveFullScreen')\n      //     }\n      //\n      //     if (body) {\n      //         body.style.setProperty('user-select', '');\n      //         body.style.setProperty('-webkit-user-select', '');\n      //\n      //         body.style.setProperty('overflow', '');\n      //         body.style.setProperty('-webkit-overflow-scrolling', '');\n      //     }\n      //\n      //     if (html) {\n      //         html.style.setProperty('position', '');\n      //         html.style.setProperty('overflow', '');\n      //     }\n      //\n      //     window.scrollTo(scrollPosition[0], scrollPosition[1])\n      //\n      //     inFullScreenMode = false;\n      //\n      // },\n\n      event: function (name: string, data: Object) {\n        self.emit(name, data)\n      },\n    };\n\n\n    params.extraJs = null;\n\n    // custom load end\n    options.no_finish_loading = true;\n\n    return this._init(mountSelector as ObjectId, options, params, storiesListOptions, functions, defaults, function (o: any, i: any, r: any) {\n      widgetRoot = o;\n      widget = i;\n      rpc = r;\n    }, null, null);\n\n  }\n\n  getWidgetDocument(widgetParams: Dict): string {\n\n    const baseUrl = process.env.BASE_URL;\n    const apiUrl = process.env.API_URL;\n    const buildVersion = process.env.BUILD_VERSION;\n\n    // todo можно BASE_URL менять в процессе сборки\n    let cssResource: URL | string = `${baseUrl}/v${buildVersion}/dist/css/storiesList.css`;\n    let jsResource: URL | string = `${baseUrl}/v${buildVersion}/dist/js/storiesList.js`;\n    if (process.env.NODE_ENV === \"development\") {\n      cssResource = `${baseUrl}/css/storiesList.css`;\n      jsResource = `${baseUrl}/js/storiesList.js`;\n\n      // if npm pack\n      // cssResource = new URL(\"~/dist/css/storiesList.css\", import.meta.url);\n      // jsResource = new URL(\"~/dist/js/storiesList.js\", import.meta.url);\n\n\n      // jsResource = `/js/storiesList.js`;\n\n    }\n\n    // cssResource = new URL(\"~/dist/css/storiesList.css\", import.meta.url);\n    // jsResource = new URL(\"~/dist/js/storiesList.js\", import.meta.url);\n\n    jsResource = jsResourceGlobal;\n\n    // console.log({meta: import.meta});\n\n    // (async () => {\n    //   const {WStories} = await import(\"~/src/stories_widget/stories-slider\");\n    //   console.log({WStories});\n    // })();\n\n\n    // <link rel=\"stylesheet\" type=\"text/css\" href=\"${cssResource}\"/>\n    // <script type=\"text/javascript\" src=\"${jsResource}\"></script>\n    // import.meta.url\n\n    // <script type=\"text/javascript\" src=\"${jsResource}\"></script>\n    return `\n        <script type=\"text/javascript\" src=\"${jsResource}\"></script>\n        <div id=\"app\"><div id=\"_app\"></div></div>\n        <script type=\"text/javascript\">\n          window.storiesList.init(${JSON.stringify(widgetParams)});\n        </script>\n`;\n\n\n  }\n\n  protected async _init(mountSelector: ObjectId, options: Dict, params: Dict, widgetParams: Dict, funcs: Dict, defaults: Dict, onDone: (obj: any, iframe: any, rpc: any) => void, widgetId: Nullable<string | number>, iter: Nullable<number>) {\n\n    funcs.event = (name: string, data: Object) => this.emit(name, data)\n\n    onDone = (obj: any, iframe: any, rpc: any) => {\n      this.rpc = rpc;\n    };\n\n    const result = super._init(mountSelector, options, params, widgetParams, funcs, defaults, onDone, widgetId, iter);\n\n    // story reader\n\n    // const storyReader = new StoryReader('body', options);\n\n\n    // this.on('sessionInitInternal', (payload: any) => storyReader.sessionInit(payload));\n    // this.on('clickOnStoryInternal', (payload: ClickOnStoryInternalPayload) => storyReader.openReader(payload));\n    this.on('clickOnStoryInternal', (payload: ClickOnStoryInternalPayload) => {\n      if (isFunction(this.callbacks?.handleClickOnStoryInternal)) {\n        this.callbacks?.handleClickOnStoryInternal(payload);\n      }\n    });\n\n    this.on('flushThumbViews', (payload: Array<number>) => {\n      if (isFunction(this.callbacks?.handleFlushThumbViews)) {\n        this.callbacks?.handleFlushThumbViews(payload);\n      }\n    });\n\n\n    // storyReader.on('storyOpenedInternal', (payload: {id: number}) => this.onStoryOpened(payload));\n\n\n    // storyReader.on('favoriteStoryInternal', (payload: {id: number, value: boolean}) => this.onStoryFavoriteChange(payload));\n\n\n    // public event\n    this.on('clickOnStory', (payload: ClickOnStoryPayload) => {\n      if (isFunction(this.callbacks?.handleClickOnStory)) {\n        this.callbacks?.handleClickOnStory(payload);\n      }\n    });\n\n    // click on deep link from story list\n    this.on('clickOnStoryDeepLink', (payload: ClickOnStoryPayload) => {\n      if (isFunction(this.callbacks?.handleClickOnStoryDeepLink)) {\n        this.callbacks?.handleClickOnStoryDeepLink(payload);\n      }\n    });\n\n    // button from slide\n    // storyReader.on('clickOnButton', (payload: ClickOnButtonPayload) => {\n    //     if (params.storyLinkHandleClick && isFunction(params.storyLinkHandleClick)) {\n    //         params.storyLinkHandleClick(payload);\n    //     } else {\n    //         window.open(payload.url, '_self');\n    //     }\n    // });\n\n    const publicEvents = ['showSlide', 'showStory', 'closeStory', 'clickOnButton', 'likeStory', 'dislikeStory', 'favoriteStory', 'shareStory', 'shareStoryWithPath'];\n\n    // publicEvents.forEach((eventName) => storyReader.on(eventName, (payload) => this.emit(eventName, payload)));\n\n    // let storyFavorite: Nullable<_StoryFavorite> = null;\n    // if (options.hasFavorite) {\n    //   storyFavorite = new _StoryFavorite('body', options);\n    // }\n\n    // storyFavorite && this.on('sessionInitInternal', (payload: any) => storyFavorite && storyFavorite.sessionInit(payload));\n    // storyFavorite && this.on('clickOnFavoriteCellInternal', (payload: ClickOnFavoriteCellInternalPayload) => storyFavorite && storyFavorite.openReader(payload));\n\n    // custom method\n    // storyFavorite && storyFavorite.on('clickOnStoryInternal', (payload: ClickOnStoryInternalPayload) => storyReader.openReader(payload));\n    // storyFavorite && storyReader.on('openStoryReader', (options: {windowReferer: STORY_READER_WINDOW_REFERER}) => storyFavorite && storyFavorite.openStoryReader(options));\n    // storyFavorite && storyReader.on('closeStoryReader', (options: {windowReferer: STORY_READER_WINDOW_REFERER}) => storyFavorite && storyFavorite.closeStoryReader(options));\n\n    /*    storyFavorite && storyFavorite.on('closeReader', () => {\n          try {\n            window.focus()\n          } catch (e) {\n            console.error(e)\n          }\n        });*/\n\n    this.on('syncStore', (payload: SyncStoreEvent) => {\n      // storyReader.syncStoreHandle(payload);\n      // storyFavorite && storyFavorite.syncStoreHandle(payload);\n    });\n\n    // storyReader.on('syncStore', (payload: SyncStoreEvent) => {\n    //     this.syncStoreHandle(payload);\n    //     storyFavorite && storyFavorite.syncStoreHandle(payload);\n    // });\n    //\n    // storyFavorite && storyFavorite.on('syncStore', (payload: SyncStoreEvent) => {\n    //     this.syncStoreHandle(payload);\n    //     storyReader.syncStoreHandle(payload);\n    // });\n\n    return result;\n  }\n\n  onStoryOpened(payload: { id: number }) {\n    this.rpc.callMethod('onStoryOpened', payload);\n  }\n\n  // onStoryFavoriteChange(payload: {id: number, value: boolean}) {\n  //     this.rpc.callMethod('onStoryFavoriteChange', payload);\n  // }\n\n  syncStoreHandle(payload: SyncStoreEvent) {\n    this.rpc.callMethod('onSyncStore', payload);\n  }\n\n\n  // pass story list\n  setStories(payload: any) {\n    // вынести в общую часть\n    setStories(payload);\n\n  }\n\n  setFonts(payload: any) {\n    setFonts(payload);\n  }\n\n\n}\n\nexport {WidgetStoriesList};\n","import {Option, Dict} from \"../../global.h\";\n\nexport enum StoryReaderCloseButtonPosition {\n  LEFT = 'left',\n  RIGHT = 'right'\n}\n\nexport enum StoryReaderSwipeStyle {\n  FLAT = 'flat',\n  COVER = 'cover',\n  CUBE = 'cube'\n}\n\n\nexport type StoryReaderOptions = {\n  closeButtonPosition: StoryReaderCloseButtonPosition,\n  scrollStyle: StoryReaderSwipeStyle,\n  loader?: {\n    default: {\n      color: Option<string>,\n      accentColor: Option<string>,\n    },\n    custom: Option<string>\n  },\n  recycleStoriesList?: boolean,\n  closeOnLastSlideByTimer?: boolean,\n};\n\nconst StoryReaderOptionsDefault: StoryReaderOptions = {\n  closeButtonPosition: StoryReaderCloseButtonPosition.RIGHT,\n  scrollStyle: StoryReaderSwipeStyle.FLAT,\n  loader: {\n    default: {\n      color: null,\n      accentColor: null,\n    },\n    custom: null\n  },\n  recycleStoriesList: false,\n  closeOnLastSlideByTimer: true\n};\n\nexport {StoryReaderOptionsDefault};\n","export type AppearanceCommonOptions = {\r\n  hasFavorite?: boolean;\r\n  hasLike?: boolean;\r\n  hasShare?: boolean;\r\n};\r\n\r\nconst AppearanceCommonOptionsDefault: AppearanceCommonOptions = {\r\n  hasFavorite: false,\r\n  hasLike: false,\r\n  hasShare: false\r\n};\r\n\r\nexport {AppearanceCommonOptionsDefault};\r\n\r\n\r\n","import {createDomain, Effect} from 'effector';\n\nimport {\n  ClickOnStoryInternalWithDataPayload,\n  FontResource,\n  STORY_LIST_TYPE,\n  STORY_READER_WINDOW_REFERER\n} from \"../story-manager/common.h\";\nimport {Dict} from \"../../global.h\";\n\n// use name|sid or  \"effector/babel-plugin\"\nconst toServerFxDomain = createDomain(\"serverFxDomainWidgetStory\");\nconst toClientFxDomain = createDomain(\"clientFxDomainWidgetStory\");\n\nexport {toServerFxDomain as serverFxDomain, toClientFxDomain as clientFxDomain}\n\nexport const rpcDomains = {\n  serverFxDomain: toServerFxDomain,\n  clientFxDomain: toClientFxDomain\n}\n\n// export const workerMessage = domain.effect<string, string[]>();\n// export const failure = domain.effect<void, any>();\n// export const ping: Effect<{now: number}, {ping: number}> = domain.effect();\n\n\n\nexport const RpcMessage = toClientFxDomain.effect<string, string[]>(\"RpcMessage\");\n\nexport const setStories = toClientFxDomain.effect<{listType: STORY_LIST_TYPE, storyList: Array<Dict>}, void>(\"setStories\");\nexport const setFonts = toClientFxDomain.effect<FontResource, void>(\"setFonts\");\n\nexport const onOpenReader = toClientFxDomain.effect<ClickOnStoryInternalWithDataPayload & {hasShare: boolean}, void>(\"onOpenReader\");\nexport const onCloseReader = toClientFxDomain.effect<void, void>(\"onCloseReader\");\n\nexport const RpcMessageOnServer = toServerFxDomain.effect<string, string[]>(\"RpcMessageOnServer\");\n\n\nexport const widgetLoaded = toServerFxDomain.effect<void, void>(\"widgetLoaded\");\nexport const onReaderOpened = toServerFxDomain.effect<{windowReferer: STORY_READER_WINDOW_REFERER}, void>(\"onReaderOpened\");\nexport const onReaderClosed = toServerFxDomain.effect<{windowReferer: STORY_READER_WINDOW_REFERER}, void>(\"onReaderClosed\");","import {Option, Dict} from \"../../global.h\";\n\nexport type StoriesListOptions = {\n    title: StoriesListTitleOptions;\n    card: StoriesListCardOptions;\n    favoriteCard: StoriesListFavoriteCardOptions;\n    layout: {\n        height: number;\n        backgroundColor: string;\n    };\n    sidePadding: number;\n    topPadding: number;\n    bottomPadding: number;\n    bottomMargin: number;\n\n    navigation: {\n        showControls: boolean;\n        controlsSize: number;\n        controlsBackgroundColor: string;\n        controlsColor: string;\n    };\n\n    extraCss?: string;\n\n    // setCallback ?\n    handleStoryLinkClick?: (payload: StoriesListClickEvent) => void;\n\n    handleStartLoading?: (loaderContainer: HTMLElement) => void;\n    handleStopLoading?: (loaderContainer: HTMLElement) => void;\n\n\n    // handleClickOnStory?: (event: StoriesListClickEvent) => void,\n\n}\n\nexport type StoriesListTitleOptions = {\n    content: string;\n    color: string;\n    font: string;\n    marginBottom: number;\n}\n\nexport enum StoriesListCardViewVariant {\n    CIRCLE = 'circle',\n    QUAD = 'quad',\n    RECTANGLE = 'rectangle'\n}\n\nexport type StoriesListCardOptions = {\n    title: {\n        color: string;\n        padding: string | number;\n        font: string;\n    };\n    gap: number;\n    height: number;\n    variant: StoriesListCardViewVariant;\n    border: {\n        radius: number;\n        color: string;\n        width: number;\n        gap: number;\n    };\n    boxShadow: Option<string>;\n    opacity: Option<number>;\n    mask: {\n        color: Option<string>;\n    };\n    opened: {\n        border: {\n            radius: Option<number>;\n            color: Option<string>;\n            width: Option<number>;\n            gap: Option<number>;\n        };\n        boxShadow: Option<string>;\n        opacity: Option<number>;\n        mask: {\n            color: Option<string>;\n        };\n    };\n}\n\nexport type StoriesListFavoriteCardOptions = StoriesListCardOptions & {\n    title: {\n        content: string;\n        color: string;\n        padding: string | number;\n        font: string;\n    }\n};\n\nexport type StoriesListClickEvent = {\n    id: number,\n    index: number,\n    isDeeplink: boolean,\n    url: string|undefined,\n};\n\n\n\nexport enum StoriesListEvents {\n    START_LOADER = 'startLoader',\n    END_LOADER = 'endLoader',\n}\n\n\n\nconst StoriesListOptionsDefault: StoriesListOptions =\n    {\n        title: {\n            content: '',\n            color: '#ffffff',\n            font: 'normal',\n            marginBottom: 20,\n        },\n        card: {\n            title: {\n                font: 'normal',\n                color: '#ffffff',\n                padding: 15,\n            },\n            gap: 10,\n            height: 70,\n            variant: StoriesListCardViewVariant.CIRCLE,\n            border: {\n                radius: 0,\n                color: 'black',\n                width: 2,\n                gap: 3,\n            },\n            boxShadow: null,\n            opacity: null,\n            mask: {\n                color: null,\n            },\n            opened: {\n                border: {\n                    radius: null,\n                    color: null,\n                    width: null,\n                    gap: null,\n                },\n                boxShadow: null,\n                opacity: null,\n                mask: {\n                    color: null,\n                },\n            },\n        },\n        favoriteCard: {\n            title: {\n                content: 'Избранное',\n                font: 'normal',\n                color: '#000',\n                padding: 15,\n            },\n            gap: 10,\n            height: 70,\n            variant: StoriesListCardViewVariant.CIRCLE,\n            border: {\n                radius: 0,\n                color: 'black',\n                width: 2,\n                gap: 3,\n            },\n            boxShadow: null,\n            opacity: null,\n            mask: {\n                color: null,\n            },\n            opened: {\n                border: {\n                    radius: null,\n                    color: null,\n                    width: null,\n                    gap: null,\n                },\n                boxShadow: null,\n                opacity: null,\n                mask: {\n                    color: null,\n                },\n            },\n        },\n        sidePadding: 20,\n        topPadding: 20,\n        bottomPadding: 20,\n        bottomMargin: 17,\n        layout: {\n            height: 0,\n            backgroundColor: 'transparent'\n        },\n        navigation: {\n            showControls: false,\n            controlsSize: 48,\n            controlsBackgroundColor: 'white',\n            controlsColor: 'black'\n        },\n    };\n\nexport {StoriesListOptionsDefault};\n","import {Dict, Option} from \"../../global.h\";\nimport Widget, {ObjectId} from \"../widget\";\nimport {\n  ClickOnStoryInternalPayload,\n  ClickOnStoryInternalWithDataPayload,\n  ClickOnStoryPayload, STORY_READER_WINDOW_REFERER,\n  SyncStoreEvent\n} from \"../story-manager/common.h\";\nimport {StoryReaderOptions, StoryReaderOptionsDefault} from \"./index.h\";\nimport {AppearanceCommonOptions, AppearanceCommonOptionsDefault} from \"../story-manager/appearanceCommon.h\";\nimport {IWidgetStoryReader} from \"./index\";\nimport {AppearanceManager} from \"../story-manager/AppearanceManager\";\nimport {CreateViewOptions} from \"./rn.h\";\n\ndeclare global {\n  interface Window {\n    scrollNode: any; // browser env\n    fastXDM: any;\n    iasAsyncInitCallbacks: Array<() => void>;\n  }\n}\n\nimport {\n  rpcDomains,\n  RpcMessage,\n  RpcMessageOnServer,\n  widgetLoaded,\n  setStories,\n  setFonts,\n  onOpenReader,\n  onCloseReader,\n  onReaderOpened, onReaderClosed\n} from \"./rpc\";\nimport {create as createRpcServer} from \"../rpc/remoteFX/server\";\nimport {IframeWorkerServer} from \"../rpc/IframeWorkerServer\";\nimport {ReactEventHandler, SyntheticEvent} from \"react\";\nimport WebView from \"react-native-webview\";\nimport {WebViewWorkerServer} from \"../rpc/WebViewWorkerServer\";\n\n\nRpcMessageOnServer.use(async arg => {\n  return [arg + \" :125\"];\n});\n\n\n//@ts-ignore\nwindow.RpcMessage = RpcMessage;\n// const result = await workerMessage('foo bar  baz bam')\n\n// const jsResourceGlobal = new URL(\"./StoriesListClient.umd.js\", import.meta.url);\n// const cssResourceGlobal = new URL(\"./StoriesListClient.umd.css\", import.meta.url);\n\n// escaped content\n// @ts-ignore\nimport jsResourceGlobal from \"../../packages/react-native-ias/StoryReaderClient.js\";\n//@ts-ignore\nimport cssResourceGlobal from \"../../packages/react-native-ias/StoryReaderClient.css.js\";\nimport {isFunction} from \"../helpers/isFunction\";\n\n// const jsResourceGlobal = \"\";\n// const cssResourceGlobal = \"\";\n\n\nclass WidgetStoryReader extends Widget implements IWidgetStoryReader {\n\n  constructor(private appearanceManagerGetter: () => Option<AppearanceManager>, private overrideStoryReaderOptions: Pick<StoryReaderOptions, \"recycleStoriesList\" | \"closeOnLastSlideByTimer\"> = {}) {\n    super();\n\n    this.widgetId = ++Widget.count;\n\n    // вынести в общую часть\n    widgetLoaded.use(() => {\n      this.emit(\"widgetLoaded\");\n    });\n\n    onReaderOpened.use(options => {\n      if (options.windowReferer === STORY_READER_WINDOW_REFERER.default) {\n        // web container only !\n        // sbHelper.setScrollbar();\n      } else if (options.windowReferer === STORY_READER_WINDOW_REFERER.favorite) {\n        // self.emit('openStoryReader', options);\n      }\n      this.emit('openStoryReader', options);\n\n      // if (body) {\n      //     body.style.setProperty('user-select', 'none');\n      //     body.style.setProperty('-webkit-user-select', 'none');\n      //\n      //     body.style.setProperty('overflow', 'hidden');\n      //     body.style.setProperty('-webkit-overflow-scrolling', 'touch');\n      // }\n\n      // if (html) {\n      //   // TODO сохранять оригинал и возвраащать обратно\n      //   // html.style.setProperty('position', 'fixed');\n      //   // html.style.setProperty('overflow', 'hidden');\n      // }\n\n      // if (self.iframe) {\n      //   // self.iframe.style.setProperty('position', 'fixed');\n      //   self.iframe.style.setProperty('display', 'block');\n      //   // self.iframe.style.setProperty('height', '0')\n      //   // self.iframe.style.setProperty('min-height', '100%')\n      //   // self.iframe.style.setProperty('max-height', '100%')\n      //\n      //   self.iframe.style.setProperty('z-index', zIndex)\n      // }\n\n    });\n\n    onReaderClosed.use(options => {\n      if (options.windowReferer === STORY_READER_WINDOW_REFERER.default) {\n        // web container only !\n        // sbHelper.resetScrollbar();\n      } else if (options.windowReferer === STORY_READER_WINDOW_REFERER.favorite) {\n        // self.emit('closeStoryReader', options);\n      }\n\n      this.emit('closeStoryReader', options);\n\n      // set display none\n\n\n      // if (self.iframe) {\n      //   self.iframe.style.setProperty('display', 'none');\n      // }\n\n      // if (body) {\n      //     body.style.setProperty('user-select', '');\n      //     body.style.setProperty('-webkit-user-select', '');\n      //\n      //     body.style.setProperty('overflow', '');\n      //     body.style.setProperty('-webkit-overflow-scrolling', '');\n      // }\n\n      // if (html) {\n      //\n      //   // TODO сохранять оригинал и возвраащать обратно\n      //   // html.style.setProperty('position', '');\n      //   // html.style.setProperty('overflow', '');\n      // }\n    });\n\n\n    const functions = {\n\n      // event: function (name: string, data: Object) {\n      //   self.emit(name, data)\n      // },\n\n      // setFixedHtmlPosition: function () {\n      //   if (html) {\n      //     // TODO сохранять оригинал и возвраащать обратно\n      //     // html.style.setProperty('position', 'fixed');\n      //     // html.style.setProperty('overflow', 'hidden');\n      //   }\n      // },\n\n\n    };\n\n  }\n\n  private get storyReaderOptions(): StoryReaderOptions & { appearanceCommon: AppearanceCommonOptions } {\n    const appearanceManager = this.appearanceManagerGetter();\n    if (appearanceManager != null) {\n      return {\n        ...appearanceManager.storyReaderOptions,\n        appearanceCommon: appearanceManager.commonOptions,\n        ...this.overrideStoryReaderOptions\n      }\n    } else {\n      return {\n        ...StoryReaderOptionsDefault,\n        appearanceCommon: AppearanceCommonOptionsDefault,\n        ...this.overrideStoryReaderOptions\n      }\n    }\n\n  }\n\n\n  public get widgetSrcFile(): string | URL {\n    return jsResourceGlobal;\n  }\n\n  public get widgetEntrypoint(): string {\n    return `\n      <head>\n        <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, user-scalable=0, shrink-to-fit=no\">\n        <style type=\"text/css\">${cssResourceGlobal}</style>\n      </head>\n      <div id=\"app\"><div id=\"_app\"></div></div>\n      <script type=\"text/javascript\">${jsResourceGlobal}</script>\n      <script type=\"text/javascript\">\n        window.storiesList = (function () {\n          var self = window.storiesList || {};\n          self._e = self._e || [];\n          self.ready = self.ready || function (f) {self._e.push(f);};\n          return self;\n        }());\n\n        window.storyReader.ready(function () {\n          window.storyReader.init(${JSON.stringify(this.storyReaderOptions)});\n        });\n\n      </script>`;\n  }\n\n\n  private rpc: any;\n\n  public async mount(mountSelector: string, storiesListOptions: StoriesListOptions & Pick<AppearanceCommonOptions, \"hasFavorite\">): Promise<boolean> {\n    // создаем iframe\n    // по завершению - mounted();\n\n\n    const options: CreateViewOptions = {\n      allowTransparency: true,\n      overflowTouch: false,\n      backgroundColor: storiesListOptions.layout.backgroundColor,\n      width: 'auto',\n      height: 0,\n      pageUrl: '',\n      startHeight: 0\n    };\n\n    // todo непонятно как высоту с учетом title рассчитывать\n    if (storiesListOptions.layout.height) {\n      options.startHeight = storiesListOptions.layout.height;\n    } else {\n      if (!storiesListOptions.title) {\n        options.startHeight = storiesListOptions.card.height + storiesListOptions.topPadding + storiesListOptions.bottomPadding + storiesListOptions.bottomMargin;\n      } else {\n        // line height + margin-bottom\n        options.startHeight = 50 + storiesListOptions.card.height + storiesListOptions.topPadding + storiesListOptions.bottomPadding + storiesListOptions.bottomMargin;\n      }\n    }\n\n    this.createView(mountSelector, options);\n\n  }\n\n\n  private createView(mountSelector: string, options: CreateViewOptions) {\n    const self = this;\n    let obj: Option<HTMLElement> = null;\n    if (mountSelector === 'body') {\n      obj = document.body;\n    } else {\n      obj = document.querySelector(mountSelector);\n    }\n\n\n    if (obj) {\n\n\n    }\n  }\n\n  private extend(obj1: Dict, obj2: Dict) {\n    for (var i in obj2) {\n      if (obj1[i] && typeof (obj1[i]) === 'object') {\n        this.extend(obj1[i], obj2[i])\n      } else {\n        obj1[i] = obj2[i];\n      }\n    }\n  }\n\n  private genKey() {\n    var key = '';\n    for (var i = 0; i < 5; i++) {\n      key += Math.ceil(Math.random() * 15).toString(16);\n    }\n    return key;\n  }\n\n  private frameName: string = '';\n\n  private mountView(obj: HTMLElement, options: Dict, attrs?: Dict) {\n\n    this.frameName = 'fXD' + this.genKey();\n\n    const div = document.createElement('div');\n    div.innerHTML = '<iframe name=\"' + this.frameName + '\" ' + (attrs || '') + '></iframe>';\n    const frame = div.firstChild as HTMLIFrameElement;\n    const self = this;\n\n    setTimeout(function () {\n      frame.frameBorder = '0';\n      if (options) self.extend(frame, options);\n      obj.insertBefore(frame, obj.firstChild);\n\n      //             this.caller = obj.contentWindow;\n      //             this.frame  = obj;\n      // rpcServerStart\n\n      // self.start(frame);\n\n    }, 0);\n\n    return frame;\n  }\n\n\n  // container options\n  public get containerOptions(): Dict {\n    const options: CreateViewOptions = {\n      allowTransparency: true,\n      overflowTouch: false,\n      backgroundColor: 'transparent',\n      width: 0,\n      height: 0,\n      pageUrl: '',\n      startHeight: 0\n    };\n\n\n    //\n    // // todo непонятно как высоту с учетом title рассчитывать\n    // if (this.storiesListOptions.layout.height) {\n    //   options.startHeight = this.storiesListOptions.layout.height;\n    // } else {\n    //   if (!this.storiesListOptions.title) {\n    //     options.startHeight = this.storiesListOptions.card.height + this.storiesListOptions.topPadding + this.storiesListOptions.bottomPadding + this.storiesListOptions.bottomMargin;\n    //   } else {\n    //     // line height + margin-bottom\n    //     options.startHeight = 50 + this.storiesListOptions.card.height + this.storiesListOptions.topPadding + this.storiesListOptions.bottomPadding + this.storiesListOptions.bottomMargin;\n    //   }\n    // }\n\n    let params: Dict<any> = {\n      extraCss: null,\n      extraJs: null,\n\n    };\n\n    let defaults = {\n      maxWidth: 0,\n      startHeight: 70,\n      minWidth: 150,\n      storiesHeight: 70,\n      scrolling: false,\n      hidden: false\n    };\n\n    // todo непонятно как высоту с учетом title рассчитывать\n    if (params.storiesLayoutHeight) {\n      defaults.startHeight = parseFloat(params.storiesLayoutHeight);\n    } else {\n      if (!params.storiesTitle) {\n        defaults.startHeight = parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      } else {\n        // line height + margin-bottom\n        defaults.startHeight = 50 + parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      }\n    }\n\n\n    let width: number = options.width === 'auto' ? (/*obj.clientWidth || obj.offsetWidth || */defaults.minWidth) | 0 : parseInt(options.width || 0, 10);\n\n    const cssWidth: string = width ? (Math.max(defaults.minWidth || 200, Math.min(defaults.maxWidth || 10000, width)) + 'px') : '100%';\n\n    const containerOptions: Dict = {\n      style: {}\n    };\n\n    containerOptions.style.width = cssWidth;\n    containerOptions.style.overflow = 'hidden';\n\n    if (options.height) {\n      // params.height = options.height;\n      containerOptions.style.height = options.height + 'px';\n    } else {\n      containerOptions.style.height = (defaults.startHeight || 200) + 'px';\n    }\n\n    if (options.overflowTouch) {\n      containerOptions.style.overflow = 'auto';\n      containerOptions.style.WebkitOverflowScrolling = 'touch';\n    }\n\n    return {\n      style: {\n        backgroundColor: 'transparent',\n        position: 'relative',\n        // TODO\n        // height - 16:9\n        // in parent container - justifyContent: \"flex-start\",\n        // height: parseInt(containerOptions.style.height),\n        height: '100%',\n\n        width: '100%'\n      }\n    };\n\n    // return containerOptions;\n  }\n\n\n  public get viewOptions(): Dict {\n    if (!this.frameName) {\n      this.frameName = 'fXD' + this.genKey();\n    }\n\n    const options: CreateViewOptions = {\n      allowTransparency: true,\n      overflowTouch: false,\n      backgroundColor: 'transparent',\n      width: '100%',\n      height: '100%',\n      pageUrl: '',\n      startHeight: 0\n    };\n\n    // // todo непонятно как высоту с учетом title рассчитывать\n    // if (this.storiesListOptions.layout.height) {\n    //   options.startHeight = this.storiesListOptions.layout.height;\n    // } else {\n    //   if (!this.storiesListOptions.title) {\n    //     options.startHeight = this.storiesListOptions.card.height + this.storiesListOptions.topPadding + this.storiesListOptions.bottomPadding + this.storiesListOptions.bottomMargin;\n    //   } else {\n    //     // line height + margin-bottom\n    //     options.startHeight = 50 + this.storiesListOptions.card.height + this.storiesListOptions.topPadding + this.storiesListOptions.bottomPadding + this.storiesListOptions.bottomMargin;\n    //   }\n    // }\n\n\n    // todo in common part\n    let params: Dict<any> = {\n      extraCss: null,\n      extraJs: null,\n\n    };\n\n    let defaults = {\n      maxWidth: 0,\n      startHeight: 70,\n      storiesHeight: 70,\n      minWidth: 150,\n      scrolling: false,\n      hidden: false\n    };\n\n    // todo непонятно как высоту с учетом title рассчитывать\n    if (params.storiesLayoutHeight) {\n      defaults.startHeight = parseFloat(params.storiesLayoutHeight);\n    } else {\n      if (!params.storiesTitle) {\n        defaults.startHeight = parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      } else {\n        // line height + margin-bottom\n        defaults.startHeight = 50 + parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      }\n    }\n\n\n    let width: number = options.width === 'auto' ? (/*obj.clientWidth || obj.offsetWidth || */defaults.minWidth) | 0 : parseInt(options.width || 0, 10);\n\n    const cssWidth: string = width ? (Math.max(defaults.minWidth || 200, Math.min(defaults.maxWidth || 10000, width)) + 'px') : '100%';\n\n\n    // if (cssWidth === '100%') params.startWidth = (obj.clientWidth || obj.offsetWidth) | 0;\n\n    const iframeOptions: Dict<any> = {\n      src: '',\n      id: 'iaswidget' + this.widgetId,\n      allowtransparency: Boolean(options.allowTransparency || false).toString(),\n      style: {\n        backgroundColor: options.backgroundColor || 'transparent',\n      }\n    };\n\n    iframeOptions.width = (cssWidth.indexOf('%') != -1) ? cssWidth : (parseInt(cssWidth) || cssWidth);\n    iframeOptions.height = defaults.startHeight || '100%';\n\n    // for correct @media in iframe work - pass innerWidth instead of clientWidth\n    // plus parent div overflow: hidden\n    // width: cssWidth === '100%' ? '100%' : cssWidth,\n    // https://stackoverflow.com/questions/23083462/how-to-get-an-iframe-to-be-responsive-in-ios-safari\n    iframeOptions.style.width = '1px';\n    iframeOptions.style.minWidth = '100%';\n    iframeOptions.style[\"*width\"] = '100%';\n\n\n    if (defaults.scrolling) {\n      iframeOptions.scrolling = 'yes';\n    } else {\n      iframeOptions.scrolling = 'no';\n      iframeOptions.style.overflow = 'hidden';\n    }\n\n    if (defaults.hidden) {\n      iframeOptions.style.display = 'none';\n    }\n\n\n    // if (isWindowSupportIframeBlobSrcSync()) {\n    //   iframeOptions.src = blobUrl.src;\n    // } else {\n    //   //@ts-ignore\n    //   iframeOptions.srcDoc = blobUrl.srcdoc;\n    // }\n\n\n    /*\n                                // flex: 1,\n                            position: 'absolute',\n                            left: 0,\n                            right: 0,\n                            top: 0,\n                            // bottom: 0,\n\n                            // width: '100%',\n                            height: this.props.screenHeight,\n                            // height: webviewHeight,\n     */\n\n    return {\n      style: {\n        backgroundColor: 'transparent',\n        // display: \"none\",\n        position: 'absolute',\n        left: 0,\n        right: 0,\n        top: 0,\n        height: \"100%\",\n        width: '100%',\n        // height: iframeOptions.height\n      },\n      // не нужно для WebView\n      // onLoad: WidgetStoriesList.onViewFirstLoad,\n      source: {\n        html: this.widgetEntrypoint, baseUrl: 'https://sdk.inappstory.com'\n      }\n    };\n\n    return {\n      name: this.frameName,\n      frameBorder: '0',\n      ...iframeOptions,\n      // onLoad: WidgetStoriesList.onViewFirstLoad\n    };\n\n  }\n\n\n  public createRpcServer(worker: any) {\n    // WebViewWorkerServer - destroy ?\n\n    createRpcServer(rpcDomains, new WebViewWorkerServer(worker));\n  }\n\n\n  public async init(mountSelector: string, storiesListOptions: StoriesListOptions & Pick<AppearanceCommonOptions, \"hasFavorite\">) {\n\n    let params: Dict<any> = {\n        // настройки storiesList виджета\n        storiesHeight: storiesListOptions.card?.height || 70,\n        storiesLayoutHeight: storiesListOptions.layout?.height || 0,\n        storiesBackgroundColor: storiesListOptions.layout?.backgroundColor || 'transparent',\n        storiesListTopPadding: storiesListOptions.topPadding || 20,\n        storiesListBottomPadding: storiesListOptions.bottomPadding || 20,\n        storiesListBottomMargin: storiesListOptions.bottomMargin || 20,\n        storiesTitle: storiesListOptions.title?.content || '',\n\n        extraCss: storiesListOptions.extraCss || null,\n        extraJs: null,\n\n      },\n      widgetRoot: any,\n      widget: any,\n      rpc: any,\n      inFullScreenMode = false,\n      scrollPosition = [0, 0],\n      options: Dict<any> = {};\n\n    options.allowTransparency = true;\n    options.overflowTouch = false;\n\n    options.backgroundColor = params.storiesBackgroundColor;\n\n    var defaults = {\n      startHeight: 70,\n      minWidth: 150,\n      storiesHeight: 70\n    };\n\n    // todo непонятно как высоту с учетом title рассчитывать\n    if (params.storiesLayoutHeight) {\n      defaults.startHeight = parseFloat(params.storiesLayoutHeight);\n    } else {\n      if (!params.storiesTitle) {\n        defaults.startHeight = parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      } else {\n        // line height + margin-bottom\n        defaults.startHeight = 50 + parseFloat((params.storiesHeight || defaults.storiesHeight)) + parseFloat(params.storiesListTopPadding) + parseFloat(params.storiesListBottomPadding) + parseFloat(params.storiesListBottomMargin);\n      }\n    }\n\n    var body = document.querySelector('body'),\n      html = document.querySelector('html'),\n      zIndex = options.zIndex || 10000;\n\n    const self = this;\n\n    const functions = {\n\n      // TODO add class to body\n\n      // switchToFullScreen: function () {\n      //     if (inFullScreenMode) {\n      //         return;\n      //     }\n      //\n      //     scrollPosition = IAS_OLD.Util.getScroll();\n      //\n      //     if (body) {\n      //         body.style.setProperty('user-select', 'none');\n      //         body.style.setProperty('-webkit-user-select', 'none');\n      //\n      //         body.style.setProperty('overflow', 'hidden');\n      //         body.style.setProperty('-webkit-overflow-scrolling', 'touch');\n      //     }\n      //\n      //     if (html) {\n      //         html.style.setProperty('position', 'fixed');\n      //         html.style.setProperty('overflow', 'hidden');\n      //     }\n      //\n      //     if (widgetRoot && widget) {\n      //         // получаем текущее смещение от начала viewport\n      //         const viewportOffset = widgetRoot.getBoundingClientRect();\n      //         const offsetTop = viewportOffset.top;\n      //\n      //         widget.style.setProperty('position', 'fixed')\n      //         widget.style.setProperty('top', '0')\n      //         widget.style.setProperty('bottom', '0')\n      //         widget.style.setProperty('left', '0')\n      //         widget.style.setProperty('right', '0')\n      //         widget.style.setProperty('height', '0')\n      //         widget.style.setProperty('min-height', '100%')\n      //         widget.style.setProperty('max-height', '100%')\n      //\n      //         widget.style.setProperty('z-index', zIndex)\n      //\n      //         rpc.callMethod('onEnterFullScreen', {offsetTop: offsetTop})\n      //\n      //     }\n      //\n      //     inFullScreenMode = true;\n      //\n      //     // newWidth  = parseInt(newWidth);\n      //     // newHeight = parseInt(newHeight);\n      //     // var widgetElem = document.getElementById('iaswidget' + widgetId);\n      //     // if (isFinite(newWidth)) {\n      //     //   obj.style.width = newWidth + 'px';\n      //     //   if (widgetElem) {\n      //     //     widgetElem.style.width = newWidth + 'px';\n      //     //   }\n      //     // }\n      //     // if (isFinite(newHeight)) {\n      //     //   obj.style.height = newHeight + 'px';\n      //     //   if (widgetElem) {\n      //     //     widgetElem.style.height = newHeight + 'px';\n      //     //   }\n      //     // }\n      //     // if (options.onResizeWidget) options.onResizeWidget();\n      //     //\n      //\n      //\n      // },\n      // switchFromFullScreen: function () {\n      //     if (!inFullScreenMode) {\n      //         return;\n      //     }\n      //\n      //     if (widgetRoot && widget) {\n      //         widget.style.setProperty('position', '')\n      //         widget.style.setProperty('top', '')\n      //         widget.style.setProperty('bottom', '')\n      //         widget.style.setProperty('left', '')\n      //         widget.style.setProperty('right', '')\n      //         widget.style.setProperty('height', isFinite(defaults['startHeight']) ? defaults['startHeight'] + 'px' : '100%')\n      //         widget.style.setProperty('min-height', '')\n      //         widget.style.setProperty('max-height', '')\n      //         widget.style.setProperty('z-index', '')\n      //\n      //         rpc.callMethod('onLeaveFullScreen')\n      //     }\n      //\n      //     if (body) {\n      //         body.style.setProperty('user-select', '');\n      //         body.style.setProperty('-webkit-user-select', '');\n      //\n      //         body.style.setProperty('overflow', '');\n      //         body.style.setProperty('-webkit-overflow-scrolling', '');\n      //     }\n      //\n      //     if (html) {\n      //         html.style.setProperty('position', '');\n      //         html.style.setProperty('overflow', '');\n      //     }\n      //\n      //     window.scrollTo(scrollPosition[0], scrollPosition[1])\n      //\n      //     inFullScreenMode = false;\n      //\n      // },\n\n      event: function (name: string, data: Object) {\n        self.emit(name, data)\n      },\n    };\n\n\n    params.extraJs = null;\n\n    // custom load end\n    options.no_finish_loading = true;\n\n    return this._init(mountSelector as ObjectId, options, params, storiesListOptions, functions, defaults, function (o: any, i: any, r: any) {\n      widgetRoot = o;\n      widget = i;\n      rpc = r;\n    }, null, null);\n\n  }\n\n  getWidgetDocument(widgetParams: Dict): string {\n\n    const baseUrl = process.env.BASE_URL;\n    const apiUrl = process.env.API_URL;\n    const buildVersion = process.env.BUILD_VERSION;\n\n    // todo можно BASE_URL менять в процессе сборки\n    let cssResource: URL | string = `${baseUrl}/v${buildVersion}/dist/css/storyReader.css`;\n    let jsResource: URL | string = `${baseUrl}/v${buildVersion}/dist/js/storiesList.js`;\n    if (process.env.NODE_ENV === \"development\") {\n      cssResource = `${baseUrl}/css/storyReader.css`;\n      jsResource = `${baseUrl}/js/storyReader.js`;\n\n      // if npm pack\n      // cssResource = new URL(\"~/dist/css/storiesList.css\", import.meta.url);\n      // jsResource = new URL(\"~/dist/js/storiesList.js\", import.meta.url);\n\n\n      // jsResource = `/js/storiesList.js`;\n\n    }\n\n    // cssResource = new URL(\"~/dist/css/storiesList.css\", import.meta.url);\n    // jsResource = new URL(\"~/dist/js/storiesList.js\", import.meta.url);\n\n    jsResource = jsResourceGlobal;\n\n    // console.log({meta: import.meta});\n\n    // (async () => {\n    //   const {WStories} = await import(\"~/src/stories_widget/stories-slider\");\n    //   console.log({WStories});\n    // })();\n\n\n    // <link rel=\"stylesheet\" type=\"text/css\" href=\"${cssResource}\"/>\n    // <script type=\"text/javascript\" src=\"${jsResource}\"></script>\n    // import.meta.url\n\n    // <script type=\"text/javascript\" src=\"${jsResource}\"></script>\n    return `\n        <script type=\"text/javascript\" src=\"${jsResource}\"></script>\n        <div id=\"app\"><div id=\"_app\"></div></div>\n        <script type=\"text/javascript\">\n          window.storyReader.init(${JSON.stringify(widgetParams)});\n        </script>\n`;\n\n\n  }\n\n  protected async _init(mountSelector: ObjectId, options: Dict, params: Dict, widgetParams: Dict, funcs: Dict, defaults: Dict, onDone: (obj: any, iframe: any, rpc: any) => void, widgetId: Nullable<string | number>, iter: Nullable<number>) {\n\n    funcs.event = (name: string, data: Object) => this.emit(name, data)\n\n    onDone = (obj: any, iframe: any, rpc: any) => {\n      this.rpc = rpc;\n    };\n\n    const result = super._init(mountSelector, options, params, widgetParams, funcs, defaults, onDone, widgetId, iter);\n\n    // story reader\n\n    // const storyReader = new StoryReader('body', options);\n\n\n    // this.on('sessionInitInternal', (payload: any) => storyReader.sessionInit(payload));\n    // this.on('clickOnStoryInternal', (payload: ClickOnStoryInternalPayload) => storyReader.openReader(payload));\n    this.on('clickOnStoryInternal', (payload: ClickOnStoryInternalPayload) => {\n      if (isFunction(this.callbacks?.handleClickOnStoryInternal)) {\n        this.callbacks?.handleClickOnStoryInternal(payload);\n      }\n    });\n\n    this.on('flushThumbViews', (payload: Array<number>) => {\n      if (isFunction(this.callbacks?.handleFlushThumbViews)) {\n        this.callbacks?.handleFlushThumbViews(payload);\n      }\n    });\n\n\n    // storyReader.on('storyOpenedInternal', (payload: {id: number}) => this.onStoryOpened(payload));\n\n\n    // storyReader.on('favoriteStoryInternal', (payload: {id: number, value: boolean}) => this.onStoryFavoriteChange(payload));\n\n\n    // public event\n    this.on('clickOnStory', (payload: ClickOnStoryPayload) => {\n      if (isFunction(this.callbacks?.handleClickOnStory)) {\n        this.callbacks?.handleClickOnStory(payload);\n      }\n    });\n\n    // click on deep link from story list\n    this.on('clickOnStoryDeepLink', (payload: ClickOnStoryPayload) => {\n      if (isFunction(this.callbacks?.handleClickOnStoryDeepLink)) {\n        this.callbacks?.handleClickOnStoryDeepLink(payload);\n      }\n    });\n\n    // button from slide\n    // storyReader.on('clickOnButton', (payload: ClickOnButtonPayload) => {\n    //     if (params.storyLinkHandleClick && isFunction(params.storyLinkHandleClick)) {\n    //         params.storyLinkHandleClick(payload);\n    //     } else {\n    //         window.open(payload.url, '_self');\n    //     }\n    // });\n\n    const publicEvents = ['showSlide', 'showStory', 'closeStory', 'clickOnButton', 'likeStory', 'dislikeStory', 'favoriteStory', 'shareStory', 'shareStoryWithPath'];\n\n    // publicEvents.forEach((eventName) => storyReader.on(eventName, (payload) => this.emit(eventName, payload)));\n\n    // let storyFavorite: Nullable<_StoryFavorite> = null;\n    // if (options.hasFavorite) {\n    //   storyFavorite = new _StoryFavorite('body', options);\n    // }\n\n    // storyFavorite && this.on('sessionInitInternal', (payload: any) => storyFavorite && storyFavorite.sessionInit(payload));\n    // storyFavorite && this.on('clickOnFavoriteCellInternal', (payload: ClickOnFavoriteCellInternalPayload) => storyFavorite && storyFavorite.openReader(payload));\n\n    // custom method\n    // storyFavorite && storyFavorite.on('clickOnStoryInternal', (payload: ClickOnStoryInternalPayload) => storyReader.openReader(payload));\n    // storyFavorite && storyReader.on('openStoryReader', (options: {windowReferer: STORY_READER_WINDOW_REFERER}) => storyFavorite && storyFavorite.openStoryReader(options));\n    // storyFavorite && storyReader.on('closeStoryReader', (options: {windowReferer: STORY_READER_WINDOW_REFERER}) => storyFavorite && storyFavorite.closeStoryReader(options));\n\n    /*    storyFavorite && storyFavorite.on('closeReader', () => {\n          try {\n            window.focus()\n          } catch (e) {\n            console.error(e)\n          }\n        });*/\n\n    this.on('syncStore', (payload: SyncStoreEvent) => {\n      // storyReader.syncStoreHandle(payload);\n      // storyFavorite && storyFavorite.syncStoreHandle(payload);\n    });\n\n    // storyReader.on('syncStore', (payload: SyncStoreEvent) => {\n    //     this.syncStoreHandle(payload);\n    //     storyFavorite && storyFavorite.syncStoreHandle(payload);\n    // });\n    //\n    // storyFavorite && storyFavorite.on('syncStore', (payload: SyncStoreEvent) => {\n    //     this.syncStoreHandle(payload);\n    //     storyReader.syncStoreHandle(payload);\n    // });\n\n    return result;\n  }\n\n  onStoryOpened(payload: { id: number }) {\n    this.rpc.callMethod('onStoryOpened', payload);\n  }\n\n  // onStoryFavoriteChange(payload: {id: number, value: boolean}) {\n  //     this.rpc.callMethod('onStoryFavoriteChange', payload);\n  // }\n\n  syncStoreHandle(payload: SyncStoreEvent) {\n    this.rpc.callMethod('onSyncStore', payload);\n  }\n\n\n  // pass story list\n  openReader(payload: ClickOnStoryInternalWithDataPayload & { hasShare: boolean }) {\n    // вынести в общую часть\n    onOpenReader(payload);\n\n  }\n\n  // pass story list\n  setStories(payload: any) {\n    // вынести в общую часть\n    setStories(payload);\n\n  }\n\n  setFonts(payload: any) {\n    setFonts(payload);\n  }\n\n\n  destructor() {\n    // destroy RPC\n\n  }\n\n\n}\n\nexport {WidgetStoryReader};\n","import {StoryManager as AbstractStoryManager} from \"../story-manager\";\nimport {IWidgetStoriesList} from \"../widget-stories-list\";\nimport {WidgetStoriesList} from \"../widget-stories-list/rn\";\nimport {Dict, Option} from \"../../global.h\";\nimport {AppearanceManager} from \"../story-manager/AppearanceManager\";\nimport {getUniqueId, getSystemName} from 'react-native-device-info';\nimport {ISessionInitData} from \"../story-manager/models/Session2\";\nimport {DeviceId} from \"../story-manager/models/storyManagerConfig/index.h\";\nimport AsyncStorage from '@react-native-async-storage/async-storage';\nimport {IWidgetStoryReader} from \"../widget-story-reader\";\nimport {WidgetStoryReader} from \"../widget-story-reader/rn\";\nimport {CacheResourceModel} from \"../story-manager/models/session\";\nimport {StoryReaderOptions} from \"../widget-story-reader/index.h\";\nimport {STORY_READER_WINDOW_REFERER} from \"../story-manager/common.h\";\nimport {StatusBar} from \"react-native\";\n\n\nexport class StoryManager extends AbstractStoryManager {\n\n  createWidgetStoriesList(appearanceManager: AppearanceManager): IWidgetStoriesList {\n    const widget = new WidgetStoriesList(appearanceManager);\n\n    this.appearanceManager = appearanceManager;\n\n    widget.on(\"widgetLoaded\", () => {\n      this._storiesListWidgetLoaded(widget, appearanceManager);\n    });\n\n\n    return widget;\n  }\n\n  createWidgetStoryReader(setNeedFirstRender: (value: boolean) => void, detachComponent: () => void): IWidgetStoryReader {\n\n      const widget = new WidgetStoryReader(() => this.appearanceManager);\n\n      this.storyReaderNeedFirstRender = setNeedFirstRender;\n      this.storyReaderDetachComponent = detachComponent;\n\n      widget.on(\"widgetLoaded\", () => {\n        this._storyReaderWidgetLoaded(widget);\n      });\n\n\n      return widget;\n  }\n\n  getDeviceInfo(configDeviceIdChanged: (device_id: DeviceId) => void): Promise<ISessionInitData> {\n    // currently without cache to localStorage\n    const data: ISessionInitData = {\n      device_id: getUniqueId(),\n      platform: getSystemName() === \"Android\" ? \"android\" : \"ios\",\n      // todo - platform values from enum\n    };\n\n    return Promise.resolve(data);\n  }\n\n\n  async localStorageGet<T extends object>(key: string): Promise<Option<T>> {\n    try {\n      const jsonValue = await AsyncStorage.getItem(key);\n      return jsonValue != null ? JSON.parse(jsonValue) : null;\n    } catch(e) {\n      console.error(e);\n      return null;\n    }\n  }\n\n  async localStorageSet<T extends object>(key: string, data: T): Promise<void> {\n    try {\n      await AsyncStorage.setItem(key, JSON.stringify(data));\n      return;\n    } catch (e) {\n      console.error(e);\n      return;\n    }\n  }\n\n  async localStorageGetArray<T extends any>(key: string): Promise<Option<Array<T>>> {\n    return this.localStorageGet(key);\n  }\n\n  async localStorageSetArray(key: string, data: Array<any>): Promise<void> {\n    return this.localStorageSet(key, data);\n  }\n\n\n  protected completeInitStoryReader(storyReaderInstance: IWidgetStoryReader/*, appearanceManager: AppearanceManager*/, fonts: Array<CacheResourceModel>, overrideStoryReaderOptions: Pick<StoryReaderOptions, \"recycleStoriesList\" | \"closeOnLastSlideByTimer\"> = {}) {\n\n    // StatusBar\n    storyReaderInstance.on('openStoryReader', (options: { windowReferer: STORY_READER_WINDOW_REFERER }) => {\n      // full screen - depend on front camera\n      StatusBar.setHidden(true);\n    });\n\n    storyReaderInstance.on('closeStoryReader', (options: { windowReferer: STORY_READER_WINDOW_REFERER }) => {\n      StatusBar.setHidden(false);\n    });\n\n    return super.completeInitStoryReader(storyReaderInstance, fonts, overrideStoryReaderOptions);\n  }\n\n\n  }","import {Optional, Dict} from \"../index\";\r\nimport {ReaderCloseButtonPosition, ReaderSwipeStyle} from \"~/src/storyManager/WidgetStoriesConfig\";\r\n\r\n\r\n\r\nexport enum StoryReaderCloseButtonPosition {\r\n  LEFT = 'left',\r\n  RIGHT = 'right'\r\n}\r\n\r\nexport enum StoryReaderSwipeStyle {\r\n  FLAT = 'flat',\r\n  COVER = 'cover',\r\n  CUBE = 'cube'\r\n}\r\n\r\n\r\nexport type StoryReaderOptions = {\r\n  closeButtonPosition: StoryReaderCloseButtonPosition,\r\n  scrollStyle: StoryReaderSwipeStyle,\r\n  loader?: {\r\n    default: {\r\n      color: Optional<string>,\r\n      accentColor: Optional<string>,\r\n    },\r\n    custom: Optional<string>\r\n  },\r\n  recycleStoriesList?: boolean,\r\n  closeOnLastSlideByTimer?: boolean,\r\n};\r\n\r\nconst StoryReaderOptionsDefault: StoryReaderOptions = {\r\n  closeButtonPosition: StoryReaderCloseButtonPosition.RIGHT,\r\n  scrollStyle: StoryReaderSwipeStyle.FLAT,\r\n  loader: {\r\n    default: {\r\n      color: null,\r\n      accentColor: null,\r\n    },\r\n    custom: null\r\n  },\r\n  recycleStoriesList: false,\r\n  closeOnLastSlideByTimer: true\r\n};\r\n\r\nexport {StoryReaderOptionsDefault};","import {Optional, Dict} from \"../index\";\r\n\r\n\r\nexport type StoryFavoriteReaderOptions = {\r\n  title?: {\r\n    content: string;\r\n  }\r\n};\r\n\r\nconst StoryFavoriteReaderOptionsDefault: StoryFavoriteReaderOptions = {\r\n  title: {\r\n    content: 'Сохраненные истории',\r\n  }\r\n};\r\n\r\nexport {StoryFavoriteReaderOptionsDefault};","import {Dict, Optional} from \"../index\";\r\n\r\n\r\nexport enum GoodsWidgetRenderingType {\r\n  DEFAULT = 'default',\r\n  CUSTOM_CARD = 'customCard',\r\n  CUSTOM_WIDGET = 'customWidget'\r\n}\r\n\r\nexport type GoodsWidgetOptions = {\r\n  goodsWidgetRenderingType: GoodsWidgetRenderingType;\r\n  openGoodsWidgetHandler?: (skuList: Array<Dict>) => Promise<Array<Dict>>;\r\n  // требуется если тип GoodsWidgetRenderingType.CUSTOM_CARD - описать это в ts\r\n  getCardHtml?: (item: Dict, index: number) => string;\r\n  // требуется для всех кроме custom widget\r\n  itemClickHandler?: (item: Dict) => void;\r\n\r\n  loader?: {\r\n    default: {\r\n      color: Optional<string>,\r\n      accentColor: Optional<string>,\r\n    },\r\n    custom: Optional<string>\r\n  };\r\n\r\n\r\n\r\n};\r\n\r\nconst GoodsWidgetOptionsDefault: GoodsWidgetOptions = {\r\n  goodsWidgetRenderingType: GoodsWidgetRenderingType.DEFAULT,\r\n  loader: {\r\n    default: {\r\n      color: null,\r\n      accentColor: null,\r\n    },\r\n    custom: null\r\n  },\r\n};\r\n\r\nexport {GoodsWidgetOptionsDefault};","import {AppearanceCommonOptions, AppearanceCommonOptionsDefault} from \"./appearanceCommon.h\";\nimport {StoriesListOptions, StoriesListOptionsDefault} from \"../widget-stories-list/index.h\";\nimport {StoryReaderOptions, StoryReaderOptionsDefault} from \"./types/storyManager/storyReader\";\nimport {StoryFavoriteReaderOptions, StoryFavoriteReaderOptionsDefault} from \"./types/storyManager/storyFavoriteReader\";\n\nimport {GoodsWidgetOptions, GoodsWidgetOptionsDefault} from \"./types/storyManager/goodsWidget\";\nimport {mergeObjects} from \"../helpers/mergeObjects\";\n\nexport class AppearanceManager {\n  constructor() {\n  }\n\n  private _commonOptions: AppearanceCommonOptions = AppearanceCommonOptionsDefault;\n\n  public setCommonOptions(options: AppearanceCommonOptions): AppearanceManager {\n    // + fonts\n    this._commonOptions = mergeObjects(this._commonOptions, options);\n    return this;\n  }\n\n  public get commonOptions(): AppearanceCommonOptions {\n    return this._commonOptions;\n  }\n\n  private _storiesListOptions: StoriesListOptions = StoriesListOptionsDefault;\n\n  public setStoriesListOptions(options: StoriesListOptions): AppearanceManager {\n    // validator\n    this._storiesListOptions = mergeObjects(this._storiesListOptions, options);\n    return this;\n  }\n\n  public get storiesListOptions(): StoriesListOptions {\n    return this._storiesListOptions;\n  }\n\n  private _storyReaderOptions: StoryReaderOptions = StoryReaderOptionsDefault;\n\n  public setStoryReaderOptions(options: StoryReaderOptions): AppearanceManager {\n    // + icons overload\n\n    this._storyReaderOptions = mergeObjects(this._storyReaderOptions, options);\n    return this;\n  }\n\n  public get storyReaderOptions(): StoryReaderOptions {\n    return this._storyReaderOptions;\n  }\n\n  private _storyFavoriteReaderOptions: StoryFavoriteReaderOptions = StoryFavoriteReaderOptionsDefault;\n\n  public setStoryFavoriteReaderOptions(options: StoryFavoriteReaderOptions): AppearanceManager {\n    this._storyFavoriteReaderOptions = mergeObjects(this._storyFavoriteReaderOptions, options);\n    return this;\n  }\n\n  public get storyFavoriteReaderOptions(): StoryFavoriteReaderOptions {\n    return this._storyFavoriteReaderOptions;\n  }\n\n  private _goodsWidgetOptions: GoodsWidgetOptions = GoodsWidgetOptionsDefault;\n\n  public setGoodsWidgetOptions(options: GoodsWidgetOptions): AppearanceManager {\n    this._goodsWidgetOptions = mergeObjects(this._goodsWidgetOptions, options);\n    return this;\n  }\n\n  public get goodsWidgetOptions(): GoodsWidgetOptions {\n    return this._goodsWidgetOptions;\n  }\n\n}\n","function e(e){i.store(e)||h('expect useStore argument to be a store');let t=e.getState(),n=f.useReducer((e=>e+1),0)[1],r=f.useRef({store:e,value:t,pending:0});return k((()=>{let t=e.updates.watch((e=>{let t=r.current;t.pending||(t.value=e,t.pending=1,n(),t.pending=0)})),o=e.getState(),u=r.current;return u.store===e&&u.value!==o&&(u.value=o,u.pending=1,n(),u.pending=0),u.store=e,t}),[e]),t}function t(t,n){let r,o,u,s;n?(r=n,u=t,s=[]):(r=t.fn,u=t.store,s=t.keys,o=t.updateFilter),i.store(u)||h('useStoreMap expects a store'),Array.isArray(s)||h('useStoreMap expects an array as keys'),'function'!=typeof r&&h('useStoreMap expects a function');let a=f.useMemo((()=>p(r(u.getState(),s),{updateFilter:o}).on(u,((e,t)=>r(t,s)))),s),l=e(a);return k((()=>()=>{a.off(u),m(a,{deep:1})}),s),l}function n(e,t){return t.displayName=e,t}function r(t,r){function o(t){let n=f.useRef(t),o=e(u);k((()=>(a({props:n.current,state:u.getState()}),()=>{l({props:n.current,state:u.getState()})})),[]);let s=r(t,o);return n.current=t,s}let u;i.store(t)?u=t:'object'==typeof t&&null!==t?u=y(t):h('shape should be a store or object with stores');let s='Unknown';u&&u.shortName&&(s=u.shortName);let a=d(),l=d();return o.mounted=a,o.unmounted=l,n(`${s}.View`,o)}function o(e){return r(e,(({children:e},t)=>e(t)))}function u(r,o){let u,s,a=[];'object'==typeof o&&null!==o?(o.keys&&(a=o.keys),u=o.fn,o.getKey&&(s=o.getKey)):u=o,i.store(r)||h('expect useList first argument to be a store'),'function'!=typeof u&&h(\"expect useList's renderItem to be a function\"),Array.isArray(a)||h(\"expect useList's keys to be an array\");let l=f.useMemo((()=>{let e=n(`${r.shortName||'Unknown'}.Item`,(e=>{let{index:n,keys:o,keyVal:u,value:s}=e;if(c.current[1])return c.current[0](s,u);let a=t({store:r,keys:[n,...o],fn:(e,t)=>e[t[0]]});return c.current[0](a,n)}));return f.memo(e)}),[r,!!s]),c=f.useRef([u,s]);c.current=[u,s];let p=f.useMemo((()=>a),a);if(s)return e(r).map((e=>{let t=c.current[1](e);return f.createElement(l,{keyVal:t,key:t,keys:p,value:e})}));{let e=t({store:r,keys:[r],fn:e=>e.length});return Array.from({length:e},((e,t)=>f.createElement(l,{index:t,key:t,keys:p})))}}function s(t,r){return n(`Connect(${r.displayName||r.name||'Unknown'})`,(n=>f.createElement(r,Object.assign({},n,e(t)))))}function a(e,t={}){let n=f.useRef(null);k((()=>(e.open(n.current),()=>e.close(n.current))),[e]),((e,t)=>{if(e===t)return 1;if('object'==typeof e&&null!==e&&'object'==typeof t&&null!==t){let n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return 0;for(let r=0;r<n.length;r++){let o=n[r];if(e[o]!==t[o])return 0}return 1}return 0})(n.current,t)||(n.current=t,e.set(t))}function l(e=\"gate\",t={}){let r;return'object'==typeof e&&null!==e&&('defaultState'in e&&(t=e.defaultState),e.domain&&(r=e.domain),e=e.name),(({name:e=\"gate\",domain:t,defaultState:r,hook:o})=>{function u(e){return o(u,e),null}let s=`${t?`${t.compositeName.fullName}/`:''}${e}`,a=d(`${s}.set`),l=d(`${s}.open`),c=d(`${s}.close`),f=p(Boolean(0),{name:`${s}.status`}).on(l,(()=>Boolean(1))).on(c,(()=>Boolean(0))),i=p(r,{name:`${s}.state`}).on(a,((e,t)=>t)).reset(c);if(t){let{hooks:e}=t;g({target:[e.store,e.store,e.event,e.event,e.event],params:[f,i,l,c,a]})}return u.open=l,u.close=c,u.status=f,u.state=i,u.set=a,n(`Gate:${s}`,u)})({name:e,domain:r,defaultState:t,hook:a})}function c(e){return e}import f from'react';import{is as i,createStore as p,clearNode as m,combine as y,createEvent as d,launch as g}from'effector/effector.mjs';let k='undefined'!=typeof window?f.useLayoutEffect:f.useEffect,h=e=>{throw Error(e)},b=(t,r,o)=>n(`${t.shortName||'Unknown'}.ContextComponent`,(n=>{let u=f.useContext(r),s=e(t);return o(n,s,u)})),S=e=>t=>{let n=e;return'function'!=typeof e&&(n=t,t=e),s(t,n)};export{S as connect,r as createComponent,b as createContextComponent,l as createGate,s as createReactState,o as createStoreConsumer,c as useEvent,a as useGate,u as useList,e as useStore,t as useStoreMap};\n//# sourceMappingURL=effector-react.mjs.map\n","import {createEvent, createStore} from \"effector\";\nimport {useRef} from \"react\";\nimport {StoryManager} from \"./StoryManager\";\nimport {AppearanceManager} from \"../story-manager/AppearanceManager\";\nimport {useStore} from \"effector-react\";\nimport {Option} from \"../../global.h\";\n\nconst willMountChanged = createEvent<boolean>();\nconst $willMount = createStore(true).on(willMountChanged, (state, payload) => payload);\n// hook\nexport const useBeforeFirstRender = (effect: () => void, global = false) => {\n  if (global) {\n    if ($willMount.getState() === true) {\n      effect();\n      willMountChanged(false);\n    }\n  } else {\n    const willMount = useRef(true);\n\n    if (willMount.current) {\n      effect();\n      willMount.current = false;\n    }}\n};\n\ntype Managers = {storyManager: Option<unknown>, appearanceManager: Option<unknown>};\nconst managersCreated = createEvent<Managers>();\nconst $managers = createStore<Managers>(\n  {storyManager: null, appearanceManager: null}\n).on(managersCreated, (state, payload) => payload);\n\nexport const useIas = (createStoryManager: () => typeof StoryManager, createAppearanceManager: () => typeof AppearanceManager) => {\n  useBeforeFirstRender(() => {\n    managersCreated({\n      storyManager: createStoryManager(),\n      appearanceManager: createAppearanceManager()\n    });\n  }, true);\n\n  // return () => {\n  //   // @ts-ignore\n  //   storyManager.destructor();\n  // };\n  return useStore($managers);\n};"],"names":["StoriesList","storyManager","appearanceManager","widgetStoriesList","setWidgetStoriesList","useState","viewRef","useRef","rpcBind","setRpcBind","useEffect","createWidgetStoriesList","current","console","log","createRpcServer","widgetStoriesListContainerOptions","containerOptions","widgetStoriesListviewOptions","viewOptions","React","View","WebView","nativeConfig","props","webContentsDebuggingEnabled","allowsInlineMediaPlayback","scalesPageToFit","originWhitelist","onMessage","e","ref","StoryReader","widgetStoryReader","setWidgetStoryReader","needFirstRender","setNeedFirstRender","createWidgetStoryReader","destructor","SafeAreaView","style","styles","container","backgroundColor","StatusBar","barStyle","t","r","a","V","J","B","Array","isArray","n","length","node","from","source","parent","to","target","o","child","s","scope","l","meta","i","family","f","type","regional","c","u","Fe","p","links","d","owners","m","h","push","Re","g","id","Y","seq","next","reg","ye","ke","Ce","Ae","Se","Be","He","params","defer","page","stack","Ne","Ee","ge","Ge","isRoot","currentPage","forkPage","isWatch","Ue","$e","idx","fail","data","barrierID","fullID","priority","Te","has","add","ze","delete","store","I","Ke","pe","value","Le","Qe","op","E","compositeName","fullName","toString","template","xe","Je","create","graphite","ht","find","watch","Z","ut","map","name","fn","Ye","yt","$","filter","kt","le","he","filterMap","se","oe","defined","prepend","shortName","je","upward","mt","off","qe","set","lt","bt","ue","gt","after","plain","subscribers","Map","updates","defaultState","stateRef","getState","setState","nodeMap","reset","on","get","firstState","config","strict","be","before","tt","loader","unshift","of","defaultConfig","updateFilter","state","changed","ne","fe","dt","handler","getType","onCopy","unit","kind","use","finally","done","named","status","result","error","doneData","failData","getHandler","getCurrent","ie","req","St","ok","anyway","then","fx","runner","rs","rj","Promise","catch","Ve","inFlight","y","pending","et","Set","history","domains","stores","effects","events","hooks","event","effect","domain","onCreateEvent","xt","onCreateEffect","onCreateStore","onCreateDomain","createEvent","createEffect","createDomain","createStore","k","ct","b","v","Nt","forEach","clock","greedy","sid","Ze","slice","W","vt","wt","nativeTemplate","ft","targetTemplate","ae","me","sample","closure","de","isObject","rng","getRandomValues","crypto","bind","msCrypto","Error","rnds8","validate","uuid","REGEX","test","v4","options","buf","offset","rnds","random","arr","arguments","undefined","byteToHex","toLowerCase","TypeError","stringify","isNil","mergeObjects","obj1","obj2","trimStartSlash","str","replace","async","getRequestConfig","method","url","expand","completeDeviceData","getDeviceData","isEmpty","obj","Object","includes","constructor","entries","listType","compositeSessionIdRef","customTags","STORY_LIST_TYPE","onboarding","configForListRequest","storySlidesGetRequestConfig","allFields","join","fields","session_id","ids","replaceAll","val","match","replacement","String","RegExp","escapeRegExp","isFunction","func","isString","valueOf","getBlobURL","code","blob","Blob","URL","createObjectURL","worker","onmessage","message","MessageType","RESPONSE","reqMap","MessageStatus","SUCCESS","raw","handleFxResponse","REQUEST","fxMap","sendMessage","serialized","ERROR","handleFx","fxReceiverDomain","fxSenderDomain","Defer","createDuplex","clientFxDomain","serverFxDomain","StyleSheet","flex","justifyContent","alignItems","position","width","height","STORY_READER_WINDOW_REFERER","StoriesEvents","_","Symbol","observable","M","z","T","H","G","U","__proto__","K","L","Q","X","ee","te","hasRef","re","ve","we","Oe","sidRoot","De","_e","Ie","Me","first","last","size","We","Xe","rt","indexOf","splice","at","nt","pop","ot","clear","st","deep","ownerSet","unsubscribe","pt","loc","path","concat","unitId","thru","subscribe","isCombine","key","clone","field","defaultShape","qt","$storyManagerConfig","apiKey","isSandbox","storyManagerConfigChanged","storyManagerConfigTagsChanged","tags","storyManagerConfigUserIdChanged","userId","storyManagerConfigPlaceholdersChanged","placeholders","storyManagerConfigLangChanged","lang","storyManagerConfigIsSandboxChanged","storyManagerConfigApiKeyChanged","$configDeviceId","configDeviceIdChanged","forward","$placeholders","sdkPlaceholdersChanged","createApi","addDefaultPlaceholders","_placeholders","item","Utility","cb","opt_timeout","called","setTimeout","formData","previousKey","keys","this","convertModelToFormData","append","Uint8Array","substr","baseURL","APIInstance","requestInterceptors","interceptors","request","interceptor","search","headers","body","JSON","response","fetch","credentials","json","headersRaw","fromEntries","statusText","Authorization","$session","_$session$getState","session","_$session$getState$se","uuidV4","process","env","BUILD_VERSION","expire_in","server_timestamp","content_base_url","user_key","share","is_allow_profiling","cache","fetchSessionFx","sessionChanged","sessionThumbViewsChanged","payload","API","post","os_name","window","isIos","Android","configData","user_id","features","StoryManager","getInstance","getDeviceInfo","$stories","$storiesIds","$storiesDefault","$storiesFavorite","$storiesOnboarding","default","favorite","is_opened","fetchStoriesFx","storyCheckLocalIsOpened","story","userKey","localStorageGetArray","$storiesIdsWithoutLoadedSlides","items","slidesLoaded","storyItemFavoriteChanged","storyItemLikeChanged","storyItemIsOpenedChanged","models","like","_$storyManagerConfig$","$storyContext","fetchStoryContextFx","storyContextChanged","context","fetchSessionAndStoriesCompositeFx","defaultList","onboardingList","favoriteList","onboardingTags","compositeRequest","getCompositeSubRequestDataFromRequestConfig","sessionGetRequestConfig","storyGetRequestConfig","success","compositeResponse","qs","replacePlaceholders","placeholdersKey","hasOwnProperty","processStories","list","title","need_placeholders","_list$find","storiesListItemsAdded","storyList","storiesListIdsChanged","_list$find2","_list$find3","_list$find4","fetchStoriesSlidesCompositeFx","isStoryModel","x","fetchStoriesContextAndStorySlidesCompositeFx","storyContextGetRequestConfig","_data$i","assign","slides_html","_data$i3","_data$i3$body","_data$i4","_data$i4$body","slides_duration","_data$i5","_data$i5$body","_list$result$find","fetchSessionAndStoryDataCompositeFx","_$session$getState2","_$session$getState2$s","SharePageEvents","sessionModel","_list$find5","_list$result$find2","_list$find6","newState","_data","GoodsWidget","_StoryFavorite","getStoryListByType","getFontResources","_showStory","storyReaderInstance","resp","_resp$find","_resp$find$body","openReaderData","windowReferer","storyContext","hasShare","openReader","EventEmitter","callbacks","_callbacks","mountSelector","storyListWidget","needLoader","instance","_loadStoriesList","_appearanceManager","storyListInstance","_storyReaderInstance","storyReaderInstancePromise","storyReaderInstancePromiseResolver","_goodsWidgetInstance","_storyReaderNeedFirstRender","_storyReaderDetachComponent","_storyReaderWidgetLoaded","completeInitStoryReader","storyReaderWidget","_storyFavoriteReaderInstance","storyFavoriteReaderInstancePromise","_loadedStoriesLength","defaultListLength","favoriteListLength","needFavorite","commonOptions","hasFavorite","_storiesListWidgetLoaded","storiesListOptions","setStories","getStoryFavoriteReaderInstance","fontResources","setFonts","setCallbacks","handleClickOnStoryDeepLink","navigator","FormData","sendBeacon","APISendBeacon","createFunctionWithTimeout","isDeeplink","handleStoryLinkClick","open","handleClickOnStory","handleFlushThumbViews","handleClickOnStoryInternal","SharePage","storyId","_showSharePage","_ref","closeGoodsWidget","closeReader","sharePageOptions","sharePage","emit","START_LOADING","handleStartLoading","initStoryReader","closeOnLastSlideByTimer","recycleStoriesList","handleStoryReaderClose","listenerCount","CLOSE_STORY_READER","location","protocol","host","END_LOADING","handleStopLoading","warn","storyLinkClickHandler","callback","openGoodsWidgetHandler","setTags","getTags","setUserId","setLang","setPlaceholders","setIsSandbox","Boolean","setApiKey","storyReaderNeedFirstRender","storyReaderDetachComponent","resolve","reject","storyContextExists","getStoryReaderInstance","fonts","overrideStoryReaderOptions","_this$storyListInstan","onStoryOpened","localStorageSetArray","rpcCb","requestId","err","CLICK_ON_STORY","cbPayload","src","srcRef","once","storyFavoriteReaderInstance","init","storyFavoriteReaderOptions","focus","openStoryReader","closeStoryReader","onboardingStories","close","BlobContentType","Events","Widget","loaderContainer","_loaderContainer","widgetId","loading","enabled","startLoader","imgResource","isSecure","isSecureContext","checkUrlProtocol","BASE_URL","background","stopLoader","getGeneratedPageURL","html","css","js","cssTag","jsTag","CSS","JS","htmlVariant","HTML","srcdoc","getWidgetDocument","widgetParams","destroy","objId","rpc","RPC","innerHTML","count","IAS_OLD","version","MD5","j","q","w","charCodeAt","charAt","fromCharCode","A","extend","overwrite","_protocol","_base_domain","xdConnectionCallbacks","_apiKey","XDM","_domain","_path","xdReady","Observer","_rootId","Util","_session","main","api","login","proxy","_nameTransportPath","toServerFxDomain","toClientFxDomain","rpcDomains","RpcMessage","RpcMessageOnServer","widgetLoaded","clickOnStoryInternalEvent","flushThumbViewsEvent","clickOnStoryEvent","clickOnStoryDeepLinkEvent","nextID","WebViewWorkerServer","webview","_destructor","onMessageCb","messageListener","nativeEvent","parse","postMessage","arg","WidgetStoriesList","frameName","_this$callbacks","_this$callbacks3","_this$callbacks5","_this$callbacks7","widgetSrcFile","jsResourceGlobal","widgetEntrypoint","cssResourceGlobal","allowTransparency","overflowTouch","layout","pageUrl","startHeight","card","topPadding","bottomPadding","bottomMargin","createView","document","querySelector","genKey","Math","ceil","mountView","attrs","div","createElement","frame","firstChild","self","frameBorder","insertBefore","storiesHeight","storiesLayoutHeight","storiesBackgroundColor","storiesListTopPadding","storiesListBottomPadding","storiesListBottomMargin","storiesTitle","content","extraCss","extraJs","defaults","maxWidth","minWidth","scrolling","hidden","parseFloat","parseInt","cssWidth","max","min","overflow","iframeOptions","allowtransparency","baseUrl","functions","no_finish_loading","_init","jsResource","funcs","onDone","iter","super","iframe","_this$callbacks9","_this$callbacks11","_this$callbacks13","_this$callbacks15","callMethod","syncStoreHandle","StoryReaderCloseButtonPosition","StoryReaderSwipeStyle","StoryReaderOptionsDefault","closeButtonPosition","RIGHT","scrollStyle","FLAT","color","accentColor","custom","AppearanceCommonOptionsDefault","hasLike","onOpenReader","StoriesListCardViewVariant","StoriesListEvents","onReaderOpened","onReaderClosed","WidgetStoryReader","appearanceManagerGetter","storyReaderOptions","appearanceCommon","left","right","top","AbstractStoryManager","widget","detachComponent","device_id","getUniqueId","platform","getSystemName","jsonValue","AsyncStorage","getItem","setItem","localStorageGet","localStorageSet","setHidden","StoriesListOptionsDefault","font","marginBottom","padding","gap","variant","CIRCLE","border","radius","boxShadow","opacity","mask","opened","favoriteCard","sidePadding","navigation","showControls","controlsSize","controlsBackgroundColor","controlsColor","StoryFavoriteReaderOptionsDefault","GoodsWidgetRenderingType","GoodsWidgetOptionsDefault","goodsWidgetRenderingType","DEFAULT","AppearanceManager","_commonOptions","_storiesListOptions","_storyReaderOptions","_storyFavoriteReaderOptions","_goodsWidgetOptions","setCommonOptions","setStoriesListOptions","setStoryReaderOptions","setStoryFavoriteReaderOptions","setGoodsWidgetOptions","goodsWidgetOptions","useLayoutEffect","willMountChanged","$willMount","managersCreated","$managers","useIas","createStoryManager","createAppearanceManager","global","willMount","useBeforeFirstRender","useReducer","useStore"],"mappings":"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"}